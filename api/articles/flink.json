{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"flink","date":"2022-04-19T02:46:59.258Z","updated":"2022-04-21T08:34:40.660Z","comments":true,"path":"api/articles/flink.json","keywords":null,"cover":null,"content":"<hr>\n<hr>\n<p>对于某一步不想要合并</p>\n<p>不应该理解为按顺序操作，而应该理解为包装了一个操作，只要有数据过来，就会执行的操作</p>\n<p>自定义source</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">//定义：</span>\n<span class=\"token comment\">//实现自定义</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySource</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SourceFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SensorReading</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> isRunning <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token annotation punctuation\">@Override</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SourceContext</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SensorReading</span><span class=\"token punctuation\">></span></span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token class-name\">Random</span> random <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 设置10个传感器的初始温度</span>\n            <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">></span></span> sensorTempMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                sensorTempMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sensor_\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60</span> <span class=\"token operator\">+</span> random<span class=\"token punctuation\">.</span><span class=\"token function\">nextGaussian</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//下一个高斯随机数，按照高斯分布</span>\n            <span class=\"token punctuation\">&#125;</span>\n\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>isRunning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> id <span class=\"token operator\">:</span> sensorTempMap<span class=\"token punctuation\">.</span><span class=\"token function\">keySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token keyword\">double</span> newTemp <span class=\"token operator\">=</span> sensorTempMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> random<span class=\"token punctuation\">.</span><span class=\"token function\">nextGaussian</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    sensorTempMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> newTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SensorReading</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> newTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">&#125;</span>\n                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token annotation punctuation\">@Override</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            isRunning <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">//使用</span>\n<span class=\"token class-name\">DataStream</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SensorReading</span><span class=\"token punctuation\">></span></span> dataStream <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">addSource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MySource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n\n<h2 id=\"5-3-Transform\"><a href=\"#5-3-Transform\" class=\"headerlink\" title=\"5.3 Transform\"></a>5.3 Transform</h2><p>[遍历数据]</p>\n<h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h3><h3 id=\"flatmap\"><a href=\"#flatmap\" class=\"headerlink\" title=\"flatmap\"></a>flatmap</h3><h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h3><p>[聚合操作相关]</p>\n<h3 id=\"keyBy\"><a href=\"#keyBy\" class=\"headerlink\" title=\"keyBy\"></a>keyBy</h3><p>能保证同一个key的都在同一个分区，但不能同一个分区只有一个key</p>\n<h3 id=\"滚动聚合算子-rolling-aggregation\"><a href=\"#滚动聚合算子-rolling-aggregation\" class=\"headerlink\" title=\"滚动聚合算子 rolling aggregation\"></a>滚动聚合算子 rolling aggregation</h3><p>sum()</p>\n<p>min()：</p>\n<p>max()</p>\n<p>minBy()：</p>\n<p>maxBy()</p>\n<h3 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h3><p>一般化的聚合</p>\n<h3 id=\"split和select\"><a href=\"#split和select\" class=\"headerlink\" title=\"split和select\"></a>split和select</h3><h3 id=\"connect和map\"><a href=\"#connect和map\" class=\"headerlink\" title=\"connect和map\"></a>connect和map</h3><h3 id=\"map-1\"><a href=\"#map-1\" class=\"headerlink\" title=\"map\"></a>map</h3><h3 id=\"map-2\"><a href=\"#map-2\" class=\"headerlink\" title=\"map\"></a>map</h3>","text":" 对于某一步不想要合并 不应该理解为按顺序操作，而应该理解为包装了一个操作，只要有数据过来，就会执行的操作 自定义source //定义： //实现自定义 public static class MySource implements SourceFunction&lt;Sens...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-3-Transform\"><span class=\"toc-text\">5.3 Transform</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#map\"><span class=\"toc-text\">map</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#flatmap\"><span class=\"toc-text\">flatmap</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#filter\"><span class=\"toc-text\">filter</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#keyBy\"><span class=\"toc-text\">keyBy</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%BB%9A%E5%8A%A8%E8%81%9A%E5%90%88%E7%AE%97%E5%AD%90-rolling-aggregation\"><span class=\"toc-text\">滚动聚合算子 rolling aggregation</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#reduce\"><span class=\"toc-text\">reduce</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#split%E5%92%8Cselect\"><span class=\"toc-text\">split和select</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#connect%E5%92%8Cmap\"><span class=\"toc-text\">connect和map</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#map-1\"><span class=\"toc-text\">map</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#map-2\"><span class=\"toc-text\">map</span></a></li></ol></li></ol>","author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"自动时间同步","uid":"11deef5068a02b0a8c8fc3e163718598","slug":"自动时间同步","date":"2022-04-21T03:46:20.000Z","updated":"2022-04-21T03:46:42.633Z","comments":true,"path":"api/articles/自动时间同步.json","keywords":null,"cover":null,"text":"1、查看当前时区设置，更改到正确的时区，以中国为例 查看时区设置ls -l /etc/localtime 更改时区设置tzselect 2、使用ntpdate与网络时间同步 安装 ntpdate sudo yum install -y ntpdate 使用：ntpdate tim...","link":"","photos":[],"count_time":{"symbolsCount":210,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"小技巧","slug":"小技巧","count":1,"path":"api/tags/小技巧.json"}],"author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"maven安装配置","uid":"29fb3d0ec9f011ab95928547f0ea4133","slug":"maven安装配置","date":"2022-04-17T02:59:20.000Z","updated":"2022-04-17T03:23:00.337Z","comments":true,"path":"api/articles/maven安装配置.json","keywords":null,"cover":null,"text":"&lt;mirror> &lt;id>nexus-aliyun&lt;/id> &lt;mirrorOf>central&lt;/mirrorOf> &lt;name>Nexus aliyun&lt;/name> &lt;url>http://maven.aliyun.com/n...","link":"","photos":[],"count_time":{"symbolsCount":753,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}