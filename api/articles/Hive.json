{"title":"Hive","uid":"00c0454f1d8e3895f071dd0779512fe7","slug":"Hive","date":"2022-03-31T13:03:51.088Z","updated":"2022-04-13T12:58:45.476Z","comments":true,"path":"api/articles/Hive.json","keywords":null,"cover":null,"content":"<p> 尚硅谷大数据技术之Hive</p>\n<h1 id=\"第-1-章-Hive基本概念\"><a href=\"#第-1-章-Hive基本概念\" class=\"headerlink\" title=\"第 1 章 Hive基本概念\"></a>第 1 章 Hive基本概念</h1><h2 id=\"1-1-什么是-Hive\"><a href=\"#1-1-什么是-Hive\" class=\"headerlink\" title=\"1 .1 什么是 Hive\"></a>1 .1 什么是 Hive</h2><h3 id=\"1-）-hive简介\"><a href=\"#1-）-hive简介\" class=\"headerlink\" title=\"1 ） hive简介\"></a>1 ） hive简介</h3><p>Hive：由Facebook开源用于解决海量结构化日志的数据统计工具。</p>\n<p>Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张表，并提供类SQL查询功能。</p>\n<h3 id=\"2-）-Hive本质：将HQL转化成MapReduce程序\"><a href=\"#2-）-Hive本质：将HQL转化成MapReduce程序\" class=\"headerlink\" title=\"2 ） Hive本质：将HQL转化成MapReduce程序\"></a>2 ） Hive本质：将HQL转化成MapReduce程序</h3><h5 id=\"（-1-）Hive处理的数据存储在HDFS\"><a href=\"#（-1-）Hive处理的数据存储在HDFS\" class=\"headerlink\" title=\"（ 1 ）Hive处理的数据存储在HDFS\"></a>（ 1 ）Hive处理的数据存储在HDFS</h5><h5 id=\"（-2-）Hive分析数据底层的实现是MapReduce\"><a href=\"#（-2-）Hive分析数据底层的实现是MapReduce\" class=\"headerlink\" title=\"（ 2 ）Hive分析数据底层的实现是MapReduce\"></a>（ 2 ）Hive分析数据底层的实现是MapReduce</h5><h5 id=\"（-3-）执行程序运行在Yarn上\"><a href=\"#（-3-）执行程序运行在Yarn上\" class=\"headerlink\" title=\"（ 3 ）执行程序运行在Yarn上\"></a>（ 3 ）执行程序运行在Yarn上</h5><h2 id=\"1-2-Hive-的优缺点\"><a href=\"#1-2-Hive-的优缺点\" class=\"headerlink\" title=\"1.2 Hive 的优缺点\"></a>1.2 Hive 的优缺点</h2><h2 id=\"1-2-1-优点\"><a href=\"#1-2-1-优点\" class=\"headerlink\" title=\"1.2.1 优点\"></a>1.2.1 优点</h2><h5 id=\"（-1-）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。\"><a href=\"#（-1-）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。\" class=\"headerlink\" title=\"（ 1 ）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。\"></a>（ 1 ）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。</h5><h5 id=\"—————————————————————————————————————\"><a href=\"#—————————————————————————————————————\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-2-）避免了去写MapReduce，减少开发人员的学习成本。\"><a href=\"#（-2-）避免了去写MapReduce，减少开发人员的学习成本。\" class=\"headerlink\" title=\"（ 2 ）避免了去写MapReduce，减少开发人员的学习成本。\"></a>（ 2 ）避免了去写MapReduce，减少开发人员的学习成本。</h5><h5 id=\"（-3-）Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。\"><a href=\"#（-3-）Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。\" class=\"headerlink\" title=\"（ 3 ）Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。\"></a>（ 3 ）Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。</h5><h5 id=\"（-4-）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较\"><a href=\"#（-4-）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较\" class=\"headerlink\" title=\"（ 4 ）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较\"></a>（ 4 ）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较</h5><h5 id=\"高。\"><a href=\"#高。\" class=\"headerlink\" title=\"高。\"></a>高。</h5><h5 id=\"（-5-）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。\"><a href=\"#（-5-）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。\" class=\"headerlink\" title=\"（ 5 ）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。\"></a>（ 5 ）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</h5><h4 id=\"1-2-2-缺点\"><a href=\"#1-2-2-缺点\" class=\"headerlink\" title=\"1 .2.2 缺点\"></a>1 .2.2 缺点</h4><h5 id=\"1-）-Hive-的-HQL-表达能力有限\"><a href=\"#1-）-Hive-的-HQL-表达能力有限\" class=\"headerlink\" title=\"1 ） Hive 的 HQL 表达能力有限\"></a>1 ） Hive 的 HQL 表达能力有限</h5><h5 id=\"（-1-）迭代式算法无法表达\"><a href=\"#（-1-）迭代式算法无法表达\" class=\"headerlink\" title=\"（ 1 ）迭代式算法无法表达\"></a>（ 1 ）迭代式算法无法表达</h5><h5 id=\"（-2-）数据挖掘方面不擅长，由于MapReduce数据处理流程的限制，效率更高的算法却\"><a href=\"#（-2-）数据挖掘方面不擅长，由于MapReduce数据处理流程的限制，效率更高的算法却\" class=\"headerlink\" title=\"（ 2 ）数据挖掘方面不擅长，由于MapReduce数据处理流程的限制，效率更高的算法却\"></a>（ 2 ）数据挖掘方面不擅长，由于MapReduce数据处理流程的限制，效率更高的算法却</h5><h5 id=\"无法实现。\"><a href=\"#无法实现。\" class=\"headerlink\" title=\"无法实现。\"></a>无法实现。</h5><h5 id=\"2-）-Hive-的效率比较低\"><a href=\"#2-）-Hive-的效率比较低\" class=\"headerlink\" title=\"2 ） Hive 的效率比较低\"></a>2 ） Hive 的效率比较低</h5><h5 id=\"（-1-）Hive自动生成的MapReduce作业，通常情况下不够智能化\"><a href=\"#（-1-）Hive自动生成的MapReduce作业，通常情况下不够智能化\" class=\"headerlink\" title=\"（ 1 ）Hive自动生成的MapReduce作业，通常情况下不够智能化\"></a>（ 1 ）Hive自动生成的MapReduce作业，通常情况下不够智能化</h5><h5 id=\"（-2-）Hive调优比较困难，粒度较粗\"><a href=\"#（-2-）Hive调优比较困难，粒度较粗\" class=\"headerlink\" title=\"（ 2 ）Hive调优比较困难，粒度较粗\"></a>（ 2 ）Hive调优比较困难，粒度较粗</h5><h4 id=\"1-3-Hive-架构原理\"><a href=\"#1-3-Hive-架构原理\" class=\"headerlink\" title=\"1.3 Hive 架构原理\"></a>1.3 Hive 架构原理</h4><h6 id=\"HDFS\"><a href=\"#HDFS\" class=\"headerlink\" title=\"HDFS\"></a>HDFS</h6><h6 id=\"MapReduce\"><a href=\"#MapReduce\" class=\"headerlink\" title=\"MapReduce\"></a>MapReduce</h6><h6 id=\"Meta-store\"><a href=\"#Meta-store\" class=\"headerlink\" title=\"Meta store\"></a>Meta store</h6><h6 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h6><h6 id=\"Parser\"><a href=\"#Parser\" class=\"headerlink\" title=\"Parser\"></a>Parser</h6><h6 id=\"解析器\"><a href=\"#解析器\" class=\"headerlink\" title=\"解析器\"></a>解析器</h6><h6 id=\"Physical\"><a href=\"#Physical\" class=\"headerlink\" title=\"Physical\"></a>Physical</h6><h6 id=\"Plan\"><a href=\"#Plan\" class=\"headerlink\" title=\"Plan\"></a>Plan</h6><h6 id=\"编译器-Execution\"><a href=\"#编译器-Execution\" class=\"headerlink\" title=\"编译器 Execution\"></a>编译器 Execution</h6><h6 id=\"执行器\"><a href=\"#执行器\" class=\"headerlink\" title=\"执行器\"></a>执行器</h6><h6 id=\"Query\"><a href=\"#Query\" class=\"headerlink\" title=\"Query\"></a>Query</h6><h6 id=\"Optimizer\"><a href=\"#Optimizer\" class=\"headerlink\" title=\"Optimizer\"></a>Optimizer</h6><h6 id=\"优化器\"><a href=\"#优化器\" class=\"headerlink\" title=\"优化器\"></a>优化器</h6><h6 id=\"Driver\"><a href=\"#Driver\" class=\"headerlink\" title=\"Driver\"></a>Driver</h6><h6 id=\"CLI-JDBC\"><a href=\"#CLI-JDBC\" class=\"headerlink\" title=\"CLI JDBC\"></a>CLI JDBC</h6><h6 id=\"Client\"><a href=\"#Client\" class=\"headerlink\" title=\"Client\"></a>Client</h6><h6 id=\"Hive-架构\"><a href=\"#Hive-架构\" class=\"headerlink\" title=\"Hive 架构\"></a>Hive 架构</h6><h5 id=\"1-）用户接口：-Client\"><a href=\"#1-）用户接口：-Client\" class=\"headerlink\" title=\"1 ）用户接口： Client\"></a>1 ）用户接口： Client</h5><h5 id=\"CLI（command-line-interface）、JDBC-x2F-ODBC-jdbc访问hive-、WEBUI（浏览器访问hive）\"><a href=\"#CLI（command-line-interface）、JDBC-x2F-ODBC-jdbc访问hive-、WEBUI（浏览器访问hive）\" class=\"headerlink\" title=\"CLI（command-line interface）、JDBC&#x2F;ODBC(jdbc访问hive)、WEBUI（浏览器访问hive）\"></a>CLI（command-line interface）、JDBC&#x2F;ODBC(jdbc访问hive)、WEBUI（浏览器访问hive）</h5><h5 id=\"—————————————————————————————————————-1\"><a href=\"#—————————————————————————————————————-1\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"2-）元数据：-Metastore\"><a href=\"#2-）元数据：-Metastore\" class=\"headerlink\" title=\"2 ）元数据： Metastore\"></a>2 ）元数据： Metastore</h5><h5 id=\"元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列-x2F-分区字段、\"><a href=\"#元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列-x2F-分区字段、\" class=\"headerlink\" title=\"元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列&#x2F;分区字段、\"></a>元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列&#x2F;分区字段、</h5><h5 id=\"表的类型（是否是外部表）、表的数据所在目录等；\"><a href=\"#表的类型（是否是外部表）、表的数据所在目录等；\" class=\"headerlink\" title=\"表的类型（是否是外部表）、表的数据所在目录等；\"></a>表的类型（是否是外部表）、表的数据所在目录等；</h5><h5 id=\"默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore\"><a href=\"#默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore\" class=\"headerlink\" title=\"默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore\"></a>默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore</h5><h5 id=\"3-）-Hadoop\"><a href=\"#3-）-Hadoop\" class=\"headerlink\" title=\"3 ） Hadoop\"></a>3 ） Hadoop</h5><h5 id=\"使用HDFS进行存储，使用MapReduce进行计算。\"><a href=\"#使用HDFS进行存储，使用MapReduce进行计算。\" class=\"headerlink\" title=\"使用HDFS进行存储，使用MapReduce进行计算。\"></a>使用HDFS进行存储，使用MapReduce进行计算。</h5><h5 id=\"4-）驱动器：-Driver\"><a href=\"#4-）驱动器：-Driver\" class=\"headerlink\" title=\"4 ）驱动器： Driver\"></a>4 ）驱动器： Driver</h5><h5 id=\"（-1-）解析器（SQL-Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第\"><a href=\"#（-1-）解析器（SQL-Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第\" class=\"headerlink\" title=\"（ 1 ）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第\"></a>（ 1 ）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第</h5><h5 id=\"三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL\"><a href=\"#三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL\" class=\"headerlink\" title=\"三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL\"></a>三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL</h5><h5 id=\"语义是否有误。\"><a href=\"#语义是否有误。\" class=\"headerlink\" title=\"语义是否有误。\"></a>语义是否有误。</h5><h5 id=\"（-2-）编译器（Physical-Plan）：将AST编译生成逻辑执行计划。\"><a href=\"#（-2-）编译器（Physical-Plan）：将AST编译生成逻辑执行计划。\" class=\"headerlink\" title=\"（ 2 ）编译器（Physical Plan）：将AST编译生成逻辑执行计划。\"></a>（ 2 ）编译器（Physical Plan）：将AST编译生成逻辑执行计划。</h5><h5 id=\"（-3-）优化器（Query-Optimizer）：对逻辑执行计划进行优化。\"><a href=\"#（-3-）优化器（Query-Optimizer）：对逻辑执行计划进行优化。\" class=\"headerlink\" title=\"（ 3 ）优化器（Query Optimizer）：对逻辑执行计划进行优化。\"></a>（ 3 ）优化器（Query Optimizer）：对逻辑执行计划进行优化。</h5><h5 id=\"（-4-）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来\"><a href=\"#（-4-）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来\" class=\"headerlink\" title=\"（ 4 ）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来\"></a>（ 4 ）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来</h5><h5 id=\"说，就是MR-x2F-Spark。\"><a href=\"#说，就是MR-x2F-Spark。\" class=\"headerlink\" title=\"说，就是MR&#x2F;Spark。\"></a>说，就是MR&#x2F;Spark。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Hive的运行机制<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">用户创建table\ncreate\ntable ...<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">用户针对数据表\n进行数据分析：\nselect ...from\ntable where ...<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">用户只需要创建表，将\n表与数据建立映射关系，\n编写SQL分析语句<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Hive中的\n元数据库\nMetastore着表对应文件的中记录 MetaStore\npath<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">解析器查询\n输入文件的\npath<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Hive中的解析器<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">将SQL语言解析成对应的\nMapReduce程序，并生成\n相应的jar包<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">MapReduce体系架构 result<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Hadoop jar xxx.jar&#x2F;path<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">数据仓库<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">数据文件<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">通过映射\n关系向表\n中导数据<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">hdfs<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"Hive通过给用户提供的一系列交互接口，接收到用户的指令-SQL-，使用自己的Driver，\"><a href=\"#Hive通过给用户提供的一系列交互接口，接收到用户的指令-SQL-，使用自己的Driver，\" class=\"headerlink\" title=\"Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，\"></a>Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，</h5><h5 id=\"结合元数据-MetaStore-，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将\"><a href=\"#结合元数据-MetaStore-，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将\" class=\"headerlink\" title=\"结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将\"></a>结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将</h5><h5 id=\"执行返回的结果输出到用户交互接口。\"><a href=\"#执行返回的结果输出到用户交互接口。\" class=\"headerlink\" title=\"执行返回的结果输出到用户交互接口。\"></a>执行返回的结果输出到用户交互接口。</h5><h4 id=\"1-4-Hive-和数据库比较\"><a href=\"#1-4-Hive-和数据库比较\" class=\"headerlink\" title=\"1.4 Hive 和数据库比较\"></a>1.4 Hive 和数据库比较</h4><h5 id=\"由于-Hive-采用了类似SQL-的查询语言-HQL-Hive-Query-Language-，因此很容易将-Hive-理\"><a href=\"#由于-Hive-采用了类似SQL-的查询语言-HQL-Hive-Query-Language-，因此很容易将-Hive-理\" class=\"headerlink\" title=\"由于 Hive 采用了类似SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理\"></a>由于 Hive 采用了类似SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理</h5><h5 id=\"—————————————————————————————————————-2\"><a href=\"#—————————————————————————————————————-2\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"解为数据库。其实从结构上来看，Hive-和数据库除了拥有类似的查询语言，再无类似之处。\"><a href=\"#解为数据库。其实从结构上来看，Hive-和数据库除了拥有类似的查询语言，再无类似之处。\" class=\"headerlink\" title=\"解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。\"></a>解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。</h5><h5 id=\"本文将从多个方面来阐述-Hive-和数据库的差异。数据库可以用在-Online-的应用中，但是\"><a href=\"#本文将从多个方面来阐述-Hive-和数据库的差异。数据库可以用在-Online-的应用中，但是\" class=\"headerlink\" title=\"本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是\"></a>本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是</h5><h5 id=\"Hive-是为数据仓库而设计的，清楚这一点，有助于从应用角度理解-Hive-的特性。\"><a href=\"#Hive-是为数据仓库而设计的，清楚这一点，有助于从应用角度理解-Hive-的特性。\" class=\"headerlink\" title=\"Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。\"></a>Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</h5><h4 id=\"1-4-1-查询语言\"><a href=\"#1-4-1-查询语言\" class=\"headerlink\" title=\"1 .4.1 查询语言\"></a>1 .4.1 查询语言</h4><h5 id=\"由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查\"><a href=\"#由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查\" class=\"headerlink\" title=\"由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查\"></a>由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查</h5><h5 id=\"询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。\"><a href=\"#询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。\" class=\"headerlink\" title=\"询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。\"></a>询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。</h5><h4 id=\"1-4-2-数据更新\"><a href=\"#1-4-2-数据更新\" class=\"headerlink\" title=\"1 .4.2 数据更新\"></a>1 .4.2 数据更新</h4><h5 id=\"由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中\"><a href=\"#由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中\" class=\"headerlink\" title=\"由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中\"></a>由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中</h5><h5 id=\"不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需\"><a href=\"#不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需\" class=\"headerlink\" title=\"不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需\"></a>不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需</h5><h5 id=\"要经常进行修改的，因此可以使用-INSERT-INTO-…-VALUES-添加数据，使用-UPDATE-…-SET修\"><a href=\"#要经常进行修改的，因此可以使用-INSERT-INTO-…-VALUES-添加数据，使用-UPDATE-…-SET修\" class=\"headerlink\" title=\"要经常进行修改的，因此可以使用 INSERT INTO … VALUES 添加数据，使用 UPDATE … SET修\"></a>要经常进行修改的，因此可以使用 INSERT INTO … VALUES 添加数据，使用 UPDATE … SET修</h5><h5 id=\"改数据。\"><a href=\"#改数据。\" class=\"headerlink\" title=\"改数据。\"></a>改数据。</h5><h4 id=\"1-4-3-执行延迟\"><a href=\"#1-4-3-执行延迟\" class=\"headerlink\" title=\"1 .4.3 执行延迟\"></a>1 .4.3 执行延迟</h4><h5 id=\"Hive-在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导\"><a href=\"#Hive-在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导\" class=\"headerlink\" title=\"Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导\"></a>Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导</h5><h5 id=\"致-Hive-执行延迟高的因素是-MapReduce框架。由于MapReduce-本身具有较高的延迟，因此\"><a href=\"#致-Hive-执行延迟高的因素是-MapReduce框架。由于MapReduce-本身具有较高的延迟，因此\" class=\"headerlink\" title=\"致 Hive 执行延迟高的因素是 MapReduce框架。由于MapReduce 本身具有较高的延迟，因此\"></a>致 Hive 执行延迟高的因素是 MapReduce框架。由于MapReduce 本身具有较高的延迟，因此</h5><h5 id=\"在利用MapReduce-执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。\"><a href=\"#在利用MapReduce-执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。\" class=\"headerlink\" title=\"在利用MapReduce 执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。\"></a>在利用MapReduce 执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。</h5><h5 id=\"当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，\"><a href=\"#当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，\" class=\"headerlink\" title=\"当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，\"></a>当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，</h5><h5 id=\"Hive的并行计算显然能体现出优势。\"><a href=\"#Hive的并行计算显然能体现出优势。\" class=\"headerlink\" title=\"Hive的并行计算显然能体现出优势。\"></a>Hive的并行计算显然能体现出优势。</h5><h4 id=\"1-4-4-数据规模\"><a href=\"#1-4-4-数据规模\" class=\"headerlink\" title=\"1 .4.4 数据规模\"></a>1 .4.4 数据规模</h4><h5 id=\"由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模\"><a href=\"#由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模\" class=\"headerlink\" title=\"由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模\"></a>由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模</h5><h5 id=\"的数据；对应的，数据库可以支持的数据规模较小。\"><a href=\"#的数据；对应的，数据库可以支持的数据规模较小。\" class=\"headerlink\" title=\"的数据；对应的，数据库可以支持的数据规模较小。\"></a>的数据；对应的，数据库可以支持的数据规模较小。</h5><h1 id=\"第-2-章-Hive安装\"><a href=\"#第-2-章-Hive安装\" class=\"headerlink\" title=\"第 2 章 Hive安装\"></a>第 2 章 Hive安装</h1><h4 id=\"2-1-Hive-安装地址\"><a href=\"#2-1-Hive-安装地址\" class=\"headerlink\" title=\"2.1 Hive 安装地址\"></a>2.1 Hive 安装地址</h4><h5 id=\"1-）-Hive-官网地址\"><a href=\"#1-）-Hive-官网地址\" class=\"headerlink\" title=\"1 ） Hive 官网地址\"></a>1 ） Hive 官网地址</h5><h5 id=\"http-hive-apache-org\"><a href=\"#http-hive-apache-org\" class=\"headerlink\" title=\"http://hive.apache.org/\"></a><a href=\"http://hive.apache.org/\">http://hive.apache.org/</a></h5><h5 id=\"2-）文档查看地址\"><a href=\"#2-）文档查看地址\" class=\"headerlink\" title=\"2 ）文档查看地址\"></a>2 ）文档查看地址</h5><h5 id=\"https-cwiki-apache-org-confluence-display-Hive-GettingStarted\"><a href=\"#https-cwiki-apache-org-confluence-display-Hive-GettingStarted\" class=\"headerlink\" title=\"https://cwiki.apache.org/confluence/display/Hive/GettingStarted\"></a><a href=\"https://cwiki.apache.org/confluence/display/Hive/GettingStarted\">https://cwiki.apache.org/confluence/display/Hive/GettingStarted</a></h5><h5 id=\"3-）下载地址\"><a href=\"#3-）下载地址\" class=\"headerlink\" title=\"3 ）下载地址\"></a>3 ）下载地址</h5><h5 id=\"—————————————————————————————————————-3\"><a href=\"#—————————————————————————————————————-3\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"http-archive-apache-org-dist-hive\"><a href=\"#http-archive-apache-org-dist-hive\" class=\"headerlink\" title=\"http://archive.apache.org/dist/hive/\"></a><a href=\"http://archive.apache.org/dist/hive/\">http://archive.apache.org/dist/hive/</a></h5><h5 id=\"4-）-github-地址\"><a href=\"#4-）-github-地址\" class=\"headerlink\" title=\"4 ） github 地址\"></a>4 ） github 地址</h5><h5 id=\"https-github-com-apache-hive\"><a href=\"#https-github-com-apache-hive\" class=\"headerlink\" title=\"https://github.com/apache/hive\"></a><a href=\"https://github.com/apache/hive\">https://github.com/apache/hive</a></h5><h4 id=\"2-2-Hive-安装部署\"><a href=\"#2-2-Hive-安装部署\" class=\"headerlink\" title=\"2.2 Hive 安装部署\"></a>2.2 Hive 安装部署</h4><h4 id=\"2-2-1-安装-Hive\"><a href=\"#2-2-1-安装-Hive\" class=\"headerlink\" title=\"2 .2.1 安装 Hive\"></a>2 .2.1 安装 Hive</h4><h5 id=\"1-）把-apache-hive-3-1-2-bin-tar-gz-上传到-linux-的-x2F-opt-x2F-software-目录下\"><a href=\"#1-）把-apache-hive-3-1-2-bin-tar-gz-上传到-linux-的-x2F-opt-x2F-software-目录下\" class=\"headerlink\" title=\"1 ）把 apache-hive-3.1.2-bin.tar.gz 上传到 linux 的 &#x2F;opt&#x2F;software 目录下\"></a>1 ）把 apache-hive-3.1.2-bin.tar.gz 上传到 linux 的 &#x2F;opt&#x2F;software 目录下</h5><h5 id=\"2-）解压-apache-hive-3-1-2-bin-tar-gz-到-x2F-opt-x2F-module-x2F-目录下面\"><a href=\"#2-）解压-apache-hive-3-1-2-bin-tar-gz-到-x2F-opt-x2F-module-x2F-目录下面\" class=\"headerlink\" title=\"2 ）解压 apache-hive-3.1.2-bin.tar.gz 到 &#x2F;opt&#x2F;module&#x2F; 目录下面\"></a>2 ）解压 apache-hive-3.1.2-bin.tar.gz 到 &#x2F;opt&#x2F;module&#x2F; 目录下面</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ tar -zxvf &#x2F;opt&#x2F;software&#x2F;apache-hive-3.1.2-\nbin.tar.gz -C &#x2F;opt&#x2F;module&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"3-）修改-apache-hive-3-1-2-bin-tar-gz-的名称为-hive\"><a href=\"#3-）修改-apache-hive-3-1-2-bin-tar-gz-的名称为-hive\" class=\"headerlink\" title=\"3 ）修改 apache-hive-3.1.2-bin.tar.gz 的名称为 hive\"></a>3 ）修改 apache-hive-3.1.2-bin.tar.gz 的名称为 hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ mv &#x2F;opt&#x2F;module&#x2F;apache-hive-3.1.2-bin&#x2F;\n&#x2F;opt&#x2F;module&#x2F;hive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"4-）修改-x2F-etc-x2F-profile-d-x2F-my-env-sh-，添加环境变量\"><a href=\"#4-）修改-x2F-etc-x2F-profile-d-x2F-my-env-sh-，添加环境变量\" class=\"headerlink\" title=\"4 ）修改 &#x2F;etc&#x2F;profile.d&#x2F;my_env.sh ，添加环境变量\"></a>4 ）修改 &#x2F;etc&#x2F;profile.d&#x2F;my_env.sh ，添加环境变量</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ sudo vim &#x2F;etc&#x2F;profile.d&#x2F;my_env.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"5-）添加内容\"><a href=\"#5-）添加内容\" class=\"headerlink\" title=\"5 ）添加内容\"></a>5 ）添加内容</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">#HIVE_HOME\nexport HIVE_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;hive\nexport PATH&#x3D;$PATH:$HIVE_HOME&#x2F;bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"6-）解决日志-Jar-包冲突\"><a href=\"#6-）解决日志-Jar-包冲突\" class=\"headerlink\" title=\"6 ）解决日志 Jar 包冲突\"></a>6 ）解决日志 Jar 包冲突</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ mv $HIVE_HOME&#x2F;lib&#x2F;log4j-slf4j-impl-\n2.10.0.jar $HIVE_HOME&#x2F;lib&#x2F;log4j-slf4j-impl-2.10.0.bak<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"7-）初始化元数据库\"><a href=\"#7-）初始化元数据库\" class=\"headerlink\" title=\"7 ）初始化元数据库\"></a>7 ）初始化元数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;schematool -dbType derby -initSchema<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"2-2-2-启动并使用-Hive\"><a href=\"#2-2-2-启动并使用-Hive\" class=\"headerlink\" title=\"2 .2.2 启动并使用 Hive\"></a>2 .2.2 启动并使用 Hive</h4><h5 id=\"1-）启动-Hive\"><a href=\"#1-）启动-Hive\" class=\"headerlink\" title=\"1 ）启动 Hive\"></a>1 ）启动 Hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）使用-Hive\"><a href=\"#2-）使用-Hive\" class=\"headerlink\" title=\"2 ）使用 Hive\"></a>2 ）使用 Hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show databases;\nhive&gt; show tables;\nhive&gt; create table test(id int);\nhive&gt; insert into test values(1);\nhive&gt; select * from test;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）在-CRT-窗口中开启另一个窗口开启-Hive-，在-x2F-tmp-x2F-atguigu-目录下监控-hive-log-文件\"><a href=\"#3-）在-CRT-窗口中开启另一个窗口开启-Hive-，在-x2F-tmp-x2F-atguigu-目录下监控-hive-log-文件\" class=\"headerlink\" title=\"3 ）在 CRT 窗口中开启另一个窗口开启 Hive ，在 &#x2F;tmp&#x2F;atguigu 目录下监控 hive.log 文件\"></a>3 ）在 CRT 窗口中开启另一个窗口开启 Hive ，在 &#x2F;tmp&#x2F;atguigu 目录下监控 hive.log 文件</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Caused by: ERROR XSDB6: Another instance of Derby may have already booted\nthe database &#x2F;opt&#x2F;module&#x2F;hive&#x2F;metastore_db.\nat\norg.apache.derby.iapi.error.StandardException.newException(Unknown\nSource)\nat\norg.apache.derby.iapi.error.StandardException.newException(Unknown<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-4\"><a href=\"#—————————————————————————————————————-4\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Source)\nat\norg.apache.derby.impl.store.raw.data.BaseDataFileFactory.privGetJBMSLockO\nnDB(Unknown Source)\nat\norg.apache.derby.impl.store.raw.data.BaseDataFileFactory.run(Unknown\nSource)\n...<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"原因在于Hive默认使用的元数据库为derby，开启Hive之后就会占用元数据库，且不与\"><a href=\"#原因在于Hive默认使用的元数据库为derby，开启Hive之后就会占用元数据库，且不与\" class=\"headerlink\" title=\"原因在于Hive默认使用的元数据库为derby，开启Hive之后就会占用元数据库，且不与\"></a>原因在于Hive默认使用的元数据库为derby，开启Hive之后就会占用元数据库，且不与</h5><h5 id=\"其他客户端共享数据，所以我们需要将Hive的元数据地址改为MySQL。\"><a href=\"#其他客户端共享数据，所以我们需要将Hive的元数据地址改为MySQL。\" class=\"headerlink\" title=\"其他客户端共享数据，所以我们需要将Hive的元数据地址改为MySQL。\"></a>其他客户端共享数据，所以我们需要将Hive的元数据地址改为MySQL。</h5><h4 id=\"2-3-MySQL-安装\"><a href=\"#2-3-MySQL-安装\" class=\"headerlink\" title=\"2.3 MySQL 安装\"></a>2.3 MySQL 安装</h4><h5 id=\"1-）检查当前系统是否安装过MySQL\"><a href=\"#1-）检查当前系统是否安装过MySQL\" class=\"headerlink\" title=\"1 ）检查当前系统是否安装过MySQL\"></a>1 ）检查当前系统是否安装过MySQL</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 ~]$ rpm -qa|grep mariadb\nmariadb-libs-5.5.56-2.el7.x86_\n&#x2F;&#x2F;如果存在通过如下命令卸载\n[atguigu @hadoop102 ~]$ sudo rpm -e --nodeps mariadb-libs<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）将-MySQL-安装包拷贝到-x2F-opt-x2F-software-目录下\"><a href=\"#2-）将-MySQL-安装包拷贝到-x2F-opt-x2F-software-目录下\" class=\"headerlink\" title=\"2 ）将 MySQL 安装包拷贝到 &#x2F;opt&#x2F;software 目录下\"></a>2 ）将 MySQL 安装包拷贝到 &#x2F;opt&#x2F;software 目录下</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 software]# ll\n总用量 528384<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>rw-r–r–. 1 root root 609556480 3月 21 15:41 mysql-5.7.28-</li>\n</ul>\n<p>1.el7.x86_64.rpm-bundle.tar</p>\n<h5 id=\"3-）解压-MySQL-安装包\"><a href=\"#3-）解压-MySQL-安装包\" class=\"headerlink\" title=\"3 ）解压 MySQL 安装包\"></a>3 ）解压 MySQL 安装包</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 software]# tar -xf mysql-5.7.28-1.el7.x86_64.rpm-\nbundle.tar<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"4-）在安装目录下执行rpm安装\"><a href=\"#4-）在安装目录下执行rpm安装\" class=\"headerlink\" title=\"4 ）在安装目录下执行rpm安装\"></a>4 ）在安装目录下执行rpm安装</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 software]$\nsudo rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"注意-按照顺序依次执行\"><a href=\"#注意-按照顺序依次执行\" class=\"headerlink\" title=\"注意:按照顺序依次执行\"></a>注意:按照顺序依次执行</h5><h5 id=\"如果Linux是最小化安装的，在安装mysql-community-server-5-7-28-1-el7-x86-64-rpm时\"><a href=\"#如果Linux是最小化安装的，在安装mysql-community-server-5-7-28-1-el7-x86-64-rpm时\" class=\"headerlink\" title=\"如果Linux是最小化安装的，在安装mysql-community-server-5.7.28-1.el7.x86_64.rpm时\"></a>如果Linux是最小化安装的，在安装mysql-community-server-5.7.28-1.el7.x86_64.rpm时</h5><h5 id=\"可能会出现如下错误\"><a href=\"#可能会出现如下错误\" class=\"headerlink\" title=\"可能会出现如下错误\"></a>可能会出现如下错误</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop 1 02 software]$ sudo rpm -ivh mysql-community-server-\n5.7.28-1.el7.x86_64.rpm\n警告：mysql-community-server-5.7.28-1.el7.x86_64.rpm: 头V3 DSA&#x2F;SHA\nSignature, 密钥 ID 5072e1f5: NOKEY<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-5\"><a href=\"#—————————————————————————————————————-5\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">错误：依赖检测失败：\nlibaio.so.1()(64bit) 被 mysql-community-server-5.7.28-1.el7.x86_\n需要\nlibaio.so.1(LIBAIO_0.1)(64bit) 被 mysql-community-server-5.7.28-\n1.el7.x86_64 需要\nlibaio.so.1(LIBAIO_0.4)(64bit) 被 mysql-community-server-5.7.28-\n1.el7.x86_64 需要<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"通过yum安装缺少的依赖-然后重新安装mysql-community-server-5-7-28-1-el7-x86-64即\"><a href=\"#通过yum安装缺少的依赖-然后重新安装mysql-community-server-5-7-28-1-el7-x86-64即\" class=\"headerlink\" title=\"通过yum安装缺少的依赖,然后重新安装mysql-community-server-5.7.28-1.el7.x86_64即\"></a>通过yum安装缺少的依赖,然后重新安装mysql-community-server-5.7.28-1.el7.x86_64即</h5><h5 id=\"可\"><a href=\"#可\" class=\"headerlink\" title=\"可\"></a>可</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop 1 02 software] yum install -y libaio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"5-）删除-x2F-etc-x2F-my-cnf-文件中-datadir-指向的目录下的所有内容-如果有内容的情况下\"><a href=\"#5-）删除-x2F-etc-x2F-my-cnf-文件中-datadir-指向的目录下的所有内容-如果有内容的情况下\" class=\"headerlink\" title=\"5 ）删除 &#x2F;etc&#x2F;my.cnf 文件中 datadir 指向的目录下的所有内容 , 如果有内容的情况下 :\"></a>5 ）删除 &#x2F;etc&#x2F;my.cnf 文件中 datadir 指向的目录下的所有内容 , 如果有内容的情况下 :</h5><h5 id=\"查看datadir的值：\"><a href=\"#查看datadir的值：\" class=\"headerlink\" title=\"查看datadir的值：\"></a>查看datadir的值：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[mysqld]\ndatadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"删除-x2F-var-x2F-lib-x2F-mysql目录下的所有内容\"><a href=\"#删除-x2F-var-x2F-lib-x2F-mysql目录下的所有内容\" class=\"headerlink\" title=\"删除&#x2F;var&#x2F;lib&#x2F;mysql目录下的所有内容:\"></a>删除&#x2F;var&#x2F;lib&#x2F;mysql目录下的所有内容:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 mysql]# cd &#x2F;var&#x2F;lib&#x2F;mysql\n[atguigu @hadoop102 mysql]# sudo rm -rf .&#x2F;* &#x2F;&#x2F;注意执行命令的位置<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"6-）初始化数据库\"><a href=\"#6-）初始化数据库\" class=\"headerlink\" title=\"6 ）初始化数据库\"></a>6 ）初始化数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 opt]$ sudo mysqld --initialize --user&#x3D;mysql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"7-）查看临时生成的-root-用户的密码\"><a href=\"#7-）查看临时生成的-root-用户的密码\" class=\"headerlink\" title=\"7 ）查看临时生成的 root 用户的密码\"></a>7 ）查看临时生成的 root 用户的密码</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 opt]$ sudo cat &#x2F;var&#x2F;log&#x2F;mysqld.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"8-）启动-MySQL-服务\"><a href=\"#8-）启动-MySQL-服务\" class=\"headerlink\" title=\"8 ）启动 MySQL 服务\"></a>8 ）启动 MySQL 服务</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 opt]$ sudo systemctl start mysqld<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"9-）登录-MySQL-数据库\"><a href=\"#9-）登录-MySQL-数据库\" class=\"headerlink\" title=\"9 ）登录 MySQL 数据库\"></a>9 ）登录 MySQL 数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu @hadoop102 opt]$ mysql -uroot -p\nEnter password: 输入临时生成的密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"登录成功\"><a href=\"#登录成功\" class=\"headerlink\" title=\"登录成功.\"></a>登录成功.</h5><h5 id=\"10-）必须先修改-root-用户的密码-否则执行其他的操作会报错\"><a href=\"#10-）必须先修改-root-用户的密码-否则执行其他的操作会报错\" class=\"headerlink\" title=\"10 ）必须先修改 root 用户的密码 , 否则执行其他的操作会报错\"></a>10 ）必须先修改 root 用户的密码 , 否则执行其他的操作会报错</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt; set password &#x3D; password(&quot;新密码&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"11-）修改-mysql-库下的-user-表中的-root-用户允许任意-ip-连接\"><a href=\"#11-）修改-mysql-库下的-user-表中的-root-用户允许任意-ip-连接\" class=\"headerlink\" title=\"11 ）修改 mysql 库下的 user 表中的 root 用户允许任意 ip 连接\"></a>11 ）修改 mysql 库下的 user 表中的 root 用户允许任意 ip 连接</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt; update mysql.user set host&#x3D;&#39;%&#39; where user&#x3D;&#39;root&#39;;\nmysql&gt; flush privileges;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-6\"><a href=\"#—————————————————————————————————————-6\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"2-4-Hive-元数据配置到-MySQL\"><a href=\"#2-4-Hive-元数据配置到-MySQL\" class=\"headerlink\" title=\"2.4 Hive 元数据配置到 MySQL\"></a>2.4 Hive 元数据配置到 MySQL</h4><h4 id=\"2-4-1-拷贝驱动\"><a href=\"#2-4-1-拷贝驱动\" class=\"headerlink\" title=\"2. 4 .1 拷贝驱动\"></a>2. 4 .1 拷贝驱动</h4><h5 id=\"将MySQL的JDBC驱动拷贝到Hive的lib目录下\"><a href=\"#将MySQL的JDBC驱动拷贝到Hive的lib目录下\" class=\"headerlink\" title=\"将MySQL的JDBC驱动拷贝到Hive的lib目录下\"></a>将MySQL的JDBC驱动拷贝到Hive的lib目录下</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ cp &#x2F;opt&#x2F;software&#x2F;mysql-connector-java-\n5.1. 37 .jar $HIVE_HOME&#x2F;lib<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"2-4-2-配置-Metastore-到-MySQL\"><a href=\"#2-4-2-配置-Metastore-到-MySQL\" class=\"headerlink\" title=\"2. 4 .2 配置 Metastore 到 MySQL\"></a>2. 4 .2 配置 Metastore 到 MySQL</h4><h5 id=\"1-）在-HIVE-HOME-x2F-conf-目录下新建-hive-site-xml-文件\"><a href=\"#1-）在-HIVE-HOME-x2F-conf-目录下新建-hive-site-xml-文件\" class=\"headerlink\" title=\"1 ）在 $HIVE_HOME&#x2F;conf 目录下新建 hive-site.xml 文件\"></a>1 ）在 $HIVE_HOME&#x2F;conf 目录下新建 hive-site.xml 文件</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ vim $HIVE_HOME&#x2F;conf&#x2F;hive-site.xml<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"添加如下内容\"><a href=\"#添加如下内容\" class=\"headerlink\" title=\"添加如下内容\"></a>添加如下内容</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;\n&lt;?xml-stylesheet type&#x3D;&quot;text&#x2F;xsl&quot; href&#x3D;&quot;configuration.xsl&quot;?&gt;\n&lt;configuration&gt;\n&lt;!-- jdbc连接的URL --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionURL&lt;&#x2F;name&gt;\n&lt;value&gt;jdbc:mysql:&#x2F;&#x2F;hadoop102:3306&#x2F;metastore?useSSL&#x3D;false&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- jdbc连接的Driver--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;&#x2F;name&gt;\n&lt;value&gt;com.mysql.jdbc.Driver&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- jdbc连接的username--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;&#x2F;name&gt;\n&lt;value&gt;root&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- jdbc连接的password --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;&#x2F;name&gt;\n&lt;value&gt; 000000 &lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- Hive元数据存储版本的验证 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.metastore.schema.verification&lt;&#x2F;name&gt;\n&lt;value&gt;false&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!--元数据存储授权--&gt;\n&lt;property&gt;\n&lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;&#x2F;name&gt;\n&lt;value&gt;false&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- Hive默认在HDFS的工作目录 --&gt;\n&lt;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-7\"><a href=\"#—————————————————————————————————————-7\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;name&gt;hive.metastore.warehouse.dir&lt;&#x2F;name&gt;\n&lt;value&gt;&#x2F;user&#x2F;hive&#x2F;warehouse&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;&#x2F;configuration&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）登陆-MySQL\"><a href=\"#2-）登陆-MySQL\" class=\"headerlink\" title=\"2 ）登陆 MySQL\"></a>2 ）登陆 MySQL</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ mysql -uroot -p<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）新建-Hive-元数据库\"><a href=\"#3-）新建-Hive-元数据库\" class=\"headerlink\" title=\"3 ）新建 Hive 元数据库\"></a>3 ）新建 Hive 元数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt; create database metastore;\nmysql&gt; quit;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"4-）-初始化-Hive-元数据库\"><a href=\"#4-）-初始化-Hive-元数据库\" class=\"headerlink\" title=\"4 ） 初始化 Hive 元数据库\"></a>4 ） 初始化 Hive 元数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ schematool -initSchema -dbType mysql -\nverbose<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"2-4-3-再次启动-Hive\"><a href=\"#2-4-3-再次启动-Hive\" class=\"headerlink\" title=\"2.4.3 再次启动 Hive\"></a>2.4.3 再次启动 Hive</h4><h5 id=\"1-）启动-Hive-1\"><a href=\"#1-）启动-Hive-1\" class=\"headerlink\" title=\"1 ）启动 Hive\"></a>1 ）启动 Hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）使用-Hive-1\"><a href=\"#2-）使用-Hive-1\" class=\"headerlink\" title=\"2 ）使用 Hive\"></a>2 ）使用 Hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show databases;\nhive&gt; show tables;\nhive&gt; create table test (id int);\nhive&gt; insert into test values(1);\nhive&gt; select * from test;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）在-CRT-窗口中开启另一个窗口开启-Hive\"><a href=\"#3-）在-CRT-窗口中开启另一个窗口开启-Hive\" class=\"headerlink\" title=\"3 ）在 CRT 窗口中开启另一个窗口开启 Hive\"></a>3 ）在 CRT 窗口中开启另一个窗口开启 Hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show databases;\nhive&gt; show tables;\nhive&gt; select * from aa;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"2-5-使用元数据服务的方式访问-Hive\"><a href=\"#2-5-使用元数据服务的方式访问-Hive\" class=\"headerlink\" title=\"2. 5 使用元数据服务的方式访问 Hive\"></a>2. 5 使用元数据服务的方式访问 Hive</h4><h5 id=\"1-）在-hive-site-xml-文件中添加如下配置信息\"><a href=\"#1-）在-hive-site-xml-文件中添加如下配置信息\" class=\"headerlink\" title=\"1 ）在 hive-site.xml 文件中添加如下配置信息\"></a>1 ）在 hive-site.xml 文件中添加如下配置信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- 指定存储元数据要连接的地址 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.metastore.uris&lt;&#x2F;name&gt;\n&lt;value&gt;thrift:&#x2F;&#x2F;hadoop102:9083&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）启动-metastore\"><a href=\"#2-）启动-metastore\" class=\"headerlink\" title=\"2 ）启动 metastore\"></a>2 ）启动 metastore</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop202 hive]$ hive --service metastore\n2020 - 04 - 24 16:58:08: Starting Hive Metastore Server\n注意: 启动后窗口不能再操作，需打开一个新的shell窗口做别的操作<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）启动-hive\"><a href=\"#3-）启动-hive\" class=\"headerlink\" title=\"3 ）启动 hive\"></a>3 ）启动 hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop202 hive]$ bin&#x2F;hive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"2-6-使用-JDBC-方式访问-Hive\"><a href=\"#2-6-使用-JDBC-方式访问-Hive\" class=\"headerlink\" title=\"2. 6 使用 JDBC 方式访问 Hive\"></a>2. 6 使用 JDBC 方式访问 Hive</h4><h5 id=\"1-）在-hive-site-xml-文件中添加如下配置信息-1\"><a href=\"#1-）在-hive-site-xml-文件中添加如下配置信息-1\" class=\"headerlink\" title=\"1 ）在 hive-site.xml 文件中添加如下配置信息\"></a>1 ）在 hive-site.xml 文件中添加如下配置信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- 指定hiveserver2连接的host --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.server2.thrift.bind.host&lt;&#x2F;name&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-8\"><a href=\"#—————————————————————————————————————-8\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;value&gt;hadoop102&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!-- 指定hiveserver2连接的端口号 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.server2.thrift.port&lt;&#x2F;name&gt;\n&lt;value&gt; 10000 &lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）启动-hiveserver-2\"><a href=\"#2-）启动-hiveserver-2\" class=\"headerlink\" title=\"2 ）启动 hiveserver 2\"></a>2 ）启动 hiveserver 2</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive --service hiveserver<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）启动-beeline-客户端（需要多等待一会）\"><a href=\"#3-）启动-beeline-客户端（需要多等待一会）\" class=\"headerlink\" title=\"3 ）启动 beeline 客户端（需要多等待一会）\"></a>3 ）启动 beeline 客户端（需要多等待一会）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;beeline -u jdbc:hive2:&#x2F;&#x2F;hadoop102:10000 -n\natguigu<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"4-）看到如下界面\"><a href=\"#4-）看到如下界面\" class=\"headerlink\" title=\"4 ）看到如下界面\"></a>4 ）看到如下界面</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Connecting to jdbc:hive2:&#x2F;&#x2F;hadoop102:\nConnected to: Apache Hive (version 3.1.2)\nDriver: Hive JDBC (version 3.1.2)\nTransaction isolation: TRANSACTION_REPEATABLE_READ\nBeeline version 3.1.2 by Apache Hive\n0: jdbc:hive2:&#x2F;&#x2F;hadoop102:10000&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"5-）编写-hive-服务启动脚本（了解）\"><a href=\"#5-）编写-hive-服务启动脚本（了解）\" class=\"headerlink\" title=\"5 ）编写 hive 服务启动脚本（了解）\"></a>5 ）编写 hive 服务启动脚本（了解）</h5><h5 id=\"（-1-）-前台启动的方式导致需要打开多个shell窗口，可以使用如下方式后台方式启动\"><a href=\"#（-1-）-前台启动的方式导致需要打开多个shell窗口，可以使用如下方式后台方式启动\" class=\"headerlink\" title=\"（ 1 ） 前台启动的方式导致需要打开多个shell窗口，可以使用如下方式后台方式启动\"></a>（ 1 ） 前台启动的方式导致需要打开多个shell窗口，可以使用如下方式后台方式启动</h5><h5 id=\"nohup-放在命令开头，表示不挂起-也就是关闭终端进程也继续保持运行状态\"><a href=\"#nohup-放在命令开头，表示不挂起-也就是关闭终端进程也继续保持运行状态\" class=\"headerlink\" title=\"nohup: 放在命令开头，表示不挂起,也就是关闭终端进程也继续保持运行状态\"></a>nohup: 放在命令开头，表示不挂起,也就是关闭终端进程也继续保持运行状态</h5><h5 id=\"x2F-dev-x2F-null：是Linux文件系统中的一个文件，被称为黑洞，所有写入改文件的内容\"><a href=\"#x2F-dev-x2F-null：是Linux文件系统中的一个文件，被称为黑洞，所有写入改文件的内容\" class=\"headerlink\" title=\"&#x2F;dev&#x2F;null：是Linux文件系统中的一个文件，被称为黑洞，所有写入改文件的内容\"></a>&#x2F;dev&#x2F;null：是Linux文件系统中的一个文件，被称为黑洞，所有写入改文件的内容</h5><h5 id=\"都会被自动丢弃\"><a href=\"#都会被自动丢弃\" class=\"headerlink\" title=\"都会被自动丢弃\"></a>都会被自动丢弃</h5><h5 id=\"2-gt-amp-1-表示将错误重定向到标准输出上\"><a href=\"#2-gt-amp-1-表示将错误重定向到标准输出上\" class=\"headerlink\" title=\"2 &gt;&amp;1 : 表示将错误重定向到标准输出上\"></a>2 &gt;&amp;1 : 表示将错误重定向到标准输出上</h5><h5 id=\"amp-放在命令结尾-表示后台运行\"><a href=\"#amp-放在命令结尾-表示后台运行\" class=\"headerlink\" title=\"&amp;: 放在命令结尾,表示后台运行\"></a>&amp;: 放在命令结尾,表示后台运行</h5><h5 id=\"一般会组合使用-nohup-xxx命令操作-gt-file-2-gt-amp-1-amp-，表示将xxx命令运行的结\"><a href=\"#一般会组合使用-nohup-xxx命令操作-gt-file-2-gt-amp-1-amp-，表示将xxx命令运行的结\" class=\"headerlink\" title=\"一般会组合使用: nohup [xxx命令操作]&gt; file 2&gt;&amp;1 &amp;，表示将xxx命令运行的结\"></a>一般会组合使用: nohup [xxx命令操作]&gt; file 2&gt;&amp;1 &amp;，表示将xxx命令运行的结</h5><h5 id=\"果输出到file中，并保持命令启动的进程在后台运行。\"><a href=\"#果输出到file中，并保持命令启动的进程在后台运行。\" class=\"headerlink\" title=\"果输出到file中，并保持命令启动的进程在后台运行。\"></a>果输出到file中，并保持命令启动的进程在后台运行。</h5><h5 id=\"如上命令不要求掌握。\"><a href=\"#如上命令不要求掌握。\" class=\"headerlink\" title=\"如上命令不要求掌握。\"></a>如上命令不要求掌握。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop202 hive]$ nohup hive --service metastore 2&gt;&amp;1 &amp;\n[atguigu@hadoop202 hive]$ nohup hive --service hiveserver2 2&gt;&amp;1 &amp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）-为了方便使用，可以直接编写脚本来管理服务的启动和关闭\"><a href=\"#（-2-）-为了方便使用，可以直接编写脚本来管理服务的启动和关闭\" class=\"headerlink\" title=\"（ 2 ） 为了方便使用，可以直接编写脚本来管理服务的启动和关闭\"></a>（ 2 ） 为了方便使用，可以直接编写脚本来管理服务的启动和关闭</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ vim $HIVE_HOME&#x2F;bin&#x2F;hiveservices.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"内容如下：此脚本的编写不要求掌握。直接拿来使用即可。\"><a href=\"#内容如下：此脚本的编写不要求掌握。直接拿来使用即可。\" class=\"headerlink\" title=\"内容如下：此脚本的编写不要求掌握。直接拿来使用即可。\"></a>内容如下：此脚本的编写不要求掌握。直接拿来使用即可。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">#!&#x2F;bin&#x2F;bash\nHIVE_LOG_DIR&#x3D;$HIVE_HOME&#x2F;logs\nif [! -d $HIVE_LOG_DIR ]\nthen\nmkdir -p $HIVE_LOG_DIR\nfi\n#检查进程是否运行正常，参数 1 为进程名，参数 2 为进程端口\nfunction check_process()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-9\"><a href=\"#—————————————————————————————————————-9\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\npid&#x3D;$(ps -ef 2&gt;&#x2F;dev&#x2F;null | grep -v grep | grep -i $1 | awk &#39;&#123;print\n$2&#125;&#39;)\nppid&#x3D;$(netstat -nltp 2&gt;&#x2F;dev&#x2F;null | grep $2 | awk &#39;&#123;print $7&#125;&#39; | cut -\nd &#39;&#x2F;&#39; -f 1)\necho $pid\n[[ &quot;$pid&quot; &#x3D;~ &quot;$ppid&quot; ]] &amp;&amp; [ &quot;$ppid&quot; ] &amp;&amp; return 0 || return 1\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">function hive_start()\n&#123;\nmetapid&#x3D;$(check_process HiveMetastore 9083)\ncmd&#x3D;&quot;nohup hive --service metastore &gt;$HIVE_LOG_DIR&#x2F;metastore.log 2&gt;&amp;\n&amp;&quot;\n[ -z &quot;$metapid&quot; ] &amp;&amp; eval $cmd || echo &quot;Metastroe服务已启动&quot;\nserver2pid&#x3D;$(check_process HiveServer2 10000)\ncmd&#x3D;&quot;nohup hiveserver2 &gt;$HIVE_LOG_DIR&#x2F;hiveServer2.log 2&gt;&amp;1 &amp;&quot;\n[ -z &quot;$server2pid&quot; ] &amp;&amp; eval $cmd || echo &quot;HiveServer2服务已启动&quot;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">function hive_stop()\n&#123;\nmetapid&#x3D;$(check_process HiveMetastore 9083)\n[ &quot;$metapid&quot; ] &amp;&amp; kill $metapid || echo &quot;Metastore服务未启动&quot;\nserver2pid&#x3D;$(check_process HiveServer2 10000)\n[ &quot;$server2pid&quot; ] &amp;&amp; kill $server2pid || echo &quot;HiveServer2服务未启动&quot;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">case $1 in\n&quot;start&quot;)\nhive_start\n;;\n&quot;stop&quot;)\nhive_stop\n;;\n&quot;restart&quot;)\nhive_stop\nsleep 2\nhive_start\n;;\n&quot;status&quot;)\ncheck_process HiveMetastore 9083 &gt;&#x2F;dev&#x2F;null &amp;&amp; echo &quot;Metastore服务运行\n正常&quot; || echo &quot;Metastore服务运行异常&quot;\ncheck_process HiveServer2 10000 &gt;&#x2F;dev&#x2F;null &amp;&amp; echo &quot;HiveServer2服务运\n行正常&quot; || echo &quot;HiveServer2服务运行异常&quot;\n;;\n*)\necho Invalid Args!\necho &#39;Usage: &#39;$(basename $0)&#39; start|stop|restart|status&#39;\n;;\nesac<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）添加执行权限\"><a href=\"#3-）添加执行权限\" class=\"headerlink\" title=\"3 ）添加执行权限\"></a>3 ）添加执行权限</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ chmod +x $HIVE_HOME&#x2F;bin&#x2F;hiveservices.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"4-）启动-Hive-后台服务\"><a href=\"#4-）启动-Hive-后台服务\" class=\"headerlink\" title=\"4 ）启动 Hive 后台服务\"></a>4 ）启动 Hive 后台服务</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ hiveservices.sh start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-10\"><a href=\"#—————————————————————————————————————-10\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"2-7-Hive-常用交互命令\"><a href=\"#2-7-Hive-常用交互命令\" class=\"headerlink\" title=\"2. 7 Hive 常用交互命令\"></a>2. 7 Hive 常用交互命令</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive -help\nusage: hive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>d,–define &lt;key&#x3D;value&gt; Variable subsitution to apply to hive<br>commands. e.g. -d A&#x3D;B or –define A&#x3D;B</li>\n</ul>\n<p>–database <databasename> Specify the database to use</p>\n<ul>\n<li>e <quoted-query-string> SQL from command line</li>\n<li>f <filename> SQL from files</li>\n<li>H,–help Print help information</li>\n</ul>\n<p>–hiveconf &lt;property&#x3D;value&gt; Use value for given property<br>–hivevar &lt;key&#x3D;value&gt; Variable subsitution to apply to hive<br>commands. e.g. –hivevar A&#x3D;B</p>\n<ul>\n<li>i <filename> Initialization SQL file</li>\n<li>S,–silent Silent mode in interactive shell</li>\n<li>v,–verbose Verbose mode (echo executed SQL to the<br>console)</li>\n</ul>\n<h5 id=\"1-）“-e-”不进入-hive-的交互窗口执行-sql-语句\"><a href=\"#1-）“-e-”不进入-hive-的交互窗口执行-sql-语句\" class=\"headerlink\" title=\"1 ）“ - e ”不进入 hive 的交互窗口执行 sql 语句\"></a>1 ）“ - e ”不进入 hive 的交互窗口执行 sql 语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive -e &quot;select id from student;&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）“-f-”执行脚本中-sql-语句\"><a href=\"#2-）“-f-”执行脚本中-sql-语句\" class=\"headerlink\" title=\"2 ）“ - f ”执行脚本中 sql 语句\"></a>2 ）“ - f ”执行脚本中 sql 语句</h5><h5 id=\"（-1-）在-x2F-opt-x2F-module-x2F-hive-x2F-下创建datas目录并在datas目录下创建hivef-sql文件\"><a href=\"#（-1-）在-x2F-opt-x2F-module-x2F-hive-x2F-下创建datas目录并在datas目录下创建hivef-sql文件\" class=\"headerlink\" title=\"（ 1 ）在&#x2F;opt&#x2F;module&#x2F;hive&#x2F;下创建datas目录并在datas目录下创建hivef.sql文件\"></a>（ 1 ）在&#x2F;opt&#x2F;module&#x2F;hive&#x2F;下创建datas目录并在datas目录下创建hivef.sql文件</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ touch hivef.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）文件中写入正确的sql语句\"><a href=\"#（-2-）文件中写入正确的sql语句\" class=\"headerlink\" title=\"（ 2 ）文件中写入正确的sql语句\"></a>（ 2 ）文件中写入正确的sql语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select *from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）执行文件中的sql语句\"><a href=\"#（-3-）执行文件中的sql语句\" class=\"headerlink\" title=\"（ 3 ）执行文件中的sql语句\"></a>（ 3 ）执行文件中的sql语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive -f &#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;hivef.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）执行文件中的sql语句并将结果写入文件中\"><a href=\"#（-4-）执行文件中的sql语句并将结果写入文件中\" class=\"headerlink\" title=\"（ 4 ）执行文件中的sql语句并将结果写入文件中\"></a>（ 4 ）执行文件中的sql语句并将结果写入文件中</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive -f &#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;hivef.sql &gt;\n&#x2F;opt&#x2F;module&#x2F;datas&#x2F;hive_result.txt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"2-8-Hive-其他命令操作\"><a href=\"#2-8-Hive-其他命令操作\" class=\"headerlink\" title=\"2. 8 Hive 其他命令操作\"></a>2. 8 Hive 其他命令操作</h4><h5 id=\"1-）退出-hive-窗口：\"><a href=\"#1-）退出-hive-窗口：\" class=\"headerlink\" title=\"1 ）退出 hive 窗口：\"></a>1 ）退出 hive 窗口：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive(default)&gt;exit;\nhive(default)&gt;quit;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）在-hive-cli-命令窗口中如何查看-hdfs-文件系统\"><a href=\"#2-）在-hive-cli-命令窗口中如何查看-hdfs-文件系统\" class=\"headerlink\" title=\"2 ）在 hive cli 命令窗口中如何查看 hdfs 文件系统\"></a>2 ）在 hive cli 命令窗口中如何查看 hdfs 文件系统</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive(default)&gt;dfs -ls &#x2F;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）查看在-hive-中输入的所有历史命令\"><a href=\"#3-）查看在-hive-中输入的所有历史命令\" class=\"headerlink\" title=\"3 ）查看在 hive 中输入的所有历史命令\"></a>3 ）查看在 hive 中输入的所有历史命令</h5><h5 id=\"（-1-）进入到当前用户的根目录-x2F-root或-x2F-home-x2F-atguigu\"><a href=\"#（-1-）进入到当前用户的根目录-x2F-root或-x2F-home-x2F-atguigu\" class=\"headerlink\" title=\"（ 1 ）进入到当前用户的根目录 &#x2F;root或&#x2F;home&#x2F;atguigu\"></a>（ 1 ）进入到当前用户的根目录 &#x2F;root或&#x2F;home&#x2F;atguigu</h5><h5 id=\"（-2-）查看-hivehistory文件\"><a href=\"#（-2-）查看-hivehistory文件\" class=\"headerlink\" title=\"（ 2 ）查看. hivehistory文件\"></a>（ 2 ）查看. hivehistory文件</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguig 2 u@hadoop102 ~]$ cat .hivehistory<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-11\"><a href=\"#—————————————————————————————————————-11\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"2-9-Hive-常见属性配置\"><a href=\"#2-9-Hive-常见属性配置\" class=\"headerlink\" title=\"2. 9 Hive 常见属性配置\"></a>2. 9 Hive 常见属性配置</h4><h4 id=\"2-9-1-Hive-运行日志信息配置\"><a href=\"#2-9-1-Hive-运行日志信息配置\" class=\"headerlink\" title=\"2. 9 .1 Hive 运行日志信息配置\"></a>2. 9 .1 Hive 运行日志信息配置</h4><h5 id=\"1-）-Hive-的-log-默认存放在-x2F-tmp-x2F-atguigu-x2F-hive-log-目录下（当前用户名下）\"><a href=\"#1-）-Hive-的-log-默认存放在-x2F-tmp-x2F-atguigu-x2F-hive-log-目录下（当前用户名下）\" class=\"headerlink\" title=\"1 ） Hive 的 log 默认存放在 &#x2F;tmp&#x2F;atguigu&#x2F;hive.log 目录下（当前用户名下）\"></a>1 ） Hive 的 log 默认存放在 &#x2F;tmp&#x2F;atguigu&#x2F;hive.log 目录下（当前用户名下）</h5><h5 id=\"2-）修改-hive-的-log-存放日志到-x2F-opt-x2F-module-x2F-hive-x2F-logs\"><a href=\"#2-）修改-hive-的-log-存放日志到-x2F-opt-x2F-module-x2F-hive-x2F-logs\" class=\"headerlink\" title=\"2 ）修改 hive 的 log 存放日志到 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs\"></a>2 ）修改 hive 的 log 存放日志到 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs</h5><h5 id=\"（-1-）修改-x2F-opt-x2F-module-x2F-hive-x2F-conf-x2F-hive-log4j-2-properties-template文件名称为\"><a href=\"#（-1-）修改-x2F-opt-x2F-module-x2F-hive-x2F-conf-x2F-hive-log4j-2-properties-template文件名称为\" class=\"headerlink\" title=\"（ 1 ）修改&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf&#x2F;hive-log4j 2 .properties.template文件名称为\"></a>（ 1 ）修改&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf&#x2F;hive-log4j 2 .properties.template文件名称为</h5><h5 id=\"hive-log4j-2-properties\"><a href=\"#hive-log4j-2-properties\" class=\"headerlink\" title=\"hive-log4j 2 .properties\"></a>hive-log4j 2 .properties</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 conf]$ pwd\n&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf\n[atguigu@hadoop102 conf]$ mv hive-log4j 2 .properties.template hive-\nlog4j 2 .properties<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）在hive-log4j-2-properties文件中修改log存放位置\"><a href=\"#（-2-）在hive-log4j-2-properties文件中修改log存放位置\" class=\"headerlink\" title=\"（ 2 ）在hive-log4j 2 .properties文件中修改log存放位置\"></a>（ 2 ）在hive-log4j 2 .properties文件中修改log存放位置</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive.log.dir&#x3D;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"2-9-2-打印-当前库-和-表头\"><a href=\"#2-9-2-打印-当前库-和-表头\" class=\"headerlink\" title=\"2. 9 .2 打印 当前库 和 表头\"></a>2. 9 .2 打印 当前库 和 表头</h4><h5 id=\"在hive-site-xml中加入如下两个配置\"><a href=\"#在hive-site-xml中加入如下两个配置\" class=\"headerlink\" title=\"在hive-site.xml中加入如下两个配置:\"></a>在hive-site.xml中加入如下两个配置:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;hive.cli.print.header&lt;&#x2F;name&gt;\n&lt;value&gt;true&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;hive.cli.print.current.db&lt;&#x2F;name&gt;\n&lt;value&gt;true&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"2-9-3-参数配置方式\"><a href=\"#2-9-3-参数配置方式\" class=\"headerlink\" title=\"2. 9. 3 参数配置方式\"></a>2. 9. 3 参数配置方式</h4><h5 id=\"1-）查看当前所有的配置信息\"><a href=\"#1-）查看当前所有的配置信息\" class=\"headerlink\" title=\"1 ）查看当前所有的配置信息\"></a>1 ）查看当前所有的配置信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt;set;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）参数的配置三种方式\"><a href=\"#2-）参数的配置三种方式\" class=\"headerlink\" title=\"2 ）参数的配置三种方式\"></a>2 ）参数的配置三种方式</h5><h5 id=\"（-1-）配置文件方式\"><a href=\"#（-1-）配置文件方式\" class=\"headerlink\" title=\"（ 1 ）配置文件方式\"></a>（ 1 ）配置文件方式</h5><h5 id=\"默认配置文件：hive-default-xml\"><a href=\"#默认配置文件：hive-default-xml\" class=\"headerlink\" title=\"默认配置文件：hive-default.xml\"></a>默认配置文件：hive-default.xml</h5><h5 id=\"用户自定义配置文件：hive-site-xml\"><a href=\"#用户自定义配置文件：hive-site-xml\" class=\"headerlink\" title=\"用户自定义配置文件：hive-site.xml\"></a>用户自定义配置文件：hive-site.xml</h5><h5 id=\"注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive\"><a href=\"#注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive\" class=\"headerlink\" title=\"注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive\"></a>注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive</h5><h5 id=\"是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本\"><a href=\"#是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本\" class=\"headerlink\" title=\"是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本\"></a>是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本</h5><h5 id=\"机启动的所有Hive进程都有效。\"><a href=\"#机启动的所有Hive进程都有效。\" class=\"headerlink\" title=\"机启动的所有Hive进程都有效。\"></a>机启动的所有Hive进程都有效。</h5><h5 id=\"（-2-）命令行参数方式\"><a href=\"#（-2-）命令行参数方式\" class=\"headerlink\" title=\"（ 2 ）命令行参数方式\"></a>（ 2 ）命令行参数方式</h5><h5 id=\"启动Hive时，可以在命令行添加-hiveconf-param-x3D-value来设定参数。\"><a href=\"#启动Hive时，可以在命令行添加-hiveconf-param-x3D-value来设定参数。\" class=\"headerlink\" title=\"启动Hive时，可以在命令行添加-hiveconf param&#x3D;value来设定参数。\"></a>启动Hive时，可以在命令行添加-hiveconf param&#x3D;value来设定参数。</h5><h5 id=\"—————————————————————————————————————-12\"><a href=\"#—————————————————————————————————————-12\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"例如：\"><a href=\"#例如：\" class=\"headerlink\" title=\"例如：\"></a>例如：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop103 hive]$ bin&#x2F;hive -hiveconf mapred.reduce.tasks&#x3D;10;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"注意：仅对本次hive启动有效\"><a href=\"#注意：仅对本次hive启动有效\" class=\"headerlink\" title=\"注意：仅对本次hive启动有效\"></a>注意：仅对本次hive启动有效</h5><h5 id=\"查看参数设置：\"><a href=\"#查看参数设置：\" class=\"headerlink\" title=\"查看参数设置：\"></a>查看参数设置：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapred.reduce.tasks;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）参数声明方式\"><a href=\"#（-3-）参数声明方式\" class=\"headerlink\" title=\"（ 3 ）参数声明方式\"></a>（ 3 ）参数声明方式</h5><h5 id=\"可以在HQL中使用SET关键字设定参数\"><a href=\"#可以在HQL中使用SET关键字设定参数\" class=\"headerlink\" title=\"可以在HQL中使用SET关键字设定参数\"></a>可以在HQL中使用SET关键字设定参数</h5><h5 id=\"例如：-1\"><a href=\"#例如：-1\" class=\"headerlink\" title=\"例如：\"></a>例如：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapred.reduce.tasks&#x3D;100;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"注意：仅对本次hive启动有效。\"><a href=\"#注意：仅对本次hive启动有效。\" class=\"headerlink\" title=\"注意：仅对本次hive启动有效。\"></a>注意：仅对本次hive启动有效。</h5><h5 id=\"查看参数设置\"><a href=\"#查看参数设置\" class=\"headerlink\" title=\"查看参数设置\"></a>查看参数设置</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapred.reduce.tasks;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"上述三种设定方式的优先级依次递增。即配置文件-lt-命令行参数-lt-参数声明。注意某些系\"><a href=\"#上述三种设定方式的优先级依次递增。即配置文件-lt-命令行参数-lt-参数声明。注意某些系\" class=\"headerlink\" title=\"上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些系\"></a>上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些系</h5><h5 id=\"统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话\"><a href=\"#统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话\" class=\"headerlink\" title=\"统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话\"></a>统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话</h5><h5 id=\"建立以前已经完成了。\"><a href=\"#建立以前已经完成了。\" class=\"headerlink\" title=\"建立以前已经完成了。\"></a>建立以前已经完成了。</h5><h1 id=\"第-3-章-Hive数据类型\"><a href=\"#第-3-章-Hive数据类型\" class=\"headerlink\" title=\"第 3 章 Hive数据类型\"></a>第 3 章 Hive数据类型</h1><h4 id=\"3-1-基本数据类型\"><a href=\"#3-1-基本数据类型\" class=\"headerlink\" title=\"3 .1 基本数据类型\"></a>3 .1 基本数据类型</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">Hive数据类型 Java数据类型 长度 例子\nTINYINT byte 1byte有符号整数 20\nSMALINT short 2byte有符号整数 20\nINT int 4byte有符号整数 20<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>BIGINT long (^) 8byte有符号整数 20<br>BOOLEAN boolean (^) 布尔类型，true或者<br>false<br>TRUE FALSE<br>FLOAT float 单精度浮点数 3.<br>DOUBLE double 双精度浮点数 3.<br>STRING string (^) 字符系列。可以指定字<br>符集。可以使用单引号或者双<br>引号。<br>‘now is the time’<br>“for all good men”<br>TIMESTAMP 时间类型<br>BINARY 字节数组</p>\n<h5 id=\"对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不\"><a href=\"#对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不\" class=\"headerlink\" title=\"对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不\"></a>对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不</h5><h5 id=\"过它不能声明其中最多能存储多少个字符，理论上它可以存储2GB的字符数。\"><a href=\"#过它不能声明其中最多能存储多少个字符，理论上它可以存储2GB的字符数。\" class=\"headerlink\" title=\"过它不能声明其中最多能存储多少个字符，理论上它可以存储2GB的字符数。\"></a>过它不能声明其中最多能存储多少个字符，理论上它可以存储2GB的字符数。</h5><h5 id=\"—————————————————————————————————————-13\"><a href=\"#—————————————————————————————————————-13\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"3-2-集合数据类型\"><a href=\"#3-2-集合数据类型\" class=\"headerlink\" title=\"3 .2 集合数据类型\"></a>3 .2 集合数据类型</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">数据类型 描述 语法示例\nSTRUCT 和c语言中的struct类似，都可以通过“点”符号访\n问元素内容。例如，如果某个列的数据类型是STRUCT&#123;first\nSTRING, last STRING&#125;,那么第 1 个元素可以通过字段.first来\n引用。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">struct()\n例如struct&lt;street:string,\ncity:string&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">MAP MAP是一组键-值对元组集合，使用数组表示法可以\n访问数据。例如，如果某个列的数据类型是MAP，其中键<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>值对是’first’-&gt;’John’和’last’-&gt;’Doe’，那么可以<br>通过字段名[‘last’]获取最后一个元素</p></blockquote>\n</li>\n</ul>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">map()\n例如map&lt;string, int&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ARRAY 数组是一组具有相同类型和名称的变量的集合。这些\n变量称为数组的元素，每个数组元素都有一个编号，编号从\n零开始。例如，数组值为[‘John’, ‘Doe’]，那么第 2 个\n元素可以通过数组名[1]进行引用。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Array()\n例如array&lt;string&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"Hive有三种复杂数据类型ARRAY、MAP-和-STRUCT。ARRAY和MAP与Java中的Array\"><a href=\"#Hive有三种复杂数据类型ARRAY、MAP-和-STRUCT。ARRAY和MAP与Java中的Array\" class=\"headerlink\" title=\"Hive有三种复杂数据类型ARRAY、MAP 和 STRUCT。ARRAY和MAP与Java中的Array\"></a>Hive有三种复杂数据类型ARRAY、MAP 和 STRUCT。ARRAY和MAP与Java中的Array</h5><h5 id=\"和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据\"><a href=\"#和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据\" class=\"headerlink\" title=\"和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据\"></a>和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据</h5><h5 id=\"类型允许任意层次的嵌套。\"><a href=\"#类型允许任意层次的嵌套。\" class=\"headerlink\" title=\"类型允许任意层次的嵌套。\"></a>类型允许任意层次的嵌套。</h5><h5 id=\"1-）案例实操\"><a href=\"#1-）案例实操\" class=\"headerlink\" title=\"1 ）案例实操\"></a>1 ）案例实操</h5><h5 id=\"（-1-）假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格\"><a href=\"#（-1-）假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格\" class=\"headerlink\" title=\"（ 1 ）假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格\"></a>（ 1 ）假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格</h5><h5 id=\"式为\"><a href=\"#式为\" class=\"headerlink\" title=\"式为\"></a>式为</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n&quot;name&quot;: &quot;songsong&quot;,\n&quot;friends&quot;: [&quot;bingbing&quot; , &quot;lili&quot;] , &#x2F;&#x2F;列表Array,\n&quot;children&quot;: &#123; &#x2F;&#x2F;键值Map,\n&quot;xiao song&quot;: 18 ,\n&quot;xiaoxiao song&quot;: 19\n&#125;\n&quot;address&quot;: &#123; &#x2F;&#x2F;结构Struct,\n&quot;street&quot;: &quot;hui long guan&quot;,\n&quot;city&quot;: &quot;beijing&quot;\n&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）基于上述数据结构，我们在Hive里创建对应的表，并导入数据。\"><a href=\"#（-2-）基于上述数据结构，我们在Hive里创建对应的表，并导入数据。\" class=\"headerlink\" title=\"（ 2 ）基于上述数据结构，我们在Hive里创建对应的表，并导入数据。\"></a>（ 2 ）基于上述数据结构，我们在Hive里创建对应的表，并导入数据。</h5><h5 id=\"创建本地测试文件test-txt\"><a href=\"#创建本地测试文件test-txt\" class=\"headerlink\" title=\"创建本地测试文件test.txt\"></a>创建本地测试文件test.txt</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">songsong,bingbing_lili,xiao song:18_xiaoxiao song:19,hui long\nguan_beijing\nyangyang,caicai_susu,xiao yang:18_xiaoxiao yang:19,chao yang_beijing<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"注意：MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“-”。\"><a href=\"#注意：MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“-”。\" class=\"headerlink\" title=\"注意：MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“_”。\"></a>注意：MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“_”。</h5><h5 id=\"（-3-）Hive上创建测试表test\"><a href=\"#（-3-）Hive上创建测试表test\" class=\"headerlink\" title=\"（ 3 ）Hive上创建测试表test\"></a>（ 3 ）Hive上创建测试表test</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table test(\nname string,\nfriends array&lt;string&gt;,<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-14\"><a href=\"#—————————————————————————————————————-14\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">children map&lt;string, int&gt;,\naddress struct&lt;street:string, city:string&gt;\n)\nrow format delimited fields terminated by &#39;,&#39;\ncollection items terminated by &#39;_&#39;\nmap keys terminated by &#39;:&#39;\nlines terminated by &#39;\\n&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"字段解释：\"><a href=\"#字段解释：\" class=\"headerlink\" title=\"字段解释：\"></a>字段解释：</h5><h5 id=\"row-format-delimited-fields-terminated-by-‘-’-–-列分隔符\"><a href=\"#row-format-delimited-fields-terminated-by-‘-’-–-列分隔符\" class=\"headerlink\" title=\"row format delimited fields terminated by ‘,’ – 列分隔符\"></a>row format delimited fields terminated by ‘,’ – 列分隔符</h5><h5 id=\"collection-items-terminated-by-‘-’-–MAP-STRUCT-和-ARRAY-的分隔符-数据分割符号\"><a href=\"#collection-items-terminated-by-‘-’-–MAP-STRUCT-和-ARRAY-的分隔符-数据分割符号\" class=\"headerlink\" title=\"collection items terminated by ‘_’ –MAP STRUCT 和 ARRAY 的分隔符(数据分割符号)\"></a>collection items terminated by ‘_’ –MAP STRUCT 和 ARRAY 的分隔符(数据分割符号)</h5><h5 id=\"map-keys-terminated-by-‘-’-–-MAP中的key与value的分隔符\"><a href=\"#map-keys-terminated-by-‘-’-–-MAP中的key与value的分隔符\" class=\"headerlink\" title=\"map keys terminated by ‘:’ – MAP中的key与value的分隔符\"></a>map keys terminated by ‘:’ – MAP中的key与value的分隔符</h5><h5 id=\"lines-terminated-by-‘-n’-–-行分隔符\"><a href=\"#lines-terminated-by-‘-n’-–-行分隔符\" class=\"headerlink\" title=\"lines terminated by ‘\\n’; – 行分隔符\"></a>lines terminated by ‘\\n’; – 行分隔符</h5><h5 id=\"（-4-）导入文本数据到测试表\"><a href=\"#（-4-）导入文本数据到测试表\" class=\"headerlink\" title=\"（ 4 ）导入文本数据到测试表\"></a>（ 4 ）导入文本数据到测试表</h5><h5 id=\"load-data-local-inpath-‘-x2F-opt-x2F-module-x2F-hive-x2F-datas-x2F-test-txt’-into-table-test\"><a href=\"#load-data-local-inpath-‘-x2F-opt-x2F-module-x2F-hive-x2F-datas-x2F-test-txt’-into-table-test\" class=\"headerlink\" title=\"load data local inpath ‘&#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;test.txt’ into table test;\"></a>load data local inpath ‘&#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;test.txt’ into table test;</h5><h5 id=\"（-5-）访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式\"><a href=\"#（-5-）访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式\" class=\"headerlink\" title=\"（ 5 ）访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式\"></a>（ 5 ）访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select friends[1],children[&#39;xiao song&#39;],address.city from\ntest\nwhere name&#x3D;&quot;songsong&quot;;\nOK\n_c0 _c1 city\nlili 18 beijing\nTime taken: 0.076 seconds, Fetched: 1 row(s)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"3-3-类型转化\"><a href=\"#3-3-类型转化\" class=\"headerlink\" title=\"3 .3 类型转化\"></a>3 .3 类型转化</h4><h5 id=\"Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式\"><a href=\"#Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式\" class=\"headerlink\" title=\"Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式\"></a>Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式</h5><h5 id=\"使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表\"><a href=\"#使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表\" class=\"headerlink\" title=\"使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表\"></a>使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表</h5><h5 id=\"达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST\"><a href=\"#达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST\" class=\"headerlink\" title=\"达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST\"></a>达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST</h5><h5 id=\"操作。\"><a href=\"#操作。\" class=\"headerlink\" title=\"操作。\"></a>操作。</h5><h5 id=\"1-）隐式类型转换规则如下\"><a href=\"#1-）隐式类型转换规则如下\" class=\"headerlink\" title=\"1 ）隐式类型转换规则如下\"></a>1 ）隐式类型转换规则如下</h5><h5 id=\"（-1-）任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成\"><a href=\"#（-1-）任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成\" class=\"headerlink\" title=\"（ 1 ）任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成\"></a>（ 1 ）任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成</h5><h5 id=\"INT，INT可以转换成BIGINT。\"><a href=\"#INT，INT可以转换成BIGINT。\" class=\"headerlink\" title=\"INT，INT可以转换成BIGINT。\"></a>INT，INT可以转换成BIGINT。</h5><h5 id=\"（-2-）所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。\"><a href=\"#（-2-）所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。\" class=\"headerlink\" title=\"（ 2 ）所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。\"></a>（ 2 ）所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。</h5><h5 id=\"（-3-）TINYINT、SMALLINT、INT都可以转换为FLOAT。\"><a href=\"#（-3-）TINYINT、SMALLINT、INT都可以转换为FLOAT。\" class=\"headerlink\" title=\"（ 3 ）TINYINT、SMALLINT、INT都可以转换为FLOAT。\"></a>（ 3 ）TINYINT、SMALLINT、INT都可以转换为FLOAT。</h5><h5 id=\"（-4-）BOOLEAN类型不可以转换为任何其它的类型。\"><a href=\"#（-4-）BOOLEAN类型不可以转换为任何其它的类型。\" class=\"headerlink\" title=\"（ 4 ）BOOLEAN类型不可以转换为任何其它的类型。\"></a>（ 4 ）BOOLEAN类型不可以转换为任何其它的类型。</h5><h5 id=\"2-）可以使用-CAST-操作显示进行数据类型转换\"><a href=\"#2-）可以使用-CAST-操作显示进行数据类型转换\" class=\"headerlink\" title=\"2 ）可以使用 CAST 操作显示进行数据类型转换\"></a>2 ）可以使用 CAST 操作显示进行数据类型转换</h5><h5 id=\"例如CAST-‘1’-AS-INT-将把字符串’1’-转换成整数-1-；如果强制类型转换失败，如执行\"><a href=\"#例如CAST-‘1’-AS-INT-将把字符串’1’-转换成整数-1-；如果强制类型转换失败，如执行\" class=\"headerlink\" title=\"例如CAST(‘1’ AS INT)将把字符串’1’ 转换成整数 1 ；如果强制类型转换失败，如执行\"></a>例如CAST(‘1’ AS INT)将把字符串’1’ 转换成整数 1 ；如果强制类型转换失败，如执行</h5><h5 id=\"CAST-‘X’-AS-INT-，表达式返回空值-NULL。\"><a href=\"#CAST-‘X’-AS-INT-，表达式返回空值-NULL。\" class=\"headerlink\" title=\"CAST(‘X’ AS INT)，表达式返回空值 NULL。\"></a>CAST(‘X’ AS INT)，表达式返回空值 NULL。</h5><h5 id=\"—————————————————————————————————————-15\"><a href=\"#—————————————————————————————————————-15\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">0: jdbc:hive2:&#x2F;&#x2F;hadoop102:10000&gt; select &#39;1&#39;+2, cast(&#39;1&#39;as int) + 2;\n+------+------+--+\n| _c0 | _c1 |\n+------+------+--+\n| 3.0 | 3 |\n+------+------+--+<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"第-4-章-DDL数据定义\"><a href=\"#第-4-章-DDL数据定义\" class=\"headerlink\" title=\"第 4 章 DDL数据定义\"></a>第 4 章 DDL数据定义</h1><h4 id=\"4-1-创建数据库\"><a href=\"#4-1-创建数据库\" class=\"headerlink\" title=\"4 .1 创建数据库\"></a>4 .1 创建数据库</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">CREATE DATABASE [IF NOT EXISTS] database_name\n[COMMENT database_comment]\n[LOCATION hdfs_path]\n[WITH DBPROPERTIES (property_name&#x3D;property_value, ...)];<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）创建一个数据库，数据库在-HDFS-上的默认存储路径是-x2F-user-x2F-hive-x2F-warehouse-x2F-db-。\"><a href=\"#1-）创建一个数据库，数据库在-HDFS-上的默认存储路径是-x2F-user-x2F-hive-x2F-warehouse-x2F-db-。\" class=\"headerlink\" title=\"1 ）创建一个数据库，数据库在 HDFS 上的默认存储路径是 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;*.db 。\"></a>1 ）创建一个数据库，数据库在 HDFS 上的默认存储路径是 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;*.db 。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create database db_hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）避免要创建的数据库已经存在错误，增加-if-not-exists-判断。（标准写法）\"><a href=\"#2-）避免要创建的数据库已经存在错误，增加-if-not-exists-判断。（标准写法）\" class=\"headerlink\" title=\"2 ）避免要创建的数据库已经存在错误，增加 if not exists 判断。（标准写法）\"></a>2 ）避免要创建的数据库已经存在错误，增加 if not exists 判断。（标准写法）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create database db_hive;\nFAILED: Execution Error, return code 1 from\norg.apache.hadoop.hive.ql.exec.DDLTask. Database db_hive already exists\nhive (default)&gt; create database if not exists db_hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）创建一个数据库，指定数据库在-HDFS-上存放的位置\"><a href=\"#3-）创建一个数据库，指定数据库在-HDFS-上存放的位置\" class=\"headerlink\" title=\"3 ）创建一个数据库，指定数据库在 HDFS 上存放的位置\"></a>3 ）创建一个数据库，指定数据库在 HDFS 上存放的位置</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create database db_hive2 location &#39;&#x2F;db_hive2.db&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"4-2-查询数据库\"><a href=\"#4-2-查询数据库\" class=\"headerlink\" title=\"4 .2 查询数据库\"></a>4 .2 查询数据库</h4><h4 id=\"4-2-1-显示数据库\"><a href=\"#4-2-1-显示数据库\" class=\"headerlink\" title=\"4 .2.1 显示数据库\"></a>4 .2.1 显示数据库</h4><h5 id=\"1-）显示数据库\"><a href=\"#1-）显示数据库\" class=\"headerlink\" title=\"1 ）显示数据库\"></a>1 ）显示数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show databases;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）过滤显示查询的数据库\"><a href=\"#2-）过滤显示查询的数据库\" class=\"headerlink\" title=\"2 ）过滤显示查询的数据库\"></a>2 ）过滤显示查询的数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show databases like &#39;db_hive*&#39;;\nOK\ndb_hive\ndb_hive_<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"4-2-2-查看数据库详情\"><a href=\"#4-2-2-查看数据库详情\" class=\"headerlink\" title=\"4 .2.2 查看数据库详情\"></a>4 .2.2 查看数据库详情</h4><h5 id=\"1-）显示数据库信息\"><a href=\"#1-）显示数据库信息\" class=\"headerlink\" title=\"1 ）显示数据库信息\"></a>1 ）显示数据库信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc database db_hive;\nOK\ndb_hive hdfs:&#x2F;&#x2F;hadoop102: 9820 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;db_hive.db\natguiguUSER<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）显示数据库详细信息，-extended\"><a href=\"#2-）显示数据库详细信息，-extended\" class=\"headerlink\" title=\"2 ）显示数据库详细信息， extended\"></a>2 ）显示数据库详细信息， extended</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc database extended db_hive;\nOK\ndb_hive hdfs:&#x2F;&#x2F;hadoop102: 9820 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;db_hive.db\natguiguUSER<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-16\"><a href=\"#—————————————————————————————————————-16\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"4-2-3-切换当前数据库\"><a href=\"#4-2-3-切换当前数据库\" class=\"headerlink\" title=\"4. 2 .3 切换当前数据库\"></a>4. 2 .3 切换当前数据库</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; use db_hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"4-3-修改数据库\"><a href=\"#4-3-修改数据库\" class=\"headerlink\" title=\"4 .3 修改数据库\"></a>4 .3 修改数据库</h4><h5 id=\"用户可以使用ALTER-DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，\"><a href=\"#用户可以使用ALTER-DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，\" class=\"headerlink\" title=\"用户可以使用ALTER DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，\"></a>用户可以使用ALTER DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，</h5><h5 id=\"来描述这个数据库的属性信息。\"><a href=\"#来描述这个数据库的属性信息。\" class=\"headerlink\" title=\"来描述这个数据库的属性信息。\"></a>来描述这个数据库的属性信息。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; alter database db_hive\nset dbproperties(&#39;createtime&#39;&#x3D;&#39;20170830&#39;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"在hive中查看修改结果\"><a href=\"#在hive中查看修改结果\" class=\"headerlink\" title=\"在hive中查看修改结果\"></a>在hive中查看修改结果</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc database extended db_hive;\ndb_name comment location owner_name owner_type parameters\ndb_hive hdfs:&#x2F;&#x2F;hadoop102: 9820 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;db_hive.db\natguigu USER &#123;createtime&#x3D;20170830&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"4-4-删除数据库\"><a href=\"#4-4-删除数据库\" class=\"headerlink\" title=\"4 .4 删除数据库\"></a>4 .4 删除数据库</h4><h5 id=\"1-）删除空数据库\"><a href=\"#1-）删除空数据库\" class=\"headerlink\" title=\"1 ）删除空数据库\"></a>1 ）删除空数据库</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt;drop database db_hive2;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）如果删除的数据库不存在，最好采用-if-exists-判断数据库是否存在\"><a href=\"#2-）如果删除的数据库不存在，最好采用-if-exists-判断数据库是否存在\" class=\"headerlink\" title=\"2 ）如果删除的数据库不存在，最好采用 if exists 判断数据库是否存在\"></a>2 ）如果删除的数据库不存在，最好采用 if exists 判断数据库是否存在</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; drop database db_hive;\nFAILED: SemanticException [Error 10072]: Database does not exist: db_hive\nhive&gt; drop database if exists db_hive2;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）如果数据库不为空，可以采用-cascade-命令，强制删除\"><a href=\"#3-）如果数据库不为空，可以采用-cascade-命令，强制删除\" class=\"headerlink\" title=\"3 ）如果数据库不为空，可以采用 cascade 命令，强制删除\"></a>3 ）如果数据库不为空，可以采用 cascade 命令，强制删除</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; drop database db_hive;\nFAILED: Execution Error, return code 1 from\norg.apache.hadoop.hive.ql.exec.DDLTask.\nInvalidOperationException(message:Database db_hive is not empty. One or\nmore tables exist.)\nhive&gt; drop database db_hive cascade;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"4-5-创建表\"><a href=\"#4-5-创建表\" class=\"headerlink\" title=\"4 .5 创建表\"></a>4 .5 创建表</h4><h5 id=\"1-）建表语法\"><a href=\"#1-）建表语法\" class=\"headerlink\" title=\"1 ）建表语法\"></a>1 ）建表语法</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name\n[(col_name data_type [COMMENT col_comment], ...)]\n[COMMENT table_comment]\n[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]\n[CLUSTERED BY (col_name, col_name, ...)\n[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]\n[ROW FORMAT row_format]\n[STORED AS file_format]\n[LOCATION hdfs_path]\n[TBLPROPERTIES (property_name&#x3D;property_value, ...)]\n[AS select_statement]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）字段解释说明\"><a href=\"#2-）字段解释说明\" class=\"headerlink\" title=\"2 ）字段解释说明\"></a>2 ）字段解释说明</h5><h5 id=\"（-1-）CREATE-TABLE-创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；\"><a href=\"#（-1-）CREATE-TABLE-创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；\" class=\"headerlink\" title=\"（ 1 ）CREATE TABLE 创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；\"></a>（ 1 ）CREATE TABLE 创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；</h5><h5 id=\"用户可以用-IF-NOT-EXISTS-选项来忽略这个异常。\"><a href=\"#用户可以用-IF-NOT-EXISTS-选项来忽略这个异常。\" class=\"headerlink\" title=\"用户可以用 IF NOT EXISTS 选项来忽略这个异常。\"></a>用户可以用 IF NOT EXISTS 选项来忽略这个异常。</h5><h5 id=\"—————————————————————————————————————-17\"><a href=\"#—————————————————————————————————————-17\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-2-）EXTERNAL关键字可以让用户创建一个外部表，在建表的同时可以指定一个指向实\"><a href=\"#（-2-）EXTERNAL关键字可以让用户创建一个外部表，在建表的同时可以指定一个指向实\" class=\"headerlink\" title=\"（ 2 ）EXTERNAL关键字可以让用户创建一个外部表，在建表的同时可以指定一个指向实\"></a>（ 2 ）EXTERNAL关键字可以让用户创建一个外部表，在建表的同时可以指定一个指向实</h5><h5 id=\"际数据的路径（LOCATION），在删除表的时候，内部表的元数据和数据会被一起删除，而外\"><a href=\"#际数据的路径（LOCATION），在删除表的时候，内部表的元数据和数据会被一起删除，而外\" class=\"headerlink\" title=\"际数据的路径（LOCATION），在删除表的时候，内部表的元数据和数据会被一起删除，而外\"></a>际数据的路径（LOCATION），在删除表的时候，内部表的元数据和数据会被一起删除，而外</h5><h5 id=\"部表只删除元数据，不删除数据。\"><a href=\"#部表只删除元数据，不删除数据。\" class=\"headerlink\" title=\"部表只删除元数据，不删除数据。\"></a>部表只删除元数据，不删除数据。</h5><h5 id=\"（-3-）COMMENT：为表和列添加注释。\"><a href=\"#（-3-）COMMENT：为表和列添加注释。\" class=\"headerlink\" title=\"（ 3 ）COMMENT：为表和列添加注释。\"></a>（ 3 ）COMMENT：为表和列添加注释。</h5><h5 id=\"（-4-）PARTITIONED-BY创建分区表\"><a href=\"#（-4-）PARTITIONED-BY创建分区表\" class=\"headerlink\" title=\"（ 4 ）PARTITIONED BY创建分区表\"></a>（ 4 ）PARTITIONED BY创建分区表</h5><h5 id=\"（-5-）CLUSTERED-BY创建分桶表\"><a href=\"#（-5-）CLUSTERED-BY创建分桶表\" class=\"headerlink\" title=\"（ 5 ）CLUSTERED BY创建分桶表\"></a>（ 5 ）CLUSTERED BY创建分桶表</h5><h5 id=\"（-6-）SORTED-BY不常用，对桶中的一个或多个列另外排序\"><a href=\"#（-6-）SORTED-BY不常用，对桶中的一个或多个列另外排序\" class=\"headerlink\" title=\"（ 6 ）SORTED BY不常用，对桶中的一个或多个列另外排序\"></a>（ 6 ）SORTED BY不常用，对桶中的一个或多个列另外排序</h5><h5 id=\"（-7-）ROW-FORMAT\"><a href=\"#（-7-）ROW-FORMAT\" class=\"headerlink\" title=\"（ 7 ）ROW FORMAT\"></a>（ 7 ）ROW FORMAT</h5><h5 id=\"DELIMITED-FIELDS-TERMINATED-BY-char-COLLECTION-ITEMS-TERMINATED-BY-char\"><a href=\"#DELIMITED-FIELDS-TERMINATED-BY-char-COLLECTION-ITEMS-TERMINATED-BY-char\" class=\"headerlink\" title=\"DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]\"></a>DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]</h5><h5 id=\"MAP-KEYS-TERMINATED-BY-char-LINES-TERMINATED-BY-char\"><a href=\"#MAP-KEYS-TERMINATED-BY-char-LINES-TERMINATED-BY-char\" class=\"headerlink\" title=\"[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]\"></a>[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</h5><h5 id=\"SERDE-serde-name-WITH-SERDEPROPERTIES-property-name-x3D-property-value\"><a href=\"#SERDE-serde-name-WITH-SERDEPROPERTIES-property-name-x3D-property-value\" class=\"headerlink\" title=\"| SERDE serde_name [WITH SERDEPROPERTIES (property_name&#x3D;property_value,\"></a>| SERDE serde_name [WITH SERDEPROPERTIES (property_name&#x3D;property_value,</h5><h5 id=\"property-name-x3D-property-value-…\"><a href=\"#property-name-x3D-property-value-…\" class=\"headerlink\" title=\"property_name&#x3D;property_value, …)]\"></a>property_name&#x3D;property_value, …)]</h5><h5 id=\"用户在建表的时候可以自定义-SerDe-或者使用自带的-SerDe。如果没有指定-ROW\"><a href=\"#用户在建表的时候可以自定义-SerDe-或者使用自带的-SerDe。如果没有指定-ROW\" class=\"headerlink\" title=\"用户在建表的时候可以自定义 SerDe 或者使用自带的 SerDe。如果没有指定 ROW\"></a>用户在建表的时候可以自定义 SerDe 或者使用自带的 SerDe。如果没有指定 ROW</h5><h5 id=\"FORMAT-或者ROW-FORMAT-DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需\"><a href=\"#FORMAT-或者ROW-FORMAT-DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需\" class=\"headerlink\" title=\"FORMAT 或者ROW FORMAT DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需\"></a>FORMAT 或者ROW FORMAT DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需</h5><h5 id=\"要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表\"><a href=\"#要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表\" class=\"headerlink\" title=\"要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表\"></a>要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表</h5><h5 id=\"的具体的列的数据。\"><a href=\"#的具体的列的数据。\" class=\"headerlink\" title=\"的具体的列的数据。\"></a>的具体的列的数据。</h5><h5 id=\"SerDe是Serialize-x2F-Deserilize的简称，-hive使用Serde进行行对象的序列与反序列化。\"><a href=\"#SerDe是Serialize-x2F-Deserilize的简称，-hive使用Serde进行行对象的序列与反序列化。\" class=\"headerlink\" title=\"SerDe是Serialize&#x2F;Deserilize的简称， hive使用Serde进行行对象的序列与反序列化。\"></a>SerDe是Serialize&#x2F;Deserilize的简称， hive使用Serde进行行对象的序列与反序列化。</h5><h5 id=\"（-8-）STORED-AS指定存储文件类型\"><a href=\"#（-8-）STORED-AS指定存储文件类型\" class=\"headerlink\" title=\"（ 8 ）STORED AS指定存储文件类型\"></a>（ 8 ）STORED AS指定存储文件类型</h5><h5 id=\"常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、RCFILE（列\"><a href=\"#常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、RCFILE（列\" class=\"headerlink\" title=\"常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、RCFILE（列\"></a>常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、RCFILE（列</h5><h5 id=\"式存储格式文件）\"><a href=\"#式存储格式文件）\" class=\"headerlink\" title=\"式存储格式文件）\"></a>式存储格式文件）</h5><h5 id=\"如果文件数据是纯文本，可以使用STORED-AS-TEXTFILE。如果数据需要压缩，使用-STORED\"><a href=\"#如果文件数据是纯文本，可以使用STORED-AS-TEXTFILE。如果数据需要压缩，使用-STORED\" class=\"headerlink\" title=\"如果文件数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用 STORED\"></a>如果文件数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用 STORED</h5><h5 id=\"AS-SEQUENCEFILE。\"><a href=\"#AS-SEQUENCEFILE。\" class=\"headerlink\" title=\"AS SEQUENCEFILE。\"></a>AS SEQUENCEFILE。</h5><h5 id=\"（-9-）LOCATION-：指定表在HDFS上的存储位置。\"><a href=\"#（-9-）LOCATION-：指定表在HDFS上的存储位置。\" class=\"headerlink\" title=\"（ 9 ）LOCATION ：指定表在HDFS上的存储位置。\"></a>（ 9 ）LOCATION ：指定表在HDFS上的存储位置。</h5><h5 id=\"（-10-）AS：后跟查询语句，根据查询结果创建表。\"><a href=\"#（-10-）AS：后跟查询语句，根据查询结果创建表。\" class=\"headerlink\" title=\"（ 10 ）AS：后跟查询语句，根据查询结果创建表。\"></a>（ 10 ）AS：后跟查询语句，根据查询结果创建表。</h5><h5 id=\"（-11-）LIKE允许用户复制现有的表结构，但是不复制数据。\"><a href=\"#（-11-）LIKE允许用户复制现有的表结构，但是不复制数据。\" class=\"headerlink\" title=\"（ 11 ）LIKE允许用户复制现有的表结构，但是不复制数据。\"></a>（ 11 ）LIKE允许用户复制现有的表结构，但是不复制数据。</h5><h4 id=\"4-5-1-管理表\"><a href=\"#4-5-1-管理表\" class=\"headerlink\" title=\"4 .5.1 管理表\"></a>4 .5.1 管理表</h4><h5 id=\"1-）理论\"><a href=\"#1-）理论\" class=\"headerlink\" title=\"1 ）理论\"></a>1 ）理论</h5><h5 id=\"默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或\"><a href=\"#默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或\" class=\"headerlink\" title=\"默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或\"></a>默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或</h5><h5 id=\"少地）控制着数据的生命周期。Hive-默认情况下会将这些表的数据存储在由配置项\"><a href=\"#少地）控制着数据的生命周期。Hive-默认情况下会将这些表的数据存储在由配置项\" class=\"headerlink\" title=\"少地）控制着数据的生命周期。Hive 默认情况下会将这些表的数据存储在由配置项\"></a>少地）控制着数据的生命周期。Hive 默认情况下会将这些表的数据存储在由配置项</h5><h5 id=\"—————————————————————————————————————-18\"><a href=\"#—————————————————————————————————————-18\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"hive-metastore-warehouse-dir-例如，-x2F-user-x2F-hive-x2F-warehouse-所定义的目录的子目录下。\"><a href=\"#hive-metastore-warehouse-dir-例如，-x2F-user-x2F-hive-x2F-warehouse-所定义的目录的子目录下。\" class=\"headerlink\" title=\"hive.metastore.warehouse.dir(例如，&#x2F;user&#x2F;hive&#x2F;warehouse)所定义的目录的子目录下。\"></a>hive.metastore.warehouse.dir(例如，&#x2F;user&#x2F;hive&#x2F;warehouse)所定义的目录的子目录下。</h5><h5 id=\"当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享\"><a href=\"#当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享\" class=\"headerlink\" title=\"当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享\"></a>当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享</h5><h5 id=\"数据。\"><a href=\"#数据。\" class=\"headerlink\" title=\"数据。\"></a>数据。</h5><h5 id=\"2-）案例实操\"><a href=\"#2-）案例实操\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><h5 id=\"（-0-）原始数据\"><a href=\"#（-0-）原始数据\" class=\"headerlink\" title=\"（ 0 ）原始数据\"></a>（ 0 ）原始数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">1001 ss\n1002 ss\n1003 ss\n1004 ss\n1005 ss\n1006 ss\n1007 ss\n1008 ss\n1009 ss\n1010 ss\n1011 ss\n1012 ss\n1013 ss\n1014 ss\n1015 ss\n1016 ss<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-1-）普通创建表\"><a href=\"#（-1-）普通创建表\" class=\"headerlink\" title=\"（ 1 ）普通创建表\"></a>（ 1 ）普通创建表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists student(\nid int, name string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as textfile\nlocation &#39;&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;student&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）根据查询结果创建表（查询的结果会添加到新创建的表中）\"><a href=\"#（-2-）根据查询结果创建表（查询的结果会添加到新创建的表中）\" class=\"headerlink\" title=\"（ 2 ）根据查询结果创建表（查询的结果会添加到新创建的表中）\"></a>（ 2 ）根据查询结果创建表（查询的结果会添加到新创建的表中）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists student 2 as select id, name from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）根据已经存在的表结构创建表\"><a href=\"#（-3-）根据已经存在的表结构创建表\" class=\"headerlink\" title=\"（ 3 ）根据已经存在的表结构创建表\"></a>（ 3 ）根据已经存在的表结构创建表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists student 3 like student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）查询表的类型\"><a href=\"#（-4-）查询表的类型\" class=\"headerlink\" title=\"（ 4 ）查询表的类型\"></a>（ 4 ）查询表的类型</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; desc formatted student2;\nTable Type: MANAGED_TABLE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"4-5-2-外部表\"><a href=\"#4-5-2-外部表\" class=\"headerlink\" title=\"4 .5.2 外部表\"></a>4 .5.2 外部表</h4><h5 id=\"1-）理论-1\"><a href=\"#1-）理论-1\" class=\"headerlink\" title=\"1 ）理论\"></a>1 ）理论</h5><h5 id=\"因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这\"><a href=\"#因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这\" class=\"headerlink\" title=\"因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这\"></a>因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这</h5><h5 id=\"份数据，不过描述表的元数据信息会被删除掉。\"><a href=\"#份数据，不过描述表的元数据信息会被删除掉。\" class=\"headerlink\" title=\"份数据，不过描述表的元数据信息会被删除掉。\"></a>份数据，不过描述表的元数据信息会被删除掉。</h5><h5 id=\"2-）管理表和外部表的使用场景\"><a href=\"#2-）管理表和外部表的使用场景\" class=\"headerlink\" title=\"2 ）管理表和外部表的使用场景\"></a>2 ）管理表和外部表的使用场景</h5><h5 id=\"每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上\"><a href=\"#每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上\" class=\"headerlink\" title=\"每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上\"></a>每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上</h5><h5 id=\"做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT-INSERT进入\"><a href=\"#做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT-INSERT进入\" class=\"headerlink\" title=\"做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入\"></a>做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入</h5><h5 id=\"—————————————————————————————————————-19\"><a href=\"#—————————————————————————————————————-19\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"内部表。\"><a href=\"#内部表。\" class=\"headerlink\" title=\"内部表。\"></a>内部表。</h5><h5 id=\"3-）案例实操\"><a href=\"#3-）案例实操\" class=\"headerlink\" title=\"3 ）案例实操\"></a>3 ）案例实操</h5><h5 id=\"分别创建部门和员工外部表，并向表中导入数据。\"><a href=\"#分别创建部门和员工外部表，并向表中导入数据。\" class=\"headerlink\" title=\"分别创建部门和员工外部表，并向表中导入数据。\"></a>分别创建部门和员工外部表，并向表中导入数据。</h5><h5 id=\"（-0-）原始数据-1\"><a href=\"#（-0-）原始数据-1\" class=\"headerlink\" title=\"（ 0 ）原始数据\"></a>（ 0 ）原始数据</h5><h5 id=\"dept\"><a href=\"#dept\" class=\"headerlink\" title=\"dept:\"></a>dept:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">10 ACCOUNTING 1700\n20 RESEARCH 1800\n30 SALES 1900\n40 OPERATIONS 1700<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"emp：\"><a href=\"#emp：\" class=\"headerlink\" title=\"emp：\"></a>emp：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">7369 SMITH CLERK 7902 1980 - 12 - 17 800.00 20\n7499 ALLEN SALESMAN 7698 1981 - 2 - 20 1600.00 300.00 30\n7521 WARD SALESMAN 7698 1981 - 2 - 22 1250.00 500.00 30\n7566 JONES MANAGER 7839 1981 - 4 - 2 2975.00 20\n7654 MARTIN SALESMAN 7698 1981 - 9 - 28 1250.00 1400.00 30\n7698 BLAKE MANAGER 7839 1981 - 5 - 1 2850.00 30\n7782 CLARK MANAGER 7839 1981 - 6 - 9 2450.00 10\n7788 SCOTT ANALYST 7566 1987 - 4 - 19 3000.00 20\n7839 KING PRESIDENT 1981 - 11 - 17 5000.00 10\n7844 TURNER SALESMAN 7698 1981 - 9 - 8 1500.00 0.00 30\n7876 ADAMS CLERK 7788 1987 - 5 - 23 1100.00 20\n7900 JAMES CLERK 7698 1981 - 12 - 3 950.00 30\n7902 FORD ANALYST 7566 1981 - 12 - 3 3000.00 20\n7934 MILLER CLERK 7782 1982 - 1 - 23 1300.00 10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-1-）上传数据到HDFS\"><a href=\"#（-1-）上传数据到HDFS\" class=\"headerlink\" title=\"（ 1 ）上传数据到HDFS\"></a>（ 1 ）上传数据到HDFS</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -mkdir &#x2F;student;\nhive (default)&gt; dfs -put &#x2F;opt&#x2F;module&#x2F;datas&#x2F;student.txt &#x2F;student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）建表语句，创建外部表\"><a href=\"#（-2-）建表语句，创建外部表\" class=\"headerlink\" title=\"（ 2 ）建表语句，创建外部表\"></a>（ 2 ）建表语句，创建外部表</h5><h5 id=\"创建部门表\"><a href=\"#创建部门表\" class=\"headerlink\" title=\"创建部门表\"></a>创建部门表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create external table if not exists dept(\ndeptno int,\ndname string,\nloc int\n)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"创建员工表\"><a href=\"#创建员工表\" class=\"headerlink\" title=\"创建员工表\"></a>创建员工表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create external table if not exists emp(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string,\nsal double,\ncomm double,\ndeptno int)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）查看创建的表\"><a href=\"#（-3-）查看创建的表\" class=\"headerlink\" title=\"（ 3 ）查看创建的表\"></a>（ 3 ）查看创建的表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;show tables;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-20\"><a href=\"#—————————————————————————————————————-20\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-4-）查看表格式化数据\"><a href=\"#（-4-）查看表格式化数据\" class=\"headerlink\" title=\"（ 4 ）查看表格式化数据\"></a>（ 4 ）查看表格式化数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; desc formatted dept;\nTable Type: EXTERNAL_TABLE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）删除外部表\"><a href=\"#（-5-）删除外部表\" class=\"headerlink\" title=\"（ 5 ）删除外部表\"></a>（ 5 ）删除外部表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; drop table dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"外部表删除后，hdfs中的数据还在，但是metadata中dept的元数据已被删除\"><a href=\"#外部表删除后，hdfs中的数据还在，但是metadata中dept的元数据已被删除\" class=\"headerlink\" title=\"外部表删除后，hdfs中的数据还在，但是metadata中dept的元数据已被删除\"></a>外部表删除后，hdfs中的数据还在，但是metadata中dept的元数据已被删除</h5><h4 id=\"4-5-3-管理表与外部表的互相转换\"><a href=\"#4-5-3-管理表与外部表的互相转换\" class=\"headerlink\" title=\"4 .5.3 管理表与外部表的互相转换\"></a>4 .5.3 管理表与外部表的互相转换</h4><h5 id=\"（-1-）查询表的类型\"><a href=\"#（-1-）查询表的类型\" class=\"headerlink\" title=\"（ 1 ）查询表的类型\"></a>（ 1 ）查询表的类型</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; desc formatted student2;\nTable Type: MANAGED_TABLE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）修改内部表student-2-为外部表\"><a href=\"#（-2-）修改内部表student-2-为外部表\" class=\"headerlink\" title=\"（ 2 ）修改内部表student 2 为外部表\"></a>（ 2 ）修改内部表student 2 为外部表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">alter table student2 set tblproperties(&#39;EXTERNAL&#39;&#x3D;&#39;TRUE&#39;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查询表的类型\"><a href=\"#（-3-）查询表的类型\" class=\"headerlink\" title=\"（ 3 ）查询表的类型\"></a>（ 3 ）查询表的类型</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; desc formatted student2;\nTable Type: EXTERNAL_TABLE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）修改外部表student-2-为内部表\"><a href=\"#（-4-）修改外部表student-2-为内部表\" class=\"headerlink\" title=\"（ 4 ）修改外部表student 2 为内部表\"></a>（ 4 ）修改外部表student 2 为内部表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">alter table student2 set tblproperties(&#39;EXTERNAL&#39;&#x3D;&#39;FALSE&#39;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-5-）查询表的类型\"><a href=\"#（-5-）查询表的类型\" class=\"headerlink\" title=\"（ 5 ）查询表的类型\"></a>（ 5 ）查询表的类型</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; desc formatted student2;\nTable Type: MANAGED_TABLE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"注意：-‘EXTERNAL’-x3D-’TRUE’-和-‘EXTERNAL’-x3D-’FALSE’-为固定写法，区分大小写！\"><a href=\"#注意：-‘EXTERNAL’-x3D-’TRUE’-和-‘EXTERNAL’-x3D-’FALSE’-为固定写法，区分大小写！\" class=\"headerlink\" title=\"注意：(‘EXTERNAL’&#x3D;’TRUE’)和(‘EXTERNAL’&#x3D;’FALSE’)为固定写法，区分大小写！\"></a>注意：(‘EXTERNAL’&#x3D;’TRUE’)和(‘EXTERNAL’&#x3D;’FALSE’)为固定写法，区分大小写！</h5><h4 id=\"4-6-修改表\"><a href=\"#4-6-修改表\" class=\"headerlink\" title=\"4 .6 修改表\"></a>4 .6 修改表</h4><h4 id=\"4-6-1-重命名表\"><a href=\"#4-6-1-重命名表\" class=\"headerlink\" title=\"4 .6.1 重命名表\"></a>4 .6.1 重命名表</h4><h5 id=\"1-）语法\"><a href=\"#1-）语法\" class=\"headerlink\" title=\"1 ）语法\"></a>1 ）语法</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">ALTER TABLE table_name RENAME TO new_table_name<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）实操案例\"><a href=\"#2-）实操案例\" class=\"headerlink\" title=\"2 ）实操案例\"></a>2 ）实操案例</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; alter table dept_partition2 rename to dept_partition3;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"4-6-2-增加、修改和删除表分区\"><a href=\"#4-6-2-增加、修改和删除表分区\" class=\"headerlink\" title=\"4 .6.2 增加、修改和删除表分区\"></a>4 .6.2 增加、修改和删除表分区</h4><h5 id=\"详见7-1章分区表基本操作。\"><a href=\"#详见7-1章分区表基本操作。\" class=\"headerlink\" title=\"详见7.1章分区表基本操作。\"></a>详见7.1章分区表基本操作。</h5><h4 id=\"4-6-3-增加-x2F-修改-x2F-替换列信息\"><a href=\"#4-6-3-增加-x2F-修改-x2F-替换列信息\" class=\"headerlink\" title=\"4 .6.3 增加 &#x2F; 修改 &#x2F; 替换列信息\"></a>4 .6.3 增加 &#x2F; 修改 &#x2F; 替换列信息</h4><h5 id=\"1-）语法-1\"><a href=\"#1-）语法-1\" class=\"headerlink\" title=\"1 ）语法\"></a>1 ）语法</h5><h5 id=\"（-1-）更新列\"><a href=\"#（-1-）更新列\" class=\"headerlink\" title=\"（ 1 ）更新列\"></a>（ 1 ）更新列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name\ncolumn_type [COMMENT col_comment] [FIRST|AFTER column_name]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）增加和替换列\"><a href=\"#（-2-）增加和替换列\" class=\"headerlink\" title=\"（ 2 ）增加和替换列\"></a>（ 2 ）增加和替换列</h5><h5 id=\"—————————————————————————————————————-21\"><a href=\"#—————————————————————————————————————-21\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT\ncol_comment], ...)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"注：ADD是代表新增一字段，字段位置在所有列后面-partition列前-，\"><a href=\"#注：ADD是代表新增一字段，字段位置在所有列后面-partition列前-，\" class=\"headerlink\" title=\"注：ADD是代表新增一字段，字段位置在所有列后面(partition列前)，\"></a>注：ADD是代表新增一字段，字段位置在所有列后面(partition列前)，</h5><h5 id=\"REPLACE则是表示替换表中所有字段。\"><a href=\"#REPLACE则是表示替换表中所有字段。\" class=\"headerlink\" title=\"REPLACE则是表示替换表中所有字段。\"></a>REPLACE则是表示替换表中所有字段。</h5><h5 id=\"2-）实操案例-1\"><a href=\"#2-）实操案例-1\" class=\"headerlink\" title=\"2 ）实操案例\"></a>2 ）实操案例</h5><h5 id=\"（-1-）查询表结构\"><a href=\"#（-1-）查询表结构\" class=\"headerlink\" title=\"（ 1 ）查询表结构\"></a>（ 1 ）查询表结构</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）添加列\"><a href=\"#（-2-）添加列\" class=\"headerlink\" title=\"（ 2 ）添加列\"></a>（ 2 ）添加列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; alter table dept add columns(deptdesc string);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查询表结构\"><a href=\"#（-3-）查询表结构\" class=\"headerlink\" title=\"（ 3 ）查询表结构\"></a>（ 3 ）查询表结构</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）更新列\"><a href=\"#（-4-）更新列\" class=\"headerlink\" title=\"（ 4 ）更新列\"></a>（ 4 ）更新列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; alter table dept change column deptdesc desc string;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-5-）查询表结构\"><a href=\"#（-5-）查询表结构\" class=\"headerlink\" title=\"（ 5 ）查询表结构\"></a>（ 5 ）查询表结构</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-6-）替换列\"><a href=\"#（-6-）替换列\" class=\"headerlink\" title=\"（ 6 ）替换列\"></a>（ 6 ）替换列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; alter table dept replace columns(deptno string, dname\nstring, loc string);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-7-）查询表结构\"><a href=\"#（-7-）查询表结构\" class=\"headerlink\" title=\"（ 7 ）查询表结构\"></a>（ 7 ）查询表结构</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"4-7-删除表\"><a href=\"#4-7-删除表\" class=\"headerlink\" title=\"4 .7 删除表\"></a>4 .7 删除表</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; drop table dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"第-5-章-DML数据操作\"><a href=\"#第-5-章-DML数据操作\" class=\"headerlink\" title=\"第 5 章 DML数据操作\"></a>第 5 章 DML数据操作</h1><h4 id=\"5-1-数据导入\"><a href=\"#5-1-数据导入\" class=\"headerlink\" title=\"5 .1 数据导入\"></a>5 .1 数据导入</h4><h4 id=\"5-1-1-向表中装载数据（-Load-）\"><a href=\"#5-1-1-向表中装载数据（-Load-）\" class=\"headerlink\" title=\"5 .1.1 向表中装载数据（ Load ）\"></a>5 .1.1 向表中装载数据（ Load ）</h4><h5 id=\"1-）语法-2\"><a href=\"#1-）语法-2\" class=\"headerlink\" title=\"1 ）语法\"></a>1 ）语法</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; load data [local] inpath &#39;数据的path&#39; [overwrite] into table\nstudent [partition (partcol1&#x3D;val1,...)];<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-1-）load-data-表示加载数据\"><a href=\"#（-1-）load-data-表示加载数据\" class=\"headerlink\" title=\"（ 1 ）load data:表示加载数据\"></a>（ 1 ）load data:表示加载数据</h5><h5 id=\"（-2-）local-表示从本地加载数据到hive表；否则从HDFS加载数据到hive表\"><a href=\"#（-2-）local-表示从本地加载数据到hive表；否则从HDFS加载数据到hive表\" class=\"headerlink\" title=\"（ 2 ）local:表示从本地加载数据到hive表；否则从HDFS加载数据到hive表\"></a>（ 2 ）local:表示从本地加载数据到hive表；否则从HDFS加载数据到hive表</h5><h5 id=\"（-3-）inpath-表示加载数据的路径\"><a href=\"#（-3-）inpath-表示加载数据的路径\" class=\"headerlink\" title=\"（ 3 ）inpath:表示加载数据的路径\"></a>（ 3 ）inpath:表示加载数据的路径</h5><h5 id=\"（-4-）overwrite-表示覆盖表中已有数据，否则表示追加\"><a href=\"#（-4-）overwrite-表示覆盖表中已有数据，否则表示追加\" class=\"headerlink\" title=\"（ 4 ）overwrite:表示覆盖表中已有数据，否则表示追加\"></a>（ 4 ）overwrite:表示覆盖表中已有数据，否则表示追加</h5><h5 id=\"（-5-）into-table-表示加载到哪张表\"><a href=\"#（-5-）into-table-表示加载到哪张表\" class=\"headerlink\" title=\"（ 5 ）into table:表示加载到哪张表\"></a>（ 5 ）into table:表示加载到哪张表</h5><h5 id=\"（-6-）student-表示具体的表\"><a href=\"#（-6-）student-表示具体的表\" class=\"headerlink\" title=\"（ 6 ）student:表示具体的表\"></a>（ 6 ）student:表示具体的表</h5><h5 id=\"—————————————————————————————————————-22\"><a href=\"#—————————————————————————————————————-22\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-7-）partition-表示上传到指定分区\"><a href=\"#（-7-）partition-表示上传到指定分区\" class=\"headerlink\" title=\"（ 7 ）partition:表示上传到指定分区\"></a>（ 7 ）partition:表示上传到指定分区</h5><h5 id=\"2-）实操案例-2\"><a href=\"#2-）实操案例-2\" class=\"headerlink\" title=\"2 ）实操案例\"></a>2 ）实操案例</h5><h5 id=\"（-0-）创建一张表\"><a href=\"#（-0-）创建一张表\" class=\"headerlink\" title=\"（ 0 ）创建一张表\"></a>（ 0 ）创建一张表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create table student(id string, name string) row format\ndelimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-1-）加载本地文件到hive\"><a href=\"#（-1-）加载本地文件到hive\" class=\"headerlink\" title=\"（ 1 ）加载本地文件到hive\"></a>（ 1 ）加载本地文件到hive</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath\n&#39;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;student.txt&#39; into table default.student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）加载HDFS文件到hive中\"><a href=\"#（-2-）加载HDFS文件到hive中\" class=\"headerlink\" title=\"（ 2 ）加载HDFS文件到hive中\"></a>（ 2 ）加载HDFS文件到hive中</h5><h5 id=\"上传文件到HDFS\"><a href=\"#上传文件到HDFS\" class=\"headerlink\" title=\"上传文件到HDFS\"></a>上传文件到HDFS</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -put &#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;student.txt\n&#x2F;user&#x2F;atguigu&#x2F;hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"加载HDFS上数据\"><a href=\"#加载HDFS上数据\" class=\"headerlink\" title=\"加载HDFS上数据\"></a>加载HDFS上数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data inpath &#39;&#x2F;user&#x2F;atguigu&#x2F;hive&#x2F;student.txt&#39; into\ntable default.student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）加载数据覆盖表中已有的数据\"><a href=\"#（-3-）加载数据覆盖表中已有的数据\" class=\"headerlink\" title=\"（ 3 ）加载数据覆盖表中已有的数据\"></a>（ 3 ）加载数据覆盖表中已有的数据</h5><h5 id=\"上传文件到HDFS-1\"><a href=\"#上传文件到HDFS-1\" class=\"headerlink\" title=\"上传文件到HDFS\"></a>上传文件到HDFS</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -put &#x2F;opt&#x2F;module&#x2F;data&#x2F;student.txt &#x2F;user&#x2F;atguigu&#x2F;hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"加载数据覆盖表中已有的数据\"><a href=\"#加载数据覆盖表中已有的数据\" class=\"headerlink\" title=\"加载数据覆盖表中已有的数据\"></a>加载数据覆盖表中已有的数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data inpath &#39;&#x2F;user&#x2F;atguigu&#x2F;hive&#x2F;student.txt&#39;\noverwrite into table default.student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"5-1-2-通过查询语句向表中插入数据（-Insert-）\"><a href=\"#5-1-2-通过查询语句向表中插入数据（-Insert-）\" class=\"headerlink\" title=\"5 .1.2 通过查询语句向表中插入数据（ Insert ）\"></a>5 .1.2 通过查询语句向表中插入数据（ Insert ）</h4><h5 id=\"1-）创建一张表\"><a href=\"#1-）创建一张表\" class=\"headerlink\" title=\"1 ）创建一张表\"></a>1 ）创建一张表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create table student_par(id int, name string) row format\ndelimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）基本插入数据\"><a href=\"#2-）基本插入数据\" class=\"headerlink\" title=\"2 ）基本插入数据\"></a>2 ）基本插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert into table student_par\nvalues(1,&#39;wangwu&#39;),(2,&#39;zhaoliu&#39;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"3-）基本模式插入（根据单张表查询结果）\"><a href=\"#3-）基本模式插入（根据单张表查询结果）\" class=\"headerlink\" title=\"3 ）基本模式插入（根据单张表查询结果）\"></a>3 ）基本模式插入（根据单张表查询结果）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite table student_par\nselect id, name from student where month&#x3D;&#39;201709&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"insert-into：以追加数据的方式插入到表或分区，原有数据不会删除\"><a href=\"#insert-into：以追加数据的方式插入到表或分区，原有数据不会删除\" class=\"headerlink\" title=\"insert into：以追加数据的方式插入到表或分区，原有数据不会删除\"></a>insert into：以追加数据的方式插入到表或分区，原有数据不会删除</h5><h5 id=\"insert-overwrite：会覆盖表中已存在的数据\"><a href=\"#insert-overwrite：会覆盖表中已存在的数据\" class=\"headerlink\" title=\"insert overwrite：会覆盖表中已存在的数据\"></a>insert overwrite：会覆盖表中已存在的数据</h5><h5 id=\"注意：insert不支持插入部分字段\"><a href=\"#注意：insert不支持插入部分字段\" class=\"headerlink\" title=\"注意：insert不支持插入部分字段\"></a>注意：insert不支持插入部分字段</h5><h5 id=\"4-）多表（多分区）插入模式（根据多张表查询结果）\"><a href=\"#4-）多表（多分区）插入模式（根据多张表查询结果）\" class=\"headerlink\" title=\"4 ）多表（多分区）插入模式（根据多张表查询结果）\"></a>4 ）多表（多分区）插入模式（根据多张表查询结果）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; from student\ninsert overwrite table student partition(month&#x3D;&#39;201707&#39;)\nselect id, name where month&#x3D;&#39;201709&#39;\ninsert overwrite table student partition(month&#x3D;&#39;201706&#39;)\nselect id, name where month&#x3D;&#39;201709&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-23\"><a href=\"#—————————————————————————————————————-23\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"5-1-3-查询语句中创建表并加载数据（-As-Select-）\"><a href=\"#5-1-3-查询语句中创建表并加载数据（-As-Select-）\" class=\"headerlink\" title=\"5 .1.3 查询语句中创建表并加载数据（ As Select ）\"></a>5 .1.3 查询语句中创建表并加载数据（ As Select ）</h4><h5 id=\"详见4-5-1章创建表。\"><a href=\"#详见4-5-1章创建表。\" class=\"headerlink\" title=\"详见4.5.1章创建表。\"></a>详见4.5.1章创建表。</h5><h5 id=\"根据查询结果创建表（查询的结果会添加到新创建的表中）\"><a href=\"#根据查询结果创建表（查询的结果会添加到新创建的表中）\" class=\"headerlink\" title=\"根据查询结果创建表（查询的结果会添加到新创建的表中）\"></a>根据查询结果创建表（查询的结果会添加到新创建的表中）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists student3\nas select id, name from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"5-1-4-创建表时通过-Location-指定加载数据路径\"><a href=\"#5-1-4-创建表时通过-Location-指定加载数据路径\" class=\"headerlink\" title=\"5 .1.4 创建表时通过 Location 指定加载数据路径\"></a>5 .1.4 创建表时通过 Location 指定加载数据路径</h4><h5 id=\"1-）上传数据到-hdfs-上\"><a href=\"#1-）上传数据到-hdfs-上\" class=\"headerlink\" title=\"1 ）上传数据到 hdfs 上\"></a>1 ）上传数据到 hdfs 上</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -mkdir &#x2F;student;\nhive (default)&gt; dfs -put &#x2F;opt&#x2F;module&#x2F;datas&#x2F;student.txt &#x2F;student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）创建表，并指定在-hdfs-上的位置\"><a href=\"#2-）创建表，并指定在-hdfs-上的位置\" class=\"headerlink\" title=\"2 ）创建表，并指定在 hdfs 上的位置\"></a>2 ）创建表，并指定在 hdfs 上的位置</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create external table if not exists student5(\nid int, name string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nlocation &#39;&#x2F;student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）查询数据\"><a href=\"#3-）查询数据\" class=\"headerlink\" title=\"3 ）查询数据\"></a>3 ）查询数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from student5;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"5-1-5-Import-数据到指定-Hive-表中\"><a href=\"#5-1-5-Import-数据到指定-Hive-表中\" class=\"headerlink\" title=\"5.1.5 Import 数据到指定 Hive 表中\"></a>5.1.5 Import 数据到指定 Hive 表中</h4><h5 id=\"注意：先用export导出后，再将数据导入。\"><a href=\"#注意：先用export导出后，再将数据导入。\" class=\"headerlink\" title=\"注意：先用export导出后，再将数据导入。\"></a>注意：先用export导出后，再将数据导入。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; import table student 2\nfrom &#39;&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;export&#x2F;student&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"5-2-数据导出\"><a href=\"#5-2-数据导出\" class=\"headerlink\" title=\"5 .2 数据导出\"></a>5 .2 数据导出</h4><h4 id=\"5-2-1-Insert-导出\"><a href=\"#5-2-1-Insert-导出\" class=\"headerlink\" title=\"5.2.1 Insert 导出\"></a>5.2.1 Insert 导出</h4><h5 id=\"1-）将查询的结果导出到本地\"><a href=\"#1-）将查询的结果导出到本地\" class=\"headerlink\" title=\"1 ）将查询的结果导出到本地\"></a>1 ）将查询的结果导出到本地</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;export&#x2F;student&#39;\nselect * from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）将查询的结果格式化导出到本地\"><a href=\"#2-）将查询的结果格式化导出到本地\" class=\"headerlink\" title=\"2 ）将查询的结果格式化导出到本地\"></a>2 ）将查询的结果格式化导出到本地</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive(default)&gt;insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;export&#x2F;student1&#39;\nROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\\t&#39;\nselect * from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）将查询的结果导出到-HDFS-上-没有-local\"><a href=\"#3-）将查询的结果导出到-HDFS-上-没有-local\" class=\"headerlink\" title=\"3 ）将查询的结果导出到 HDFS 上 ( 没有 local)\"></a>3 ）将查询的结果导出到 HDFS 上 ( 没有 local)</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite directory &#39;&#x2F;user&#x2F;atguigu&#x2F;student2&#39;\nROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\\t&#39;\nselect * from student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"5-2-2-Hadoop-命令导出到本地\"><a href=\"#5-2-2-Hadoop-命令导出到本地\" class=\"headerlink\" title=\"5.2.2 Hadoop 命令导出到本地\"></a>5.2.2 Hadoop 命令导出到本地</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -get &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;student&#x2F;student.txt\n&#x2F;opt&#x2F;module&#x2F;data&#x2F;export&#x2F;student3.txt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-24\"><a href=\"#—————————————————————————————————————-24\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"5-2-3-Hive-Shell-命令导出\"><a href=\"#5-2-3-Hive-Shell-命令导出\" class=\"headerlink\" title=\"5.2.3 Hive Shell 命令导出\"></a>5.2.3 Hive Shell 命令导出</h4><h5 id=\"基本语法：（hive-f-x2F-e-执行语句或者脚本-gt-file）\"><a href=\"#基本语法：（hive-f-x2F-e-执行语句或者脚本-gt-file）\" class=\"headerlink\" title=\"基本语法：（hive -f&#x2F;-e 执行语句或者脚本 &gt; file）\"></a>基本语法：（hive -f&#x2F;-e 执行语句或者脚本 &gt; file）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 hive]$ bin&#x2F;hive -e &#39;select * from default.student;&#39; &gt;\n&#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;export&#x2F;student4.txt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"5-2-4-Export-导出到-HDFS-上\"><a href=\"#5-2-4-Export-导出到-HDFS-上\" class=\"headerlink\" title=\"5.2.4 Export 导出到 HDFS 上\"></a>5.2.4 Export 导出到 HDFS 上</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">(defahiveult)&gt; export table default.student\nto &#39;&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;export&#x2F;student&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"export和import主要用于两个Hadoop平台集群之间Hive表迁移。\"><a href=\"#export和import主要用于两个Hadoop平台集群之间Hive表迁移。\" class=\"headerlink\" title=\"export和import主要用于两个Hadoop平台集群之间Hive表迁移。\"></a>export和import主要用于两个Hadoop平台集群之间Hive表迁移。</h5><h4 id=\"5-2-5-Sqoop-导出\"><a href=\"#5-2-5-Sqoop-导出\" class=\"headerlink\" title=\"5.2.5 Sqoop 导出\"></a>5.2.5 Sqoop 导出</h4><h5 id=\"后续课程专门讲。\"><a href=\"#后续课程专门讲。\" class=\"headerlink\" title=\"后续课程专门讲。\"></a>后续课程专门讲。</h5><h4 id=\"5-2-6-清除表中数据（-Truncate-）\"><a href=\"#5-2-6-清除表中数据（-Truncate-）\" class=\"headerlink\" title=\"5.2.6 清除表中数据（ Truncate ）\"></a>5.2.6 清除表中数据（ Truncate ）</h4><h5 id=\"注意：Truncate只能删除管理表，不能删除外部表中数据\"><a href=\"#注意：Truncate只能删除管理表，不能删除外部表中数据\" class=\"headerlink\" title=\"注意：Truncate只能删除管理表，不能删除外部表中数据\"></a>注意：Truncate只能删除管理表，不能删除外部表中数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; truncate table student;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"第-6-章-查询\"><a href=\"#第-6-章-查询\" class=\"headerlink\" title=\"第 6 章 查询\"></a>第 6 章 查询</h1><h5 id=\"https-cwiki-apache-org-confluence-display-Hive-LanguageManual-Select\"><a href=\"#https-cwiki-apache-org-confluence-display-Hive-LanguageManual-Select\" class=\"headerlink\" title=\"https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select\"></a><a href=\"https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select\">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select</a></h5><h5 id=\"查询语句语法：\"><a href=\"#查询语句语法：\" class=\"headerlink\" title=\"查询语句语法：\"></a>查询语句语法：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT [ALL | DISTINCT] select_expr, select_expr, ...\nFROM table_reference\n[WHERE where_condition]\n[GROUP BY col_list]\n[ORDER BY col_list]\n[CLUSTER BY col_list\n| [DISTRIBUTE BY col_list] [SORT BY col_list]\n]\n[LIMIT number]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"6-1-基本查询（-Select…From-）\"><a href=\"#6-1-基本查询（-Select…From-）\" class=\"headerlink\" title=\"6 .1 基本查询（ Select…From ）\"></a>6 .1 基本查询（ Select…From ）</h4><h4 id=\"6-1-1-全表和特定列查询\"><a href=\"#6-1-1-全表和特定列查询\" class=\"headerlink\" title=\"6 .1.1 全表和特定列查询\"></a>6 .1.1 全表和特定列查询</h4><h5 id=\"0-）数据准备\"><a href=\"#0-）数据准备\" class=\"headerlink\" title=\"0 ）数据准备\"></a>0 ）数据准备</h5><h5 id=\"（-0-）原始数据-2\"><a href=\"#（-0-）原始数据-2\" class=\"headerlink\" title=\"（ 0 ）原始数据\"></a>（ 0 ）原始数据</h5><h5 id=\"dept-1\"><a href=\"#dept-1\" class=\"headerlink\" title=\"dept:\"></a>dept:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">10 ACCOUNTING 1700\n20 RESEARCH 1800\n30 SALES 1900\n40 OPERATIONS 1700<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"emp：-1\"><a href=\"#emp：-1\" class=\"headerlink\" title=\"emp：\"></a>emp：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">7369 SMITH CLERK 7902 1980 - 12 - 17 800.00 20<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-25\"><a href=\"#—————————————————————————————————————-25\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">7499 ALLEN SALESMAN 7698 1981 - 2 - 20 1600.00 300.00 30\n7521 WARD SALESMAN 7698 1981 - 2 - 22 1250.00 500.00 30\n7566 JONES MANAGER 7839 1981 - 4 - 2 2975.00 20\n7654 MARTIN SALESMAN 7698 1981 - 9 - 28 1250.00 1400.00 30\n7698 BLAKE MANAGER 7839 1981 - 5 - 1 2850.00 30\n7782 CLARK MANAGER 7839 1981 - 6 - 9 2450.00 10\n7788 SCOTT ANALYST 7566 1987 - 4 - 19 3000.00 20\n7839 KING PRESIDENT 1981 - 11 - 17 5000.00 10\n7844 TURNER SALESMAN 7698 1981 - 9 - 8 1500.00 0.00 30\n7876 ADAMS CLERK 7788 1987 - 5 - 23 1100.00 20\n7900 JAMES CLERK 7698 1981 - 12 - 3 950.00 30\n7902 FORD ANALYST 7566 1981 - 12 - 3 3000.00 20\n7934 MILLER CLERK 7782 1982 - 1 - 23 1300.00 10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-1-）创建部门表\"><a href=\"#（-1-）创建部门表\" class=\"headerlink\" title=\"（ 1 ）创建部门表\"></a>（ 1 ）创建部门表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists dept(\ndeptno int,\ndname string,\nloc int\n)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）创建员工表\"><a href=\"#（-2-）创建员工表\" class=\"headerlink\" title=\"（ 2 ）创建员工表\"></a>（ 2 ）创建员工表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists emp(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string,\nsal double,\ncomm double,\ndeptno int)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）导入数据\"><a href=\"#（-3-）导入数据\" class=\"headerlink\" title=\"（ 3 ）导入数据\"></a>（ 3 ）导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;datas&#x2F;dept.txt&#39; into table\ndept;\nload data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;datas&#x2F;emp.txt&#39; into table emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）全表查询\"><a href=\"#1-）全表查询\" class=\"headerlink\" title=\"1 ）全表查询\"></a>1 ）全表查询</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp;\nhive (default)&gt; select empno,ename,job,mgr,hiredate,sal,comm,deptno from\nemp ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）选择特定列查询\"><a href=\"#2-）选择特定列查询\" class=\"headerlink\" title=\"2 ）选择特定列查询\"></a>2 ）选择特定列查询</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select empno, ename from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h5><h5 id=\"（-1-）SQL-语言大小写不敏感。\"><a href=\"#（-1-）SQL-语言大小写不敏感。\" class=\"headerlink\" title=\"（ 1 ）SQL 语言大小写不敏感。\"></a>（ 1 ）SQL 语言大小写不敏感。</h5><h5 id=\"（-2-）SQL-可以写在一行或者多行\"><a href=\"#（-2-）SQL-可以写在一行或者多行\" class=\"headerlink\" title=\"（ 2 ）SQL 可以写在一行或者多行\"></a>（ 2 ）SQL 可以写在一行或者多行</h5><h5 id=\"（-3-）关键字不能被缩写也不能分行\"><a href=\"#（-3-）关键字不能被缩写也不能分行\" class=\"headerlink\" title=\"（ 3 ）关键字不能被缩写也不能分行\"></a>（ 3 ）关键字不能被缩写也不能分行</h5><h5 id=\"（-4-）各子句一般要分行写。\"><a href=\"#（-4-）各子句一般要分行写。\" class=\"headerlink\" title=\"（ 4 ）各子句一般要分行写。\"></a>（ 4 ）各子句一般要分行写。</h5><h5 id=\"—————————————————————————————————————-26\"><a href=\"#—————————————————————————————————————-26\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-5-）使用缩进提高语句的可读性。\"><a href=\"#（-5-）使用缩进提高语句的可读性。\" class=\"headerlink\" title=\"（ 5 ）使用缩进提高语句的可读性。\"></a>（ 5 ）使用缩进提高语句的可读性。</h5><h4 id=\"6-1-2-列别名\"><a href=\"#6-1-2-列别名\" class=\"headerlink\" title=\"6 .1.2 列别名\"></a>6 .1.2 列别名</h4><h5 id=\"1-）重命名一个列\"><a href=\"#1-）重命名一个列\" class=\"headerlink\" title=\"1 ）重命名一个列\"></a>1 ）重命名一个列</h5><h5 id=\"2-）便于计算\"><a href=\"#2-）便于计算\" class=\"headerlink\" title=\"2 ）便于计算\"></a>2 ）便于计算</h5><h5 id=\"3-）紧跟列名，也可以在列名和别名之间加入关键字‘-AS-’\"><a href=\"#3-）紧跟列名，也可以在列名和别名之间加入关键字‘-AS-’\" class=\"headerlink\" title=\"3 ）紧跟列名，也可以在列名和别名之间加入关键字‘ AS ’\"></a>3 ）紧跟列名，也可以在列名和别名之间加入关键字‘ AS ’</h5><h5 id=\"4-）案例实操\"><a href=\"#4-）案例实操\" class=\"headerlink\" title=\"4 ）案例实操\"></a>4 ）案例实操</h5><h5 id=\"查询名称和部门\"><a href=\"#查询名称和部门\" class=\"headerlink\" title=\"查询名称和部门\"></a>查询名称和部门</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select ename AS name, deptno dn from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-3-算术运算符\"><a href=\"#6-1-3-算术运算符\" class=\"headerlink\" title=\"6 .1.3 算术运算符\"></a>6 .1.3 算术运算符</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">运算符 描述\nA+B A和B 相加\nA-B A减去B\nA*B A和B 相乘\nA&#x2F;B A除以B\nA%B A对B取余\nA&amp;B A和B按位取与\nA|B A和B按位取或\nA^B A和B按位取异或\n~A A按位取反<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"案例实操：查询出所有员工的薪水后加-1-显示。\"><a href=\"#案例实操：查询出所有员工的薪水后加-1-显示。\" class=\"headerlink\" title=\"案例实操：查询出所有员工的薪水后加 1 显示。\"></a>案例实操：查询出所有员工的薪水后加 1 显示。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select sal +1 from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-4-常用函数\"><a href=\"#6-1-4-常用函数\" class=\"headerlink\" title=\"6 .1.4 常用函数\"></a>6 .1.4 常用函数</h4><h5 id=\"1-）求总行数（-count-）\"><a href=\"#1-）求总行数（-count-）\" class=\"headerlink\" title=\"1 ）求总行数（ count ）\"></a>1 ）求总行数（ count ）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(*) cnt from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）求工资的最大值（-max-）\"><a href=\"#2-）求工资的最大值（-max-）\" class=\"headerlink\" title=\"2 ）求工资的最大值（ max ）\"></a>2 ）求工资的最大值（ max ）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select max(sal) max_sal from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）求工资的最小值（-min-）\"><a href=\"#3-）求工资的最小值（-min-）\" class=\"headerlink\" title=\"3 ）求工资的最小值（ min ）\"></a>3 ）求工资的最小值（ min ）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select min(sal) min_sal from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"4-）求工资的总和（-sum-）\"><a href=\"#4-）求工资的总和（-sum-）\" class=\"headerlink\" title=\"4 ）求工资的总和（ sum ）\"></a>4 ）求工资的总和（ sum ）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select sum(sal) sum_sal from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"5-）求工资的平均值（-avg-）\"><a href=\"#5-）求工资的平均值（-avg-）\" class=\"headerlink\" title=\"5 ）求工资的平均值（ avg ）\"></a>5 ）求工资的平均值（ avg ）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select avg(sal) avg_sal from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-5-Limit-语句\"><a href=\"#6-1-5-Limit-语句\" class=\"headerlink\" title=\"6.1.5 Limit 语句\"></a>6.1.5 Limit 语句</h4><h5 id=\"典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。\"><a href=\"#典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。\" class=\"headerlink\" title=\"典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。\"></a>典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp limit 5;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-27\"><a href=\"#—————————————————————————————————————-27\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp limit 2 ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-6-Where-语句\"><a href=\"#6-1-6-Where-语句\" class=\"headerlink\" title=\"6.1.6 Where 语句\"></a>6.1.6 Where 语句</h4><h5 id=\"1-）使用-WHERE-子句，将不满足条件的行过滤掉\"><a href=\"#1-）使用-WHERE-子句，将不满足条件的行过滤掉\" class=\"headerlink\" title=\"1 ）使用 WHERE 子句，将不满足条件的行过滤掉\"></a>1 ）使用 WHERE 子句，将不满足条件的行过滤掉</h5><h5 id=\"2-）-WHERE-子句紧随-FROM-子句\"><a href=\"#2-）-WHERE-子句紧随-FROM-子句\" class=\"headerlink\" title=\"2 ） WHERE 子句紧随 FROM 子句\"></a>2 ） WHERE 子句紧随 FROM 子句</h5><h5 id=\"3-）案例实操-1\"><a href=\"#3-）案例实操-1\" class=\"headerlink\" title=\"3 ）案例实操\"></a>3 ）案例实操</h5><h5 id=\"查询出薪水大于-1000-的所有员工\"><a href=\"#查询出薪水大于-1000-的所有员工\" class=\"headerlink\" title=\"查询出薪水大于 1000 的所有员工\"></a>查询出薪水大于 1000 的所有员工</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal &gt;1000;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"注意：where子句中不能使用字段别名。\"><a href=\"#注意：where子句中不能使用字段别名。\" class=\"headerlink\" title=\"注意：where子句中不能使用字段别名。\"></a>注意：where子句中不能使用字段别名。</h5><h4 id=\"6-1-7-比较运算符（-Between-x2F-In-x2F-Is-Null-）\"><a href=\"#6-1-7-比较运算符（-Between-x2F-In-x2F-Is-Null-）\" class=\"headerlink\" title=\"6 .1.7 比较运算符（ Between&#x2F;In&#x2F; Is Null ）\"></a>6 .1.7 比较运算符（ Between&#x2F;In&#x2F; Is Null ）</h4><h5 id=\"1-）下面表中描述了谓词操作符，这些操作符同样可以用于-JOIN…ON-和-HAVING-语句中。\"><a href=\"#1-）下面表中描述了谓词操作符，这些操作符同样可以用于-JOIN…ON-和-HAVING-语句中。\" class=\"headerlink\" title=\"1 ）下面表中描述了谓词操作符，这些操作符同样可以用于 JOIN…ON 和 HAVING 语句中。\"></a>1 ）下面表中描述了谓词操作符，这些操作符同样可以用于 JOIN…ON 和 HAVING 语句中。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">操作符 支持的数据类型 描述\nA&#x3D;B 基本数据类型 如果A等于B则返回TRUE，反之返回FALSE\nA&lt;&#x3D;&gt;B 基本数据类型 如果A和B都为NULL，则返回TRUE，如果一边为NULL，\n返回False\nA&lt;&gt;B, A!&#x3D;B 基本数据类型 A或者B为NULL则返回NULL；如果A不等于B，则返回\nTRUE，反之返回FALSE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>A&lt;B (^) 基本数据类型 A或者B为NULL，则返回NULL；如果A小于B，则返回<br>TRUE，反之返回FALSE<br>A&lt;&#x3D;B 基本数据类型 A或者B为NULL，则返回NULL；如果A小于等于B，则返<br>回TRUE，反之返回FALSE<br>A&gt;B 基本数据类型 A或者B为NULL，则返回NULL；如果A大于B，则返回<br>TRUE，反之返回FALSE<br>A&gt;&#x3D;B (^) 基本数据类型 A或者B为NULL，则返回NULL；如果A大于等于B，则返<br>回TRUE，反之返回FALSE<br>A [NOT] BETWEEN B<br>AND C<br>基本数据类型 如果A，B或者C任一为NULL，则结果为NULL。如果A的<br>值大于等于B而且小于或等于C，则结果为TRUE，反之为FALSE。<br>如果使用NOT关键字则可达到相反的效果。<br>A IS NULL (^) 所有数据类型 如果A等于NULL，则返回TRUE，反之返回FALSE<br>A IS NOT NULL 所有数据类型 如果A不等于NULL，则返回TRUE，反之返回FALSE<br>IN(数值1, 数值2) 所有数据类型 使用 IN运算显示列表中的值<br>A [NOT] LIKE B STRING 类型 B是一个SQL下的简单正则表达式，也叫通配符模式，如<br>果A与其匹配的话，则返回TRUE；反之返回FALSE。B的表达式<br>说明如下：‘x%’表示A必须以字母‘x’开头，‘%x’表示A<br>必须以字母’x’结尾，而‘%x%’表示A包含有字母’x’,可以<br>位于开头，结尾或者字符串中间。如果使用NOT关键字则可达到<br>相反的效果。<br>A RLIKE B, A REGEXP B STRING 类型 B是基于java的正则表达式，如果A与其匹配，则返回<br>TRUE；反之返回FALSE。匹配使用的是JDK中的正则表达式接口</p>\n<h5 id=\"—————————————————————————————————————-28\"><a href=\"#—————————————————————————————————————-28\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">实现的，因为正则也依据其中的规则。例如，正则表达式必须和\n整个字符串A相匹配，而不是只需与其字符串匹配。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）案例实操-1\"><a href=\"#2-）案例实操-1\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><h5 id=\"（-1-）查询出薪水等于-5000-的所有员工\"><a href=\"#（-1-）查询出薪水等于-5000-的所有员工\" class=\"headerlink\" title=\"（ 1 ）查询出薪水等于 5000 的所有员工\"></a>（ 1 ）查询出薪水等于 5000 的所有员工</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal &#x3D;5000;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）查询工资在-500-到-1000-的员工信息\"><a href=\"#（-2-）查询工资在-500-到-1000-的员工信息\" class=\"headerlink\" title=\"（ 2 ）查询工资在 500 到 1000 的员工信息\"></a>（ 2 ）查询工资在 500 到 1000 的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal between 500 and 1000;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查询comm为空的所有员工信息\"><a href=\"#（-3-）查询comm为空的所有员工信息\" class=\"headerlink\" title=\"（ 3 ）查询comm为空的所有员工信息\"></a>（ 3 ）查询comm为空的所有员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where comm is null;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）查询工资是-1500-或-5000-的员工信息\"><a href=\"#（-4-）查询工资是-1500-或-5000-的员工信息\" class=\"headerlink\" title=\"（ 4 ）查询工资是 1500 或 5000 的员工信息\"></a>（ 4 ）查询工资是 1500 或 5000 的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal IN (1500, 5000);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-8-Like-和-RLike\"><a href=\"#6-1-8-Like-和-RLike\" class=\"headerlink\" title=\"6.1.8 Like 和 RLike\"></a>6.1.8 Like 和 RLike</h4><h5 id=\"1-）使用-LIKE-运算选择类似的值\"><a href=\"#1-）使用-LIKE-运算选择类似的值\" class=\"headerlink\" title=\"1 ）使用 LIKE 运算选择类似的值\"></a>1 ）使用 LIKE 运算选择类似的值</h5><h5 id=\"2-）选择条件可以包含字符或数字\"><a href=\"#2-）选择条件可以包含字符或数字\" class=\"headerlink\" title=\"2 ）选择条件可以包含字符或数字 :\"></a>2 ）选择条件可以包含字符或数字 :</h5><h5 id=\"代表零个或多个字符-任意个字符-。\"><a href=\"#代表零个或多个字符-任意个字符-。\" class=\"headerlink\" title=\"% 代表零个或多个字符(任意个字符)。\"></a>% 代表零个或多个字符(任意个字符)。</h5><h5 id=\"代表一个字符。\"><a href=\"#代表一个字符。\" class=\"headerlink\" title=\"_ 代表一个字符。\"></a>_ 代表一个字符。</h5><h5 id=\"3-）-RLIKE-子句\"><a href=\"#3-）-RLIKE-子句\" class=\"headerlink\" title=\"3 ） RLIKE 子句\"></a>3 ） RLIKE 子句</h5><h5 id=\"RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大\"><a href=\"#RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大\" class=\"headerlink\" title=\"RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大\"></a>RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大</h5><h5 id=\"的语言来指定匹配条件。\"><a href=\"#的语言来指定匹配条件。\" class=\"headerlink\" title=\"的语言来指定匹配条件。\"></a>的语言来指定匹配条件。</h5><h5 id=\"4-）案例实操-1\"><a href=\"#4-）案例实操-1\" class=\"headerlink\" title=\"4 ）案例实操\"></a>4 ）案例实操</h5><h5 id=\"（-1-）查找名字以A开头的员工信息\"><a href=\"#（-1-）查找名字以A开头的员工信息\" class=\"headerlink\" title=\"（ 1 ）查找名字以A开头的员工信息\"></a>（ 1 ）查找名字以A开头的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where ename LIKE &#39;A%&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）查找名字中第二个字母为A的员工信息\"><a href=\"#（-2-）查找名字中第二个字母为A的员工信息\" class=\"headerlink\" title=\"（ 2 ）查找名字中第二个字母为A的员工信息\"></a>（ 2 ）查找名字中第二个字母为A的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where ename LIKE &#39;_A%&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查找名字中带有A的员工信息\"><a href=\"#（-3-）查找名字中带有A的员工信息\" class=\"headerlink\" title=\"（ 3 ）查找名字中带有A的员工信息\"></a>（ 3 ）查找名字中带有A的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where ename RLIKE &#39;[A]&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-1-9-逻辑运算符（-And-x2F-Or-x2F-Not-）\"><a href=\"#6-1-9-逻辑运算符（-And-x2F-Or-x2F-Not-）\" class=\"headerlink\" title=\"6 .1.9 逻辑运算符（ And&#x2F;Or&#x2F;Not ）\"></a>6 .1.9 逻辑运算符（ And&#x2F;Or&#x2F;Not ）</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">操作符 含义\nAND 逻辑并\nOR 逻辑或\nNOT 逻辑否<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）案例实操-1\"><a href=\"#1-）案例实操-1\" class=\"headerlink\" title=\"1 ）案例实操\"></a>1 ）案例实操</h5><h5 id=\"（-1-）查询薪水大于-1000-，部门是-30\"><a href=\"#（-1-）查询薪水大于-1000-，部门是-30\" class=\"headerlink\" title=\"（ 1 ）查询薪水大于 1000 ，部门是 30\"></a>（ 1 ）查询薪水大于 1000 ，部门是 30</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal&gt;1000 and deptno&#x3D;30;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-29\"><a href=\"#—————————————————————————————————————-29\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-2-）查询薪水大于-1000-，或者部门是-30\"><a href=\"#（-2-）查询薪水大于-1000-，或者部门是-30\" class=\"headerlink\" title=\"（ 2 ）查询薪水大于 1000 ，或者部门是 30\"></a>（ 2 ）查询薪水大于 1000 ，或者部门是 30</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where sal&gt;1000 or deptno&#x3D;30;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查询除了-20-部门和-30-部门以外的员工信息\"><a href=\"#（-3-）查询除了-20-部门和-30-部门以外的员工信息\" class=\"headerlink\" title=\"（ 3 ）查询除了 20 部门和 30 部门以外的员工信息\"></a>（ 3 ）查询除了 20 部门和 30 部门以外的员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp where deptno not IN(30, 20);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-2-分组\"><a href=\"#6-2-分组\" class=\"headerlink\" title=\"6 .2 分组\"></a>6 .2 分组</h4><h4 id=\"6-2-1-Group-By-语句\"><a href=\"#6-2-1-Group-By-语句\" class=\"headerlink\" title=\"6.2.1 Group By 语句\"></a>6.2.1 Group By 语句</h4><h5 id=\"GROUP-BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然\"><a href=\"#GROUP-BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然\" class=\"headerlink\" title=\"GROUP BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然\"></a>GROUP BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然</h5><h5 id=\"后对每个组执行聚合操作。\"><a href=\"#后对每个组执行聚合操作。\" class=\"headerlink\" title=\"后对每个组执行聚合操作。\"></a>后对每个组执行聚合操作。</h5><h5 id=\"1-）案例实操：\"><a href=\"#1-）案例实操：\" class=\"headerlink\" title=\"1 ）案例实操：\"></a>1 ）案例实操：</h5><h5 id=\"（-1-）计算emp表每个部门的平均工资\"><a href=\"#（-1-）计算emp表每个部门的平均工资\" class=\"headerlink\" title=\"（ 1 ）计算emp表每个部门的平均工资\"></a>（ 1 ）计算emp表每个部门的平均工资</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select t.deptno, avg(t.sal) avg_sal from emp t group by\nt.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）计算emp每个部门中每个岗位的最高薪水\"><a href=\"#（-2-）计算emp每个部门中每个岗位的最高薪水\" class=\"headerlink\" title=\"（ 2 ）计算emp每个部门中每个岗位的最高薪水\"></a>（ 2 ）计算emp每个部门中每个岗位的最高薪水</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select t.deptno, t.job, max(t.sal) max_sal from emp t\ngroup by\nt.deptno, t.job;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"6-2-2-Having-语句\"><a href=\"#6-2-2-Having-语句\" class=\"headerlink\" title=\"6.2.2 Having 语句\"></a>6.2.2 Having 语句</h4><h5 id=\"1-）-having-与-where-不同点\"><a href=\"#1-）-having-与-where-不同点\" class=\"headerlink\" title=\"1 ） having 与 where 不同点\"></a>1 ） having 与 where 不同点</h5><h5 id=\"（-1-）where后面不能写分组函数，而having后面可以使用分组函数。\"><a href=\"#（-1-）where后面不能写分组函数，而having后面可以使用分组函数。\" class=\"headerlink\" title=\"（ 1 ）where后面不能写分组函数，而having后面可以使用分组函数。\"></a>（ 1 ）where后面不能写分组函数，而having后面可以使用分组函数。</h5><h5 id=\"（-2-）having只用于group-by分组统计语句。\"><a href=\"#（-2-）having只用于group-by分组统计语句。\" class=\"headerlink\" title=\"（ 2 ）having只用于group by分组统计语句。\"></a>（ 2 ）having只用于group by分组统计语句。</h5><h5 id=\"2-）案例实操-2\"><a href=\"#2-）案例实操-2\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><h5 id=\"（-1-）求每个部门的平均薪水大于-2000-的部门\"><a href=\"#（-1-）求每个部门的平均薪水大于-2000-的部门\" class=\"headerlink\" title=\"（ 1 ）求每个部门的平均薪水大于 2000 的部门\"></a>（ 1 ）求每个部门的平均薪水大于 2000 的部门</h5><h5 id=\"求每个部门的平均工资\"><a href=\"#求每个部门的平均工资\" class=\"headerlink\" title=\"求每个部门的平均工资\"></a>求每个部门的平均工资</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select deptno, avg(sal) from emp group by deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"求每个部门的平均薪水大于-2000-的部门\"><a href=\"#求每个部门的平均薪水大于-2000-的部门\" class=\"headerlink\" title=\"求每个部门的平均薪水大于 2000 的部门\"></a>求每个部门的平均薪水大于 2000 的部门</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select deptno, avg(sal) avg_sal from emp group by deptno\nhaving avg_sal &gt; 2000;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-Join-语句\"><a href=\"#6-3-Join-语句\" class=\"headerlink\" title=\"6.3 Join 语句\"></a>6.3 Join 语句</h4><h4 id=\"6-3-1-等值-Join\"><a href=\"#6-3-1-等值-Join\" class=\"headerlink\" title=\"6.3.1 等值 Join\"></a>6.3.1 等值 Join</h4><h5 id=\"Hive支持通常的SQL-JOIN语句。\"><a href=\"#Hive支持通常的SQL-JOIN语句。\" class=\"headerlink\" title=\"Hive支持通常的SQL JOIN语句。\"></a>Hive支持通常的SQL JOIN语句。</h5><h5 id=\"1-）案例实操-2\"><a href=\"#1-）案例实操-2\" class=\"headerlink\" title=\"1 ）案例实操\"></a>1 ）案例实操</h5><h5 id=\"（-1-）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称；\"><a href=\"#（-1-）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称；\" class=\"headerlink\" title=\"（ 1 ）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称；\"></a>（ 1 ）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称；</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno, d.dname from emp e<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-30\"><a href=\"#—————————————————————————————————————-30\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">join dept d on e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-3-2-表的别名\"><a href=\"#6-3-2-表的别名\" class=\"headerlink\" title=\"6 .3.2 表的别名\"></a>6 .3.2 表的别名</h4><h5 id=\"1-）好处\"><a href=\"#1-）好处\" class=\"headerlink\" title=\"1 ）好处\"></a>1 ）好处</h5><h5 id=\"（-1-）使用别名可以简化查询。\"><a href=\"#（-1-）使用别名可以简化查询。\" class=\"headerlink\" title=\"（ 1 ）使用别名可以简化查询。\"></a>（ 1 ）使用别名可以简化查询。</h5><h5 id=\"（-2-）使用表名前缀可以提高执行效率。\"><a href=\"#（-2-）使用表名前缀可以提高执行效率。\" class=\"headerlink\" title=\"（ 2 ）使用表名前缀可以提高执行效率。\"></a>（ 2 ）使用表名前缀可以提高执行效率。</h5><h5 id=\"2-）案例实操-3\"><a href=\"#2-）案例实操-3\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><h5 id=\"合并员工表和部门表\"><a href=\"#合并员工表和部门表\" class=\"headerlink\" title=\"合并员工表和部门表\"></a>合并员工表和部门表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d\non e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-3-内连接\"><a href=\"#6-3-3-内连接\" class=\"headerlink\" title=\"6 .3.3 内连接\"></a>6 .3.3 内连接</h4><h5 id=\"内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。\"><a href=\"#内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。\" class=\"headerlink\" title=\"内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。\"></a>内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d\non e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-4-左外连接\"><a href=\"#6-3-4-左外连接\" class=\"headerlink\" title=\"6 .3.4 左外连接\"></a>6 .3.4 左外连接</h4><h5 id=\"左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。\"><a href=\"#左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。\" class=\"headerlink\" title=\"左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。\"></a>左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e left join\ndept d on e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-5-右外连接\"><a href=\"#6-3-5-右外连接\" class=\"headerlink\" title=\"6 .3.5 右外连接\"></a>6 .3.5 右外连接</h4><h5 id=\"右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。\"><a href=\"#右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。\" class=\"headerlink\" title=\"右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。\"></a>右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e right join\ndept d on e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-6-满外连接\"><a href=\"#6-3-6-满外连接\" class=\"headerlink\" title=\"6 .3.6 满外连接\"></a>6 .3.6 满外连接</h4><h5 id=\"满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字\"><a href=\"#满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字\" class=\"headerlink\" title=\"满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字\"></a>满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字</h5><h5 id=\"段没有符合条件的值的话，那么就使用NULL值替代。\"><a href=\"#段没有符合条件的值的话，那么就使用NULL值替代。\" class=\"headerlink\" title=\"段没有符合条件的值的话，那么就使用NULL值替代。\"></a>段没有符合条件的值的话，那么就使用NULL值替代。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select e.empno, e.ename, d.deptno from emp e full join\ndept d on e.deptno &#x3D; d.deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"6-3-7-多表连接\"><a href=\"#6-3-7-多表连接\" class=\"headerlink\" title=\"6 .3.7 多表连接\"></a>6 .3.7 多表连接</h4><h5 id=\"注意：连接-n个表，至少需要n-1-个连接条件。例如：连接三个表，至少需要两个连接\"><a href=\"#注意：连接-n个表，至少需要n-1-个连接条件。例如：连接三个表，至少需要两个连接\" class=\"headerlink\" title=\"注意：连接 n个表，至少需要n- 1 个连接条件。例如：连接三个表，至少需要两个连接\"></a>注意：连接 n个表，至少需要n- 1 个连接条件。例如：连接三个表，至少需要两个连接</h5><h5 id=\"条件。\"><a href=\"#条件。\" class=\"headerlink\" title=\"条件。\"></a>条件。</h5><h5 id=\"数据准备\"><a href=\"#数据准备\" class=\"headerlink\" title=\"数据准备\"></a>数据准备</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">1700 Beijing\n1800 London\n1900 Tokyo<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）创建位置表\"><a href=\"#1-）创建位置表\" class=\"headerlink\" title=\"1 ）创建位置表\"></a>1 ）创建位置表</h5><h5 id=\"—————————————————————————————————————-31\"><a href=\"#—————————————————————————————————————-31\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table if not exists location(\nloc int,\nloc_name string\n)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）导入数据\"><a href=\"#2-）导入数据\" class=\"headerlink\" title=\"2 ）导入数据\"></a>2 ）导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;datas&#x2F;location.txt&#39;\ninto table location;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"3-）多表连接查询\"><a href=\"#3-）多表连接查询\" class=\"headerlink\" title=\"3 ）多表连接查询\"></a>3 ）多表连接查询</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;SELECT e.ename, d.dname, l.loc_name\nFROM emp e\nJOIN dept d\nON d.deptno &#x3D; e.deptno\nJOIN location l\nON d.loc &#x3D; l.loc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先\"><a href=\"#大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先\" class=\"headerlink\" title=\"大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先\"></a>大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先</h5><h5 id=\"启动一个MapReduce-job对表e和表d进行连接操作，然后会再启动一个MapReduce-job将\"><a href=\"#启动一个MapReduce-job对表e和表d进行连接操作，然后会再启动一个MapReduce-job将\" class=\"headerlink\" title=\"启动一个MapReduce job对表e和表d进行连接操作，然后会再启动一个MapReduce job将\"></a>启动一个MapReduce job对表e和表d进行连接操作，然后会再启动一个MapReduce job将</h5><h5 id=\"第一个MapReduce-job的输出和表l-进行连接操作。\"><a href=\"#第一个MapReduce-job的输出和表l-进行连接操作。\" class=\"headerlink\" title=\"第一个MapReduce job的输出和表l;进行连接操作。\"></a>第一个MapReduce job的输出和表l;进行连接操作。</h5><h5 id=\"注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的\"><a href=\"#注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的\" class=\"headerlink\" title=\"注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的\"></a>注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的</h5><h5 id=\"顺序执行的。\"><a href=\"#顺序执行的。\" class=\"headerlink\" title=\"顺序执行的。\"></a>顺序执行的。</h5><h5 id=\"优化：当对-3-个或者更多表进行join连接时，如果每个on子句都使用相同的连接键的\"><a href=\"#优化：当对-3-个或者更多表进行join连接时，如果每个on子句都使用相同的连接键的\" class=\"headerlink\" title=\"优化：当对 3 个或者更多表进行join连接时，如果每个on子句都使用相同的连接键的\"></a>优化：当对 3 个或者更多表进行join连接时，如果每个on子句都使用相同的连接键的</h5><h5 id=\"话，那么只会产生一个MapReduce-job。\"><a href=\"#话，那么只会产生一个MapReduce-job。\" class=\"headerlink\" title=\"话，那么只会产生一个MapReduce job。\"></a>话，那么只会产生一个MapReduce job。</h5><h4 id=\"6-3-8-笛卡尔积\"><a href=\"#6-3-8-笛卡尔积\" class=\"headerlink\" title=\"6 .3.8 笛卡尔积\"></a>6 .3.8 笛卡尔积</h4><h5 id=\"1-）笛卡尔集会在下面条件下产生\"><a href=\"#1-）笛卡尔集会在下面条件下产生\" class=\"headerlink\" title=\"1 ）笛卡尔集会在下面条件下产生\"></a>1 ）笛卡尔集会在下面条件下产生</h5><h5 id=\"（-1-）省略连接条件\"><a href=\"#（-1-）省略连接条件\" class=\"headerlink\" title=\"（ 1 ）省略连接条件\"></a>（ 1 ）省略连接条件</h5><h5 id=\"（-2-）连接条件无效\"><a href=\"#（-2-）连接条件无效\" class=\"headerlink\" title=\"（ 2 ）连接条件无效\"></a>（ 2 ）连接条件无效</h5><h5 id=\"（-3-）所有表中的所有行互相连接\"><a href=\"#（-3-）所有表中的所有行互相连接\" class=\"headerlink\" title=\"（ 3 ）所有表中的所有行互相连接\"></a>（ 3 ）所有表中的所有行互相连接</h5><h5 id=\"2-）案例实操-4\"><a href=\"#2-）案例实操-4\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select empno, dname from emp, dept;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-4-排序\"><a href=\"#6-4-排序\" class=\"headerlink\" title=\"6 .4 排序\"></a>6 .4 排序</h4><h4 id=\"6-4-1-全局排序（-Order-By-）\"><a href=\"#6-4-1-全局排序（-Order-By-）\" class=\"headerlink\" title=\"6.4.1 全局排序（ Order By ）\"></a>6.4.1 全局排序（ Order By ）</h4><h5 id=\"Order-By：全局排序，只有一个Reducer\"><a href=\"#Order-By：全局排序，只有一个Reducer\" class=\"headerlink\" title=\"Order By：全局排序，只有一个Reducer\"></a>Order By：全局排序，只有一个Reducer</h5><h5 id=\"1-）使用-ORDER-BY-子句排序\"><a href=\"#1-）使用-ORDER-BY-子句排序\" class=\"headerlink\" title=\"1 ）使用 ORDER BY 子句排序\"></a>1 ）使用 ORDER BY 子句排序</h5><h5 id=\"ASC（ascend）-升序（默认）\"><a href=\"#ASC（ascend）-升序（默认）\" class=\"headerlink\" title=\"ASC（ascend）: 升序（默认）\"></a>ASC（ascend）: 升序（默认）</h5><h5 id=\"DESC（descend）-降序\"><a href=\"#DESC（descend）-降序\" class=\"headerlink\" title=\"DESC（descend）: 降序\"></a>DESC（descend）: 降序</h5><h5 id=\"—————————————————————————————————————-32\"><a href=\"#—————————————————————————————————————-32\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"2-）-ORDER-BY-子句在-SELECT-语句的结尾\"><a href=\"#2-）-ORDER-BY-子句在-SELECT-语句的结尾\" class=\"headerlink\" title=\"2 ） ORDER BY 子句在 SELECT 语句的结尾\"></a>2 ） ORDER BY 子句在 SELECT 语句的结尾</h5><h5 id=\"3-）案例实操-2\"><a href=\"#3-）案例实操-2\" class=\"headerlink\" title=\"3 ）案例实操\"></a>3 ）案例实操</h5><h5 id=\"（-1-）查询员工信息按工资升序排列\"><a href=\"#（-1-）查询员工信息按工资升序排列\" class=\"headerlink\" title=\"（ 1 ）查询员工信息按工资升序排列\"></a>（ 1 ）查询员工信息按工资升序排列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp order by sal;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）查询员工信息按工资降序排列\"><a href=\"#（-2-）查询员工信息按工资降序排列\" class=\"headerlink\" title=\"（ 2 ）查询员工信息按工资降序排列\"></a>（ 2 ）查询员工信息按工资降序排列</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp order by sal desc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-4-2-按照别名排序\"><a href=\"#6-4-2-按照别名排序\" class=\"headerlink\" title=\"6 .4.2 按照别名排序\"></a>6 .4.2 按照别名排序</h4><h5 id=\"按照员工薪水的-2-倍排序\"><a href=\"#按照员工薪水的-2-倍排序\" class=\"headerlink\" title=\"按照员工薪水的 2 倍排序\"></a>按照员工薪水的 2 倍排序</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select ename, sal*2 twosal from emp order by twosal;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-4-3-多个列排序\"><a href=\"#6-4-3-多个列排序\" class=\"headerlink\" title=\"6 .4.3 多个列排序\"></a>6 .4.3 多个列排序</h4><h5 id=\"按照部门和工资升序排序\"><a href=\"#按照部门和工资升序排序\" class=\"headerlink\" title=\"按照部门和工资升序排序\"></a>按照部门和工资升序排序</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select ename, deptno, sal from emp order by deptno, sal;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"6-4-4-每个-Reduce-内部排序（-Sort-By-）\"><a href=\"#6-4-4-每个-Reduce-内部排序（-Sort-By-）\" class=\"headerlink\" title=\"6 .4.4 每个 Reduce 内部排序（ Sort By ）\"></a>6 .4.4 每个 Reduce 内部排序（ Sort By ）</h4><h5 id=\"Sort-By：对于大规模的数据集order-by的效率非常低。在很多情况下，并不需要全局排\"><a href=\"#Sort-By：对于大规模的数据集order-by的效率非常低。在很多情况下，并不需要全局排\" class=\"headerlink\" title=\"Sort By：对于大规模的数据集order by的效率非常低。在很多情况下，并不需要全局排\"></a>Sort By：对于大规模的数据集order by的效率非常低。在很多情况下，并不需要全局排</h5><h5 id=\"序，此时可以使用-sort-by-。\"><a href=\"#序，此时可以使用-sort-by-。\" class=\"headerlink\" title=\"序，此时可以使用 sort by 。\"></a>序，此时可以使用 sort by 。</h5><h5 id=\"Sort-by为每个reducer产生一个排序文件。每个Reducer内部进行排序，对全局结果集\"><a href=\"#Sort-by为每个reducer产生一个排序文件。每个Reducer内部进行排序，对全局结果集\" class=\"headerlink\" title=\"Sort by为每个reducer产生一个排序文件。每个Reducer内部进行排序，对全局结果集\"></a>Sort by为每个reducer产生一个排序文件。每个Reducer内部进行排序，对全局结果集</h5><h5 id=\"来说不是排序。\"><a href=\"#来说不是排序。\" class=\"headerlink\" title=\"来说不是排序。\"></a>来说不是排序。</h5><h5 id=\"1-）设置-reduce-个数\"><a href=\"#1-）设置-reduce-个数\" class=\"headerlink\" title=\"1 ）设置 reduce 个数\"></a>1 ）设置 reduce 个数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapreduce.job.reduces&#x3D;3;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）查看设置-reduce-个数\"><a href=\"#2-）查看设置-reduce-个数\" class=\"headerlink\" title=\"2 ）查看设置 reduce 个数\"></a>2 ）查看设置 reduce 个数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapreduce.job.reduces;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）根据部门编号降序查看员工信息\"><a href=\"#3-）根据部门编号降序查看员工信息\" class=\"headerlink\" title=\"3 ）根据部门编号降序查看员工信息\"></a>3 ）根据部门编号降序查看员工信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp sort by deptno desc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"4-）将查询结果导入到文件中（按照部门编号降序排序）\"><a href=\"#4-）将查询结果导入到文件中（按照部门编号降序排序）\" class=\"headerlink\" title=\"4 ）将查询结果导入到文件中（按照部门编号降序排序）\"></a>4 ）将查询结果导入到文件中（按照部门编号降序排序）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;sortby-result&#39;\nselect * from emp sort by deptno desc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"6-4-5-分区（-Distribute-By-）\"><a href=\"#6-4-5-分区（-Distribute-By-）\" class=\"headerlink\" title=\"6 .4.5 分区（ Distribute By ）\"></a>6 .4.5 分区（ Distribute By ）</h4><h5 id=\"Distribute-By：-在有些情况下，我们需要控制某个特定行应该到哪个reducer，通常是为\"><a href=\"#Distribute-By：-在有些情况下，我们需要控制某个特定行应该到哪个reducer，通常是为\" class=\"headerlink\" title=\"Distribute By： 在有些情况下，我们需要控制某个特定行应该到哪个reducer，通常是为\"></a>Distribute By： 在有些情况下，我们需要控制某个特定行应该到哪个reducer，通常是为</h5><h5 id=\"了进行后续的聚集操作。-distribute-by-子句可以做这件事。-distribute-by-类似MR中partition\"><a href=\"#了进行后续的聚集操作。-distribute-by-子句可以做这件事。-distribute-by-类似MR中partition\" class=\"headerlink\" title=\"了进行后续的聚集操作。 distribute by 子句可以做这件事。 distribute by 类似MR中partition\"></a>了进行后续的聚集操作。 distribute by 子句可以做这件事。 distribute by 类似MR中partition</h5><h5 id=\"（自定义分区），进行分区，结合sort-by使用。\"><a href=\"#（自定义分区），进行分区，结合sort-by使用。\" class=\"headerlink\" title=\"（自定义分区），进行分区，结合sort by使用。\"></a>（自定义分区），进行分区，结合sort by使用。</h5><h5 id=\"对于distribute-by进行测试，一定要分配多reduce进行处理，否则无法看到distribute\"><a href=\"#对于distribute-by进行测试，一定要分配多reduce进行处理，否则无法看到distribute\" class=\"headerlink\" title=\"对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute\"></a>对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute</h5><h5 id=\"by的效果。\"><a href=\"#by的效果。\" class=\"headerlink\" title=\"by的效果。\"></a>by的效果。</h5><h5 id=\"—————————————————————————————————————-33\"><a href=\"#—————————————————————————————————————-33\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"1-）案例实操：-1\"><a href=\"#1-）案例实操：-1\" class=\"headerlink\" title=\"1 ）案例实操：\"></a>1 ）案例实操：</h5><h5 id=\"（-1-）先按照部门编号分区，再按照员工编号降序排序。\"><a href=\"#（-1-）先按照部门编号分区，再按照员工编号降序排序。\" class=\"headerlink\" title=\"（ 1 ）先按照部门编号分区，再按照员工编号降序排序。\"></a>（ 1 ）先按照部门编号分区，再按照员工编号降序排序。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapreduce.job.reduces&#x3D;3;\nhive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;distribute-result&#39; select * from emp distribute by\ndeptno sort by empno desc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"注意：-1\"><a href=\"#注意：-1\" class=\"headerlink\" title=\"注意：\"></a>注意：</h5><h5 id=\"➢-distribute-by的分区规则是根据分区字段的hash码与reduce的个数进行模除后，\"><a href=\"#➢-distribute-by的分区规则是根据分区字段的hash码与reduce的个数进行模除后，\" class=\"headerlink\" title=\"➢ distribute by的分区规则是根据分区字段的hash码与reduce的个数进行模除后，\"></a>➢ distribute by的分区规则是根据分区字段的hash码与reduce的个数进行模除后，</h5><h5 id=\"余数相同的分到一个区。\"><a href=\"#余数相同的分到一个区。\" class=\"headerlink\" title=\"余数相同的分到一个区。\"></a>余数相同的分到一个区。</h5><h5 id=\"➢-Hive要求DISTRIBUTE-BY语句要写在SORT-BY语句之前。\"><a href=\"#➢-Hive要求DISTRIBUTE-BY语句要写在SORT-BY语句之前。\" class=\"headerlink\" title=\"➢ Hive要求DISTRIBUTE BY语句要写在SORT BY语句之前。\"></a>➢ Hive要求DISTRIBUTE BY语句要写在SORT BY语句之前。</h5><h4 id=\"6-4-6-Cluster-By\"><a href=\"#6-4-6-Cluster-By\" class=\"headerlink\" title=\"6.4.6 Cluster By\"></a>6.4.6 Cluster By</h4><h5 id=\"当distribute-by和sorts-by字段相同时，可以使用cluster-by方式。\"><a href=\"#当distribute-by和sorts-by字段相同时，可以使用cluster-by方式。\" class=\"headerlink\" title=\"当distribute by和sorts by字段相同时，可以使用cluster by方式。\"></a>当distribute by和sorts by字段相同时，可以使用cluster by方式。</h5><h5 id=\"cluster-by除了具有distribute-by的功能外还兼具sort-by的功能。但是排序只能是升序\"><a href=\"#cluster-by除了具有distribute-by的功能外还兼具sort-by的功能。但是排序只能是升序\" class=\"headerlink\" title=\"cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序只能是升序\"></a>cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序只能是升序</h5><h5 id=\"排序，不能指定排序规则为ASC或者DESC。\"><a href=\"#排序，不能指定排序规则为ASC或者DESC。\" class=\"headerlink\" title=\"排序，不能指定排序规则为ASC或者DESC。\"></a>排序，不能指定排序规则为ASC或者DESC。</h5><h5 id=\"（-1-）以下两种写法等价\"><a href=\"#（-1-）以下两种写法等价\" class=\"headerlink\" title=\"（ 1 ）以下两种写法等价\"></a>（ 1 ）以下两种写法等价</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select * from emp cluster by deptno;\nhive (default)&gt; select * from emp distribute by deptno sort by deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"注意：按照部门编号分区，不一定就是固定死的数值，可以是-20-号和-30-号部门分到一\"><a href=\"#注意：按照部门编号分区，不一定就是固定死的数值，可以是-20-号和-30-号部门分到一\" class=\"headerlink\" title=\"注意：按照部门编号分区，不一定就是固定死的数值，可以是 20 号和 30 号部门分到一\"></a>注意：按照部门编号分区，不一定就是固定死的数值，可以是 20 号和 30 号部门分到一</h5><h5 id=\"个分区里面去。\"><a href=\"#个分区里面去。\" class=\"headerlink\" title=\"个分区里面去。\"></a>个分区里面去。</h5><h1 id=\"第-7-章-分区表和分桶表\"><a href=\"#第-7-章-分区表和分桶表\" class=\"headerlink\" title=\"第 7 章 分区表和分桶表\"></a>第 7 章 分区表和分桶表</h1><h2 id=\"7-1-分区表\"><a href=\"#7-1-分区表\" class=\"headerlink\" title=\"7.1 分区表\"></a>7.1 分区表</h2><p>分区表实际上就是对应一个 HDFS 文件系统上的<strong>独立的文件夹</strong>，该文件夹下是该分区所有的数据文件。</p>\n<p>Hive 中的分区 &#x3D; 分目录，把一个大的数据集根据业务需要分割成小的数据集。</p>\n<p>在查询时通过 WHERE 子句中的表达式选择查询所需要的指定的分区，这样的查询效率会提高很多。</p>\n<p>why? 数据量太大于是分门别类</p>\n<p>How?</p>\n<p>1、创建</p>\n<p><span style=\"color:blue\">partitioned by (day string)</span></p>\n<pre class=\"line-numbers language-mysql\" data-language=\"mysql\"><code class=\"language-mysql\">create table dept_partition(\n    deptno int,\n    dname string,\n    loc string\n)\npartitioned by (day string)\nrow format delimited fields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>2、加载数据</p>\n<p>3、查询</p>\n<p><code>分区名 = 值</code></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> dept_partition <span class=\"token keyword\">where</span> <span class=\"token keyword\">day</span><span class=\"token operator\">=</span><span class=\"token string\">'20200401'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<p>3、增加分区</p>\n<p>删除分区</p>\n<p>查看分区表有多少分区</p>\n<p>查看分区表结构</p>\n<p>二级分区 </p>\n<p>what：做了一级拆分后数据量还是太大，因此很容易想到，将一级分区的数据再分，比如说一级分区按天，二级分区按小时</p>\n<p>how</p>\n<p>创建</p>\n<p>加载数据</p>\n<p>查询</p>\n<p>增加分区</p>\n<p>删除分区</p>\n<p>查看分区表有多少分区</p>\n<p>查看分区表结构</p>\n<h2 id=\"7-2-分桶表\"><a href=\"#7-2-分桶表\" class=\"headerlink\" title=\"7.2 分桶表\"></a>7.2 分桶表</h2><h1 id=\"第-8-章-函数\"><a href=\"#第-8-章-函数\" class=\"headerlink\" title=\"第 8 章 函数\"></a>第 8 章 函数</h1><h4 id=\"8-1-系统内置函数\"><a href=\"#8-1-系统内置函数\" class=\"headerlink\" title=\"8 .1 系统内置函数\"></a>8 .1 系统内置函数</h4><h5 id=\"1-）查看系统自带的函数\"><a href=\"#1-）查看系统自带的函数\" class=\"headerlink\" title=\"1 ）查看系统自带的函数\"></a>1 ）查看系统自带的函数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; show functions;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）显示自带的函数的用法\"><a href=\"#2-）显示自带的函数的用法\" class=\"headerlink\" title=\"2 ）显示自带的函数的用法\"></a>2 ）显示自带的函数的用法</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc function upper;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）详细显示自带的函数的用法\"><a href=\"#3-）详细显示自带的函数的用法\" class=\"headerlink\" title=\"3 ）详细显示自带的函数的用法\"></a>3 ）详细显示自带的函数的用法</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive&gt; desc function extended upper;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"8-2-常用内置函数\"><a href=\"#8-2-常用内置函数\" class=\"headerlink\" title=\"8 .2 常用内置函数\"></a>8 .2 常用内置函数</h4><h4 id=\"8-2-1-空字段赋值\"><a href=\"#8-2-1-空字段赋值\" class=\"headerlink\" title=\"8 .2.1 空字段赋值\"></a>8 .2.1 空字段赋值</h4><h5 id=\"1-）函数说明\"><a href=\"#1-）函数说明\" class=\"headerlink\" title=\"1 ）函数说明\"></a>1 ）函数说明</h5><h5 id=\"NVL：给值为NULL的数据赋值，它的格式是NVL-value，default-value-。它的功能是如\"><a href=\"#NVL：给值为NULL的数据赋值，它的格式是NVL-value，default-value-。它的功能是如\" class=\"headerlink\" title=\"NVL：给值为NULL的数据赋值，它的格式是NVL( value，default_value)。它的功能是如\"></a>NVL：给值为NULL的数据赋值，它的格式是NVL( value，default_value)。它的功能是如</h5><h5 id=\"果value为NULL，则NVL函数返回default-value的值，否则返回value的值，如果两个参数\"><a href=\"#果value为NULL，则NVL函数返回default-value的值，否则返回value的值，如果两个参数\" class=\"headerlink\" title=\"果value为NULL，则NVL函数返回default_value的值，否则返回value的值，如果两个参数\"></a>果value为NULL，则NVL函数返回default_value的值，否则返回value的值，如果两个参数</h5><h5 id=\"都为NULL-，则返回NULL。\"><a href=\"#都为NULL-，则返回NULL。\" class=\"headerlink\" title=\"都为NULL ，则返回NULL。\"></a>都为NULL ，则返回NULL。</h5><h5 id=\"2-）数据准备：采用员工表\"><a href=\"#2-）数据准备：采用员工表\" class=\"headerlink\" title=\"2 ）数据准备：采用员工表\"></a>2 ）数据准备：采用员工表</h5><h5 id=\"3-）查询：如果员工的-comm-为-NULL-，则用-1-代替\"><a href=\"#3-）查询：如果员工的-comm-为-NULL-，则用-1-代替\" class=\"headerlink\" title=\"3 ）查询：如果员工的 comm 为 NULL ，则用 - 1 代替\"></a>3 ）查询：如果员工的 comm 为 NULL ，则用 - 1 代替</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select comm,nvl(comm, -1) from emp;\nOK\ncomm _c1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-34\"><a href=\"#—————————————————————————————————————-34\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">NULL -1.0\n300.0 300.0\n500.0 500.0\nNULL -1.0\n140 0.0 1400.0\nNULL -1.0\nNULL -1.0\nNULL -1.0\nNULL -1.0\n0.0 0.0\nNULL -1.0\nNULL -1.0\nNULL -1.0\nNULL -1.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）查询：如果员工的-comm-为-NULL-，则用领导-id-代替\"><a href=\"#4-）查询：如果员工的-comm-为-NULL-，则用领导-id-代替\" class=\"headerlink\" title=\"4 ）查询：如果员工的 comm 为 NULL ，则用领导 id 代替\"></a>4 ）查询：如果员工的 comm 为 NULL ，则用领导 id 代替</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select comm, nvl(comm,mgr) from emp;\nOK\ncomm _c1\nNULL 7902.0\n300.0 300.0\n500.0 500.0\nNULL 7839.0\n1400.0 1400.0\nNULL 7839.0\nNULL 7839.0\nNULL 7566.0\nNULL NULL\n0.0 0.0\nNULL 7788.0\nNULL 7698.0\nNULL 7566.0\nNULL 7782.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"8-2-2-CASE-WHEN-THEN-ELSE-END\"><a href=\"#8-2-2-CASE-WHEN-THEN-ELSE-END\" class=\"headerlink\" title=\"8 .2.2 CASE WHEN THEN ELSE END\"></a>8 .2.2 CASE WHEN THEN ELSE END</h4><h5 id=\"1-）数据准备\"><a href=\"#1-）数据准备\" class=\"headerlink\" title=\"1 ）数据准备\"></a>1 ）数据准备</h5><h5 id=\"name-dept-id-sex\"><a href=\"#name-dept-id-sex\" class=\"headerlink\" title=\"name dept_id sex\"></a>name dept_id sex</h5><h5 id=\"悟空-A-男\"><a href=\"#悟空-A-男\" class=\"headerlink\" title=\"悟空 A^ 男\"></a>悟空 A^ 男</h5><h5 id=\"大海-A-男\"><a href=\"#大海-A-男\" class=\"headerlink\" title=\"大海 A^ 男\"></a>大海 A^ 男</h5><h5 id=\"宋宋-B-男\"><a href=\"#宋宋-B-男\" class=\"headerlink\" title=\"宋宋 B^ 男\"></a>宋宋 B^ 男</h5><h5 id=\"凤姐-A-女\"><a href=\"#凤姐-A-女\" class=\"headerlink\" title=\"凤姐 A 女\"></a>凤姐 A 女</h5><h5 id=\"婷姐-B-女\"><a href=\"#婷姐-B-女\" class=\"headerlink\" title=\"婷姐 B 女\"></a>婷姐 B 女</h5><h5 id=\"婷婷-B-女\"><a href=\"#婷婷-B-女\" class=\"headerlink\" title=\"婷婷 B 女\"></a>婷婷 B 女</h5><h5 id=\"2-）需求\"><a href=\"#2-）需求\" class=\"headerlink\" title=\"2 ）需求\"></a>2 ）需求</h5><h5 id=\"求出不同部门男女各多少人。结果如下：\"><a href=\"#求出不同部门男女各多少人。结果如下：\" class=\"headerlink\" title=\"求出不同部门男女各多少人。结果如下：\"></a>求出不同部门男女各多少人。结果如下：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">dept_Id 男 女\nA 2 1\nB 1 2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）创建本地-emp-sex-txt-，导入数据\"><a href=\"#3-）创建本地-emp-sex-txt-，导入数据\" class=\"headerlink\" title=\"3 ）创建本地 emp_sex.txt ，导入数据\"></a>3 ）创建本地 emp_sex.txt ，导入数据</h5><h5 id=\"—————————————————————————————————————-35\"><a href=\"#—————————————————————————————————————-35\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ vi emp_sex.txt\n悟空 A 男\n大海 A 男\n宋宋 B 男\n凤姐 A 女\n婷姐 B 女\n婷婷 B 女<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）创建-hive-表并导入数据\"><a href=\"#4-）创建-hive-表并导入数据\" class=\"headerlink\" title=\"4 ）创建 hive 表并导入数据\"></a>4 ）创建 hive 表并导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table emp_sex(\nname string,\ndept_id string,\nsex string)\nrow format delimited fields terminated by &quot;\\t&quot;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;emp_sex.txt&#39; into table\nemp_sex;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"5-）按需求查询数据\"><a href=\"#5-）按需求查询数据\" class=\"headerlink\" title=\"5 ）按需求查询数据\"></a>5 ）按需求查询数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select\ndept_id,\nsum(case sex when &#39;男&#39; then 1 else 0 end) male_count,\nsum(case sex when &#39;女&#39; then 1 else 0 end) female_count\nfrom emp_sex\ngroup by dept_id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"8-2-3-行转列\"><a href=\"#8-2-3-行转列\" class=\"headerlink\" title=\"8 .2.3 行转列\"></a>8 .2.3 行转列</h4><h5 id=\"1-）相关函数说明\"><a href=\"#1-）相关函数说明\" class=\"headerlink\" title=\"1 ）相关函数说明\"></a>1 ）相关函数说明</h5><h5 id=\"CONCAT-string-A-x2F-col-string-B-x2F-col…-：返回输入字符串连接后的结果，支持任意个输入字\"><a href=\"#CONCAT-string-A-x2F-col-string-B-x2F-col…-：返回输入字符串连接后的结果，支持任意个输入字\" class=\"headerlink\" title=\"CONCAT(string A&#x2F;col, string B&#x2F;col…)：返回输入字符串连接后的结果，支持任意个输入字\"></a>CONCAT(string A&#x2F;col, string B&#x2F;col…)：返回输入字符串连接后的结果，支持任意个输入字</h5><h5 id=\"符串\"><a href=\"#符串\" class=\"headerlink\" title=\"符串;\"></a>符串;</h5><h5 id=\"CONCAT-WS-separator-str1-str2-…-：它是一个特殊形式的-CONCAT-。第一个参数剩余参\"><a href=\"#CONCAT-WS-separator-str1-str2-…-：它是一个特殊形式的-CONCAT-。第一个参数剩余参\" class=\"headerlink\" title=\"CONCAT_WS(separator, str1, str2,…)：它是一个特殊形式的 CONCAT()。第一个参数剩余参\"></a>CONCAT_WS(separator, str1, str2,…)：它是一个特殊形式的 CONCAT()。第一个参数剩余参</h5><h5 id=\"数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是-NULL，返回值也将\"><a href=\"#数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是-NULL，返回值也将\" class=\"headerlink\" title=\"数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将\"></a>数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将</h5><h5 id=\"为-NULL。这个函数会跳过分隔符参数后的任何-NULL-和空字符串。分隔符将被加到被连接\"><a href=\"#为-NULL。这个函数会跳过分隔符参数后的任何-NULL-和空字符串。分隔符将被加到被连接\" class=\"headerlink\" title=\"为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接\"></a>为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接</h5><h5 id=\"的字符串之间\"><a href=\"#的字符串之间\" class=\"headerlink\" title=\"的字符串之间;\"></a>的字符串之间;</h5><h5 id=\"注意-CONCAT-WS-must-be-“string-or-array\"><a href=\"#注意-CONCAT-WS-must-be-“string-or-array\" class=\"headerlink\" title=\"注意: CONCAT_WS must be “string or array\"></a>注意: CONCAT_WS must be “string or array<string></h5><h5 id=\"COLLECT-SET-col-：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重\"><a href=\"#COLLECT-SET-col-：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重\" class=\"headerlink\" title=\"COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重\"></a>COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重</h5><h5 id=\"汇总，产生Array类型字段。\"><a href=\"#汇总，产生Array类型字段。\" class=\"headerlink\" title=\"汇总，产生Array类型字段。\"></a>汇总，产生Array类型字段。</h5><h5 id=\"2-）数据准备\"><a href=\"#2-）数据准备\" class=\"headerlink\" title=\"2 ）数据准备\"></a>2 ）数据准备</h5><h5 id=\"name-constellation-blood-type\"><a href=\"#name-constellation-blood-type\" class=\"headerlink\" title=\"name constellation blood_type\"></a>name constellation blood_type</h5><h5 id=\"孙悟空-白羊座-A\"><a href=\"#孙悟空-白羊座-A\" class=\"headerlink\" title=\"孙悟空 白羊座 A^\"></a>孙悟空 白羊座 A^</h5><h5 id=\"大海-射手座-A\"><a href=\"#大海-射手座-A\" class=\"headerlink\" title=\"大海 射手座 A^\"></a>大海 射手座 A^</h5><h5 id=\"宋宋-白羊座-B\"><a href=\"#宋宋-白羊座-B\" class=\"headerlink\" title=\"宋宋 白羊座 B^\"></a>宋宋 白羊座 B^</h5><h5 id=\"—————————————————————————————————————-36\"><a href=\"#—————————————————————————————————————-36\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"猪八戒-白羊座-A\"><a href=\"#猪八戒-白羊座-A\" class=\"headerlink\" title=\"猪八戒 白羊座 A^\"></a>猪八戒 白羊座 A^</h5><h5 id=\"凤姐-射手座-A\"><a href=\"#凤姐-射手座-A\" class=\"headerlink\" title=\"凤姐 射手座 A\"></a>凤姐 射手座 A</h5><h5 id=\"苍老师-白羊座-B\"><a href=\"#苍老师-白羊座-B\" class=\"headerlink\" title=\"苍老师 白羊座 B\"></a>苍老师 白羊座 B</h5><h5 id=\"3-）需求\"><a href=\"#3-）需求\" class=\"headerlink\" title=\"3 ）需求\"></a>3 ）需求</h5><h5 id=\"把星座和血型一样的人归类到一起。结果如下：\"><a href=\"#把星座和血型一样的人归类到一起。结果如下：\" class=\"headerlink\" title=\"把星座和血型一样的人归类到一起。结果如下：\"></a>把星座和血型一样的人归类到一起。结果如下：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">射手座,A 大海|凤姐\n白羊座,A 孙悟空|猪八戒\n白羊座,B 宋宋|苍老师<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）创建本地-constellation-txt-，导入数据\"><a href=\"#4-）创建本地-constellation-txt-，导入数据\" class=\"headerlink\" title=\"4 ）创建本地 constellation.txt ，导入数据\"></a>4 ）创建本地 constellation.txt ，导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ vim person_info.txt\n孙悟空 白羊座 A\n大海 射手座 A\n宋宋 白羊座 B\n猪八戒 白羊座 A\n凤姐 射手座 A\n苍老师 白羊座 B<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"5-）创建-hive-表并导入数据\"><a href=\"#5-）创建-hive-表并导入数据\" class=\"headerlink\" title=\"5 ）创建 hive 表并导入数据\"></a>5 ）创建 hive 表并导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table person_info(\nname string,\nconstellation string,\nblood_type string)\nrow format delimited fields terminated by &quot;\\t&quot;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">load data local inpath &quot;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;person_info.txt&quot; into table\nperson_info;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"6-）按需求查询数据\"><a href=\"#6-）按需求查询数据\" class=\"headerlink\" title=\"6 ）按需求查询数据\"></a>6 ）按需求查询数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt1.c_b,\nCONCAT_WS(&quot;|&quot;,collect_set(t1.name))\nFROM (\nSELECT\nNAME,\nCONCAT_WS(&#39;,&#39;,constellation,blood_type) c_b\nFROM person_info\n)t1\nGROUP BY t1.c_b<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"8-2-4-列转行\"><a href=\"#8-2-4-列转行\" class=\"headerlink\" title=\"8 .2.4 列转行\"></a>8 .2.4 列转行</h4><h5 id=\"1-）函数说明-1\"><a href=\"#1-）函数说明-1\" class=\"headerlink\" title=\"1 ）函数说明\"></a>1 ）函数说明</h5><h5 id=\"EXPLODE-col-：将hive一列中复杂的Array或者Map结构拆分成多行。\"><a href=\"#EXPLODE-col-：将hive一列中复杂的Array或者Map结构拆分成多行。\" class=\"headerlink\" title=\"EXPLODE(col)：将hive一列中复杂的Array或者Map结构拆分成多行。\"></a>EXPLODE(col)：将hive一列中复杂的Array或者Map结构拆分成多行。</h5><h5 id=\"LATERAL-VIEW\"><a href=\"#LATERAL-VIEW\" class=\"headerlink\" title=\"LATERAL VIEW\"></a>LATERAL VIEW</h5><h5 id=\"用法：LATERAL-VIEW-udtf-expression-tableAlias-AS-columnAlias\"><a href=\"#用法：LATERAL-VIEW-udtf-expression-tableAlias-AS-columnAlias\" class=\"headerlink\" title=\"用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias\"></a>用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</h5><h5 id=\"解释：用于和split-explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此\"><a href=\"#解释：用于和split-explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此\" class=\"headerlink\" title=\"解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此\"></a>解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此</h5><h5 id=\"基础上可以对拆分后的数据进行聚合。\"><a href=\"#基础上可以对拆分后的数据进行聚合。\" class=\"headerlink\" title=\"基础上可以对拆分后的数据进行聚合。\"></a>基础上可以对拆分后的数据进行聚合。</h5><h5 id=\"—————————————————————————————————————-37\"><a href=\"#—————————————————————————————————————-37\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"2-）数据准备-1\"><a href=\"#2-）数据准备-1\" class=\"headerlink\" title=\"2 ）数据准备\"></a>2 ）数据准备</h5><h5 id=\"表-6-7-数据准备\"><a href=\"#表-6-7-数据准备\" class=\"headerlink\" title=\"表 6 - 7 数据准备\"></a>表 6 - 7 数据准备</h5><h5 id=\"movie-category\"><a href=\"#movie-category\" class=\"headerlink\" title=\"movie category\"></a>movie category</h5><h5 id=\"《疑犯追踪》-悬疑-动作-科幻-剧情\"><a href=\"#《疑犯追踪》-悬疑-动作-科幻-剧情\" class=\"headerlink\" title=\"《疑犯追踪》 悬疑,动作,科幻,剧情\"></a>《疑犯追踪》 悬疑,动作,科幻,剧情</h5><h5 id=\"《Lie-to-me》-悬疑-警匪-动作-心理-剧情\"><a href=\"#《Lie-to-me》-悬疑-警匪-动作-心理-剧情\" class=\"headerlink\" title=\"《Lie to me》 悬疑,警匪,动作,心理,剧情\"></a>《Lie to me》 悬疑,警匪,动作,心理,剧情</h5><h5 id=\"《战狼-2-》-战争-动作-灾难\"><a href=\"#《战狼-2-》-战争-动作-灾难\" class=\"headerlink\" title=\"《战狼 2 》 战争,动作,灾难\"></a>《战狼 2 》 战争,动作,灾难</h5><h5 id=\"3-）需求-1\"><a href=\"#3-）需求-1\" class=\"headerlink\" title=\"3 ）需求\"></a>3 ）需求</h5><h5 id=\"将电影分类中的数组数据展开。结果如下：\"><a href=\"#将电影分类中的数组数据展开。结果如下：\" class=\"headerlink\" title=\"将电影分类中的数组数据展开。结果如下：\"></a>将电影分类中的数组数据展开。结果如下：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">《疑犯追踪》 悬疑\n《疑犯追踪》 动作\n《疑犯追踪》 科幻\n《疑犯追踪》 剧情\n《Lie to me》 悬疑\n《Lie to me》 警匪\n《Lie to me》 动作\n《Lie to me》 心理\n《Lie to me》 剧情\n《战狼 2 》 战争\n《战狼 2 》 动作\n《战狼 2 》 灾难<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）创建本地-movie-txt-，导入数据\"><a href=\"#4-）创建本地-movie-txt-，导入数据\" class=\"headerlink\" title=\"4 ）创建本地 movie.txt ，导入数据\"></a>4 ）创建本地 movie.txt ，导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ vi movie_info.txt\n《疑犯追踪》 悬疑,动作,科幻,剧情\n《Lie to me》 悬疑,警匪,动作,心理,剧情\n《战狼 2 》 战争,动作,灾难<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"5-）创建-hive-表并导入数据-1\"><a href=\"#5-）创建-hive-表并导入数据-1\" class=\"headerlink\" title=\"5 ）创建 hive 表并导入数据\"></a>5 ）创建 hive 表并导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table movie_info(\nmovie string,\ncategory string)\nrow format delimited fields terminated by &quot;\\t&quot;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">load data local inpath &quot;&#x2F;opt&#x2F;module&#x2F;data&#x2F;movie.txt&quot; into table\nmovie_info;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"6-）按需求查询数据-1\"><a href=\"#6-）按需求查询数据-1\" class=\"headerlink\" title=\"6 ）按需求查询数据\"></a>6 ）按需求查询数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nmovie,\ncategory_name\nFROM\nmovie_info\nlateral VIEW\nexplode(split(category,&quot;,&quot;)) movie_info_tmp AS category_name;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"8-2-5-窗口函数（开窗函数）\"><a href=\"#8-2-5-窗口函数（开窗函数）\" class=\"headerlink\" title=\"8 .2.5 窗口函数（开窗函数）\"></a>8 .2.5 窗口函数（开窗函数）</h4><h5 id=\"1-）相关函数说明-1\"><a href=\"#1-）相关函数说明-1\" class=\"headerlink\" title=\"1 ）相关函数说明\"></a>1 ）相关函数说明</h5><h5 id=\"OVER-：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变\"><a href=\"#OVER-：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变\" class=\"headerlink\" title=\"OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变\"></a>OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变</h5><h5 id=\"—————————————————————————————————————-38\"><a href=\"#—————————————————————————————————————-38\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"化。\"><a href=\"#化。\" class=\"headerlink\" title=\"化。\"></a>化。</h5><h5 id=\"CURRENT-ROW：当前行\"><a href=\"#CURRENT-ROW：当前行\" class=\"headerlink\" title=\"CURRENT ROW：当前行\"></a>CURRENT ROW：当前行</h5><h5 id=\"n-PRECEDING：往前n行数据\"><a href=\"#n-PRECEDING：往前n行数据\" class=\"headerlink\" title=\"n PRECEDING：往前n行数据\"></a>n PRECEDING：往前n行数据</h5><h5 id=\"n-FOLLOWING：往后n行数据\"><a href=\"#n-FOLLOWING：往后n行数据\" class=\"headerlink\" title=\"n FOLLOWING：往后n行数据\"></a>n FOLLOWING：往后n行数据</h5><h5 id=\"UNBOUNDED：起点，\"><a href=\"#UNBOUNDED：起点，\" class=\"headerlink\" title=\"UNBOUNDED：起点，\"></a>UNBOUNDED：起点，</h5><h5 id=\"UNBOUNDED-PRECEDING-表示从前面的起点，\"><a href=\"#UNBOUNDED-PRECEDING-表示从前面的起点，\" class=\"headerlink\" title=\"UNBOUNDED PRECEDING 表示从前面的起点，\"></a>UNBOUNDED PRECEDING 表示从前面的起点，</h5><h5 id=\"UNBOUNDED-FOLLOWING表示到后面的终点\"><a href=\"#UNBOUNDED-FOLLOWING表示到后面的终点\" class=\"headerlink\" title=\"UNBOUNDED FOLLOWING表示到后面的终点\"></a>UNBOUNDED FOLLOWING表示到后面的终点</h5><h5 id=\"LAG-col-n-default-val-：往前第n行数据\"><a href=\"#LAG-col-n-default-val-：往前第n行数据\" class=\"headerlink\" title=\"LAG(col,n,default_val)：往前第n行数据\"></a>LAG(col,n,default_val)：往前第n行数据</h5><h5 id=\"LEAD-col-n-default-val-：往后第n行数据\"><a href=\"#LEAD-col-n-default-val-：往后第n行数据\" class=\"headerlink\" title=\"LEAD(col,n, default_val)：往后第n行数据\"></a>LEAD(col,n, default_val)：往后第n行数据</h5><h5 id=\"NTILE-n-：把有序窗口的行分发到指定数据的组中，各个组有编号，编号从-1-开始，对\"><a href=\"#NTILE-n-：把有序窗口的行分发到指定数据的组中，各个组有编号，编号从-1-开始，对\" class=\"headerlink\" title=\"NTILE(n)：把有序窗口的行分发到指定数据的组中，各个组有编号，编号从 1 开始，对\"></a>NTILE(n)：把有序窗口的行分发到指定数据的组中，各个组有编号，编号从 1 开始，对</h5><h5 id=\"于每一行，NTILE返回此行所属的组的编号。注意：n必须为int类型。\"><a href=\"#于每一行，NTILE返回此行所属的组的编号。注意：n必须为int类型。\" class=\"headerlink\" title=\"于每一行，NTILE返回此行所属的组的编号。注意：n必须为int类型。\"></a>于每一行，NTILE返回此行所属的组的编号。注意：n必须为int类型。</h5><h5 id=\"2-）数据准备：-name-，-orderdate-，-cost\"><a href=\"#2-）数据准备：-name-，-orderdate-，-cost\" class=\"headerlink\" title=\"2 ）数据准备： name ， orderdate ， cost\"></a>2 ）数据准备： name ， orderdate ， cost</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">jack,2017- 01 - 01,10\ntony,2017- 01 - 02,15\njack,2017- 02 - 03,23\ntony,2017- 01 - 04,29\njack,2017- 01 - 05,46\njack,2017- 04 - 06,42\ntony,2017- 01 - 07,50\njack,2017- 01 - 08,55\nmart,2017- 04 - 08,62\nmart,2017- 04 - 09,68\nneil,2017- 05 - 10,12\nmart,2017- 04 - 11,75\nneil,2017- 06 - 12,80\nmart,2017- 04 - 13,94<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）需求-2\"><a href=\"#3-）需求-2\" class=\"headerlink\" title=\"3 ）需求\"></a>3 ）需求</h5><h5 id=\"（-1-）查询在-2017-年-4-月份购买过的顾客及总人数\"><a href=\"#（-1-）查询在-2017-年-4-月份购买过的顾客及总人数\" class=\"headerlink\" title=\"（ 1 ）查询在 2017 年 4 月份购买过的顾客及总人数\"></a>（ 1 ）查询在 2017 年 4 月份购买过的顾客及总人数</h5><h5 id=\"（-2-）查询顾客的购买明细及月购买总额\"><a href=\"#（-2-）查询顾客的购买明细及月购买总额\" class=\"headerlink\" title=\"（ 2 ）查询顾客的购买明细及月购买总额\"></a>（ 2 ）查询顾客的购买明细及月购买总额</h5><h5 id=\"（-3-）上述的场景-将每个顾客的cost按照日期进行累加\"><a href=\"#（-3-）上述的场景-将每个顾客的cost按照日期进行累加\" class=\"headerlink\" title=\"（ 3 ）上述的场景, 将每个顾客的cost按照日期进行累加\"></a>（ 3 ）上述的场景, 将每个顾客的cost按照日期进行累加</h5><h5 id=\"（-4-）查询每个顾客上次的购买时间\"><a href=\"#（-4-）查询每个顾客上次的购买时间\" class=\"headerlink\" title=\"（ 4 ）查询每个顾客上次的购买时间\"></a>（ 4 ）查询每个顾客上次的购买时间</h5><h5 id=\"（-5-）查询前20-时间的订单信息\"><a href=\"#（-5-）查询前20-时间的订单信息\" class=\"headerlink\" title=\"（ 5 ）查询前20%时间的订单信息\"></a>（ 5 ）查询前20%时间的订单信息</h5><h5 id=\"4-）创建本地-business-txt-，导入数据\"><a href=\"#4-）创建本地-business-txt-，导入数据\" class=\"headerlink\" title=\"4 ）创建本地 business.txt ，导入数据\"></a>4 ）创建本地 business.txt ，导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ vi business.txt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"5-）创建-hive-表并导入数据-2\"><a href=\"#5-）创建-hive-表并导入数据-2\" class=\"headerlink\" title=\"5 ）创建 hive 表并导入数据\"></a>5 ）创建 hive 表并导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table business(\nname string,\norderdate string,<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-39\"><a href=\"#—————————————————————————————————————-39\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">cost int\n) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;,&#39;;\nload data local inpath &quot;&#x2F;opt&#x2F;module&#x2F;data&#x2F;business.txt&quot; into table\nbusiness;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"6-）按需求查询数据-2\"><a href=\"#6-）按需求查询数据-2\" class=\"headerlink\" title=\"6 ）按需求查询数据\"></a>6 ）按需求查询数据</h5><h5 id=\"（-1-）-查询在-2017-年-4-月份购买过的顾客及总人数\"><a href=\"#（-1-）-查询在-2017-年-4-月份购买过的顾客及总人数\" class=\"headerlink\" title=\"（ 1 ） 查询在 2017 年 4 月份购买过的顾客及总人数\"></a>（ 1 ） 查询在 2017 年 4 月份购买过的顾客及总人数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select name,count(*) over ()\nfrom business\nwhere substring(orderdate,1,7) &#x3D; &#39;2017-04&#39;\ngroup by name;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）-查询顾客的购买明细及月购买总额\"><a href=\"#（-2-）-查询顾客的购买明细及月购买总额\" class=\"headerlink\" title=\"（ 2 ） 查询顾客的购买明细及月购买总额\"></a>（ 2 ） 查询顾客的购买明细及月购买总额</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select name,orderdate,cost,sum(cost) over(partition by month(orderdate))\nfrom business;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）-将每个顾客的cost按照日期进行累加\"><a href=\"#（-3-）-将每个顾客的cost按照日期进行累加\" class=\"headerlink\" title=\"（ 3 ） 将每个顾客的cost按照日期进行累加\"></a>（ 3 ） 将每个顾客的cost按照日期进行累加</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select name,orderdate,cost,\nsum(cost) over() as sample1,--所有行相加\nsum(cost) over(partition by name) as sample2,--按name分组，组内数据相加\nsum(cost) over(partition by name order by orderdate) as sample3,--按name\n分组，组内数据累加\nsum(cost) over(partition by name order by orderdate rows between\nUNBOUNDED PRECEDING and current row ) as sample4 ,--和sample3一样,由起点到\n当前行的聚合\nsum(cost) over(partition by name order by orderdate rows between 1\nPRECEDING and current row) as sample5, --当前行和前面一行做聚合\nsum(cost) over(partition by name order by orderdate rows between 1\nPRECEDING AND 1 FOLLOWING ) as sample6,--当前行和前边一行及后面一行\nsum(cost) over(partition by name order by orderdate rows between current\nrow and UNBOUNDED FOLLOWING ) as sample7 --当前行及后面所有行\nfrom business;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"rows必须跟在order-by-子句之后，对排序的结果进行限制，使用固定的行数来限制分\"><a href=\"#rows必须跟在order-by-子句之后，对排序的结果进行限制，使用固定的行数来限制分\" class=\"headerlink\" title=\"rows必须跟在order by 子句之后，对排序的结果进行限制，使用固定的行数来限制分\"></a>rows必须跟在order by 子句之后，对排序的结果进行限制，使用固定的行数来限制分</h5><h5 id=\"区中的数据行数量\"><a href=\"#区中的数据行数量\" class=\"headerlink\" title=\"区中的数据行数量\"></a>区中的数据行数量</h5><h5 id=\"（-4-）-查看顾客上次的购买时间\"><a href=\"#（-4-）-查看顾客上次的购买时间\" class=\"headerlink\" title=\"（ 4 ） 查看顾客上次的购买时间\"></a>（ 4 ） 查看顾客上次的购买时间</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select name,orderdate,cost,\nlag(orderdate,1,&#39;1900- 01 - 01&#39;) over(partition by name order by orderdate )\nas time1, lag(orderdate,2) over (partition by name order by orderdate) as\ntime2\nfrom business;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）-查询前20-时间的订单信息\"><a href=\"#（-5-）-查询前20-时间的订单信息\" class=\"headerlink\" title=\"（ 5 ） 查询前20%时间的订单信息\"></a>（ 5 ） 查询前20%时间的订单信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select * from (\nselect name,orderdate,cost, ntile(5) over(order by orderdate) sorted\nfrom business\n) t\nwhere sorted &#x3D; 1;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"8-2-6-Rank\"><a href=\"#8-2-6-Rank\" class=\"headerlink\" title=\"8 .2.6 Rank\"></a>8 .2.6 Rank</h4><h5 id=\"1-）函数说明-2\"><a href=\"#1-）函数说明-2\" class=\"headerlink\" title=\"1 ）函数说明\"></a>1 ）函数说明</h5><h5 id=\"RANK-排序相同时会重复，总数不会变\"><a href=\"#RANK-排序相同时会重复，总数不会变\" class=\"headerlink\" title=\"RANK() 排序相同时会重复，总数不会变\"></a>RANK() 排序相同时会重复，总数不会变</h5><h5 id=\"—————————————————————————————————————-40\"><a href=\"#—————————————————————————————————————-40\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"DENSE-RANK-排序相同时会重复，总数会减少\"><a href=\"#DENSE-RANK-排序相同时会重复，总数会减少\" class=\"headerlink\" title=\"DENSE_RANK() 排序相同时会重复，总数会减少\"></a>DENSE_RANK() 排序相同时会重复，总数会减少</h5><h5 id=\"ROW-NUMBER-会根据顺序计算\"><a href=\"#ROW-NUMBER-会根据顺序计算\" class=\"headerlink\" title=\"ROW_NUMBER() 会根据顺序计算\"></a>ROW_NUMBER() 会根据顺序计算</h5><h5 id=\"2-）数据准备-2\"><a href=\"#2-）数据准备-2\" class=\"headerlink\" title=\"2 ）数据准备\"></a>2 ）数据准备</h5><h5 id=\"name-subject-score\"><a href=\"#name-subject-score\" class=\"headerlink\" title=\"name subject score\"></a>name subject score</h5><h5 id=\"孙悟空-语文-87\"><a href=\"#孙悟空-语文-87\" class=\"headerlink\" title=\"孙悟空 语文 87\"></a>孙悟空 语文 87</h5><h5 id=\"孙悟空-数学-95\"><a href=\"#孙悟空-数学-95\" class=\"headerlink\" title=\"孙悟空 数学 95\"></a>孙悟空 数学 95</h5><h5 id=\"孙悟空-英语-68\"><a href=\"#孙悟空-英语-68\" class=\"headerlink\" title=\"孙悟空 英语 68\"></a>孙悟空 英语 68</h5><h5 id=\"大海-语文-94\"><a href=\"#大海-语文-94\" class=\"headerlink\" title=\"大海 语文 94\"></a>大海 语文 94</h5><h5 id=\"大海-数学-56\"><a href=\"#大海-数学-56\" class=\"headerlink\" title=\"大海 数学 56\"></a>大海 数学 56</h5><h5 id=\"大海-英语-84\"><a href=\"#大海-英语-84\" class=\"headerlink\" title=\"大海 英语 84\"></a>大海 英语 84</h5><h5 id=\"宋宋-语文-64\"><a href=\"#宋宋-语文-64\" class=\"headerlink\" title=\"宋宋 语文 64\"></a>宋宋 语文 64</h5><h5 id=\"宋宋-数学-86\"><a href=\"#宋宋-数学-86\" class=\"headerlink\" title=\"宋宋 数学 86\"></a>宋宋 数学 86</h5><h5 id=\"宋宋-英语-84\"><a href=\"#宋宋-英语-84\" class=\"headerlink\" title=\"宋宋 英语 84\"></a>宋宋 英语 84</h5><h5 id=\"婷婷-语文-65\"><a href=\"#婷婷-语文-65\" class=\"headerlink\" title=\"婷婷 语文 65\"></a>婷婷 语文 65</h5><h5 id=\"婷婷-数学-85\"><a href=\"#婷婷-数学-85\" class=\"headerlink\" title=\"婷婷 数学 85\"></a>婷婷 数学 85</h5><h5 id=\"婷婷-英语-78\"><a href=\"#婷婷-英语-78\" class=\"headerlink\" title=\"婷婷 英语 78\"></a>婷婷 英语 78</h5><h5 id=\"3-）需求-3\"><a href=\"#3-）需求-3\" class=\"headerlink\" title=\"3 ）需求\"></a>3 ）需求</h5><h5 id=\"计算每门学科成绩排名。\"><a href=\"#计算每门学科成绩排名。\" class=\"headerlink\" title=\"计算每门学科成绩排名。\"></a>计算每门学科成绩排名。</h5><h5 id=\"4-）创建本地-score-txt-，导入数据\"><a href=\"#4-）创建本地-score-txt-，导入数据\" class=\"headerlink\" title=\"4 ）创建本地 score.txt ，导入数据\"></a>4 ）创建本地 score.txt ，导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 datas]$ vi score.txt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"5-）创建-hive-表并导入数据-3\"><a href=\"#5-）创建-hive-表并导入数据-3\" class=\"headerlink\" title=\"5 ）创建 hive 表并导入数据\"></a>5 ）创建 hive 表并导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table score(\nname string,\nsubject string,\nscore int)\nrow format delimited fields terminated by &quot;\\t&quot;;\nload data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;score.txt&#39; into table score;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"6-）按需求查询数据-3\"><a href=\"#6-）按需求查询数据-3\" class=\"headerlink\" title=\"6 ）按需求查询数据\"></a>6 ）按需求查询数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">select name,\nsubject,\nscore,\nrank() over(partition by subject order by score desc) rp,\ndense_rank() over(partition by subject order by score desc) drp,\nrow_number() over(partition by subject order by score desc) rmp\nfrom score;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">name subject score rp drp rmp\n孙悟空 数学 95 1 1 1\n宋宋 数学 86 2 2 2\n婷婷 数学 85 3 3 3\n大海 数学 56 4 4 4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-41\"><a href=\"#—————————————————————————————————————-41\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">宋宋 英语 84 1 1 1\n大海 英语 84 1 1 2\n婷婷 英语 78 3 2 3\n孙悟空 英语 68 4 3 4\n大海 语文 94 1 1 1\n孙悟空 语文 87 2 2 2\n婷婷 语文 65 3 3 3\n宋宋 语文 64 4 4 4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"扩展：求出每门学科前三名的学生？\"><a href=\"#扩展：求出每门学科前三名的学生？\" class=\"headerlink\" title=\"扩展：求出每门学科前三名的学生？\"></a>扩展：求出每门学科前三名的学生？</h5><h4 id=\"8-2-7-其他常用函数\"><a href=\"#8-2-7-其他常用函数\" class=\"headerlink\" title=\"8 .2.7 其他常用函数\"></a>8 .2.7 其他常用函数</h4><h5 id=\"2-资料-05-常用函数-常用函数-txt\"><a href=\"#2-资料-05-常用函数-常用函数-txt\" class=\"headerlink\" title=\"..\\2.资料\\05_常用函数\\常用函数.txt\"></a>..\\2.资料\\05_常用函数\\常用函数.txt</h5><h4 id=\"8-3-自定义函数\"><a href=\"#8-3-自定义函数\" class=\"headerlink\" title=\"8 .3 自定义函数\"></a>8 .3 自定义函数</h4><h5 id=\"1-）Hive-自带了一些函数，比如：max-x2F-min等，但是数量有限，自己可以通过自定义UDF来\"><a href=\"#1-）Hive-自带了一些函数，比如：max-x2F-min等，但是数量有限，自己可以通过自定义UDF来\" class=\"headerlink\" title=\"1 ）Hive 自带了一些函数，比如：max&#x2F;min等，但是数量有限，自己可以通过自定义UDF来\"></a>1 ）Hive 自带了一些函数，比如：max&#x2F;min等，但是数量有限，自己可以通过自定义UDF来</h5><h5 id=\"方便的扩展。\"><a href=\"#方便的扩展。\" class=\"headerlink\" title=\"方便的扩展。\"></a>方便的扩展。</h5><h5 id=\"2-）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义\"><a href=\"#2-）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义\" class=\"headerlink\" title=\"2 ）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义\"></a>2 ）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义</h5><h5 id=\"函数（UDF：user-defined-function）。\"><a href=\"#函数（UDF：user-defined-function）。\" class=\"headerlink\" title=\"函数（UDF：user-defined function）。\"></a>函数（UDF：user-defined function）。</h5><h5 id=\"3-）根据用户自定义函数类别分为以下三种：\"><a href=\"#3-）根据用户自定义函数类别分为以下三种：\" class=\"headerlink\" title=\"3 ）根据用户自定义函数类别分为以下三种：\"></a>3 ）根据用户自定义函数类别分为以下三种：</h5><h5 id=\"（-1-）UDF（User-Defined-Function）\"><a href=\"#（-1-）UDF（User-Defined-Function）\" class=\"headerlink\" title=\"（ 1 ）UDF（User-Defined-Function）\"></a>（ 1 ）UDF（User-Defined-Function）</h5><h5 id=\"一进一出\"><a href=\"#一进一出\" class=\"headerlink\" title=\"一进一出\"></a>一进一出</h5><h5 id=\"（-2-）UDAF（User-Defined-Aggregation-Function）\"><a href=\"#（-2-）UDAF（User-Defined-Aggregation-Function）\" class=\"headerlink\" title=\"（ 2 ）UDAF（User-Defined Aggregation Function）\"></a>（ 2 ）UDAF（User-Defined Aggregation Function）</h5><h5 id=\"聚集函数，多进一出\"><a href=\"#聚集函数，多进一出\" class=\"headerlink\" title=\"聚集函数，多进一出\"></a>聚集函数，多进一出</h5><h5 id=\"类似于：count-x2F-max-x2F-min\"><a href=\"#类似于：count-x2F-max-x2F-min\" class=\"headerlink\" title=\"类似于：count&#x2F;max&#x2F;min\"></a>类似于：count&#x2F;max&#x2F;min</h5><h5 id=\"（-3-）UDTF（User-Defined-Table-Generating-Functions）\"><a href=\"#（-3-）UDTF（User-Defined-Table-Generating-Functions）\" class=\"headerlink\" title=\"（ 3 ）UDTF（User-Defined Table-Generating Functions）\"></a>（ 3 ）UDTF（User-Defined Table-Generating Functions）</h5><h5 id=\"一进多出\"><a href=\"#一进多出\" class=\"headerlink\" title=\"一进多出\"></a>一进多出</h5><h5 id=\"如lateral-view-explode\"><a href=\"#如lateral-view-explode\" class=\"headerlink\" title=\"如lateral view explode()\"></a>如lateral view explode()</h5><h5 id=\"4-）官方文档地址\"><a href=\"#4-）官方文档地址\" class=\"headerlink\" title=\"4 ）官方文档地址\"></a>4 ）官方文档地址</h5><h5 id=\"https-cwiki-apache-org-confluence-display-Hive-HivePlugins\"><a href=\"#https-cwiki-apache-org-confluence-display-Hive-HivePlugins\" class=\"headerlink\" title=\"https://cwiki.apache.org/confluence/display/Hive/HivePlugins\"></a><a href=\"https://cwiki.apache.org/confluence/display/Hive/HivePlugins\">https://cwiki.apache.org/confluence/display/Hive/HivePlugins</a></h5><h5 id=\"5-）编程步骤：\"><a href=\"#5-）编程步骤：\" class=\"headerlink\" title=\"5 ）编程步骤：\"></a>5 ）编程步骤：</h5><h5 id=\"（-1-）继承Hive提供的类\"><a href=\"#（-1-）继承Hive提供的类\" class=\"headerlink\" title=\"（ 1 ）继承Hive提供的类\"></a>（ 1 ）继承Hive提供的类</h5><h5 id=\"org-apache-hadoop-hive-ql-udf-generic-GenericUDF\"><a href=\"#org-apache-hadoop-hive-ql-udf-generic-GenericUDF\" class=\"headerlink\" title=\"org.apache.hadoop.hive.ql.udf.generic.GenericUDF\"></a>org.apache.hadoop.hive.ql.udf.generic.GenericUDF</h5><h5 id=\"org-apache-hadoop-hive-ql-udf-generic-GenericUDTF\"><a href=\"#org-apache-hadoop-hive-ql-udf-generic-GenericUDTF\" class=\"headerlink\" title=\"org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;\"></a>org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;</h5><h5 id=\"（-2-）实现类中的抽象方法\"><a href=\"#（-2-）实现类中的抽象方法\" class=\"headerlink\" title=\"（ 2 ）实现类中的抽象方法\"></a>（ 2 ）实现类中的抽象方法</h5><h5 id=\"—————————————————————————————————————-42\"><a href=\"#—————————————————————————————————————-42\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-3-）在hive的命令行窗口创建函数\"><a href=\"#（-3-）在hive的命令行窗口创建函数\" class=\"headerlink\" title=\"（ 3 ）在hive的命令行窗口创建函数\"></a>（ 3 ）在hive的命令行窗口创建函数</h5><h5 id=\"添加jar\"><a href=\"#添加jar\" class=\"headerlink\" title=\"添加jar\"></a>添加jar</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">add jar linux_jar_path<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"创建function\"><a href=\"#创建function\" class=\"headerlink\" title=\"创建function\"></a>创建function</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create [temporary] function [dbname.]function_name AS class_name;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）在hive的命令行窗口删除函数\"><a href=\"#（-4-）在hive的命令行窗口删除函数\" class=\"headerlink\" title=\"（ 4 ）在hive的命令行窗口删除函数\"></a>（ 4 ）在hive的命令行窗口删除函数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">drop [temporary] function [if exists] [dbname.]function_name;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"8-4-自定义-UDF-函数\"><a href=\"#8-4-自定义-UDF-函数\" class=\"headerlink\" title=\"8 .4 自定义 UDF 函数\"></a>8 .4 自定义 UDF 函数</h4><h5 id=\"0-）需求\"><a href=\"#0-）需求\" class=\"headerlink\" title=\"0 ）需求 :\"></a>0 ）需求 :</h5><h5 id=\"自定义一个UDF实现计算给定字符串的长度，例如：\"><a href=\"#自定义一个UDF实现计算给定字符串的长度，例如：\" class=\"headerlink\" title=\"自定义一个UDF实现计算给定字符串的长度，例如：\"></a>自定义一个UDF实现计算给定字符串的长度，例如：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive(default)&gt; select my_len(&quot;abcd&quot;);\n4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"1-）创建一个-Maven-工程-Hive\"><a href=\"#1-）创建一个-Maven-工程-Hive\" class=\"headerlink\" title=\"1 ）创建一个 Maven 工程 Hive\"></a>1 ）创建一个 Maven 工程 Hive</h5><h5 id=\"2-）导入依赖\"><a href=\"#2-）导入依赖\" class=\"headerlink\" title=\"2 ）导入依赖\"></a>2 ）导入依赖</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hive&lt;&#x2F;groupId&gt;\n&lt;artifactId&gt;hive-exec&lt;&#x2F;artifactId&gt;\n&lt;version&gt;3.1.2&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;\n&lt;&#x2F;dependencies&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）创建一个类\"><a href=\"#3-）创建一个类\" class=\"headerlink\" title=\"3 ）创建一个类\"></a>3 ）创建一个类</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">package com.atguigu.hive;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import org.apache.hadoop.hive.ql.exec.UDFArgumentException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentLengthException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentTypeException;\nimport org.apache.hadoop.hive.ql.metadata.HiveException;\nimport org.apache.hadoop.hive.ql.udf.generic.GenericUDF;\nimport org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;\nimport\norg.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectIn\nspectorFactory;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;**\n* 自定义UDF函数，需要继承GenericUDF类\n* 需求: 计算指定字符串的长度\n*&#x2F;\npublic class MyStringLength extends GenericUDF &#123;\n&#x2F;**\n*\n* @param arguments 输入参数类型的鉴别器对象\n* @return 返回值类型的鉴别器对象\n* @throws UDFArgumentException\n*&#x2F;\n@Override\npublic ObjectInspector initialize(ObjectInspector[] arguments) throws\nUDFArgumentException &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-43\"><a href=\"#—————————————————————————————————————-43\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 判断输入参数的个数\nif(arguments.length !&#x3D;1)&#123;\nthrow new UDFArgumentLengthException(&quot;Input Args Length\nError!!!&quot;);\n&#125;\n&#x2F;&#x2F; 判断输入参数的类型<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">if(!arguments[0].getCategory().equals(ObjectInspector.Category.PRIMITIVE)\n)&#123;\nthrow new UDFArgumentTypeException(0,&quot;Input Args Type\nError!!!&quot;);\n&#125;\n&#x2F;&#x2F;函数本身返回值为int，需要返回int类型的鉴别器对象\nreturn PrimitiveObjectInspectorFactory.javaIntObjectInspector;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;**\n* 函数的逻辑处理\n* @param arguments 输入的参数\n* @return 返回值\n* @throws HiveException\n*&#x2F;\n@Override\npublic Object evaluate(DeferredObject[] arguments) throws\nHiveException &#123;\nif(arguments[0].get() &#x3D;&#x3D; null)&#123;\nreturn 0;\n&#125;\nreturn arguments[0].get().toString().length();\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Override\npublic String getDisplayString(String[] children) &#123;\nreturn &quot;&quot;;\n&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）打成-jar-包上传到服务器-x2F-opt-x2F-module-x2F-data-x2F-myudf-jar\"><a href=\"#4-）打成-jar-包上传到服务器-x2F-opt-x2F-module-x2F-data-x2F-myudf-jar\" class=\"headerlink\" title=\"4 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;data&#x2F;myudf.jar\"></a>4 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;data&#x2F;myudf.jar</h5><h5 id=\"5-）将-jar-包添加到-hive-的-classpath\"><a href=\"#5-）将-jar-包添加到-hive-的-classpath\" class=\"headerlink\" title=\"5 ）将 jar 包添加到 hive 的 classpath\"></a>5 ）将 jar 包添加到 hive 的 classpath</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; add jar &#x2F;opt&#x2F;module&#x2F;data&#x2F;myudf.jar;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"6-）创建临时函数与开发好的-java-class-关联\"><a href=\"#6-）创建临时函数与开发好的-java-class-关联\" class=\"headerlink\" title=\"6 ）创建临时函数与开发好的 java class 关联\"></a>6 ）创建临时函数与开发好的 java class 关联</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create temporary function my_len as &quot;com.atguigu.hive.\nMyStringLength&quot;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"7-）即可在-hql-中使用自定义的函数\"><a href=\"#7-）即可在-hql-中使用自定义的函数\" class=\"headerlink\" title=\"7 ）即可在 hql 中使用自定义的函数\"></a>7 ）即可在 hql 中使用自定义的函数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select ename,my_len(ename) ename_len from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"8-5-自定义UDTF函数\"><a href=\"#8-5-自定义UDTF函数\" class=\"headerlink\" title=\"8 .5 自定义UDTF函数\"></a>8 .5 自定义UDTF函数</h2><h5 id=\"0-）需求-1\"><a href=\"#0-）需求-1\" class=\"headerlink\" title=\"0 ）需求\"></a>0 ）需求</h5><h5 id=\"自定义一个UDTF实现将一个任意分割符的字符串切割成独立的单词，例如：\"><a href=\"#自定义一个UDTF实现将一个任意分割符的字符串切割成独立的单词，例如：\" class=\"headerlink\" title=\"自定义一个UDTF实现将一个任意分割符的字符串切割成独立的单词，例如：\"></a>自定义一个UDTF实现将一个任意分割符的字符串切割成独立的单词，例如：</h5><h5 id=\"—————————————————————————————————————-44\"><a href=\"#—————————————————————————————————————-44\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive(default)&gt; select myudtf(&quot;hello,world,hadoop,hive&quot;, &quot;,&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">hello\nworld\nhadoop\nhive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）代码实现\"><a href=\"#1-）代码实现\" class=\"headerlink\" title=\"1 ）代码实现\"></a>1 ）代码实现</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">package com.atguigu.udtf;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import org.apache.hadoop.hive.ql.exec.UDFArgumentException;\nimport org.apache.hadoop.hive.ql.metadata.HiveException;\nimport org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;\nimport org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;\nimport\norg.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;\nimport\norg.apache.hadoop.hive.serde2.objectinspector.StructObjectInspector;\nimport\norg.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectIn\nspectorFactory;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import java.util.ArrayList;\nimport java.util.List;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">public class MyUDTF extends GenericUDTF &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">private ArrayList&lt;String&gt; outList &#x3D; new ArrayList&lt;&gt;();<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Override\npublic StructObjectInspector initialize(StructObjectInspector argOIs)\nthrows UDFArgumentException &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;1.定义输出数据的列名和类型\nList&lt;String&gt; fieldNames &#x3D; new ArrayList&lt;&gt;();\nList&lt;ObjectInspector&gt; fieldOIs &#x3D; new ArrayList&lt;&gt;();<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;2.添加输出数据的列名和类型\nfieldNames.add(&quot;lineToWord&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">return\nObjectInspectorFactory.getStandardStructObjectInspector(fieldNames,\nfieldOIs);\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Override\npublic void process(Object[] args) throws HiveException &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;1.获取原始数据\nString arg &#x3D; args[0].toString();<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;2.获取数据传入的第二个参数，此处为分隔符\nString splitKey &#x3D; args[1].toString();<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;3.将原始数据按照传入的分隔符进行切分\nString[] fields &#x3D; arg.split(splitKey);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-45\"><a href=\"#—————————————————————————————————————-45\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;4.遍历切分后的结果，并写出\nfor (String field : fields) &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;集合为复用的，首先清空集合\noutList.clear();<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;将每一个单词添加至集合\noutList.add(field);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F;将集合内容写出\nforward(outList);\n&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Override\npublic void close() throws HiveException &#123;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）打成-jar-包上传到服务器-x2F-opt-x2F-module-x2F-hive-x2F-data-x2F-myudtf-jar\"><a href=\"#2-）打成-jar-包上传到服务器-x2F-opt-x2F-module-x2F-hive-x2F-data-x2F-myudtf-jar\" class=\"headerlink\" title=\"2 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;myudtf.jar\"></a>2 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;myudtf.jar</h5><h5 id=\"3-）将-jar-包添加到-hive-的-classpath-下\"><a href=\"#3-）将-jar-包添加到-hive-的-classpath-下\" class=\"headerlink\" title=\"3 ）将 jar 包添加到 hive 的 classpath 下\"></a>3 ）将 jar 包添加到 hive 的 classpath 下</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; add jar &#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;myudtf.jar;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"4-）创建临时函数与开发好的-java-class-关联\"><a href=\"#4-）创建临时函数与开发好的-java-class-关联\" class=\"headerlink\" title=\"4 ）创建临时函数与开发好的 java class 关联\"></a>4 ）创建临时函数与开发好的 java class 关联</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create temporary function myudtf as\n&quot;com.atguigu.hive.MyUDTF&quot;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"5-）使用自定义的函数\"><a href=\"#5-）使用自定义的函数\" class=\"headerlink\" title=\"5 ）使用自定义的函数\"></a>5 ）使用自定义的函数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select myudtf(&quot;hello,world,hadoop,hive&quot;,&quot;,&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"第-9-章-压缩和存储\"><a href=\"#第-9-章-压缩和存储\" class=\"headerlink\" title=\"第 9 章 压缩和存储\"></a>第 9 章 压缩和存储</h1><h4 id=\"9-1-Hadoop-压缩配置\"><a href=\"#9-1-Hadoop-压缩配置\" class=\"headerlink\" title=\"9 .1 Hadoop 压缩配置\"></a>9 .1 Hadoop 压缩配置</h4><h4 id=\"9-1-1-MR-支持的压缩编码\"><a href=\"#9-1-1-MR-支持的压缩编码\" class=\"headerlink\" title=\"9 .1.1 MR 支持的压缩编码\"></a>9 .1.1 MR 支持的压缩编码</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">压缩格式 算法 文件扩展名 是否可切分\nDEFLATE DEFLATE .deflate 否\nGzip DEFLATE .gz 否\nbzip2 bzip2 .bz2 是\nLZO LZO .lzo 是\nSnappy Snappy .snappy 否<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"为了支持多种压缩-x2F-解压缩算法，Hadoop引入了编码-x2F-解码器，如下表所示：\"><a href=\"#为了支持多种压缩-x2F-解压缩算法，Hadoop引入了编码-x2F-解码器，如下表所示：\" class=\"headerlink\" title=\"为了支持多种压缩&#x2F;解压缩算法，Hadoop引入了编码&#x2F;解码器，如下表所示：\"></a>为了支持多种压缩&#x2F;解压缩算法，Hadoop引入了编码&#x2F;解码器，如下表所示：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">压缩格式 对应的编码&#x2F;解码器\nDEFLATE org.apache.hadoop.io.compress.DefaultCodec\ngzip org.apache.hadoop.io.compress.GzipCodec\nbzip2 org.apache.hadoop.io.compress.BZip2Codec\nLZO com.hadoop.compression.lzo.LzopCodec<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-46\"><a href=\"#—————————————————————————————————————-46\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Snappy org.apache.hadoop.io.compress.SnappyCodec<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"压缩性能的比较：\"><a href=\"#压缩性能的比较：\" class=\"headerlink\" title=\"压缩性能的比较：\"></a>压缩性能的比较：</h5><p>压缩算法 (^) 原始文件大小 压缩文件大小 压缩速度 解压速度<br>gzip 8.3GB 1.8GB 17.5MB&#x2F;s 58MB&#x2F;s<br>bzip2 8.3GB 1.1GB 2.4MB&#x2F;s 9.5MB&#x2F;s<br>LZO 8.3GB 2.9GB 49.3MB&#x2F;s 74.6MB&#x2F;s</p>\n<h5 id=\"http-google-github-io-snappy\"><a href=\"#http-google-github-io-snappy\" class=\"headerlink\" title=\"http://google.github.io/snappy/\"></a><a href=\"http://google.github.io/snappy/\">http://google.github.io/snappy/</a></h5><h5 id=\"On-a-single-core-of-a-Core-i7-processor-in-64-bit-mode-Snappy-compresses-at-about-250\"><a href=\"#On-a-single-core-of-a-Core-i7-processor-in-64-bit-mode-Snappy-compresses-at-about-250\" class=\"headerlink\" title=\"On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250\"></a>On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250</h5><h5 id=\"MB-x2F-sec-or-more-and-decompresses-at-about-500-MB-x2F-sec-or-more\"><a href=\"#MB-x2F-sec-or-more-and-decompresses-at-about-500-MB-x2F-sec-or-more\" class=\"headerlink\" title=\"MB&#x2F;sec or more and decompresses at about 500 MB&#x2F;sec or more.\"></a>MB&#x2F;sec or more and decompresses at about 500 MB&#x2F;sec or more.</h5><h4 id=\"9-1-2-压缩参数配置\"><a href=\"#9-1-2-压缩参数配置\" class=\"headerlink\" title=\"9 .1.2 压缩参数配置\"></a>9 .1.2 压缩参数配置</h4><h5 id=\"要在Hadoop中启用压缩，可以配置如下参数（mapred-site-xml文件中）：\"><a href=\"#要在Hadoop中启用压缩，可以配置如下参数（mapred-site-xml文件中）：\" class=\"headerlink\" title=\"要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：\"></a>要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">参数 默认值 阶段 建议\nio.compression.codecs\n（在core-site.xml中配置）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">org.apache.hadoop.io.compress.DefaultCodec,\norg.apache.hadoop.io.compress.GzipCodec,\norg.apache.hadoop.io.compress.BZip2Codec,\norg.apache.hadoop.io.compress.Lz4Codec<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">输入压缩 Hadoop使用文件扩展\n名判断是否支持某种\n编解码器<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mapreduce.map.output.com\npress<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>false (^) mapper输出 这个参数设为true启<br>用压缩<br>mapreduce.map.output.com<br>press.codec<br>org.apache.hadoop.io.compress.DefaultCodec mapper输出 使用LZO、LZ4或<br>snappy编解码器在此<br>阶段压缩数据<br>mapreduce.output.fileoutput<br>format.compress<br>false (^) reducer输出 这个参数设为true启<br>用压缩<br>mapreduce.output.fileoutput<br>format.compress.codec<br>org.apache.hadoop.io.compress. DefaultCodec reducer输出 使用标准工具或者编<br>解码器，如gzip和<br>bzip2<br>mapreduce.output.fileoutput<br>format.compress.type<br>RECORD reducer输出 SequenceFile输出使用<br>的压缩类型：NONE<br>和BLOCK</p>\n<h4 id=\"9-2-开启-Map-输出阶段压缩（-MR-引擎）\"><a href=\"#9-2-开启-Map-输出阶段压缩（-MR-引擎）\" class=\"headerlink\" title=\"9 .2 开启 Map 输出阶段压缩（ MR 引擎）\"></a>9 .2 开启 Map 输出阶段压缩（ MR 引擎）</h4><h5 id=\"开启map输出阶段压缩可以减少job中map和Reduce-task间数据传输量。具体配置如\"><a href=\"#开启map输出阶段压缩可以减少job中map和Reduce-task间数据传输量。具体配置如\" class=\"headerlink\" title=\"开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如\"></a>开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如</h5><h5 id=\"下：\"><a href=\"#下：\" class=\"headerlink\" title=\"下：\"></a>下：</h5><h5 id=\"1-）案例实操：-2\"><a href=\"#1-）案例实操：-2\" class=\"headerlink\" title=\"1 ）案例实操：\"></a>1 ）案例实操：</h5><h5 id=\"（-1-）开启hive中间传输数据压缩功能\"><a href=\"#（-1-）开启hive中间传输数据压缩功能\" class=\"headerlink\" title=\"（ 1 ）开启hive中间传输数据压缩功能\"></a>（ 1 ）开启hive中间传输数据压缩功能</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;set hive.exec.compress.intermediate&#x3D;true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）开启mapreduce中map输出压缩功能\"><a href=\"#（-2-）开启mapreduce中map输出压缩功能\" class=\"headerlink\" title=\"（ 2 ）开启mapreduce中map输出压缩功能\"></a>（ 2 ）开启mapreduce中map输出压缩功能</h5><h5 id=\"—————————————————————————————————————-47\"><a href=\"#—————————————————————————————————————-47\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;set mapreduce.map.output.compress&#x3D;true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）设置mapreduce中map输出数据的压缩方式\"><a href=\"#（-3-）设置mapreduce中map输出数据的压缩方式\" class=\"headerlink\" title=\"（ 3 ）设置mapreduce中map输出数据的压缩方式\"></a>（ 3 ）设置mapreduce中map输出数据的压缩方式</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;set mapreduce.map.output.compress.codec&#x3D;\norg.apache.hadoop.io.compress.SnappyCodec;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）执行查询语句\"><a href=\"#（-4-）执行查询语句\" class=\"headerlink\" title=\"（ 4 ）执行查询语句\"></a>（ 4 ）执行查询语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(ename) name from emp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"9-3-开启-Reduce-输出阶段压缩\"><a href=\"#9-3-开启-Reduce-输出阶段压缩\" class=\"headerlink\" title=\"9 .3 开启 Reduce 输出阶段压缩\"></a>9 .3 开启 Reduce 输出阶段压缩</h4><h5 id=\"当-Hive-将-输-出-写-入-到-表-中-时，输出内容同样可以进行压缩。属性\"><a href=\"#当-Hive-将-输-出-写-入-到-表-中-时，输出内容同样可以进行压缩。属性\" class=\"headerlink\" title=\"当 Hive 将 输 出 写 入 到 表 中 时，输出内容同样可以进行压缩。属性\"></a>当 Hive 将 输 出 写 入 到 表 中 时，输出内容同样可以进行压缩。属性</h5><h5 id=\"hive-exec-compress-output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，\"><a href=\"#hive-exec-compress-output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，\" class=\"headerlink\" title=\"hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，\"></a>hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，</h5><h5 id=\"这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这\"><a href=\"#这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这\" class=\"headerlink\" title=\"这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这\"></a>这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这</h5><h5 id=\"个值为true，来开启输出结果压缩功能。\"><a href=\"#个值为true，来开启输出结果压缩功能。\" class=\"headerlink\" title=\"个值为true，来开启输出结果压缩功能。\"></a>个值为true，来开启输出结果压缩功能。</h5><h5 id=\"1-）案例实操：-3\"><a href=\"#1-）案例实操：-3\" class=\"headerlink\" title=\"1 ）案例实操：\"></a>1 ）案例实操：</h5><h5 id=\"（-1-）开启hive最终输出数据压缩功能\"><a href=\"#（-1-）开启hive最终输出数据压缩功能\" class=\"headerlink\" title=\"（ 1 ）开启hive最终输出数据压缩功能\"></a>（ 1 ）开启hive最终输出数据压缩功能</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;set hive.exec.compress.output&#x3D;true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）开启mapreduce最终输出数据压缩\"><a href=\"#（-2-）开启mapreduce最终输出数据压缩\" class=\"headerlink\" title=\"（ 2 ）开启mapreduce最终输出数据压缩\"></a>（ 2 ）开启mapreduce最终输出数据压缩</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt;set mapreduce.output.fileoutputformat.compress&#x3D;true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）设置mapreduce最终数据输出压缩方式\"><a href=\"#（-3-）设置mapreduce最终数据输出压缩方式\" class=\"headerlink\" title=\"（ 3 ）设置mapreduce最终数据输出压缩方式\"></a>（ 3 ）设置mapreduce最终数据输出压缩方式</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapreduce.output.fileoutputformat.compress.codec &#x3D;\norg.apache.hadoop.io.compress.SnappyCodec;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）设置mapreduce最终数据输出压缩为块压缩\"><a href=\"#（-4-）设置mapreduce最终数据输出压缩为块压缩\" class=\"headerlink\" title=\"（ 4 ）设置mapreduce最终数据输出压缩为块压缩\"></a>（ 4 ）设置mapreduce最终数据输出压缩为块压缩</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set\nmapreduce.output.fileoutputformat.compress.type&#x3D;BLOCK;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）测试一下输出结果是否是压缩文件\"><a href=\"#（-5-）测试一下输出结果是否是压缩文件\" class=\"headerlink\" title=\"（ 5 ）测试一下输出结果是否是压缩文件\"></a>（ 5 ）测试一下输出结果是否是压缩文件</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;distribute-result&#39; select * from emp distribute by\ndeptno sort by empno desc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"9-4-文件存储格式\"><a href=\"#9-4-文件存储格式\" class=\"headerlink\" title=\"9 .4 文件存储格式\"></a>9 .4 文件存储格式</h4><h5 id=\"Hive支持的存储数据的格式主要有：TEXTFILE-、SEQUENCEFILE、ORC、PARQUET。\"><a href=\"#Hive支持的存储数据的格式主要有：TEXTFILE-、SEQUENCEFILE、ORC、PARQUET。\" class=\"headerlink\" title=\"Hive支持的存储数据的格式主要有：TEXTFILE 、SEQUENCEFILE、ORC、PARQUET。\"></a>Hive支持的存储数据的格式主要有：TEXTFILE 、SEQUENCEFILE、ORC、PARQUET。</h5><h5 id=\"—————————————————————————————————————-48\"><a href=\"#—————————————————————————————————————-48\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"9-4-1-列式存储和行式存储\"><a href=\"#9-4-1-列式存储和行式存储\" class=\"headerlink\" title=\"9 .4.1 列式存储和行式存储\"></a>9 .4.1 列式存储和行式存储</h4><h5 id=\"如图所示左边为逻辑表，右边第一个为行式存储，第二个为列式存储。\"><a href=\"#如图所示左边为逻辑表，右边第一个为行式存储，第二个为列式存储。\" class=\"headerlink\" title=\"如图所示左边为逻辑表，右边第一个为行式存储，第二个为列式存储。\"></a>如图所示左边为逻辑表，右边第一个为行式存储，第二个为列式存储。</h5><h5 id=\"1-）行存储的特点\"><a href=\"#1-）行存储的特点\" class=\"headerlink\" title=\"1 ）行存储的特点\"></a>1 ）行存储的特点</h5><h5 id=\"查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列\"><a href=\"#查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列\" class=\"headerlink\" title=\"查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列\"></a>查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列</h5><h5 id=\"的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度\"><a href=\"#的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度\" class=\"headerlink\" title=\"的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度\"></a>的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度</h5><h5 id=\"更快。\"><a href=\"#更快。\" class=\"headerlink\" title=\"更快。\"></a>更快。</h5><h5 id=\"2-）列存储的特点\"><a href=\"#2-）列存储的特点\" class=\"headerlink\" title=\"2 ）列存储的特点\"></a>2 ）列存储的特点</h5><h5 id=\"因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的\"><a href=\"#因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的\" class=\"headerlink\" title=\"因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的\"></a>因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的</h5><h5 id=\"数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算\"><a href=\"#数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算\" class=\"headerlink\" title=\"数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算\"></a>数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算</h5><h5 id=\"法。\"><a href=\"#法。\" class=\"headerlink\" title=\"法。\"></a>法。</h5><h5 id=\"TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；\"><a href=\"#TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；\" class=\"headerlink\" title=\"TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；\"></a>TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；</h5><h5 id=\"ORC和PARQUET是基于列式存储的。\"><a href=\"#ORC和PARQUET是基于列式存储的。\" class=\"headerlink\" title=\"ORC和PARQUET是基于列式存储的。\"></a>ORC和PARQUET是基于列式存储的。</h5><h4 id=\"9-4-2-TextFile-格式\"><a href=\"#9-4-2-TextFile-格式\" class=\"headerlink\" title=\"9 .4.2 TextFile 格式\"></a>9 .4.2 TextFile 格式</h4><h5 id=\"默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，\"><a href=\"#默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，\" class=\"headerlink\" title=\"默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，\"></a>默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，</h5><h5 id=\"但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。\"><a href=\"#但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。\" class=\"headerlink\" title=\"但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。\"></a>但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。</h5><h4 id=\"9-4-3-Orc-格式\"><a href=\"#9-4-3-Orc-格式\" class=\"headerlink\" title=\"9 .4.3 Orc 格式\"></a>9 .4.3 Orc 格式</h4><h5 id=\"Orc-Optimized-Row-Columnar-是Hive-0-11版里引入的新的存储格式。\"><a href=\"#Orc-Optimized-Row-Columnar-是Hive-0-11版里引入的新的存储格式。\" class=\"headerlink\" title=\"Orc (Optimized Row Columnar)是Hive 0.11版里引入的新的存储格式。\"></a>Orc (Optimized Row Columnar)是Hive 0.11版里引入的新的存储格式。</h5><h5 id=\"如下图所示可以看到每个Orc文件由-1-个或多个stripe组成，每个stripe一般为HDFS\"><a href=\"#如下图所示可以看到每个Orc文件由-1-个或多个stripe组成，每个stripe一般为HDFS\" class=\"headerlink\" title=\"如下图所示可以看到每个Orc文件由 1 个或多个stripe组成，每个stripe一般为HDFS\"></a>如下图所示可以看到每个Orc文件由 1 个或多个stripe组成，每个stripe一般为HDFS</h5><h5 id=\"的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet\"><a href=\"#的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet\" class=\"headerlink\" title=\"的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet\"></a>的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet</h5><h5 id=\"中的row-group的概念。每个Stripe里有三部分组成，分别是Index-Data，Row-Data，Stripe\"><a href=\"#中的row-group的概念。每个Stripe里有三部分组成，分别是Index-Data，Row-Data，Stripe\" class=\"headerlink\" title=\"中的row group的概念。每个Stripe里有三部分组成，分别是Index Data，Row Data，Stripe\"></a>中的row group的概念。每个Stripe里有三部分组成，分别是Index Data，Row Data，Stripe</h5><h5 id=\"Footer：\"><a href=\"#Footer：\" class=\"headerlink\" title=\"Footer：\"></a>Footer：</h5><h5 id=\"—————————————————————————————————————-49\"><a href=\"#—————————————————————————————————————-49\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"1-）Index-Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该\"><a href=\"#1-）Index-Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该\" class=\"headerlink\" title=\"1 ）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该\"></a>1 ）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该</h5><h5 id=\"只是记录某行的各字段在Row-Data中的offset。\"><a href=\"#只是记录某行的各字段在Row-Data中的offset。\" class=\"headerlink\" title=\"只是记录某行的各字段在Row Data中的offset。\"></a>只是记录某行的各字段在Row Data中的offset。</h5><h5 id=\"2-）Row-Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个\"><a href=\"#2-）Row-Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个\" class=\"headerlink\" title=\"2 ）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个\"></a>2 ）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个</h5><h5 id=\"列进行了编码，分成多个Stream来存储。\"><a href=\"#列进行了编码，分成多个Stream来存储。\" class=\"headerlink\" title=\"列进行了编码，分成多个Stream来存储。\"></a>列进行了编码，分成多个Stream来存储。</h5><h5 id=\"3-）Stripe-Footer：存的是各个Stream的类型，长度等信息。\"><a href=\"#3-）Stripe-Footer：存的是各个Stream的类型，长度等信息。\" class=\"headerlink\" title=\"3 ）Stripe Footer：存的是各个Stream的类型，长度等信息。\"></a>3 ）Stripe Footer：存的是各个Stream的类型，长度等信息。</h5><h5 id=\"每个文件有一个File-Footer，这里面存的是每个Stripe的行数，每个Column的数据类\"><a href=\"#每个文件有一个File-Footer，这里面存的是每个Stripe的行数，每个Column的数据类\" class=\"headerlink\" title=\"每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类\"></a>每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类</h5><h5 id=\"型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及\"><a href=\"#型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及\" class=\"headerlink\" title=\"型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及\"></a>型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及</h5><h5 id=\"FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到\"><a href=\"#FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到\" class=\"headerlink\" title=\"FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到\"></a>FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到</h5><h5 id=\"File-Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后\"><a href=\"#File-Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后\" class=\"headerlink\" title=\"File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后\"></a>File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后</h5><h5 id=\"往前读。\"><a href=\"#往前读。\" class=\"headerlink\" title=\"往前读。\"></a>往前读。</h5><h5 id=\"—————————————————————————————————————-50\"><a href=\"#—————————————————————————————————————-50\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"9-4-4-Parquet-格式\"><a href=\"#9-4-4-Parquet-格式\" class=\"headerlink\" title=\"9 .4.4 Parquet 格式\"></a>9 .4.4 Parquet 格式</h4><h5 id=\"Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的\"><a href=\"#Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的\" class=\"headerlink\" title=\"Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的\"></a>Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的</h5><h5 id=\"数据和元数据，因此Parquet格式文件是自解析的。\"><a href=\"#数据和元数据，因此Parquet格式文件是自解析的。\" class=\"headerlink\" title=\"数据和元数据，因此Parquet格式文件是自解析的。\"></a>数据和元数据，因此Parquet格式文件是自解析的。</h5><h5 id=\"（-1-）行组-Row-Group-：每一个行组包含一定的行数，在一个HDFS文件中至少存储一\"><a href=\"#（-1-）行组-Row-Group-：每一个行组包含一定的行数，在一个HDFS文件中至少存储一\" class=\"headerlink\" title=\"（ 1 ）行组(Row Group)：每一个行组包含一定的行数，在一个HDFS文件中至少存储一\"></a>（ 1 ）行组(Row Group)：每一个行组包含一定的行数，在一个HDFS文件中至少存储一</h5><h5 id=\"个行组，类似于orc的stripe的概念。\"><a href=\"#个行组，类似于orc的stripe的概念。\" class=\"headerlink\" title=\"个行组，类似于orc的stripe的概念。\"></a>个行组，类似于orc的stripe的概念。</h5><h5 id=\"（-2-）列块-Column-Chunk-：在一个行组中每一列保存在一个列块中，行组中的所有列连\"><a href=\"#（-2-）列块-Column-Chunk-：在一个行组中每一列保存在一个列块中，行组中的所有列连\" class=\"headerlink\" title=\"（ 2 ）列块(Column Chunk)：在一个行组中每一列保存在一个列块中，行组中的所有列连\"></a>（ 2 ）列块(Column Chunk)：在一个行组中每一列保存在一个列块中，行组中的所有列连</h5><h5 id=\"续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的\"><a href=\"#续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的\" class=\"headerlink\" title=\"续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的\"></a>续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的</h5><h5 id=\"算法进行压缩。\"><a href=\"#算法进行压缩。\" class=\"headerlink\" title=\"算法进行压缩。\"></a>算法进行压缩。</h5><h5 id=\"（-3-）页-Page-：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块\"><a href=\"#（-3-）页-Page-：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块\" class=\"headerlink\" title=\"（ 3 ）页(Page)：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块\"></a>（ 3 ）页(Page)：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块</h5><h5 id=\"的不同页可能使用不同的编码方式。\"><a href=\"#的不同页可能使用不同的编码方式。\" class=\"headerlink\" title=\"的不同页可能使用不同的编码方式。\"></a>的不同页可能使用不同的编码方式。</h5><h5 id=\"通常情况下，在存储Parquet数据的时候会按照Block大小设置行组的大小，由于一般\"><a href=\"#通常情况下，在存储Parquet数据的时候会按照Block大小设置行组的大小，由于一般\" class=\"headerlink\" title=\"通常情况下，在存储Parquet数据的时候会按照Block大小设置行组的大小，由于一般\"></a>通常情况下，在存储Parquet数据的时候会按照Block大小设置行组的大小，由于一般</h5><h5 id=\"情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一\"><a href=\"#情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一\" class=\"headerlink\" title=\"情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一\"></a>情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一</h5><h5 id=\"个Mapper任务处理，增大任务执行并行度。Parquet文件的格式。\"><a href=\"#个Mapper任务处理，增大任务执行并行度。Parquet文件的格式。\" class=\"headerlink\" title=\"个Mapper任务处理，增大任务执行并行度。Parquet文件的格式。\"></a>个Mapper任务处理，增大任务执行并行度。Parquet文件的格式。</h5><h5 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h5><h5 id=\"上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是\"><a href=\"#上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是\" class=\"headerlink\" title=\"上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是\"></a>上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是</h5><h5 id=\"该文件的Magic-Code，用于校验它是否是一个Parquet文件，Footer-length记录了文件元数\"><a href=\"#该文件的Magic-Code，用于校验它是否是一个Parquet文件，Footer-length记录了文件元数\" class=\"headerlink\" title=\"该文件的Magic Code，用于校验它是否是一个Parquet文件，Footer length记录了文件元数\"></a>该文件的Magic Code，用于校验它是否是一个Parquet文件，Footer length记录了文件元数</h5><h5 id=\"—————————————————————————————————————-51\"><a href=\"#—————————————————————————————————————-51\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行\"><a href=\"#据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行\" class=\"headerlink\" title=\"据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行\"></a>据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行</h5><h5 id=\"组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一\"><a href=\"#组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一\" class=\"headerlink\" title=\"组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一\"></a>组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一</h5><h5 id=\"页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引\"><a href=\"#页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引\" class=\"headerlink\" title=\"页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引\"></a>页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引</h5><h5 id=\"页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最\"><a href=\"#页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最\" class=\"headerlink\" title=\"页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最\"></a>页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最</h5><h5 id=\"多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引\"><a href=\"#多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引\" class=\"headerlink\" title=\"多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引\"></a>多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引</h5><h5 id=\"页。\"><a href=\"#页。\" class=\"headerlink\" title=\"页。\"></a>页。</h5><h4 id=\"9-4-5-主流文件存储格式对比实验\"><a href=\"#9-4-5-主流文件存储格式对比实验\" class=\"headerlink\" title=\"9 .4.5 主流文件存储格式对比实验\"></a>9 .4.5 主流文件存储格式对比实验</h4><h5 id=\"从存储文件的压缩比和查询速度两个角度对比。\"><a href=\"#从存储文件的压缩比和查询速度两个角度对比。\" class=\"headerlink\" title=\"从存储文件的压缩比和查询速度两个角度对比。\"></a>从存储文件的压缩比和查询速度两个角度对比。</h5><h5 id=\"存储文件的压缩比测试：\"><a href=\"#存储文件的压缩比测试：\" class=\"headerlink\" title=\"存储文件的压缩比测试：\"></a>存储文件的压缩比测试：</h5><h5 id=\"1-）测试数据\"><a href=\"#1-）测试数据\" class=\"headerlink\" title=\"1 ）测试数据\"></a>1 ）测试数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">log.data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）-TextFile\"><a href=\"#2-）-TextFile\" class=\"headerlink\" title=\"2 ） TextFile\"></a>2 ） TextFile</h5><h5 id=\"（-1-）创建表，存储数据格式为TEXTFILE\"><a href=\"#（-1-）创建表，存储数据格式为TEXTFILE\" class=\"headerlink\" title=\"（ 1 ）创建表，存储数据格式为TEXTFILE\"></a>（ 1 ）创建表，存储数据格式为TEXTFILE</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_text (\ntrack_time string,\nurl string,\nsession_id string,\nreferer string,\nip string,\nend_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as textfile;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）向表中加载数据\"><a href=\"#（-2-）向表中加载数据\" class=\"headerlink\" title=\"（ 2 ）向表中加载数据\"></a>（ 2 ）向表中加载数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;log.data&#39;\ninto table log_text ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）查看表中数据大小\"><a href=\"#（-3-）查看表中数据大小\" class=\"headerlink\" title=\"（ 3 ）查看表中数据大小\"></a>（ 3 ）查看表中数据大小</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"18-1-3-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-text-x2F-log-data\"><a href=\"#18-1-3-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-text-x2F-log-data\" class=\"headerlink\" title=\"18.1 3 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_text&#x2F;log.data\"></a>18.1 3 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_text&#x2F;log.data</h5><h5 id=\"3-）-ORC\"><a href=\"#3-）-ORC\" class=\"headerlink\" title=\"3 ） ORC\"></a>3 ） ORC</h5><h5 id=\"（-1-）创建表，存储数据格式为ORC\"><a href=\"#（-1-）创建表，存储数据格式为ORC\" class=\"headerlink\" title=\"（ 1 ）创建表，存储数据格式为ORC\"></a>（ 1 ）创建表，存储数据格式为ORC</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_orc(\ntrack_time string,\nurl string,\nsession_id string,\nreferer string,\nip string,<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-52\"><a href=\"#—————————————————————————————————————-52\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">end_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as orc\ntblproperties(&quot;orc.compress&quot;&#x3D;&quot;NONE&quot;); -- 设置orc存储不使用压缩<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）向表中加载数据-1\"><a href=\"#（-2-）向表中加载数据-1\" class=\"headerlink\" title=\"（ 2 ）向表中加载数据\"></a>（ 2 ）向表中加载数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert into table log_orc select * from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查看表中数据大小-1\"><a href=\"#（-3-）查看表中数据大小-1\" class=\"headerlink\" title=\"（ 3 ）查看表中数据大小\"></a>（ 3 ）查看表中数据大小</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc&#x2F; ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"7-7-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-x2F-000000-0\"><a href=\"#7-7-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-x2F-000000-0\" class=\"headerlink\" title=\"7. 7 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc&#x2F;000000_0\"></a>7. 7 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc&#x2F;000000_0</h5><h5 id=\"4-）-Parquet\"><a href=\"#4-）-Parquet\" class=\"headerlink\" title=\"4 ） Parquet\"></a>4 ） Parquet</h5><h5 id=\"（-1-）创建表，存储数据格式为parquet\"><a href=\"#（-1-）创建表，存储数据格式为parquet\" class=\"headerlink\" title=\"（ 1 ）创建表，存储数据格式为parquet\"></a>（ 1 ）创建表，存储数据格式为parquet</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_parquet(\ntrack_time string,\nurl string,\nsession_id string,\nreferer string,\nip string,\nend_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as parquet;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）向表中加载数据-2\"><a href=\"#（-2-）向表中加载数据-2\" class=\"headerlink\" title=\"（ 2 ）向表中加载数据\"></a>（ 2 ）向表中加载数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert into table log_parquet select * from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查看表中数据大小-2\"><a href=\"#（-3-）查看表中数据大小-2\" class=\"headerlink\" title=\"（ 3 ）查看表中数据大小\"></a>（ 3 ）查看表中数据大小</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_parquet&#x2F;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"13-1-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-x2F-000000-0\"><a href=\"#13-1-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-x2F-000000-0\" class=\"headerlink\" title=\"13.1 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_parquet&#x2F;000000_0\"></a>13.1 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_parquet&#x2F;000000_0</h5><h5 id=\"存储文件的对比总结：\"><a href=\"#存储文件的对比总结：\" class=\"headerlink\" title=\"存储文件的对比总结：\"></a>存储文件的对比总结：</h5><h5 id=\"ORC-gt-Parquet-gt-textFile\"><a href=\"#ORC-gt-Parquet-gt-textFile\" class=\"headerlink\" title=\"ORC &gt; Parquet &gt; textFile\"></a>ORC &gt; Parquet &gt; textFile</h5><h5 id=\"存储文件的查询速度测试：\"><a href=\"#存储文件的查询速度测试：\" class=\"headerlink\" title=\"存储文件的查询速度测试：\"></a>存储文件的查询速度测试：</h5><h5 id=\"（-1-）TextFile\"><a href=\"#（-1-）TextFile\" class=\"headerlink\" title=\"（ 1 ）TextFile\"></a>（ 1 ）TextFile</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;log_text&#39; select substring(url,1,4) from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）ORC\"><a href=\"#（-2-）ORC\" class=\"headerlink\" title=\"（ 2 ）ORC\"></a>（ 2 ）ORC</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;log_orc&#39; select substring(url,1,4) from log_orc;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）Parquet\"><a href=\"#（-3-）Parquet\" class=\"headerlink\" title=\"（ 3 ）Parquet\"></a>（ 3 ）Parquet</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite local directory\n&#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;log_parquet&#39; select substring(url,1,4) from\nlog_parquet;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"存储文件的查询速度总结：查询速度相近。\"><a href=\"#存储文件的查询速度总结：查询速度相近。\" class=\"headerlink\" title=\"存储文件的查询速度总结：查询速度相近。\"></a>存储文件的查询速度总结：查询速度相近。</h5><h5 id=\"—————————————————————————————————————-53\"><a href=\"#—————————————————————————————————————-53\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"9-5-存储和压缩结合\"><a href=\"#9-5-存储和压缩结合\" class=\"headerlink\" title=\"9 .5 存储和压缩结合\"></a>9 .5 存储和压缩结合</h4><h4 id=\"9-5-1-测试存储和压缩\"><a href=\"#9-5-1-测试存储和压缩\" class=\"headerlink\" title=\"9 .5.1 测试存储和压缩\"></a>9 .5.1 测试存储和压缩</h4><h5 id=\"官网：https-cwiki-apache-org-confluence-display-Hive-LanguageManual-ORC\"><a href=\"#官网：https-cwiki-apache-org-confluence-display-Hive-LanguageManual-ORC\" class=\"headerlink\" title=\"官网：https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC\"></a>官网：<a href=\"https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC\">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+ORC</a></h5><h5 id=\"ORC存储方式的压缩：\"><a href=\"#ORC存储方式的压缩：\" class=\"headerlink\" title=\"ORC存储方式的压缩：\"></a>ORC存储方式的压缩：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">Key Default Notes<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">orc.compress ZLIB high level compression (one of NONE, ZLIB, SNAPPY)\norc.compress.size 262,144 number of bytes in each compression chunk\norc.stripe.size 268 , 435 , 456 number of bytes in each stripe\norc.row.index.stride 10,000 number of rows between index entries (must be &gt;&#x3D;\n1000)\norc.create.index true whether to create row indexes\norc.bloom.filter.columns &quot;&quot; comma separated list of column names for which\nbloom filter should be created\norc.bloom.filter.fpp 0.05 false positive probability for bloom filter (must &gt;0.0\nand &lt;1.0)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"注意：所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现\"><a href=\"#注意：所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现\" class=\"headerlink\" title=\"注意：所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现\"></a>注意：所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现</h5><h5 id=\"1-）创建一个-ZLIB-压缩的-ORC-存储方式\"><a href=\"#1-）创建一个-ZLIB-压缩的-ORC-存储方式\" class=\"headerlink\" title=\"1 ）创建一个 ZLIB 压缩的 ORC 存储方式\"></a>1 ）创建一个 ZLIB 压缩的 ORC 存储方式</h5><h5 id=\"（-1-）建表语句\"><a href=\"#（-1-）建表语句\" class=\"headerlink\" title=\"（ 1 ）建表语句\"></a>（ 1 ）建表语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_orc_zlib(\ntrack_time string,\nurl string,\nsession_id string,\nreferer string,\nip string,\nend_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as orc\ntblproperties(&quot;orc.compress&quot;&#x3D;&quot;ZLIB&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）插入数据\"><a href=\"#（-2-）插入数据\" class=\"headerlink\" title=\"（ 2 ）插入数据\"></a>（ 2 ）插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert into log_orc_zlib select * from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查看插入后数据\"><a href=\"#（-3-）查看插入后数据\" class=\"headerlink\" title=\"（ 3 ）查看插入后数据\"></a>（ 3 ）查看插入后数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_zlib&#x2F; ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-78-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-none-x2F-000000-0\"><a href=\"#2-78-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-none-x2F-000000-0\" class=\"headerlink\" title=\"2.78 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_none&#x2F;000000_0\"></a>2.78 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_none&#x2F;000000_0</h5><h5 id=\"2-）创建一个-SNAPPY-压缩的-ORC-存储方式\"><a href=\"#2-）创建一个-SNAPPY-压缩的-ORC-存储方式\" class=\"headerlink\" title=\"2 ）创建一个 SNAPPY 压缩的 ORC 存储方式\"></a>2 ）创建一个 SNAPPY 压缩的 ORC 存储方式</h5><h5 id=\"（-1-）建表语句-1\"><a href=\"#（-1-）建表语句-1\" class=\"headerlink\" title=\"（ 1 ）建表语句\"></a>（ 1 ）建表语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_orc_snappy(\ntrack_time string,\nurl string,\nsession_id string,<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-54\"><a href=\"#—————————————————————————————————————-54\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">referer string,\nip string,\nend_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as orc\ntblproperties(&quot;orc.compress&quot;&#x3D;&quot;SNAPPY&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）插入数据-1\"><a href=\"#（-2-）插入数据-1\" class=\"headerlink\" title=\"（ 2 ）插入数据\"></a>（ 2 ）插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert into log_orc_snappy select * from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查看插入后数据-1\"><a href=\"#（-3-）查看插入后数据-1\" class=\"headerlink\" title=\"（ 3 ）查看插入后数据\"></a>（ 3 ）查看插入后数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_snappy&#x2F;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-75-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-snappy-x2F-000000-0\"><a href=\"#3-75-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-snappy-x2F-000000-0\" class=\"headerlink\" title=\"3. 75 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_snappy&#x2F;000000_0\"></a>3. 75 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_snappy&#x2F;000000_0</h5><h5 id=\"ZLIB比Snappy压缩的还小。原因是ZLIB采用的是deflate压缩算法。比snappy压缩的\"><a href=\"#ZLIB比Snappy压缩的还小。原因是ZLIB采用的是deflate压缩算法。比snappy压缩的\" class=\"headerlink\" title=\"ZLIB比Snappy压缩的还小。原因是ZLIB采用的是deflate压缩算法。比snappy压缩的\"></a>ZLIB比Snappy压缩的还小。原因是ZLIB采用的是deflate压缩算法。比snappy压缩的</h5><h5 id=\"压缩率高。\"><a href=\"#压缩率高。\" class=\"headerlink\" title=\"压缩率高。\"></a>压缩率高。</h5><h5 id=\"3-）创建一个-SNAPPY-压缩的-parquet-存储方式\"><a href=\"#3-）创建一个-SNAPPY-压缩的-parquet-存储方式\" class=\"headerlink\" title=\"3 ）创建一个 SNAPPY 压缩的 parquet 存储方式\"></a>3 ）创建一个 SNAPPY 压缩的 parquet 存储方式</h5><h5 id=\"（-1-）建表语句-2\"><a href=\"#（-1-）建表语句-2\" class=\"headerlink\" title=\"（ 1 ）建表语句\"></a>（ 1 ）建表语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table log_parquet_snappy(\ntrack_time string,\nurl string,\nsession_id string,\nreferer string,\nip string,\nend_user_id string,\ncity_id string\n)\nrow format delimited fields terminated by &#39;\\t&#39;\nstored as parquet\ntblproperties(&quot;parquet.compression&quot;&#x3D;&quot;SNAPPY&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）插入数据-2\"><a href=\"#（-2-）插入数据-2\" class=\"headerlink\" title=\"（ 2 ）插入数据\"></a>（ 2 ）插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert into log_parquet_snappy select * from log_text;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）查看插入后数据-2\"><a href=\"#（-3-）查看插入后数据-2\" class=\"headerlink\" title=\"（ 3 ）查看插入后数据\"></a>（ 3 ）查看插入后数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; dfs -du -h &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_parquet_snappy&#x2F;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"6-39-MB-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-snappy-x2F-000000-0\"><a href=\"#6-39-MB-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-snappy-x2F-000000-0\" class=\"headerlink\" title=\"6.39 MB &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F; log_parquet_snappy &#x2F;000000_0\"></a>6.39 MB &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F; log_parquet_snappy &#x2F;000000_0</h5><h5 id=\"4-）存储方式和压缩总结\"><a href=\"#4-）存储方式和压缩总结\" class=\"headerlink\" title=\"4 ）存储方式和压缩总结\"></a>4 ）存储方式和压缩总结</h5><h5 id=\"在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一\"><a href=\"#在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一\" class=\"headerlink\" title=\"在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一\"></a>在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一</h5><h5 id=\"般选择snappy，lzo。\"><a href=\"#般选择snappy，lzo。\" class=\"headerlink\" title=\"般选择snappy，lzo。\"></a>般选择snappy，lzo。</h5><h1 id=\"第-10-章-企业级调优\"><a href=\"#第-10-章-企业级调优\" class=\"headerlink\" title=\"第 10 章 企业级调优\"></a>第 10 章 企业级调优</h1><h4 id=\"1-0-1-执行计划（-Explain-）\"><a href=\"#1-0-1-执行计划（-Explain-）\" class=\"headerlink\" title=\"1 0. 1 执行计划（ Explain ）\"></a>1 0. 1 执行计划（ Explain ）</h4><h5 id=\"1-）基本语法\"><a href=\"#1-）基本语法\" class=\"headerlink\" title=\"1 ）基本语法\"></a>1 ）基本语法</h5><h5 id=\"—————————————————————————————————————-55\"><a href=\"#—————————————————————————————————————-55\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"EXPLAIN-EXTENDED-DEPENDENCY-AUTHORIZATION-query\"><a href=\"#EXPLAIN-EXTENDED-DEPENDENCY-AUTHORIZATION-query\" class=\"headerlink\" title=\"EXPLAIN [EXTENDED | DEPENDENCY | AUTHORIZATION] query\"></a>EXPLAIN [EXTENDED | DEPENDENCY | AUTHORIZATION] query</h5><h5 id=\"2-）案例实操-5\"><a href=\"#2-）案例实操-5\" class=\"headerlink\" title=\"2 ）案例实操\"></a>2 ）案例实操</h5><h5 id=\"（-1-）查看下面这条语句的执行计划\"><a href=\"#（-1-）查看下面这条语句的执行计划\" class=\"headerlink\" title=\"（ 1 ）查看下面这条语句的执行计划\"></a>（ 1 ）查看下面这条语句的执行计划</h5><h5 id=\"没有生成MR任务的\"><a href=\"#没有生成MR任务的\" class=\"headerlink\" title=\"没有生成MR任务的\"></a>没有生成MR任务的</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; explain select * from emp;\nExplain\nSTAGE DEPENDENCIES:\nStage-0 is a root stage<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">STAGE PLANS:\nStage: Stage- 0\nFetch Operator\nlimit: - 1\nProcessor Tree:\nTableScan\nalias: emp\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nSelect Operator\nexpressions: empno (type: int), ename (type: string), job\n(type: string), mgr (type: int), hiredate (type: string), sal (type:\ndouble), comm (type: double), deptno (type: int)\noutputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5,\n_col6, _col7\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nListSink<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"有生成MR任务的\"><a href=\"#有生成MR任务的\" class=\"headerlink\" title=\"有生成MR任务的\"></a>有生成MR任务的</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; explain select deptno, avg(sal) avg_sal from emp group by\ndeptno;\nExplain\nSTAGE DEPENDENCIES:\nStage-1 is a root stage\nStage-0 depends on stages: Stage- 1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">STAGE PLANS:\nStage: Stage- 1\nMap Reduce\nMap Operator Tree:\nTableScan\nalias: emp\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nSelect Operator\nexpressions: sal (type: double), deptno (type: int)\noutputColumnNames: sal, deptno\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nGroup By Operator\naggregations: sum(sal), count(sal)\nkeys: deptno (type: int)\nmode: hash\noutputColumnNames: _col0, _col1, _col2\nStatistics: Num rows: 1 Data size: 7020 Basic stats:<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-56\"><a href=\"#—————————————————————————————————————-56\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">COMPLETE Column stats: NONE\nReduce Output Operator\nkey expressions: _col0 (type: int)\nsort order: +\nMap-reduce partition columns: _col0 (type: int)\nStatistics: Num rows: 1 Data size: 7020 Basic stats:\nCOMPLETE Column stats: NONE\nvalue expressions: _col1 (type: double), _col2 (type:\nbigint)\nExecution mode: vectorized\nReduce Operator Tree:\nGroup By Operator\naggregations: sum(VALUE._col0), count(VALUE._col1)\nkeys: KEY._col0 (type: int)\nmode: mergepartial\noutputColumnNames: _col0, _col1, _col2\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nSelect Operator\nexpressions: _col0 (type: int), (_col1 &#x2F; _col2) (type: double)\noutputColumnNames: _col0, _col1\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\nFile Output Operator\ncompressed: false\nStatistics: Num rows: 1 Data size: 7020 Basic stats: COMPLETE\nColumn stats: NONE\ntable:\ninput format:\norg.apache.hadoop.mapred.SequenceFileInputFormat\noutput format:\norg.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat\nserde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Stage: Stage- 0\nFetch Operator\nlimit: - 1\nProcessor Tree:\nListSink<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）查看详细执行计划\"><a href=\"#（-2-）查看详细执行计划\" class=\"headerlink\" title=\"（ 2 ）查看详细执行计划\"></a>（ 2 ）查看详细执行计划</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; explain extended select * from emp;\nhive (default)&gt; explain extended select deptno, avg(sal) avg_sal from emp\ngroup by deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"10-2-Fetch-抓取\"><a href=\"#10-2-Fetch-抓取\" class=\"headerlink\" title=\"10. 2 Fetch 抓取\"></a>10. 2 Fetch 抓取</h4><h5 id=\"Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT\"><a href=\"#Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT\" class=\"headerlink\" title=\"Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT\"></a>Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT</h5><h5 id=\"FROM-employees-在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，\"><a href=\"#FROM-employees-在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，\" class=\"headerlink\" title=\"* FROM employees;在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，\"></a>* FROM employees;在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，</h5><h5 id=\"然后输出查询结果到控制台。\"><a href=\"#然后输出查询结果到控制台。\" class=\"headerlink\" title=\"然后输出查询结果到控制台。\"></a>然后输出查询结果到控制台。</h5><h5 id=\"在hive-default-xml-template文件中hive-fetch-task-conversion默认是more，老版本hive\"><a href=\"#在hive-default-xml-template文件中hive-fetch-task-conversion默认是more，老版本hive\" class=\"headerlink\" title=\"在hive-default.xml.template文件中hive.fetch.task.conversion默认是more，老版本hive\"></a>在hive-default.xml.template文件中hive.fetch.task.conversion默认是more，老版本hive</h5><h5 id=\"默认是minimal，该属性修改为-more以后，在全局查找、字段查找、limit查找等都不走\"><a href=\"#默认是minimal，该属性修改为-more以后，在全局查找、字段查找、limit查找等都不走\" class=\"headerlink\" title=\"默认是minimal，该属性修改为 more以后，在全局查找、字段查找、limit查找等都不走\"></a>默认是minimal，该属性修改为 more以后，在全局查找、字段查找、limit查找等都不走</h5><h5 id=\"mapreduce。\"><a href=\"#mapreduce。\" class=\"headerlink\" title=\"mapreduce。\"></a>mapreduce。</h5><h5 id=\"—————————————————————————————————————-57\"><a href=\"#—————————————————————————————————————-57\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;hive.fetch.task.conversion&lt;&#x2F;name&gt;\n&lt;value&gt;more&lt;&#x2F;value&gt;\n&lt;description&gt;\nExpects one of [none, minimal, more].\nSome select queries can be converted to single FETCH task minimizing\nlatency.\nCurrently the query should be single sourced not having any subquery\nand should not have any aggregations or distincts (which incurs RS),\nlateral views and joins.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"0\">\n<li>none : disable hive.fetch.task.conversion</li>\n<li>minimal : SELECT STAR, FILTER on partition columns, LIMIT only</li>\n<li>more : SELECT, FILTER, LIMIT only (support TABLESAMPLE and<br>virtual columns)</description>\n</property></li>\n</ol>\n<h5 id=\"1-）案例实操：-4\"><a href=\"#1-）案例实操：-4\" class=\"headerlink\" title=\"1 ）案例实操：\"></a>1 ）案例实操：</h5><h5 id=\"（-1-）把-hive-fetch-task-conversion设置成none，然后执行查询语句，都会执行mapreduce\"><a href=\"#（-1-）把-hive-fetch-task-conversion设置成none，然后执行查询语句，都会执行mapreduce\" class=\"headerlink\" title=\"（ 1 ）把 hive.fetch.task.conversion设置成none，然后执行查询语句，都会执行mapreduce\"></a>（ 1 ）把 hive.fetch.task.conversion设置成none，然后执行查询语句，都会执行mapreduce</h5><h5 id=\"程序。\"><a href=\"#程序。\" class=\"headerlink\" title=\"程序。\"></a>程序。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set hive.fetch.task.conversion&#x3D;none;\nhive (default)&gt; select * from emp;\nhive (default)&gt; select ename from emp;\nhive (default)&gt; select ename from emp limit 3;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）把hive-fetch-task-conversion设置成more，然后执行查询语句，如下查询方式都不\"><a href=\"#（-2-）把hive-fetch-task-conversion设置成more，然后执行查询语句，如下查询方式都不\" class=\"headerlink\" title=\"（ 2 ）把hive.fetch.task.conversion设置成more，然后执行查询语句，如下查询方式都不\"></a>（ 2 ）把hive.fetch.task.conversion设置成more，然后执行查询语句，如下查询方式都不</h5><h5 id=\"会执行mapreduce程序。\"><a href=\"#会执行mapreduce程序。\" class=\"headerlink\" title=\"会执行mapreduce程序。\"></a>会执行mapreduce程序。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set hive.fetch.task.conversion&#x3D;more;\nhive (default)&gt; select * from emp;\nhive (default)&gt; select ename from emp;\nhive (default)&gt; select ename from emp limit 3;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"10-3-本地模式\"><a href=\"#10-3-本地模式\" class=\"headerlink\" title=\"10.3 本地模式\"></a>10.3 本地模式</h4><h5 id=\"大多数的Hadoop-Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，\"><a href=\"#大多数的Hadoop-Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，\" class=\"headerlink\" title=\"大多数的Hadoop Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，\"></a>大多数的Hadoop Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，</h5><h5 id=\"有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能\"><a href=\"#有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能\" class=\"headerlink\" title=\"有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能\"></a>有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能</h5><h5 id=\"会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机\"><a href=\"#会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机\" class=\"headerlink\" title=\"会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机\"></a>会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机</h5><h5 id=\"器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。\"><a href=\"#器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。\" class=\"headerlink\" title=\"器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。\"></a>器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。</h5><h5 id=\"用户可以通过设置hive-exec-mode-local-auto的值为true，来让Hive在适当的时候自动\"><a href=\"#用户可以通过设置hive-exec-mode-local-auto的值为true，来让Hive在适当的时候自动\" class=\"headerlink\" title=\"用户可以通过设置hive.exec.mode.local.auto的值为true，来让Hive在适当的时候自动\"></a>用户可以通过设置hive.exec.mode.local.auto的值为true，来让Hive在适当的时候自动</h5><h5 id=\"启动这个优化。\"><a href=\"#启动这个优化。\" class=\"headerlink\" title=\"启动这个优化。\"></a>启动这个优化。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.exec.mode.local.auto&#x3D;true; &#x2F;&#x2F;开启本地mr\n&#x2F;&#x2F;设置local mr的最大输入数据量，当输入数据量小于这个值时采用local mr的方式，默认\n为 134217728 ，即128M\nset hive.exec.mode.local.auto.inputbytes.max&#x3D;50000000;\n&#x2F;&#x2F;设置local mr的最大输入文件个数，当输入文件个数小于这个值时采用local mr的方式，默\n认为 4\nset hive.exec.mode.local.auto.input.files.max&#x3D;10;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）-案例实操：\"><a href=\"#1-）-案例实操：\" class=\"headerlink\" title=\"1 ） 案例实操：\"></a>1 ） 案例实操：</h5><h5 id=\"（-2-）关闭本地模式（默认是关闭的），并执行查询语句\"><a href=\"#（-2-）关闭本地模式（默认是关闭的），并执行查询语句\" class=\"headerlink\" title=\"（ 2 ）关闭本地模式（默认是关闭的），并执行查询语句\"></a>（ 2 ）关闭本地模式（默认是关闭的），并执行查询语句</h5><h5 id=\"—————————————————————————————————————-58\"><a href=\"#—————————————————————————————————————-58\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(*) from emp group by deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-1-）开启本地模式，并执行查询语句\"><a href=\"#（-1-）开启本地模式，并执行查询语句\" class=\"headerlink\" title=\"（ 1 ）开启本地模式，并执行查询语句\"></a>（ 1 ）开启本地模式，并执行查询语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set hive.exec.mode.local.auto&#x3D;true;\nhive (default)&gt; select count(*) from emp group by deptno;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"10-4-表的优化\"><a href=\"#10-4-表的优化\" class=\"headerlink\" title=\"10. 4 表的优化\"></a>10. 4 表的优化</h4><h4 id=\"10-4-1-小表大表-Join-（-MapJOIN-）\"><a href=\"#10-4-1-小表大表-Join-（-MapJOIN-）\" class=\"headerlink\" title=\"10. 4 .1 小表大表 Join （ MapJOIN ）\"></a>10. 4 .1 小表大表 Join （ MapJOIN ）</h4><h5 id=\"将key相对分散，并且数据量小的表放在join的左边，可以使用map-join让小的维度表\"><a href=\"#将key相对分散，并且数据量小的表放在join的左边，可以使用map-join让小的维度表\" class=\"headerlink\" title=\"将key相对分散，并且数据量小的表放在join的左边，可以使用map join让小的维度表\"></a>将key相对分散，并且数据量小的表放在join的左边，可以使用map join让小的维度表</h5><h5 id=\"先进内存。在map端完成join。\"><a href=\"#先进内存。在map端完成join。\" class=\"headerlink\" title=\"先进内存。在map端完成join。\"></a>先进内存。在map端完成join。</h5><h5 id=\"实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放\"><a href=\"#实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放\" class=\"headerlink\" title=\"实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放\"></a>实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放</h5><h5 id=\"在左边和右边已经没有区别。\"><a href=\"#在左边和右边已经没有区别。\" class=\"headerlink\" title=\"在左边和右边已经没有区别。\"></a>在左边和右边已经没有区别。</h5><h5 id=\"案例实操\"><a href=\"#案例实操\" class=\"headerlink\" title=\"案例实操\"></a>案例实操</h5><h5 id=\"1-）需求介绍\"><a href=\"#1-）需求介绍\" class=\"headerlink\" title=\"1 ）需求介绍\"></a>1 ）需求介绍</h5><h5 id=\"测试大表JOIN小表和小表JOIN大表的效率\"><a href=\"#测试大表JOIN小表和小表JOIN大表的效率\" class=\"headerlink\" title=\"测试大表JOIN小表和小表JOIN大表的效率\"></a>测试大表JOIN小表和小表JOIN大表的效率</h5><h5 id=\"2-）开启-MapJoin-参数设置\"><a href=\"#2-）开启-MapJoin-参数设置\" class=\"headerlink\" title=\"2 ）开启 MapJoin 参数设置\"></a>2 ）开启 MapJoin 参数设置</h5><h5 id=\"（-1-）设置自动选择Mapjoin\"><a href=\"#（-1-）设置自动选择Mapjoin\" class=\"headerlink\" title=\"（ 1 ）设置自动选择Mapjoin\"></a>（ 1 ）设置自动选择Mapjoin</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.auto.convert.join &#x3D; true; 默认为true<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）大表小表的阈值设置（默认25M以下认为是小表）：\"><a href=\"#（-2-）大表小表的阈值设置（默认25M以下认为是小表）：\" class=\"headerlink\" title=\"（ 2 ）大表小表的阈值设置（默认25M以下认为是小表）：\"></a>（ 2 ）大表小表的阈值设置（默认25M以下认为是小表）：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.mapjoin.smalltable.filesize &#x3D; 25000000;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）-MapJoin-工作机制\"><a href=\"#3-）-MapJoin-工作机制\" class=\"headerlink\" title=\"3 ） MapJoin 工作机制\"></a>3 ） MapJoin 工作机制</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">MapJoin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Task A<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">MR Local\nTask<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Small Table b<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">HashTable\nFiles<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Distribute\nTask B Cache\nMapJoinTask\nmapper\nmapper\nmapper<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Output file1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Output file2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Output file3<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">1 ）TaskA，它是一个LocalTask（在客户端\n本地执行的Task），负责扫描小表b的数据，将\n其转换成一个HashTable的数据结构，并写入本\n地 的 文 件 中，之 后 将 该 文 件 加 载 到\nDistributeCache中。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">2 ）TaskB，该任务是一个没有Reduce的MR，\n启动MapTasks扫描大表a，在Map阶段，根据a的\n每一条记录去和DistributeCache中b表对应的\nHashTable关联，并直接输出结果。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">3 ）由于MapJoin没有Reduce，所以由Map直\n接输出结果文件，有多少个MapTask，就有多\n少个结果文件。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">load<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Table a<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"4-）建大表、小表和-JOIN-后表的语句\"><a href=\"#4-）建大表、小表和-JOIN-后表的语句\" class=\"headerlink\" title=\"4 ）建大表、小表和 JOIN 后表的语句\"></a>4 ）建大表、小表和 JOIN 后表的语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 创建大表<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-59\"><a href=\"#—————————————————————————————————————-59\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table bigtable(id bigint, t bigint, uid string, keyword string,\nurl_rank int, click_num int, click_url string) row format delimited\nfields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 创建小表\ncreate table smalltable(id bigint, t bigint, uid string, keyword string,\nurl_rank int, click_num int, click_url string) row format delimited\nfields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 创建join后表的语句\ncreate table jointable(id bigint, t bigint, uid string, keyword string,\nurl_rank int, click_num int, click_url string) row format delimited\nfields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"5-）分别向大表和小表中导入数据\"><a href=\"#5-）分别向大表和小表中导入数据\" class=\"headerlink\" title=\"5 ）分别向大表和小表中导入数据\"></a>5 ）分别向大表和小表中导入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;bigtable&#39; into\ntable bigtable;\nhive (default)&gt;load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;smalltable&#39; into\ntable smalltable;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"6-）小表-JOIN-大表语句\"><a href=\"#6-）小表-JOIN-大表语句\" class=\"headerlink\" title=\"6 ）小表 JOIN 大表语句\"></a>6 ）小表 JOIN 大表语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect b.id, b.t, b.uid, b.keyword, b.url_rank, b.click_num, b.click_url\nfrom smalltable s\njoin bigtable b\non b.id &#x3D; s.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"7-）大表-JOIN-小表语句\"><a href=\"#7-）大表-JOIN-小表语句\" class=\"headerlink\" title=\"7 ）大表 JOIN 小表语句\"></a>7 ）大表 JOIN 小表语句</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect b.id, b.t, b.uid, b.keyword, b.url_rank, b.click_num, b.click_url\nfrom bigtable b\njoin smalltable s\non s.id &#x3D; b.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"10-4-2-大表-Join-大表\"><a href=\"#10-4-2-大表-Join-大表\" class=\"headerlink\" title=\"10.4.2 大表 Join 大表\"></a>10.4.2 大表 Join 大表</h4><h5 id=\"1-）空-KEY-过滤\"><a href=\"#1-）空-KEY-过滤\" class=\"headerlink\" title=\"1 ）空 KEY 过滤\"></a>1 ）空 KEY 过滤</h5><h5 id=\"有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同\"><a href=\"#有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同\" class=\"headerlink\" title=\"有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同\"></a>有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同</h5><h5 id=\"的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，\"><a href=\"#的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，\" class=\"headerlink\" title=\"的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，\"></a>的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，</h5><h5 id=\"这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为\"><a href=\"#这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为\" class=\"headerlink\" title=\"这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为\"></a>这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为</h5><h5 id=\"空，操作如下：\"><a href=\"#空，操作如下：\" class=\"headerlink\" title=\"空，操作如下：\"></a>空，操作如下：</h5><h5 id=\"案例实操-1\"><a href=\"#案例实操-1\" class=\"headerlink\" title=\"案例实操\"></a>案例实操</h5><h5 id=\"（-1-）配置历史服务器\"><a href=\"#（-1-）配置历史服务器\" class=\"headerlink\" title=\"（ 1 ）配置历史服务器\"></a>（ 1 ）配置历史服务器</h5><h5 id=\"配置mapred-site-xml\"><a href=\"#配置mapred-site-xml\" class=\"headerlink\" title=\"配置mapred-site.xml\"></a>配置mapred-site.xml</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;mapreduce.jobhistory.address&lt;&#x2F;name&gt;\n&lt;value&gt;hadoop102:10020&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;mapreduce.jobhistory.webapp.address&lt;&#x2F;name&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-60\"><a href=\"#—————————————————————————————————————-60\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;value&gt;hadoop102:19888&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"启动历史服务器\"><a href=\"#启动历史服务器\" class=\"headerlink\" title=\"启动历史服务器\"></a>启动历史服务器</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">sbin&#x2F;mr-jobhistory-daemon.sh start historyserver<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"查看jobhistory\"><a href=\"#查看jobhistory\" class=\"headerlink\" title=\"查看jobhistory\"></a>查看jobhistory</h5><h5 id=\"http-hadoop102-19888-jobhistory\"><a href=\"#http-hadoop102-19888-jobhistory\" class=\"headerlink\" title=\"http://hadoop102:19888/jobhistory\"></a><a href=\"http://hadoop102:19888/jobhistory\">http://hadoop102:19888/jobhistory</a></h5><h5 id=\"（-2-）创建原始数据空id表\"><a href=\"#（-2-）创建原始数据空id表\" class=\"headerlink\" title=\"（ 2 ）创建原始数据空id表\"></a>（ 2 ）创建原始数据空id表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; 创建空id表\ncreate table nullidtable(id bigint, t bigint, uid string, keyword string,\nurl_rank int, click_num int, click_url string) row format delimited\nfields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）分别加载原始数据和空id数据到对应表中\"><a href=\"#（-3-）分别加载原始数据和空id数据到对应表中\" class=\"headerlink\" title=\"（ 3 ）分别加载原始数据和空id数据到对应表中\"></a>（ 3 ）分别加载原始数据和空id数据到对应表中</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;nullid&#39; into\ntable nullidtable;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）测试不过滤空id\"><a href=\"#（-4-）测试不过滤空id\" class=\"headerlink\" title=\"（ 4 ）测试不过滤空id\"></a>（ 4 ）测试不过滤空id</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite table jointable select n.* from\nnullidtable n left join bigtable o on n.id &#x3D; o.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）测试过滤空id\"><a href=\"#（-5-）测试过滤空id\" class=\"headerlink\" title=\"（ 5 ）测试过滤空id\"></a>（ 5 ）测试过滤空id</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; insert overwrite table jointable select n.* from (select\n* from nullidtable where id is not null) n left join bigtable o on n.id &#x3D;\no.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）空-key-转换\"><a href=\"#2-）空-key-转换\" class=\"headerlink\" title=\"2 ）空 key 转换\"></a>2 ）空 key 转换</h5><h5 id=\"有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在\"><a href=\"#有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在\" class=\"headerlink\" title=\"有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在\"></a>有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在</h5><h5 id=\"join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地\"><a href=\"#join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地\" class=\"headerlink\" title=\"join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地\"></a>join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地</h5><h5 id=\"分不到不同的reducer上。例如：\"><a href=\"#分不到不同的reducer上。例如：\" class=\"headerlink\" title=\"分不到不同的reducer上。例如：\"></a>分不到不同的reducer上。例如：</h5><h5 id=\"案例实操：\"><a href=\"#案例实操：\" class=\"headerlink\" title=\"案例实操：\"></a>案例实操：</h5><h5 id=\"不随机分布空null值：\"><a href=\"#不随机分布空null值：\" class=\"headerlink\" title=\"不随机分布空null值：\"></a>不随机分布空null值：</h5><h5 id=\"（-1-）设置-5-个reduce个数\"><a href=\"#（-1-）设置-5-个reduce个数\" class=\"headerlink\" title=\"（ 1 ）设置 5 个reduce个数\"></a>（ 1 ）设置 5 个reduce个数</h5><h5 id=\"set-mapreduce-job-reduces-x3D-5\"><a href=\"#set-mapreduce-job-reduces-x3D-5\" class=\"headerlink\" title=\"set mapreduce.job.reduces &#x3D; 5;\"></a>set mapreduce.job.reduces &#x3D; 5;</h5><h5 id=\"（-2-）JOIN两张表\"><a href=\"#（-2-）JOIN两张表\" class=\"headerlink\" title=\"（ 2 ）JOIN两张表\"></a>（ 2 ）JOIN两张表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect n.* from nullidtable n left join bigtable b on n.id &#x3D; b.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"结果：如下图所示，可以看出来，出现了数据倾斜，某些reducer的资源消耗远大于其\"><a href=\"#结果：如下图所示，可以看出来，出现了数据倾斜，某些reducer的资源消耗远大于其\" class=\"headerlink\" title=\"结果：如下图所示，可以看出来，出现了数据倾斜，某些reducer的资源消耗远大于其\"></a>结果：如下图所示，可以看出来，出现了数据倾斜，某些reducer的资源消耗远大于其</h5><h5 id=\"他reducer。\"><a href=\"#他reducer。\" class=\"headerlink\" title=\"他reducer。\"></a>他reducer。</h5><h5 id=\"—————————————————————————————————————-61\"><a href=\"#—————————————————————————————————————-61\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"随机分布空null值\"><a href=\"#随机分布空null值\" class=\"headerlink\" title=\"随机分布空null值\"></a>随机分布空null值</h5><h5 id=\"（-1-）设置-5-个reduce个数-1\"><a href=\"#（-1-）设置-5-个reduce个数-1\" class=\"headerlink\" title=\"（ 1 ）设置 5 个reduce个数\"></a>（ 1 ）设置 5 个reduce个数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set mapreduce.job.reduces &#x3D; 5;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）JOIN两张表-1\"><a href=\"#（-2-）JOIN两张表-1\" class=\"headerlink\" title=\"（ 2 ）JOIN两张表\"></a>（ 2 ）JOIN两张表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect n.* from nullidtable n full join bigtable o on\nnvl(n.id,rand()) &#x3D; o.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"结果：如下图所示，可以看出来，消除了数据倾斜，负载均衡reducer的资源消耗\"><a href=\"#结果：如下图所示，可以看出来，消除了数据倾斜，负载均衡reducer的资源消耗\" class=\"headerlink\" title=\"结果：如下图所示，可以看出来，消除了数据倾斜，负载均衡reducer的资源消耗\"></a>结果：如下图所示，可以看出来，消除了数据倾斜，负载均衡reducer的资源消耗</h5><h5 id=\"3-）-SMB-Sort-Merge-Bucket-join\"><a href=\"#3-）-SMB-Sort-Merge-Bucket-join\" class=\"headerlink\" title=\"3 ） SMB(Sort Merge Bucket join)\"></a>3 ） SMB(Sort Merge Bucket join)</h5><h5 id=\"（-1-）创建第二张大表\"><a href=\"#（-1-）创建第二张大表\" class=\"headerlink\" title=\"（ 1 ）创建第二张大表\"></a>（ 1 ）创建第二张大表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table bigtable 2 (\nid bigint,\nt bigint,\nuid string,\nkeyword string,\nurl_rank int,\nclick_num int,\nclick_url string)\nrow format delimited fields terminated by &#39;\\t&#39;;\nload data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;bigtable&#39; into table bigtable 2 ;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-62\"><a href=\"#—————————————————————————————————————-62\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"测试大表直接JOIN\"><a href=\"#测试大表直接JOIN\" class=\"headerlink\" title=\"测试大表直接JOIN\"></a>测试大表直接JOIN</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect b.id, b.t, b.uid, b.keyword, b.url_rank, b.click_num, b.click_url\nfrom bigtable s\njoin bigtable 2 b\non b.id &#x3D; s.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）创建分通表-1-桶的个数不要超过可用CPU的核数\"><a href=\"#（-2-）创建分通表-1-桶的个数不要超过可用CPU的核数\" class=\"headerlink\" title=\"（ 2 ）创建分通表 1 ,桶的个数不要超过可用CPU的核数\"></a>（ 2 ）创建分通表 1 ,桶的个数不要超过可用CPU的核数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table bigtable_buck1(\nid bigint,\nt bigint,\nuid string,\nkeyword string,\nurl_rank int,\nclick_num int,\nclick_url string)\nclustered by(id)\nsorted by(id)\ninto 6 buckets\nrow format delimited fields terminated by &#39;\\t&#39;;\nload data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;bigtable&#39; into table\nbigtable_buck1;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）创建分通表-2-桶的个数不要超过可用CPU的核数\"><a href=\"#（-3-）创建分通表-2-桶的个数不要超过可用CPU的核数\" class=\"headerlink\" title=\"（ 3 ）创建分通表 2 ,桶的个数不要超过可用CPU的核数\"></a>（ 3 ）创建分通表 2 ,桶的个数不要超过可用CPU的核数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table bigtable_buck2(\nid bigint,\nt bigint,\nuid string,\nkeyword string,\nurl_rank int,\nclick_num int,\nclick_url string)\nclustered by(id)\nsorted by(id)\ninto 6 buckets\nrow format delimited fields terminated by &#39;\\t&#39;;\nload data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;bigtable&#39; into table\nbigtable_buck2;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）设置参数\"><a href=\"#（-4-）设置参数\" class=\"headerlink\" title=\"（ 4 ）设置参数\"></a>（ 4 ）设置参数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.optimize.bucketmapjoin &#x3D; true;\nset hive.optimize.bucketmapjoin.sortedmerge &#x3D; true;\nset\nhive.input.format&#x3D;org.apache.hadoop.hive.ql.io.BucketizedHiveInputFormat;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）测试\"><a href=\"#（-5-）测试\" class=\"headerlink\" title=\"（ 5 ）测试\"></a>（ 5 ）测试</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert overwrite table jointable\nselect b.id, b.t, b.uid, b.keyword, b.url_rank, b.click_num, b.click_url\nfrom bigtable_buck1 s\njoin bigtable_buck2 b\non b.id &#x3D; s.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"10-4-3-Group-By\"><a href=\"#10-4-3-Group-By\" class=\"headerlink\" title=\"10.4.3 Group By\"></a>10.4.3 Group By</h4><h5 id=\"默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜\"><a href=\"#默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜\" class=\"headerlink\" title=\"默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜\"></a>默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜</h5><h5 id=\"了。\"><a href=\"#了。\" class=\"headerlink\" title=\"了。\"></a>了。</h5><h5 id=\"—————————————————————————————————————-63\"><a href=\"#—————————————————————————————————————-63\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行\"><a href=\"#并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行\" class=\"headerlink\" title=\"并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行\"></a>并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行</h5><h5 id=\"部分聚合，最后在Reduce端得出最终结果。\"><a href=\"#部分聚合，最后在Reduce端得出最终结果。\" class=\"headerlink\" title=\"部分聚合，最后在Reduce端得出最终结果。\"></a>部分聚合，最后在Reduce端得出最终结果。</h5><h5 id=\"1-）开启-Map-端聚合参数设置\"><a href=\"#1-）开启-Map-端聚合参数设置\" class=\"headerlink\" title=\"1 ）开启 Map 端聚合参数设置\"></a>1 ）开启 Map 端聚合参数设置</h5><h5 id=\"（-1-）是否在Map端进行聚合，默认为True\"><a href=\"#（-1-）是否在Map端进行聚合，默认为True\" class=\"headerlink\" title=\"（ 1 ）是否在Map端进行聚合，默认为True\"></a>（ 1 ）是否在Map端进行聚合，默认为True</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.map.aggr &#x3D; true<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-2-）在Map端进行聚合操作的条目数目\"><a href=\"#（-2-）在Map端进行聚合操作的条目数目\" class=\"headerlink\" title=\"（ 2 ）在Map端进行聚合操作的条目数目\"></a>（ 2 ）在Map端进行聚合操作的条目数目</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.groupby.mapaggr.checkinterval &#x3D; 100000<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）有数据倾斜的时候进行负载均衡（默认是false）\"><a href=\"#（-3-）有数据倾斜的时候进行负载均衡（默认是false）\" class=\"headerlink\" title=\"（ 3 ）有数据倾斜的时候进行负载均衡（默认是false）\"></a>（ 3 ）有数据倾斜的时候进行负载均衡（默认是false）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.groupby.skewindata &#x3D; true<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"当选项设定为-true，生成的查询计划会有两个MR-Job。第一个MR-Job中，Map的输出\"><a href=\"#当选项设定为-true，生成的查询计划会有两个MR-Job。第一个MR-Job中，Map的输出\" class=\"headerlink\" title=\"当选项设定为 true，生成的查询计划会有两个MR Job。第一个MR Job中，Map的输出\"></a>当选项设定为 true，生成的查询计划会有两个MR Job。第一个MR Job中，Map的输出</h5><h5 id=\"结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果\"><a href=\"#结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果\" class=\"headerlink\" title=\"结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果\"></a>结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果</h5><h5 id=\"是相同的Group-By-Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二\"><a href=\"#是相同的Group-By-Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二\" class=\"headerlink\" title=\"是相同的Group By Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二\"></a>是相同的Group By Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二</h5><h5 id=\"个MR-Job再根据预处理的数据结果按照Group-By-Key分布到Reduce中（这个过程可以保证\"><a href=\"#个MR-Job再根据预处理的数据结果按照Group-By-Key分布到Reduce中（这个过程可以保证\" class=\"headerlink\" title=\"个MR Job再根据预处理的数据结果按照Group By Key分布到Reduce中（这个过程可以保证\"></a>个MR Job再根据预处理的数据结果按照Group By Key分布到Reduce中（这个过程可以保证</h5><h5 id=\"相同的Group-By-Key被分布到同一个Reduce中），最后完成最终的聚合操作。\"><a href=\"#相同的Group-By-Key被分布到同一个Reduce中），最后完成最终的聚合操作。\" class=\"headerlink\" title=\"相同的Group By Key被分布到同一个Reduce中），最后完成最终的聚合操作。\"></a>相同的Group By Key被分布到同一个Reduce中），最后完成最终的聚合操作。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select deptno from emp group by deptno;\nStage-Stage-1: Map: 1 Reduce: 5 Cumulative CPU: 23.68 sec HDFS Read:\n19987 HDFS Write: 9 SUCCESS\nTotal MapReduce CPU Time Spent: 23 seconds 680 msec\nOK\ndeptno\n10\n20\n30<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"优化以后\"><a href=\"#优化以后\" class=\"headerlink\" title=\"优化以后\"></a>优化以后</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set hive.groupby.skewindata &#x3D; true;\nhive (default)&gt; select deptno from emp group by deptno;\nStage-Stage-1: Map: 1 Reduce: 5 Cumulative CPU: 28.53 sec HDFS Read:\n18209 HDFS Write: 534 SUCCESS\nStage-Stage-2: Map: 1 Reduce: 5 Cumulative CPU: 38.32 sec HDFS Read:\n15014 HDFS Write: 9 SUCCESS\nTotal MapReduce CPU Time Spent: 1 minutes 6 seconds 850 msec\nOK\ndeptno\n10\n20\n30<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-64\"><a href=\"#—————————————————————————————————————-64\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"10-4-4-Count-Distinct-去重统计\"><a href=\"#10-4-4-Count-Distinct-去重统计\" class=\"headerlink\" title=\"10.4. 4 Count(Distinct) 去重统计\"></a>10.4. 4 Count(Distinct) 去重统计</h4><h5 id=\"数据量小的时候无所谓，数据量大的情况下，由于-COUNT-DISTINCT操作需要用一个\"><a href=\"#数据量小的时候无所谓，数据量大的情况下，由于-COUNT-DISTINCT操作需要用一个\" class=\"headerlink\" title=\"数据量小的时候无所谓，数据量大的情况下，由于 COUNT DISTINCT操作需要用一个\"></a>数据量小的时候无所谓，数据量大的情况下，由于 COUNT DISTINCT操作需要用一个</h5><h5 id=\"Reduce-Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，\"><a href=\"#Reduce-Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，\" class=\"headerlink\" title=\"Reduce Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，\"></a>Reduce Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，</h5><h5 id=\"一般COUNT-DISTINCT使用先GROUP-BY再COUNT的方式替换-但是需要注意group-by造成\"><a href=\"#一般COUNT-DISTINCT使用先GROUP-BY再COUNT的方式替换-但是需要注意group-by造成\" class=\"headerlink\" title=\"一般COUNT DISTINCT使用先GROUP BY再COUNT的方式替换,但是需要注意group by造成\"></a>一般COUNT DISTINCT使用先GROUP BY再COUNT的方式替换,但是需要注意group by造成</h5><h5 id=\"的数据倾斜问题\"><a href=\"#的数据倾斜问题\" class=\"headerlink\" title=\"的数据倾斜问题.\"></a>的数据倾斜问题.</h5><h5 id=\"1-）-案例实操\"><a href=\"#1-）-案例实操\" class=\"headerlink\" title=\"1 ） 案例实操\"></a>1 ） 案例实操</h5><h5 id=\"（-1-）创建一张大表\"><a href=\"#（-1-）创建一张大表\" class=\"headerlink\" title=\"（ 1 ）创建一张大表\"></a>（ 1 ）创建一张大表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; create table bigtable(id bigint, time bigint, uid string,\nkeyword\nstring, url_rank int, click_num int, click_url string) row format\ndelimited\nfields terminated by &#39;\\t&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）加载数据\"><a href=\"#（-2-）加载数据\" class=\"headerlink\" title=\"（ 2 ）加载数据\"></a>（ 2 ）加载数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; load data local inpath &#39;&#x2F;opt&#x2F;module&#x2F;data&#x2F;bigtable&#39; into\ntable bigtable;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）设置-5-个reduce个数\"><a href=\"#（-3-）设置-5-个reduce个数\" class=\"headerlink\" title=\"（ 3 ）设置 5 个reduce个数\"></a>（ 3 ）设置 5 个reduce个数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set mapreduce.job.reduces &#x3D; 5;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-4-）执行去重id查询\"><a href=\"#（-4-）执行去重id查询\" class=\"headerlink\" title=\"（ 4 ）执行去重id查询\"></a>（ 4 ）执行去重id查询</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(distinct id) from bigtable;\nStage-Stage-1: Map: 1 Reduce: 1 Cumulative CPU: 7.12 sec HDFS Read:\n120741990 HDFS Write: 7 SUCCESS\nTotal MapReduce CPU Time Spent: 7 seconds 120 msec\nOK\nc0\n100001\nTime taken: 23.607 seconds, Fetched: 1 row(s)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-5-）采用GROUP-by去重id\"><a href=\"#（-5-）采用GROUP-by去重id\" class=\"headerlink\" title=\"（ 5 ）采用GROUP by去重id\"></a>（ 5 ）采用GROUP by去重id</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(id) from (select id from bigtable group by\nid) a;\nStage-Stage-1: Map: 1 Reduce: 5 Cumulative CPU: 17.53 sec HDFS Read:\n120752703 HDFS Write: 580 SUCCESS\nStage-Stage-2: Map: 1 Reduce: 1 Cumulative CPU: 4.29 sec2 HDFS Read:\n9409 HDFS Write: 7 SUCCESS\nTotal MapReduce CPU Time Spent: 21 seconds 820 msec\nOK\n_c0\n100001\nTime taken: 50.795 seconds, Fetched: 1 row(s)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。\"><a href=\"#虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。\" class=\"headerlink\" title=\"虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。\"></a>虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。</h5><h4 id=\"10-4-5-笛卡尔积\"><a href=\"#10-4-5-笛卡尔积\" class=\"headerlink\" title=\"10.4. 5 笛卡尔积\"></a>10.4. 5 笛卡尔积</h4><h5 id=\"尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用-1-个\"><a href=\"#尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用-1-个\" class=\"headerlink\" title=\"尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用 1 个\"></a>尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用 1 个</h5><h5 id=\"reducer来完成笛卡尔积。\"><a href=\"#reducer来完成笛卡尔积。\" class=\"headerlink\" title=\"reducer来完成笛卡尔积。\"></a>reducer来完成笛卡尔积。</h5><h5 id=\"—————————————————————————————————————-65\"><a href=\"#—————————————————————————————————————-65\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"10-4-6-行列过滤\"><a href=\"#10-4-6-行列过滤\" class=\"headerlink\" title=\"10.4. 6 行列过滤\"></a>10.4. 6 行列过滤</h4><h5 id=\"列处理：在SELECT中，只拿需要的列，如果有分区，尽量使用分区过滤，少用SELECT\"><a href=\"#列处理：在SELECT中，只拿需要的列，如果有分区，尽量使用分区过滤，少用SELECT\" class=\"headerlink\" title=\"列处理：在SELECT中，只拿需要的列，如果有分区，尽量使用分区过滤，少用SELECT\"></a>列处理：在SELECT中，只拿需要的列，如果有分区，尽量使用分区过滤，少用SELECT</h5><h5 id=\"。\"><a href=\"#。\" class=\"headerlink\" title=\"*。\"></a>*。</h5><h5 id=\"行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，\"><a href=\"#行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，\" class=\"headerlink\" title=\"行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，\"></a>行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，</h5><h5 id=\"那么就会先全表关联，之后再过滤，比如：\"><a href=\"#那么就会先全表关联，之后再过滤，比如：\" class=\"headerlink\" title=\"那么就会先全表关联，之后再过滤，比如：\"></a>那么就会先全表关联，之后再过滤，比如：</h5><h5 id=\"案例实操：-1\"><a href=\"#案例实操：-1\" class=\"headerlink\" title=\"案例实操：\"></a>案例实操：</h5><h5 id=\"1-）测试先关联两张表，再用-where-条件过滤\"><a href=\"#1-）测试先关联两张表，再用-where-条件过滤\" class=\"headerlink\" title=\"1 ）测试先关联两张表，再用 where 条件过滤\"></a>1 ）测试先关联两张表，再用 where 条件过滤</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select o.id from bigtable b\njoin bigtable o on o.id &#x3D; b.id\nwhere o.id &lt;&#x3D; 10;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"Time-taken-34-406-seconds-Fetched-100-row-s\"><a href=\"#Time-taken-34-406-seconds-Fetched-100-row-s\" class=\"headerlink\" title=\"Time taken: 34.406 seconds, Fetched: 100 row(s)\"></a>Time taken: 34.406 seconds, Fetched: 100 row(s)</h5><h5 id=\"2-）通过子查询后，再关联表\"><a href=\"#2-）通过子查询后，再关联表\" class=\"headerlink\" title=\"2 ）通过子查询后，再关联表\"></a>2 ）通过子查询后，再关联表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select b.id from bigtable b\njoin (select id from bigtable where id &lt;&#x3D; 10) o on b.id &#x3D; o.id;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"Time-taken-30-058-seconds-Fetched-100-row-s\"><a href=\"#Time-taken-30-058-seconds-Fetched-100-row-s\" class=\"headerlink\" title=\"Time taken: 30.058 seconds, Fetched: 100 row(s)\"></a>Time taken: 30.058 seconds, Fetched: 100 row(s)</h5><h4 id=\"10-4-7-分区\"><a href=\"#10-4-7-分区\" class=\"headerlink\" title=\"10.4. 7 分区\"></a>10.4. 7 分区</h4><h5 id=\"详见7-1章。\"><a href=\"#详见7-1章。\" class=\"headerlink\" title=\"详见7.1章。\"></a>详见7.1章。</h5><h4 id=\"10-4-8-分桶\"><a href=\"#10-4-8-分桶\" class=\"headerlink\" title=\"10.4. 8 分桶\"></a>10.4. 8 分桶</h4><h5 id=\"详见-7-2章。\"><a href=\"#详见-7-2章。\" class=\"headerlink\" title=\"详见 7 .2章。\"></a>详见 7 .2章。</h5><h4 id=\"10-5-合理设置-Map-及-Reduce-数\"><a href=\"#10-5-合理设置-Map-及-Reduce-数\" class=\"headerlink\" title=\"10. 5 合理设置 Map 及 Reduce 数\"></a>10. 5 合理设置 Map 及 Reduce 数</h4><h5 id=\"1-）通常情况下，作业会通过input的目录产生一个或者多个map任务。\"><a href=\"#1-）通常情况下，作业会通过input的目录产生一个或者多个map任务。\" class=\"headerlink\" title=\"1 ）通常情况下，作业会通过input的目录产生一个或者多个map任务。\"></a>1 ）通常情况下，作业会通过input的目录产生一个或者多个map任务。</h5><h5 id=\"主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。\"><a href=\"#主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。\" class=\"headerlink\" title=\"主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。\"></a>主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。</h5><h5 id=\"2-）是不是map数越多越好？\"><a href=\"#2-）是不是map数越多越好？\" class=\"headerlink\" title=\"2 ）是不是map数越多越好？\"></a>2 ）是不是map数越多越好？</h5><h5 id=\"答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件\"><a href=\"#答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件\" class=\"headerlink\" title=\"答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件\"></a>答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件</h5><h5 id=\"也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大\"><a href=\"#也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大\" class=\"headerlink\" title=\"也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大\"></a>也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大</h5><h5 id=\"于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。\"><a href=\"#于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。\" class=\"headerlink\" title=\"于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。\"></a>于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。</h5><h5 id=\"3-）是不是保证每个map处理接近128m的文件块，就高枕无忧了？\"><a href=\"#3-）是不是保证每个map处理接近128m的文件块，就高枕无忧了？\" class=\"headerlink\" title=\"3 ）是不是保证每个map处理接近128m的文件块，就高枕无忧了？\"></a>3 ）是不是保证每个map处理接近128m的文件块，就高枕无忧了？</h5><h5 id=\"答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只\"><a href=\"#答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只\" class=\"headerlink\" title=\"答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只\"></a>答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只</h5><h5 id=\"有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map\"><a href=\"#有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map\" class=\"headerlink\" title=\"有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map\"></a>有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map</h5><h5 id=\"任务去做，肯定也比较耗时。\"><a href=\"#任务去做，肯定也比较耗时。\" class=\"headerlink\" title=\"任务去做，肯定也比较耗时。\"></a>任务去做，肯定也比较耗时。</h5><h5 id=\"—————————————————————————————————————-66\"><a href=\"#—————————————————————————————————————-66\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"针对上面的问题-2-和-3-，我们需要采取两种方式来解决：即减少map数和增加map数；\"><a href=\"#针对上面的问题-2-和-3-，我们需要采取两种方式来解决：即减少map数和增加map数；\" class=\"headerlink\" title=\"针对上面的问题 2 和 3 ，我们需要采取两种方式来解决：即减少map数和增加map数；\"></a>针对上面的问题 2 和 3 ，我们需要采取两种方式来解决：即减少map数和增加map数；</h5><h4 id=\"10-5-1-复杂文件增加-Map-数\"><a href=\"#10-5-1-复杂文件增加-Map-数\" class=\"headerlink\" title=\"10. 5 .1 复杂文件增加 Map 数\"></a>10. 5 .1 复杂文件增加 Map 数</h4><h5 id=\"当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，\"><a href=\"#当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，\" class=\"headerlink\" title=\"当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，\"></a>当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，</h5><h5 id=\"来使得每个map处理的数据量减少，从而提高任务的执行效率。\"><a href=\"#来使得每个map处理的数据量减少，从而提高任务的执行效率。\" class=\"headerlink\" title=\"来使得每个map处理的数据量减少，从而提高任务的执行效率。\"></a>来使得每个map处理的数据量减少，从而提高任务的执行效率。</h5><h5 id=\"增加map的方法为：根据\"><a href=\"#增加map的方法为：根据\" class=\"headerlink\" title=\"增加map的方法为：根据\"></a>增加map的方法为：根据</h5><h5 id=\"computeSliteSize-Math-max-minSize-Math-min-maxSize-blocksize-x3D-blocksize-x3D-128M-公式，\"><a href=\"#computeSliteSize-Math-max-minSize-Math-min-maxSize-blocksize-x3D-blocksize-x3D-128M-公式，\" class=\"headerlink\" title=\"computeSliteSize(Math.max(minSize,Math.min(maxSize,blocksize)))&#x3D;blocksize&#x3D;128M 公式，\"></a>computeSliteSize(Math.max(minSize,Math.min(maxSize,blocksize)))&#x3D;blocksize&#x3D;128M 公式，</h5><h5 id=\"调整maxSize最大值。让maxSize最大值低于blocksize就可以增加map的个数。\"><a href=\"#调整maxSize最大值。让maxSize最大值低于blocksize就可以增加map的个数。\" class=\"headerlink\" title=\"调整maxSize最大值。让maxSize最大值低于blocksize就可以增加map的个数。\"></a>调整maxSize最大值。让maxSize最大值低于blocksize就可以增加map的个数。</h5><h5 id=\"案例实操：-2\"><a href=\"#案例实操：-2\" class=\"headerlink\" title=\"案例实操：\"></a>案例实操：</h5><h5 id=\"1-）执行查询\"><a href=\"#1-）执行查询\" class=\"headerlink\" title=\"1 ）执行查询\"></a>1 ）执行查询</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; select count(*) from emp;\nHadoop job information for Stage-1: number of mappers: 1; number of\nreducers: 1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）设置最大切片值为-100-个字节\"><a href=\"#2-）设置最大切片值为-100-个字节\" class=\"headerlink\" title=\"2 ）设置最大切片值为 100 个字节\"></a>2 ）设置最大切片值为 100 个字节</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set mapreduce.input.fileinputformat.split.maxsize&#x3D;100;\nhive (default)&gt; select count(*) from emp;\nHadoop job information for Stage-1: number of mappers: 6; number of\nreducers: 1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"10-5-2-小文件进行合并\"><a href=\"#10-5-2-小文件进行合并\" class=\"headerlink\" title=\"10. 5 .2 小文件进行合并\"></a>10. 5 .2 小文件进行合并</h4><h5 id=\"1-）在map执行前合并小文件，减少map数：CombineHiveInputFormat具有对小文件进行合\"><a href=\"#1-）在map执行前合并小文件，减少map数：CombineHiveInputFormat具有对小文件进行合\" class=\"headerlink\" title=\"1 ）在map执行前合并小文件，减少map数：CombineHiveInputFormat具有对小文件进行合\"></a>1 ）在map执行前合并小文件，减少map数：CombineHiveInputFormat具有对小文件进行合</h5><h5 id=\"并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。\"><a href=\"#并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。\" class=\"headerlink\" title=\"并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。\"></a>并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.input.format&#x3D;\norg.apache.hadoop.hive.ql.io.CombineHiveInputFormat;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"2-）在Map-Reduce的任务结束时合并小文件的设置：\"><a href=\"#2-）在Map-Reduce的任务结束时合并小文件的设置：\" class=\"headerlink\" title=\"2 ）在Map-Reduce的任务结束时合并小文件的设置：\"></a>2 ）在Map-Reduce的任务结束时合并小文件的设置：</h5><h5 id=\"在map-only任务结束时合并小文件，默认true\"><a href=\"#在map-only任务结束时合并小文件，默认true\" class=\"headerlink\" title=\"在map-only任务结束时合并小文件，默认true\"></a>在map-only任务结束时合并小文件，默认true</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SET hive.merge.mapfiles &#x3D; true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"在map-reduce任务结束时合并小文件，默认false\"><a href=\"#在map-reduce任务结束时合并小文件，默认false\" class=\"headerlink\" title=\"在map-reduce任务结束时合并小文件，默认false\"></a>在map-reduce任务结束时合并小文件，默认false</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SET hive.merge.mapredfiles &#x3D; true;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"合并文件的大小，默认256M\"><a href=\"#合并文件的大小，默认256M\" class=\"headerlink\" title=\"合并文件的大小，默认256M\"></a>合并文件的大小，默认256M</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SET hive.merge.size.per.task &#x3D; 268435456;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge\"><a href=\"#当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge\" class=\"headerlink\" title=\"当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge\"></a>当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SET hive.merge.smallfiles.avgsize &#x3D; 16777216;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"10-5-3-合理设置-Reduce-数\"><a href=\"#10-5-3-合理设置-Reduce-数\" class=\"headerlink\" title=\"10. 5 .3 合理设置 Reduce 数\"></a>10. 5 .3 合理设置 Reduce 数</h4><h5 id=\"1-）调整-reduce-个数方法一\"><a href=\"#1-）调整-reduce-个数方法一\" class=\"headerlink\" title=\"1 ）调整 reduce 个数方法一\"></a>1 ）调整 reduce 个数方法一</h5><h5 id=\"（-1-）每个Reduce处理的数据量默认是256MB\"><a href=\"#（-1-）每个Reduce处理的数据量默认是256MB\" class=\"headerlink\" title=\"（ 1 ）每个Reduce处理的数据量默认是256MB\"></a>（ 1 ）每个Reduce处理的数据量默认是256MB</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive.exec.reducers.bytes.per.reducer&#x3D;256000000<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-67\"><a href=\"#—————————————————————————————————————-67\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"（-2-）每个任务最大的reduce数，默认为-1009\"><a href=\"#（-2-）每个任务最大的reduce数，默认为-1009\" class=\"headerlink\" title=\"（ 2 ）每个任务最大的reduce数，默认为 1009\"></a>（ 2 ）每个任务最大的reduce数，默认为 1009</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive.exec.reducers.max&#x3D;1009<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"（-3-）计算reducer数的公式\"><a href=\"#（-3-）计算reducer数的公式\" class=\"headerlink\" title=\"（ 3 ）计算reducer数的公式\"></a>（ 3 ）计算reducer数的公式</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">N&#x3D;min(参数 2 ，总输入数据量&#x2F;参数1)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"2-）调整-reduce-个数方法二\"><a href=\"#2-）调整-reduce-个数方法二\" class=\"headerlink\" title=\"2 ）调整 reduce 个数方法二\"></a>2 ）调整 reduce 个数方法二</h5><h5 id=\"在hadoop的mapred-default-xml文件中修改\"><a href=\"#在hadoop的mapred-default-xml文件中修改\" class=\"headerlink\" title=\"在hadoop的mapred-default.xml文件中修改\"></a>在hadoop的mapred-default.xml文件中修改</h5><h5 id=\"设置每个job的Reduce个数\"><a href=\"#设置每个job的Reduce个数\" class=\"headerlink\" title=\"设置每个job的Reduce个数\"></a>设置每个job的Reduce个数</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set mapreduce.job.reduces &#x3D; 15;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"3-）-reduce-个数并不是越多越好\"><a href=\"#3-）-reduce-个数并不是越多越好\" class=\"headerlink\" title=\"3 ） reduce 个数并不是越多越好\"></a>3 ） reduce 个数并不是越多越好</h5><h5 id=\"（-1-）过多的启动和初始化reduce也会消耗时间和资源；\"><a href=\"#（-1-）过多的启动和初始化reduce也会消耗时间和资源；\" class=\"headerlink\" title=\"（ 1 ）过多的启动和初始化reduce也会消耗时间和资源；\"></a>（ 1 ）过多的启动和初始化reduce也会消耗时间和资源；</h5><h5 id=\"（-2-）另外，有多少个reduce，就会有多少个输出文件，如果生成了很多个小文件，那\"><a href=\"#（-2-）另外，有多少个reduce，就会有多少个输出文件，如果生成了很多个小文件，那\" class=\"headerlink\" title=\"（ 2 ）另外，有多少个reduce，就会有多少个输出文件，如果生成了很多个小文件，那\"></a>（ 2 ）另外，有多少个reduce，就会有多少个输出文件，如果生成了很多个小文件，那</h5><h5 id=\"么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；\"><a href=\"#么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；\" class=\"headerlink\" title=\"么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；\"></a>么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；</h5><h5 id=\"在设置reduce个数的时候也需要考虑这两个原则：处理大数据量利用合适的reduce数；\"><a href=\"#在设置reduce个数的时候也需要考虑这两个原则：处理大数据量利用合适的reduce数；\" class=\"headerlink\" title=\"在设置reduce个数的时候也需要考虑这两个原则：处理大数据量利用合适的reduce数；\"></a>在设置reduce个数的时候也需要考虑这两个原则：处理大数据量利用合适的reduce数；</h5><h5 id=\"使单个reduce任务处理数据量大小要合适；\"><a href=\"#使单个reduce任务处理数据量大小要合适；\" class=\"headerlink\" title=\"使单个reduce任务处理数据量大小要合适；\"></a>使单个reduce任务处理数据量大小要合适；</h5><h4 id=\"10-6-并行执行\"><a href=\"#10-6-并行执行\" class=\"headerlink\" title=\"10. 6 并行执行\"></a>10. 6 并行执行</h4><h5 id=\"Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽\"><a href=\"#Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽\" class=\"headerlink\" title=\"Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽\"></a>Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽</h5><h5 id=\"样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，\"><a href=\"#样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，\" class=\"headerlink\" title=\"样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，\"></a>样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，</h5><h5 id=\"Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能\"><a href=\"#Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能\" class=\"headerlink\" title=\"Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能\"></a>Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能</h5><h5 id=\"并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行\"><a href=\"#并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行\" class=\"headerlink\" title=\"并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行\"></a>并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行</h5><h5 id=\"时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。\"><a href=\"#时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。\" class=\"headerlink\" title=\"时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。\"></a>时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。</h5><h5 id=\"通过设置参数hive-exec-parallel值为true，就可以开启并发执行。不过，在共享集群中，\"><a href=\"#通过设置参数hive-exec-parallel值为true，就可以开启并发执行。不过，在共享集群中，\" class=\"headerlink\" title=\"通过设置参数hive.exec.parallel值为true，就可以开启并发执行。不过，在共享集群中，\"></a>通过设置参数hive.exec.parallel值为true，就可以开启并发执行。不过，在共享集群中，</h5><h5 id=\"需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。\"><a href=\"#需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。\" class=\"headerlink\" title=\"需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。\"></a>需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">set hive.exec.parallel&#x3D;true; &#x2F;&#x2F;打开任务并行执行\nset hive.exec.parallel.thread.number&#x3D;16; &#x2F;&#x2F;同一个sql允许最大并行度，默认为\n8 。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。\"><a href=\"#当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。\" class=\"headerlink\" title=\"当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。\"></a>当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。</h5><h4 id=\"10-7-严格模式\"><a href=\"#10-7-严格模式\" class=\"headerlink\" title=\"10. 7 严格模式\"></a>10. 7 严格模式</h4><h5 id=\"Hive可以通过设置防止一些危险操作：\"><a href=\"#Hive可以通过设置防止一些危险操作：\" class=\"headerlink\" title=\"Hive可以通过设置防止一些危险操作：\"></a>Hive可以通过设置防止一些危险操作：</h5><h5 id=\"1-）分区表不使用分区过滤\"><a href=\"#1-）分区表不使用分区过滤\" class=\"headerlink\" title=\"1 ）分区表不使用分区过滤\"></a>1 ）分区表不使用分区过滤</h5><h5 id=\"将hive-strict-checks-no-partition-filter设置为true时，对于分区表，除非where语句中含\"><a href=\"#将hive-strict-checks-no-partition-filter设置为true时，对于分区表，除非where语句中含\" class=\"headerlink\" title=\"将hive.strict.checks.no.partition.filter设置为true时，对于分区表，除非where语句中含\"></a>将hive.strict.checks.no.partition.filter设置为true时，对于分区表，除非where语句中含</h5><h5 id=\"有分区字段过滤条件来限制范围，否则不允许执行。换句话说，就是用户不允许扫描所有分\"><a href=\"#有分区字段过滤条件来限制范围，否则不允许执行。换句话说，就是用户不允许扫描所有分\" class=\"headerlink\" title=\"有分区字段过滤条件来限制范围，否则不允许执行。换句话说，就是用户不允许扫描所有分\"></a>有分区字段过滤条件来限制范围，否则不允许执行。换句话说，就是用户不允许扫描所有分</h5><h5 id=\"—————————————————————————————————————-68\"><a href=\"#—————————————————————————————————————-68\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"区。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有\"><a href=\"#区。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有\" class=\"headerlink\" title=\"区。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有\"></a>区。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有</h5><h5 id=\"进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。\"><a href=\"#进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。\" class=\"headerlink\" title=\"进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。\"></a>进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。</h5><h5 id=\"2-）使用-order-by-没有-limit-过滤\"><a href=\"#2-）使用-order-by-没有-limit-过滤\" class=\"headerlink\" title=\"2 ）使用 order by 没有 limit 过滤\"></a>2 ）使用 order by 没有 limit 过滤</h5><h5 id=\"将hive-strict-checks-orderby-no-limit设置为true时，对于使用了order-by语句的查询，要\"><a href=\"#将hive-strict-checks-orderby-no-limit设置为true时，对于使用了order-by语句的查询，要\" class=\"headerlink\" title=\"将hive.strict.checks.orderby.no.limit设置为true时，对于使用了order by语句的查询，要\"></a>将hive.strict.checks.orderby.no.limit设置为true时，对于使用了order by语句的查询，要</h5><h5 id=\"求必须使用limit语句。因为order-by为了执行排序过程会将所有的结果数据分发到同一个\"><a href=\"#求必须使用limit语句。因为order-by为了执行排序过程会将所有的结果数据分发到同一个\" class=\"headerlink\" title=\"求必须使用limit语句。因为order by为了执行排序过程会将所有的结果数据分发到同一个\"></a>求必须使用limit语句。因为order by为了执行排序过程会将所有的结果数据分发到同一个</h5><h5 id=\"Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一\"><a href=\"#Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一\" class=\"headerlink\" title=\"Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一\"></a>Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一</h5><h5 id=\"段时间。\"><a href=\"#段时间。\" class=\"headerlink\" title=\"段时间。\"></a>段时间。</h5><h5 id=\"3-）笛卡尔积\"><a href=\"#3-）笛卡尔积\" class=\"headerlink\" title=\"3 ）笛卡尔积\"></a>3 ）笛卡尔积</h5><h5 id=\"将hive-strict-checks-cartesian-product设置为true时，会限制笛卡尔积的查询。对关系型数\"><a href=\"#将hive-strict-checks-cartesian-product设置为true时，会限制笛卡尔积的查询。对关系型数\" class=\"headerlink\" title=\"将hive.strict.checks.cartesian.product设置为true时，会限制笛卡尔积的查询。对关系型数\"></a>将hive.strict.checks.cartesian.product设置为true时，会限制笛卡尔积的查询。对关系型数</h5><h5 id=\"据库非常了解的用户可能期望在-执行JOIN查询的时候不使用ON语句而是使用where语\"><a href=\"#据库非常了解的用户可能期望在-执行JOIN查询的时候不使用ON语句而是使用where语\" class=\"headerlink\" title=\"据库非常了解的用户可能期望在 执行JOIN查询的时候不使用ON语句而是使用where语\"></a>据库非常了解的用户可能期望在 执行JOIN查询的时候不使用ON语句而是使用where语</h5><h5 id=\"句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸\"><a href=\"#句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸\" class=\"headerlink\" title=\"句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸\"></a>句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸</h5><h5 id=\"的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情\"><a href=\"#的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情\" class=\"headerlink\" title=\"的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情\"></a>的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情</h5><h5 id=\"况。\"><a href=\"#况。\" class=\"headerlink\" title=\"况。\"></a>况。</h5><h4 id=\"10-8-JVM-重用\"><a href=\"#10-8-JVM-重用\" class=\"headerlink\" title=\"10. 8 JVM 重用\"></a>10. 8 JVM 重用</h4><h5 id=\"详见hadoop优化文档中jvm重用\"><a href=\"#详见hadoop优化文档中jvm重用\" class=\"headerlink\" title=\"详见hadoop优化文档中jvm重用\"></a>详见hadoop优化文档中jvm重用</h5><h4 id=\"10-9-压缩\"><a href=\"#10-9-压缩\" class=\"headerlink\" title=\"10. 9 压缩\"></a>10. 9 压缩</h4><h5 id=\"详见第-9-章。\"><a href=\"#详见第-9-章。\" class=\"headerlink\" title=\"详见第 9 章。\"></a>详见第 9 章。</h5><h1 id=\"第-11-章-Hive实战\"><a href=\"#第-11-章-Hive实战\" class=\"headerlink\" title=\"第 11 章 Hive实战\"></a>第 11 章 Hive实战</h1><h4 id=\"11-1-需求描述\"><a href=\"#11-1-需求描述\" class=\"headerlink\" title=\"11 .1 需求描述\"></a>11 .1 需求描述</h4><h5 id=\"统计硅谷影音视频网站的常规指标，各种TopN指标：\"><a href=\"#统计硅谷影音视频网站的常规指标，各种TopN指标：\" class=\"headerlink\" title=\"统计硅谷影音视频网站的常规指标，各种TopN指标：\"></a>统计硅谷影音视频网站的常规指标，各种TopN指标：</h5><h5 id=\"–-统计视频观看数Top-10\"><a href=\"#–-统计视频观看数Top-10\" class=\"headerlink\" title=\"– 统计视频观看数Top 10\"></a>– 统计视频观看数Top 10</h5><h5 id=\"–-统计视频类别热度Top-10\"><a href=\"#–-统计视频类别热度Top-10\" class=\"headerlink\" title=\"– 统计视频类别热度Top 10\"></a>– 统计视频类别热度Top 10</h5><h5 id=\"–-统计出视频观看数最高的-20-个视频的所属类别以及类别包含Top20视频的个数\"><a href=\"#–-统计出视频观看数最高的-20-个视频的所属类别以及类别包含Top20视频的个数\" class=\"headerlink\" title=\"– 统计出视频观看数最高的 20 个视频的所属类别以及类别包含Top20视频的个数\"></a>– 统计出视频观看数最高的 20 个视频的所属类别以及类别包含Top20视频的个数</h5><h5 id=\"–-统计视频观看数Top-50-所关联视频的所属类别排序\"><a href=\"#–-统计视频观看数Top-50-所关联视频的所属类别排序\" class=\"headerlink\" title=\"– 统计视频观看数Top 50 所关联视频的所属类别排序\"></a>– 统计视频观看数Top 50 所关联视频的所属类别排序</h5><h5 id=\"–-统计每个类别中的视频热度Top10-以Music为例\"><a href=\"#–-统计每个类别中的视频热度Top10-以Music为例\" class=\"headerlink\" title=\"– 统计每个类别中的视频热度Top10,以Music为例\"></a>– 统计每个类别中的视频热度Top10,以Music为例</h5><h5 id=\"–-统计每个类别视频观看数Top-10\"><a href=\"#–-统计每个类别视频观看数Top-10\" class=\"headerlink\" title=\"– 统计每个类别视频观看数Top 10\"></a>– 统计每个类别视频观看数Top 10</h5><ul>\n<li><ul>\n<li>统计上传视频最多的用户Top 10 以及他们上传的视频观看次数在前 20 的视频</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"—————————————————————————————————————-69\"><a href=\"#—————————————————————————————————————-69\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h4 id=\"11-2-数据结构\"><a href=\"#11-2-数据结构\" class=\"headerlink\" title=\"11 .2 数据结构\"></a>11 .2 数据结构</h4><h5 id=\"1-）视频表\"><a href=\"#1-）视频表\" class=\"headerlink\" title=\"1 ）视频表\"></a>1 ）视频表</h5><h5 id=\"视频表\"><a href=\"#视频表\" class=\"headerlink\" title=\"视频表\"></a>视频表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">字段 备注 详细描述\nvideoId 视频唯一id（String） 11 位字符串\nuploader 视频上传者（String） 上传视频的用户名String\nage 视频年龄（int） 视频在平台上的整数天\ncategory 视频类别（Array&lt;String&gt;） 上传视频指定的视频分类<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>length (^) 视频长度（Int） 整形数字标识的视频长度<br>views 观看次数（Int） 视频被浏览的次数<br>rate 视频评分（Double） 满分 5 分<br>Ratings 流量（Int） 视频的流量，整型数字<br>conments 评论数（Int） 一个视频的整数评论数<br>relatedId 相关视频id（Array<String>） 相关视频的id，最多 20 个</p>\n<h5 id=\"2-）用户表\"><a href=\"#2-）用户表\" class=\"headerlink\" title=\"2 ）用户表\"></a>2 ）用户表</h5><h5 id=\"用户表\"><a href=\"#用户表\" class=\"headerlink\" title=\"用户表\"></a>用户表</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">字段 备注 字段类型<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">uploader 上传者用户名 string<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>videos (^) 上传视频数 int<br>friends (^) 朋友数量 int</p>\n<h2 id=\"11-3-准备工作\"><a href=\"#11-3-准备工作\" class=\"headerlink\" title=\"11 .3 准备工作\"></a>11 .3 准备工作</h2><h2 id=\"11-3-1-准备表\"><a href=\"#11-3-1-准备表\" class=\"headerlink\" title=\"11 .3. 1 准备表\"></a>11 .3. 1 准备表</h2><h5 id=\"1-）需要准备的表\"><a href=\"#1-）需要准备的表\" class=\"headerlink\" title=\"1 ）需要准备的表\"></a>1 ）需要准备的表</h5><h5 id=\"创建原始数据表：gulivideo-ori，gulivideo-user-ori，\"><a href=\"#创建原始数据表：gulivideo-ori，gulivideo-user-ori，\" class=\"headerlink\" title=\"创建原始数据表：gulivideo_ori，gulivideo_user_ori，\"></a>创建原始数据表：gulivideo_ori，gulivideo_user_ori，</h5><h5 id=\"创建最终表：gulivideo-orc，gulivideo-user-orc\"><a href=\"#创建最终表：gulivideo-orc，gulivideo-user-orc\" class=\"headerlink\" title=\"创建最终表：gulivideo_orc，gulivideo_user_orc\"></a>创建最终表：gulivideo_orc，gulivideo_user_orc</h5><h5 id=\"2-）创建原始数据表：\"><a href=\"#2-）创建原始数据表：\" class=\"headerlink\" title=\"2 ）创建原始数据表：\"></a>2 ）创建原始数据表：</h5><h5 id=\"（-1-）gulivideo-ori\"><a href=\"#（-1-）gulivideo-ori\" class=\"headerlink\" title=\"（ 1 ）gulivideo_ori\"></a>（ 1 ）gulivideo_ori</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table gulivideo_ori(<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-70\"><a href=\"#—————————————————————————————————————-70\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">videoId string,\nuploader string,\nage int,\ncategory array&lt;string&gt;,\nlength int,\nviews int,\nrate float,\nratings int,\ncomments int,\nrelatedId array&lt;string&gt;)\nrow format delimited fields terminated by &quot;\\t&quot;\ncollection items terminated by &quot;&amp;&quot;\nstored as textfile;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）创建原始数据表-gulivideo-user-ori\"><a href=\"#（-2-）创建原始数据表-gulivideo-user-ori\" class=\"headerlink\" title=\"（ 2 ）创建原始数据表: gulivideo_user_ori\"></a>（ 2 ）创建原始数据表: gulivideo_user_ori</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table gulivideo_user_ori(\nuploader string,\nvideos int,\nfriends int)\nrow format delimited\nfields terminated by &quot;\\t&quot;\nstored as textfile;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）-创建-orc-存储格式带-snappy-压缩的表：\"><a href=\"#2-）-创建-orc-存储格式带-snappy-压缩的表：\" class=\"headerlink\" title=\"2 ） 创建 orc 存储格式带 snappy 压缩的表：\"></a>2 ） 创建 orc 存储格式带 snappy 压缩的表：</h5><h5 id=\"（-1-）gulivideo-orc\"><a href=\"#（-1-）gulivideo-orc\" class=\"headerlink\" title=\"（ 1 ）gulivideo_orc\"></a>（ 1 ）gulivideo_orc</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table gulivideo_orc(\nvideoId string,\nuploader string,\nage int,\ncategory array&lt;string&gt;,\nlength int,\nviews int,\nrate float,\nratings int,\ncomments int,\nrelatedId array&lt;string&gt;)\nstored as orc\ntblproperties(&quot;orc.compress&quot;&#x3D;&quot;SNAPPY&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-2-）gulivideo-user-orc\"><a href=\"#（-2-）gulivideo-user-orc\" class=\"headerlink\" title=\"（ 2 ）gulivideo_user_orc\"></a>（ 2 ）gulivideo_user_orc</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">create table gulivideo_user_orc(\nuploader string,\nvideos int,\nfriends int)\nrow format delimited\nfields terminated by &quot;\\t&quot;\nstored as orc\ntblproperties(&quot;orc.compress&quot;&#x3D;&quot;SNAPPY&quot;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"（-3-）向ori表插入数据\"><a href=\"#（-3-）向ori表插入数据\" class=\"headerlink\" title=\"（ 3 ）向ori表插入数据\"></a>（ 3 ）向ori表插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">load data local inpath &quot;&#x2F;opt&#x2F;module&#x2F;data&#x2F;video&quot; into table gulivideo_ori;\nload data local inpath &quot;&#x2F;opt&#x2F;module&#x2F;user&quot; into table gulivideo_user_ori;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"（-4-）向orc表插入数据\"><a href=\"#（-4-）向orc表插入数据\" class=\"headerlink\" title=\"（ 4 ）向orc表插入数据\"></a>（ 4 ）向orc表插入数据</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">insert into table gulivideo_orc select * from gulivideo_ori;\ninsert into table gulivideo_user_orc select * from gulivideo_user_ori;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-71\"><a href=\"#—————————————————————————————————————-71\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h2 id=\"11-3-2-安装-Tez-引擎（了解）\"><a href=\"#11-3-2-安装-Tez-引擎（了解）\" class=\"headerlink\" title=\"11.3. 2 安装 Tez 引擎（了解）\"></a>11.3. 2 安装 Tez 引擎（了解）</h2><h5 id=\"Tez是一个Hive的运行引擎，性能优于MR。为什么优于MR呢？看下。\"><a href=\"#Tez是一个Hive的运行引擎，性能优于MR。为什么优于MR呢？看下。\" class=\"headerlink\" title=\"Tez是一个Hive的运行引擎，性能优于MR。为什么优于MR呢？看下。\"></a>Tez是一个Hive的运行引擎，性能优于MR。为什么优于MR呢？看下。</h5><h5 id=\"用Hive直接编写MR程序，假设有四个有依赖关系的MR作业，上图中，绿色是Reduce\"><a href=\"#用Hive直接编写MR程序，假设有四个有依赖关系的MR作业，上图中，绿色是Reduce\" class=\"headerlink\" title=\"用Hive直接编写MR程序，假设有四个有依赖关系的MR作业，上图中，绿色是Reduce\"></a>用Hive直接编写MR程序，假设有四个有依赖关系的MR作业，上图中，绿色是Reduce</h5><h5 id=\"Task，云状表示写屏蔽，需要将中间结果持久化写到HDFS。\"><a href=\"#Task，云状表示写屏蔽，需要将中间结果持久化写到HDFS。\" class=\"headerlink\" title=\"Task，云状表示写屏蔽，需要将中间结果持久化写到HDFS。\"></a>Task，云状表示写屏蔽，需要将中间结果持久化写到HDFS。</h5><h5 id=\"Tez可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，\"><a href=\"#Tez可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，\" class=\"headerlink\" title=\"Tez可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，\"></a>Tez可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，</h5><h5 id=\"从而大大提升作业的计算性能。\"><a href=\"#从而大大提升作业的计算性能。\" class=\"headerlink\" title=\"从而大大提升作业的计算性能。\"></a>从而大大提升作业的计算性能。</h5><h5 id=\"1-）将-tez-安装包拷贝到集群，并解压-tar-包\"><a href=\"#1-）将-tez-安装包拷贝到集群，并解压-tar-包\" class=\"headerlink\" title=\"1 ）将 tez 安装包拷贝到集群，并解压 tar 包\"></a>1 ）将 tez 安装包拷贝到集群，并解压 tar 包</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ mkdir &#x2F;opt&#x2F;module&#x2F;tez\n[atguigu@hadoop102 software]$ tar -zxvf &#x2F;opt&#x2F;software&#x2F;tez-0.10. 1 -\nSNAPSHOT-minimal.tar.gz - C &#x2F;opt&#x2F;module&#x2F;tez<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"2-）上传-tez-依赖到-HDFS\"><a href=\"#2-）上传-tez-依赖到-HDFS\" class=\"headerlink\" title=\"2 ）上传 tez 依赖到 HDFS\"></a>2 ）上传 tez 依赖到 HDFS</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ hadoop fs -mkdir &#x2F;tez\n[atguigu@hadoop102 software]$ hadoop fs -put &#x2F;opt&#x2F;software&#x2F;tez-0.10.1-\nSNAPSHOT.tar.gz &#x2F;tez<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"3-）新建-tez-site-xml\"><a href=\"#3-）新建-tez-site-xml\" class=\"headerlink\" title=\"3 ）新建 tez-site.xml\"></a>3 ）新建 tez-site.xml</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ vim $HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;tez-site.xml<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"添加如下内容：\"><a href=\"#添加如下内容：\" class=\"headerlink\" title=\"添加如下内容：\"></a>添加如下内容：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;?xml-stylesheet type&#x3D;&quot;text&#x2F;xsl&quot; href&#x3D;&quot;configuration.xsl&quot;?&gt;\n&lt;configuration&gt;\n&lt;property&gt;\n&lt;name&gt;tez.lib.uris&lt;&#x2F;name&gt;\n&lt;value&gt;$&#123;fs.defaultFS&#125;&#x2F;tez&#x2F;tez-0.10.1-SNAPSHOT.tar.gz&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.use.cluster.hadoop-libs&lt;&#x2F;name&gt;\n&lt;value&gt;true&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.am.resource.memory.mb&lt;&#x2F;name&gt;\n&lt;value&gt;1024&lt;&#x2F;value&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-72\"><a href=\"#—————————————————————————————————————-72\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.am.resource.cpu.vcores&lt;&#x2F;name&gt;\n&lt;value&gt;1&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.container.max.java.heap.fraction&lt;&#x2F;name&gt;\n&lt;value&gt;0.4&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.task.resource.memory.mb&lt;&#x2F;name&gt;\n&lt;value&gt;1024&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.task.resource.cpu.vcores&lt;&#x2F;name&gt;\n&lt;value&gt;1&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;&#x2F;configuration&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"4-）修改-Hadoop-环境变量\"><a href=\"#4-）修改-Hadoop-环境变量\" class=\"headerlink\" title=\"4 ）修改 Hadoop 环境变量\"></a>4 ）修改 Hadoop 环境变量</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ vim\n$HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;shellprofile.d&#x2F;tez.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"添加Tez的Jar包相关信息\"><a href=\"#添加Tez的Jar包相关信息\" class=\"headerlink\" title=\"添加Tez的Jar包相关信息\"></a>添加Tez的Jar包相关信息</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hadoop_add_profile tez\nfunction _tez_hadoop_classpath\n&#123;\nhadoop_add_classpath &quot;$HADOOP_HOME&#x2F;etc&#x2F;hadoop&quot; after\nhadoop_add_classpath &quot;&#x2F;opt&#x2F;module&#x2F;tez&#x2F;*&quot; after\nhadoop_add_classpath &quot;&#x2F;opt&#x2F;module&#x2F;tez&#x2F;lib&#x2F;*&quot; after\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"5-）修改-Hive-的计算引擎\"><a href=\"#5-）修改-Hive-的计算引擎\" class=\"headerlink\" title=\"5 ）修改 Hive 的计算引擎\"></a>5 ）修改 Hive 的计算引擎</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ vim $HIVE_HOME&#x2F;conf&#x2F;hive-site.xml<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"添加\"><a href=\"#添加\" class=\"headerlink\" title=\"添加\"></a>添加</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;hive.execution.engine&lt;&#x2F;name&gt;\n&lt;value&gt;tez&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;hive.tez.container.size&lt;&#x2F;name&gt;\n&lt;value&gt;1024&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"6-）解决日志-Jar-包冲突-1\"><a href=\"#6-）解决日志-Jar-包冲突-1\" class=\"headerlink\" title=\"6 ）解决日志 Jar 包冲突\"></a>6 ）解决日志 Jar 包冲突</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">[atguigu@hadoop102 software]$ rm &#x2F;opt&#x2F;module&#x2F;tez&#x2F;lib&#x2F;slf4j-log4j12-\n1.7.10.jar<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-业务分析\"><a href=\"#11-4-业务分析\" class=\"headerlink\" title=\"11 .4 业务分析\"></a>11 .4 业务分析</h4><h4 id=\"11-4-1-统计视频观看数-Top10\"><a href=\"#11-4-1-统计视频观看数-Top10\" class=\"headerlink\" title=\"11 .4.1 统计视频观看数 Top10\"></a>11 .4.1 统计视频观看数 Top10</h4><h5 id=\"思路：使用order-by按照views字段做一个全局排序即可，同时我们设置只显示前-10\"><a href=\"#思路：使用order-by按照views字段做一个全局排序即可，同时我们设置只显示前-10\" class=\"headerlink\" title=\"思路：使用order by按照views字段做一个全局排序即可，同时我们设置只显示前 10\"></a>思路：使用order by按照views字段做一个全局排序即可，同时我们设置只显示前 10</h5><h5 id=\"条。\"><a href=\"#条。\" class=\"headerlink\" title=\"条。\"></a>条。</h5><h5 id=\"最终代码：\"><a href=\"#最终代码：\" class=\"headerlink\" title=\"最终代码：\"></a>最终代码：</h5><h5 id=\"—————————————————————————————————————-73\"><a href=\"#—————————————————————————————————————-73\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nvideoId,\nviews\nFROM\ngulivideo_orc\nORDER BY\nviews DESC\nLIMIT 10;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-2-统计视频类别热度-Top10\"><a href=\"#11-4-2-统计视频类别热度-Top10\" class=\"headerlink\" title=\"11 .4.2 统计视频类别热度 Top10\"></a>11 .4.2 统计视频类别热度 Top10</h4><h5 id=\"思路：\"><a href=\"#思路：\" class=\"headerlink\" title=\"思路：\"></a>思路：</h5><h5 id=\"（-1-）即统计每个类别有多少个视频，显示出包含视频最多的前-10-个类别。\"><a href=\"#（-1-）即统计每个类别有多少个视频，显示出包含视频最多的前-10-个类别。\" class=\"headerlink\" title=\"（ 1 ）即统计每个类别有多少个视频，显示出包含视频最多的前 10 个类别。\"></a>（ 1 ）即统计每个类别有多少个视频，显示出包含视频最多的前 10 个类别。</h5><h5 id=\"（-2-）我们需要按照类别group-by聚合，然后count组内的videoId个数即可。\"><a href=\"#（-2-）我们需要按照类别group-by聚合，然后count组内的videoId个数即可。\" class=\"headerlink\" title=\"（ 2 ）我们需要按照类别group by聚合，然后count组内的videoId个数即可。\"></a>（ 2 ）我们需要按照类别group by聚合，然后count组内的videoId个数即可。</h5><h5 id=\"（-3-）因为当前表结构为：一个视频对应一个或多个类别。所以如果要group-by类别，\"><a href=\"#（-3-）因为当前表结构为：一个视频对应一个或多个类别。所以如果要group-by类别，\" class=\"headerlink\" title=\"（ 3 ）因为当前表结构为：一个视频对应一个或多个类别。所以如果要group by类别，\"></a>（ 3 ）因为当前表结构为：一个视频对应一个或多个类别。所以如果要group by类别，</h5><h5 id=\"需要先将类别进行列转行-展开-，然后再进行count即可。\"><a href=\"#需要先将类别进行列转行-展开-，然后再进行count即可。\" class=\"headerlink\" title=\"需要先将类别进行列转行(展开)，然后再进行count即可。\"></a>需要先将类别进行列转行(展开)，然后再进行count即可。</h5><h5 id=\"（-4-）最后按照热度排序，显示前-10-条。\"><a href=\"#（-4-）最后按照热度排序，显示前-10-条。\" class=\"headerlink\" title=\"（ 4 ）最后按照热度排序，显示前 10 条。\"></a>（ 4 ）最后按照热度排序，显示前 10 条。</h5><h5 id=\"最终代码：-1\"><a href=\"#最终代码：-1\" class=\"headerlink\" title=\"最终代码：\"></a>最终代码：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt1.category_name ,\nCOUNT(t1.videoId) hot\nFROM\n(\nSELECT\nvideoId,\ncategory_name\nFROM\ngulivideo_orc\nlateral VIEW explode(category) gulivideo_orc_tmp AS category_name\n) t1\nGROUP BY\nt1.category_name\nORDER BY\nhot\nDESC\nLIMIT 10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-3-统计出视频观看数最高的-20-个视频的所属类别以及类别包含\"><a href=\"#11-4-3-统计出视频观看数最高的-20-个视频的所属类别以及类别包含\" class=\"headerlink\" title=\"11 .4.3 统计出视频观看数最高的 20 个视频的所属类别以及类别包含\"></a>11 .4.3 统计出视频观看数最高的 20 个视频的所属类别以及类别包含</h4><h4 id=\"Top20-视频的个数\"><a href=\"#Top20-视频的个数\" class=\"headerlink\" title=\"Top20 视频的个数\"></a>Top20 视频的个数</h4><h5 id=\"思路：-1\"><a href=\"#思路：-1\" class=\"headerlink\" title=\"思路：\"></a>思路：</h5><h5 id=\"（-1-）先找到观看数最高的-20-个视频所属条目的所有信息，降序排列\"><a href=\"#（-1-）先找到观看数最高的-20-个视频所属条目的所有信息，降序排列\" class=\"headerlink\" title=\"（ 1 ）先找到观看数最高的 20 个视频所属条目的所有信息，降序排列\"></a>（ 1 ）先找到观看数最高的 20 个视频所属条目的所有信息，降序排列</h5><h5 id=\"（-2-）把这-20-条信息中的category分裂出来-列转行\"><a href=\"#（-2-）把这-20-条信息中的category分裂出来-列转行\" class=\"headerlink\" title=\"（ 2 ）把这 20 条信息中的category分裂出来(列转行)\"></a>（ 2 ）把这 20 条信息中的category分裂出来(列转行)</h5><h5 id=\"（-3-）最后查询视频分类名称和该分类下有多少个Top20的视频\"><a href=\"#（-3-）最后查询视频分类名称和该分类下有多少个Top20的视频\" class=\"headerlink\" title=\"（ 3 ）最后查询视频分类名称和该分类下有多少个Top20的视频\"></a>（ 3 ）最后查询视频分类名称和该分类下有多少个Top20的视频</h5><h5 id=\"最终代码：-2\"><a href=\"#最终代码：-2\" class=\"headerlink\" title=\"最终代码：\"></a>最终代码：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-74\"><a href=\"#—————————————————————————————————————-74\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">t2.category_name,\nCOUNT(t2.videoId) video_sum\nFROM\n(\nSELECT\nt1.videoId,\ncategory_name\nFROM\n(\nSELECT\nvideoId,\nviews ,\ncategory\nFROM\ngulivideo_orc\nORDER BY\nviews\nDESC\nLIMIT 20\n) t1\nlateral VIEW explode(t1.category) t1_tmp AS category_name\n) t2\nGROUP BY t2.category_name<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-4-统计视频观看数-Top50-所关联视频的所属类别排序\"><a href=\"#11-4-4-统计视频观看数-Top50-所关联视频的所属类别排序\" class=\"headerlink\" title=\"11 .4.4 统计视频观看数 Top50 所关联视频的所属类别排序\"></a>11 .4.4 统计视频观看数 Top50 所关联视频的所属类别排序</h4><h5 id=\"代码：\"><a href=\"#代码：\" class=\"headerlink\" title=\"代码：\"></a>代码：</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt6.category_name,\nt6.video_sum,\nrank() over(ORDER BY t6.video_sum DESC ) rk\nFROM\n(\nSELECT\nt5.category_name,\nCOUNT(t5.relatedid_id) video_sum\nFROM\n(\nSELECT\nt4.relatedid_id,\ncategory_name\nFROM\n(\nSELECT\nt2.relatedid_id ,\nt3.category\nFROM\n(\nSELECT\nrelatedid_id\nFROM\n(\nSELECT\nvideoId,\nviews,\nrelatedid\nFROM\ngulivideo_orc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-75\"><a href=\"#—————————————————————————————————————-75\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">ORDER BY\nviews\nDESC\nLIMIT 50\n)t1\nlateral VIEW explode(t1.relatedid) t1_tmp AS relatedid_id\n)t2\nJOIN\ngulivideo_orc t3\nON\nt2.relatedid_id &#x3D; t3.videoId\n) t4\nlateral VIEW explode(t4.category) t4_tmp AS category_name\n) t5\nGROUP BY\nt5.category_name\nORDER BY\nvideo_sum\nDESC\n) t6<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-5-统计每个类别中的视频热度-Top10-，以-Music-为例\"><a href=\"#11-4-5-统计每个类别中的视频热度-Top10-，以-Music-为例\" class=\"headerlink\" title=\"11 .4.5 统计每个类别中的视频热度 Top10 ，以 Music 为例\"></a>11 .4.5 统计每个类别中的视频热度 Top10 ，以 Music 为例</h4><h5 id=\"思路：-2\"><a href=\"#思路：-2\" class=\"headerlink\" title=\"思路：\"></a>思路：</h5><h5 id=\"（-1-）要想统计Music类别中的视频热度Top-10-，需要先找到Music类别，那么就需要将\"><a href=\"#（-1-）要想统计Music类别中的视频热度Top-10-，需要先找到Music类别，那么就需要将\" class=\"headerlink\" title=\"（ 1 ）要想统计Music类别中的视频热度Top 10 ，需要先找到Music类别，那么就需要将\"></a>（ 1 ）要想统计Music类别中的视频热度Top 10 ，需要先找到Music类别，那么就需要将</h5><h5 id=\"category展开，所以可以创建一张表用于存放categoryId展开的数据。\"><a href=\"#category展开，所以可以创建一张表用于存放categoryId展开的数据。\" class=\"headerlink\" title=\"category展开，所以可以创建一张表用于存放categoryId展开的数据。\"></a>category展开，所以可以创建一张表用于存放categoryId展开的数据。</h5><h5 id=\"（-2-）向category展开的表中插入数据。\"><a href=\"#（-2-）向category展开的表中插入数据。\" class=\"headerlink\" title=\"（ 2 ）向category展开的表中插入数据。\"></a>（ 2 ）向category展开的表中插入数据。</h5><h5 id=\"（-3-）统计对应类别（Music）中的视频热度。\"><a href=\"#（-3-）统计对应类别（Music）中的视频热度。\" class=\"headerlink\" title=\"（ 3 ）统计对应类别（Music）中的视频热度。\"></a>（ 3 ）统计对应类别（Music）中的视频热度。</h5><h5 id=\"统计Music类别的Top-10-（也可以统计其他）\"><a href=\"#统计Music类别的Top-10-（也可以统计其他）\" class=\"headerlink\" title=\"统计Music类别的Top 10 （也可以统计其他）\"></a>统计Music类别的Top 10 （也可以统计其他）</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt1.videoId,\nt1.views,\nt1.category_name\nFROM\n(\nSELECT\nvideoId,\nviews,\ncategory_name\nFROM gulivideo_orc\nlateral VIEW explode(category) gulivideo_orc_tmp AS category_name\n)t1\nWHERE\nt1.category_name &#x3D; &quot;Music&quot;\nORDER BY\nt1.views\nDESC\nLIMIT 10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"11-4-6-统计每个类别视频观看数-Top10\"><a href=\"#11-4-6-统计每个类别视频观看数-Top10\" class=\"headerlink\" title=\"11 .4.6 统计每个类别视频观看数 Top10\"></a>11 .4.6 统计每个类别视频观看数 Top10</h4><h5 id=\"最终代码：-3\"><a href=\"#最终代码：-3\" class=\"headerlink\" title=\"最终代码：\"></a>最终代码：</h5><h5 id=\"—————————————————————————————————————-76\"><a href=\"#—————————————————————————————————————-76\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt2.videoId,\nt2.views,\nt2.category_name,\nt2.rk\nFROM\n(\nSELECT\nt1.videoId,\nt1.views,\nt1.category_name,\nrank() over(PARTITION BY t1.category_name ORDER BY t1.views DESC ) rk\nFROM\n(\nSELECT\nvideoId,\nviews,\ncategory_name\nFROM gulivideo_orc\nlateral VIEW explode(category) gulivideo_orc_tmp AS category_name\n)t1\n)t2\nWHERE t2.rk &lt;&#x3D;10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"11-4-7-统计上传视频最多的用户-Top-10-以及他们上传的视频\"><a href=\"#11-4-7-统计上传视频最多的用户-Top-10-以及他们上传的视频\" class=\"headerlink\" title=\"11 .4.7 统计上传视频最多的用户 Top 10 以及他们上传的视频\"></a>11 .4.7 统计上传视频最多的用户 Top 10 以及他们上传的视频</h2><h2 id=\"观看次数在前-20-的视频\"><a href=\"#观看次数在前-20-的视频\" class=\"headerlink\" title=\"观看次数在前 20 的视频\"></a>观看次数在前 20 的视频</h2><h5 id=\"思路：-3\"><a href=\"#思路：-3\" class=\"headerlink\" title=\"思路：\"></a>思路：</h5><h5 id=\"（-1-）求出上传视频最多的-10-个用户\"><a href=\"#（-1-）求出上传视频最多的-10-个用户\" class=\"headerlink\" title=\"（ 1 ）求出上传视频最多的 10 个用户\"></a>（ 1 ）求出上传视频最多的 10 个用户</h5><h5 id=\"（-2-）关联gulivideo-orc表，求出这-10-个用户上传的所有的视频，按照观看数取前-20\"><a href=\"#（-2-）关联gulivideo-orc表，求出这-10-个用户上传的所有的视频，按照观看数取前-20\" class=\"headerlink\" title=\"（ 2 ）关联gulivideo_orc表，求出这 10 个用户上传的所有的视频，按照观看数取前 20\"></a>（ 2 ）关联gulivideo_orc表，求出这 10 个用户上传的所有的视频，按照观看数取前 20</h5><h5 id=\"最终代码\"><a href=\"#最终代码\" class=\"headerlink\" title=\"最终代码:\"></a>最终代码:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT\nt2.videoId,\nt2.views,\nt2.uploader\nFROM\n(\nSELECT\nuploader,\nvideos\nFROM gulivideo_user_orc\nORDER BY\nvideos\nDESC\nLIMIT 10\n) t1\nJOIN gulivideo_orc t2\nON t1.uploader &#x3D; t2.uploader\nORDER BY\nt2.views\nDESC<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"—————————————————————————————————————-77\"><a href=\"#—————————————————————————————————————-77\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">LIMIT 20<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n\n\n\n<h3 id=\"附录：常见错误及解决方案\"><a href=\"#附录：常见错误及解决方案\" class=\"headerlink\" title=\"附录：常见错误及解决方案\"></a>附录：常见错误及解决方案</h3><h5 id=\"0-）-如果更换-Tez-引擎后，执行任务卡住，可以尝试调节容量调度器的资源调度策略\"><a href=\"#0-）-如果更换-Tez-引擎后，执行任务卡住，可以尝试调节容量调度器的资源调度策略\" class=\"headerlink\" title=\"0 ） 如果更换 Tez 引擎后，执行任务卡住，可以尝试调节容量调度器的资源调度策略\"></a>0 ） 如果更换 Tez 引擎后，执行任务卡住，可以尝试调节容量调度器的资源调度策略</h5><h5 id=\"将-HADOOP-HOME-x2F-etc-x2F-hadoop-x2F-capacity-scheduler-xml文件中的\"><a href=\"#将-HADOOP-HOME-x2F-etc-x2F-hadoop-x2F-capacity-scheduler-xml文件中的\" class=\"headerlink\" title=\"将$HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;capacity-scheduler.xml文件中的\"></a>将$HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;capacity-scheduler.xml文件中的</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.maximum-am-resource-percent&lt;&#x2F;name&gt;\n&lt;value&gt;0. 1 &lt;&#x2F;value&gt;\n&lt;description&gt;\nMaximum percent of resources in the cluster which can be used to run\napplication masters i.e. controls number of concurrent running\napplications.\n&lt;&#x2F;description&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"改成\"><a href=\"#改成\" class=\"headerlink\" title=\"改成\"></a>改成</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.maximum-am-resource-percent&lt;&#x2F;name&gt;\n&lt;value&gt; 1 &lt;&#x2F;value&gt;\n&lt;description&gt;\nMaximum percent of resources in the cluster which can be used to run\napplication masters i.e. controls number of concurrent running\napplications.\n&lt;&#x2F;description&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"1-）连接不上-mysql-数据库\"><a href=\"#1-）连接不上-mysql-数据库\" class=\"headerlink\" title=\"1 ）连接不上 mysql 数据库\"></a>1 ）连接不上 mysql 数据库</h5><h5 id=\"（-1-）导错驱动包，应该把mysql-connector-java-5-1-27-bin-jar导入-x2F-opt-x2F-module-x2F-hive-x2F-lib的\"><a href=\"#（-1-）导错驱动包，应该把mysql-connector-java-5-1-27-bin-jar导入-x2F-opt-x2F-module-x2F-hive-x2F-lib的\" class=\"headerlink\" title=\"（ 1 ）导错驱动包，应该把mysql-connector-java-5.1.27-bin.jar导入&#x2F;opt&#x2F;module&#x2F;hive&#x2F;lib的\"></a>（ 1 ）导错驱动包，应该把mysql-connector-java-5.1.27-bin.jar导入&#x2F;opt&#x2F;module&#x2F;hive&#x2F;lib的</h5><h5 id=\"不是这个包。错把mysql-connector-java-5-1-27-tar-gz导入hive-x2F-lib包下。\"><a href=\"#不是这个包。错把mysql-connector-java-5-1-27-tar-gz导入hive-x2F-lib包下。\" class=\"headerlink\" title=\"不是这个包。错把mysql-connector-java-5.1.27.tar.gz导入hive&#x2F;lib包下。\"></a>不是这个包。错把mysql-connector-java-5.1.27.tar.gz导入hive&#x2F;lib包下。</h5><h5 id=\"（-2-）修改user表中的主机名称没有都修改为-，而是修改为localhost\"><a href=\"#（-2-）修改user表中的主机名称没有都修改为-，而是修改为localhost\" class=\"headerlink\" title=\"（ 2 ）修改user表中的主机名称没有都修改为%，而是修改为localhost\"></a>（ 2 ）修改user表中的主机名称没有都修改为%，而是修改为localhost</h5><h5 id=\"2-）-hive-默认的输入格式处理是-CombineHiveInputFormat-，会对小文件进行合并。\"><a href=\"#2-）-hive-默认的输入格式处理是-CombineHiveInputFormat-，会对小文件进行合并。\" class=\"headerlink\" title=\"2 ） hive 默认的输入格式处理是 CombineHiveInputFormat ，会对小文件进行合并。\"></a>2 ） hive 默认的输入格式处理是 CombineHiveInputFormat ，会对小文件进行合并。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set hive.input.format;\nhive.input.format&#x3D;org.apache.hadoop.hive.ql.io.CombineHiveInputFormat<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"可以采用HiveInputFormat就会根据分区数输出相应的文件。\"><a href=\"#可以采用HiveInputFormat就会根据分区数输出相应的文件。\" class=\"headerlink\" title=\"可以采用HiveInputFormat就会根据分区数输出相应的文件。\"></a>可以采用HiveInputFormat就会根据分区数输出相应的文件。</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">hive (default)&gt; set\nhive.input.format&#x3D;org.apache.hadoop.hive.ql.io.HiveInputFormat;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"3-）不能执行-mapreduce-程序\"><a href=\"#3-）不能执行-mapreduce-程序\" class=\"headerlink\" title=\"3 ）不能执行 mapreduce 程序\"></a>3 ）不能执行 mapreduce 程序</h5><h5 id=\"可能是hadoop的yarn没开启。\"><a href=\"#可能是hadoop的yarn没开启。\" class=\"headerlink\" title=\"可能是hadoop的yarn没开启。\"></a>可能是hadoop的yarn没开启。</h5><h5 id=\"4-）启动-mysql-服务时，报-MySQL-server-PID-file-could-not-be-found-异常。\"><a href=\"#4-）启动-mysql-服务时，报-MySQL-server-PID-file-could-not-be-found-异常。\" class=\"headerlink\" title=\"4 ）启动 mysql 服务时，报 MySQL server PID file could not be found! 异常。\"></a>4 ）启动 mysql 服务时，报 MySQL server PID file could not be found! 异常。</h5><h5 id=\"在-x2F-var-x2F-lock-x2F-subsys-x2F-mysql路径下创建hadoop102-pid，并在文件中添加内容：-4396\"><a href=\"#在-x2F-var-x2F-lock-x2F-subsys-x2F-mysql路径下创建hadoop102-pid，并在文件中添加内容：-4396\" class=\"headerlink\" title=\"在&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql路径下创建hadoop102.pid，并在文件中添加内容： 4396\"></a>在&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql路径下创建hadoop102.pid，并在文件中添加内容： 4396</h5><h5 id=\"5-）报-service-mysql-status-MySQL-is-not-running-but-lock-file-x2F-var-x2F-lock-x2F-subsys-x2F-mysql-失败-异\"><a href=\"#5-）报-service-mysql-status-MySQL-is-not-running-but-lock-file-x2F-var-x2F-lock-x2F-subsys-x2F-mysql-失败-异\" class=\"headerlink\" title=\"5 ）报 service mysql status MySQL is not running, but lock file (&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql[ 失败 ]) 异\"></a>5 ）报 service mysql status MySQL is not running, but lock file (&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql[ 失败 ]) 异</h5><h5 id=\"常。\"><a href=\"#常。\" class=\"headerlink\" title=\"常。\"></a>常。</h5><h5 id=\"—————————————————————————————————————-78\"><a href=\"#—————————————————————————————————————-78\" class=\"headerlink\" title=\"—————————————————————————————————————\"></a>—————————————————————————————————————</h5><h5 id=\"解决方案：在-x2F-var-x2F-lib-x2F-mysql-目录下创建：-rw-rw—-1-mysql-mysql-5-12月-22\"><a href=\"#解决方案：在-x2F-var-x2F-lib-x2F-mysql-目录下创建：-rw-rw—-1-mysql-mysql-5-12月-22\" class=\"headerlink\" title=\"解决方案：在&#x2F;var&#x2F;lib&#x2F;mysql 目录下创建： - rw-rw—-. 1 mysql mysql 5 12月 22\"></a>解决方案：在&#x2F;var&#x2F;lib&#x2F;mysql 目录下创建： - rw-rw—-. 1 mysql mysql 5 12月 22</h5><h5 id=\"16-41-hadoop102-pid-文件，并修改权限为-777-。\"><a href=\"#16-41-hadoop102-pid-文件，并修改权限为-777-。\" class=\"headerlink\" title=\"16:41 hadoop102.pid 文件，并修改权限为 777 。\"></a>16:41 hadoop102.pid 文件，并修改权限为 777 。</h5><h5 id=\"6-）-JVM-堆内存溢出\"><a href=\"#6-）-JVM-堆内存溢出\" class=\"headerlink\" title=\"6 ） JVM 堆内存溢出\"></a>6 ） JVM 堆内存溢出</h5><h5 id=\"描述：java-lang-OutOfMemoryError-Java-heap-space\"><a href=\"#描述：java-lang-OutOfMemoryError-Java-heap-space\" class=\"headerlink\" title=\"描述：java.lang.OutOfMemoryError: Java heap space\"></a>描述：java.lang.OutOfMemoryError: Java heap space</h5><h5 id=\"解决：在yarn-site-xml中加入如下代码\"><a href=\"#解决：在yarn-site-xml中加入如下代码\" class=\"headerlink\" title=\"解决：在yarn-site.xml中加入如下代码\"></a>解决：在yarn-site.xml中加入如下代码</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;&#x2F;name&gt;\n&lt;value&gt;2048&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;&#x2F;name&gt;\n&lt;value&gt;2048&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-pmem-ratio&lt;&#x2F;name&gt;\n&lt;value&gt;2.1&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;\n&lt;property&gt;\n&lt;name&gt;mapred.child.java.opts&lt;&#x2F;name&gt;\n&lt;value&gt;-Xmx1024m&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"7-）虚拟内存限制\"><a href=\"#7-）虚拟内存限制\" class=\"headerlink\" title=\"7 ）虚拟内存限制\"></a>7 ）虚拟内存限制</h5><h5 id=\"在yarn-site-xml中添加如下配置\"><a href=\"#在yarn-site-xml中添加如下配置\" class=\"headerlink\" title=\"在yarn-site.xml中添加如下配置:\"></a>在yarn-site.xml中添加如下配置:</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;&#x2F;name&gt;\n&lt;value&gt;false&lt;&#x2F;value&gt;\n&lt;&#x2F;property&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span>\n\n<span class=\"token keyword\">from</span>\n\n\n<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> 字段<span class=\"token number\">1</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">asc</span><span class=\"token operator\">|</span><span class=\"token keyword\">desc</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>字段<span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">--同样的字段1再按字段2排序</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","text":" 尚硅谷大数据技术之Hive 第 1 章 Hive基本概念1 .1 什么是 Hive1 ） hive简介Hive：由Facebook开源用于解决海量结构化日志的数据统计工具。 Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张表，并提供类SQL查询功能...","link":"","photos":[],"count_time":{"symbolsCount":"94k","symbolsTime":"1:25"},"categories":[],"tags":[{"name":"大数据","slug":"大数据","count":3,"path":"api/tags/大数据.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-1-%E7%AB%A0-Hive%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">第 1 章 Hive基本概念</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-Hive\"><span class=\"toc-text\">1 .1 什么是 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-hive%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">1 ） hive简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-Hive%E6%9C%AC%E8%B4%A8%EF%BC%9A%E5%B0%86HQL%E8%BD%AC%E5%8C%96%E6%88%90MapReduce%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">2 ） Hive本质：将HQL转化成MapReduce程序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89Hive%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%9C%A8HDFS\"><span class=\"toc-text\">（ 1 ）Hive处理的数据存储在HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89Hive%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E5%BA%95%E5%B1%82%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%98%AFMapReduce\"><span class=\"toc-text\">（ 2 ）Hive分析数据底层的实现是MapReduce</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%9C%A8Yarn%E4%B8%8A\"><span class=\"toc-text\">（ 3 ）执行程序运行在Yarn上</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2-Hive-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9\"><span class=\"toc-text\">1.2 Hive 的优缺点</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2-1-%E4%BC%98%E7%82%B9\"><span class=\"toc-text\">1.2.1 优点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3%E9%87%87%E7%94%A8%E7%B1%BBSQL%E8%AF%AD%E6%B3%95%EF%BC%8C%E6%8F%90%E4%BE%9B%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%88%E7%AE%80%E5%8D%95%E3%80%81%E5%AE%B9%E6%98%93%E4%B8%8A%E6%89%8B%EF%BC%89%E3%80%82\"><span class=\"toc-text\">（ 1 ）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E9%81%BF%E5%85%8D%E4%BA%86%E5%8E%BB%E5%86%99MapReduce%EF%BC%8C%E5%87%8F%E5%B0%91%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9C%AC%E3%80%82\"><span class=\"toc-text\">（ 2 ）避免了去写MapReduce，减少开发人员的学习成本。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89Hive%E7%9A%84%E6%89%A7%E8%A1%8C%E5%BB%B6%E8%BF%9F%E6%AF%94%E8%BE%83%E9%AB%98%EF%BC%8C%E5%9B%A0%E6%AD%A4Hive%E5%B8%B8%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%EF%BC%8C%E5%AF%B9%E5%AE%9E%E6%97%B6%E6%80%A7%E8%A6%81%E6%B1%82%E4%B8%8D%E9%AB%98%E7%9A%84%E5%9C%BA%E5%90%88%E3%80%82\"><span class=\"toc-text\">（ 3 ）Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89Hive%E4%BC%98%E5%8A%BF%E5%9C%A8%E4%BA%8E%E5%A4%84%E7%90%86%E5%A4%A7%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%AF%B9%E4%BA%8E%E5%A4%84%E7%90%86%E5%B0%8F%E6%95%B0%E6%8D%AE%E6%B2%A1%E6%9C%89%E4%BC%98%E5%8A%BF%EF%BC%8C%E5%9B%A0%E4%B8%BAHive%E7%9A%84%E6%89%A7%E8%A1%8C%E5%BB%B6%E8%BF%9F%E6%AF%94%E8%BE%83\"><span class=\"toc-text\">（ 4 ）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%AB%98%E3%80%82\"><span class=\"toc-text\">高。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89Hive%E6%94%AF%E6%8C%81%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%EF%BC%8C%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E9%9C%80%E6%B1%82%E6%9D%A5%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%87%BD%E6%95%B0%E3%80%82\"><span class=\"toc-text\">（ 5 ）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-2-2-%E7%BC%BA%E7%82%B9\"><span class=\"toc-text\">1 .2.2 缺点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-Hive-%E7%9A%84-HQL-%E8%A1%A8%E8%BE%BE%E8%83%BD%E5%8A%9B%E6%9C%89%E9%99%90\"><span class=\"toc-text\">1 ） Hive 的 HQL 表达能力有限</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%BF%AD%E4%BB%A3%E5%BC%8F%E7%AE%97%E6%B3%95%E6%97%A0%E6%B3%95%E8%A1%A8%E8%BE%BE\"><span class=\"toc-text\">（ 1 ）迭代式算法无法表达</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E6%96%B9%E9%9D%A2%E4%B8%8D%E6%93%85%E9%95%BF%EF%BC%8C%E7%94%B1%E4%BA%8EMapReduce%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E7%9A%84%E9%99%90%E5%88%B6%EF%BC%8C%E6%95%88%E7%8E%87%E6%9B%B4%E9%AB%98%E7%9A%84%E7%AE%97%E6%B3%95%E5%8D%B4\"><span class=\"toc-text\">（ 2 ）数据挖掘方面不擅长，由于MapReduce数据处理流程的限制，效率更高的算法却</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%97%A0%E6%B3%95%E5%AE%9E%E7%8E%B0%E3%80%82\"><span class=\"toc-text\">无法实现。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-Hive-%E7%9A%84%E6%95%88%E7%8E%87%E6%AF%94%E8%BE%83%E4%BD%8E\"><span class=\"toc-text\">2 ） Hive 的效率比较低</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89Hive%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84MapReduce%E4%BD%9C%E4%B8%9A%EF%BC%8C%E9%80%9A%E5%B8%B8%E6%83%85%E5%86%B5%E4%B8%8B%E4%B8%8D%E5%A4%9F%E6%99%BA%E8%83%BD%E5%8C%96\"><span class=\"toc-text\">（ 1 ）Hive自动生成的MapReduce作业，通常情况下不够智能化</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89Hive%E8%B0%83%E4%BC%98%E6%AF%94%E8%BE%83%E5%9B%B0%E9%9A%BE%EF%BC%8C%E7%B2%92%E5%BA%A6%E8%BE%83%E7%B2%97\"><span class=\"toc-text\">（ 2 ）Hive调优比较困难，粒度较粗</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-3-Hive-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">1.3 Hive 架构原理</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#HDFS\"><span class=\"toc-text\">HDFS</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#MapReduce\"><span class=\"toc-text\">MapReduce</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Meta-store\"><span class=\"toc-text\">Meta store</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#SQL\"><span class=\"toc-text\">SQL</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Parser\"><span class=\"toc-text\">Parser</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E6%9E%90%E5%99%A8\"><span class=\"toc-text\">解析器</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Physical\"><span class=\"toc-text\">Physical</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Plan\"><span class=\"toc-text\">Plan</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E7%BC%96%E8%AF%91%E5%99%A8-Execution\"><span class=\"toc-text\">编译器 Execution</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E6%89%A7%E8%A1%8C%E5%99%A8\"><span class=\"toc-text\">执行器</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Query\"><span class=\"toc-text\">Query</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Optimizer\"><span class=\"toc-text\">Optimizer</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E4%BC%98%E5%8C%96%E5%99%A8\"><span class=\"toc-text\">优化器</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Driver\"><span class=\"toc-text\">Driver</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#CLI-JDBC\"><span class=\"toc-text\">CLI JDBC</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Client\"><span class=\"toc-text\">Client</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#Hive-%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">Hive 架构</span></a></li></ol></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3%EF%BC%9A-Client\"><span class=\"toc-text\">1 ）用户接口： Client</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#CLI%EF%BC%88command-line-interface%EF%BC%89%E3%80%81JDBC-x2F-ODBC-jdbc%E8%AE%BF%E9%97%AEhive-%E3%80%81WEBUI%EF%BC%88%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhive%EF%BC%89\"><span class=\"toc-text\">CLI（command-line interface）、JDBC&#x2F;ODBC(jdbc访问hive)、WEBUI（浏览器访问hive）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-1\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%9A-Metastore\"><span class=\"toc-text\">2 ）元数据： Metastore</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%83%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8B%AC%EF%BC%9A%E8%A1%A8%E5%90%8D%E3%80%81%E8%A1%A8%E6%89%80%E5%B1%9E%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%BB%98%E8%AE%A4%E6%98%AFdefault%EF%BC%89%E3%80%81%E8%A1%A8%E7%9A%84%E6%8B%A5%E6%9C%89%E8%80%85%E3%80%81%E5%88%97-x2F-%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E3%80%81\"><span class=\"toc-text\">元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列&#x2F;分区字段、</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%98%AF%E5%90%A6%E6%98%AF%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%89%E3%80%81%E8%A1%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95%E7%AD%89%EF%BC%9B\"><span class=\"toc-text\">表的类型（是否是外部表）、表的数据所在目录等；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E5%9C%A8%E8%87%AA%E5%B8%A6%E7%9A%84derby%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%EF%BC%8C%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8MySQL%E5%AD%98%E5%82%A8Metastore\"><span class=\"toc-text\">默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-Hadoop\"><span class=\"toc-text\">3 ） Hadoop</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8HDFS%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8%EF%BC%8C%E4%BD%BF%E7%94%A8MapReduce%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%E3%80%82\"><span class=\"toc-text\">使用HDFS进行存储，使用MapReduce进行计算。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E9%A9%B1%E5%8A%A8%E5%99%A8%EF%BC%9A-Driver\"><span class=\"toc-text\">4 ）驱动器： Driver</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%A7%A3%E6%9E%90%E5%99%A8%EF%BC%88SQL-Parser%EF%BC%89%EF%BC%9A%E5%B0%86SQL%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%88%90%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91AST%EF%BC%8C%E8%BF%99%E4%B8%80%E6%AD%A5%E4%B8%80%E8%88%AC%E9%83%BD%E7%94%A8%E7%AC%AC\"><span class=\"toc-text\">（ 1 ）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E5%BA%93%E5%AE%8C%E6%88%90%EF%BC%8C%E6%AF%94%E5%A6%82antlr%EF%BC%9B%E5%AF%B9AST%E8%BF%9B%E8%A1%8C%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%8C%E6%AF%94%E5%A6%82%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E3%80%81%E5%AD%97%E6%AE%B5%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E3%80%81SQL\"><span class=\"toc-text\">三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%AD%E4%B9%89%E6%98%AF%E5%90%A6%E6%9C%89%E8%AF%AF%E3%80%82\"><span class=\"toc-text\">语义是否有误。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88Physical-Plan%EF%BC%89%EF%BC%9A%E5%B0%86AST%E7%BC%96%E8%AF%91%E7%94%9F%E6%88%90%E9%80%BB%E8%BE%91%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E3%80%82\"><span class=\"toc-text\">（ 2 ）编译器（Physical Plan）：将AST编译生成逻辑执行计划。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E4%BC%98%E5%8C%96%E5%99%A8%EF%BC%88Query-Optimizer%EF%BC%89%EF%BC%9A%E5%AF%B9%E9%80%BB%E8%BE%91%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96%E3%80%82\"><span class=\"toc-text\">（ 3 ）优化器（Query Optimizer）：对逻辑执行计划进行优化。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%89%A7%E8%A1%8C%E5%99%A8%EF%BC%88Execution%EF%BC%89%EF%BC%9A%E6%8A%8A%E9%80%BB%E8%BE%91%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E8%BD%AC%E6%8D%A2%E6%88%90%E5%8F%AF%E4%BB%A5%E8%BF%90%E8%A1%8C%E7%9A%84%E7%89%A9%E7%90%86%E8%AE%A1%E5%88%92%E3%80%82%E5%AF%B9%E4%BA%8EHive%E6%9D%A5\"><span class=\"toc-text\">（ 4 ）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%B4%EF%BC%8C%E5%B0%B1%E6%98%AFMR-x2F-Spark%E3%80%82\"><span class=\"toc-text\">说，就是MR&#x2F;Spark。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E9%80%9A%E8%BF%87%E7%BB%99%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BA%A4%E4%BA%92%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84%E6%8C%87%E4%BB%A4-SQL-%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84Driver%EF%BC%8C\"><span class=\"toc-text\">Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%93%E5%90%88%E5%85%83%E6%95%B0%E6%8D%AE-MetaStore-%EF%BC%8C%E5%B0%86%E8%BF%99%E4%BA%9B%E6%8C%87%E4%BB%A4%E7%BF%BB%E8%AF%91%E6%88%90MapReduce%EF%BC%8C%E6%8F%90%E4%BA%A4%E5%88%B0Hadoop%E4%B8%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E6%9C%80%E5%90%8E%EF%BC%8C%E5%B0%86\"><span class=\"toc-text\">结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%89%A7%E8%A1%8C%E8%BF%94%E5%9B%9E%E7%9A%84%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E6%8E%A5%E5%8F%A3%E3%80%82\"><span class=\"toc-text\">执行返回的结果输出到用户交互接口。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-Hive-%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AF%94%E8%BE%83\"><span class=\"toc-text\">1.4 Hive 和数据库比较</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%B1%E4%BA%8E-Hive-%E9%87%87%E7%94%A8%E4%BA%86%E7%B1%BB%E4%BC%BCSQL-%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-HQL-Hive-Query-Language-%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%BE%88%E5%AE%B9%E6%98%93%E5%B0%86-Hive-%E7%90%86\"><span class=\"toc-text\">由于 Hive 采用了类似SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-2\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82%E5%85%B6%E5%AE%9E%E4%BB%8E%E7%BB%93%E6%9E%84%E4%B8%8A%E6%9D%A5%E7%9C%8B%EF%BC%8CHive-%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%99%A4%E4%BA%86%E6%8B%A5%E6%9C%89%E7%B1%BB%E4%BC%BC%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%EF%BC%8C%E5%86%8D%E6%97%A0%E7%B1%BB%E4%BC%BC%E4%B9%8B%E5%A4%84%E3%80%82\"><span class=\"toc-text\">解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E6%96%87%E5%B0%86%E4%BB%8E%E5%A4%9A%E4%B8%AA%E6%96%B9%E9%9D%A2%E6%9D%A5%E9%98%90%E8%BF%B0-Hive-%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%B7%AE%E5%BC%82%E3%80%82%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8-Online-%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%AD%EF%BC%8C%E4%BD%86%E6%98%AF\"><span class=\"toc-text\">本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive-%E6%98%AF%E4%B8%BA%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%80%8C%E8%AE%BE%E8%AE%A1%E7%9A%84%EF%BC%8C%E6%B8%85%E6%A5%9A%E8%BF%99%E4%B8%80%E7%82%B9%EF%BC%8C%E6%9C%89%E5%8A%A9%E4%BA%8E%E4%BB%8E%E5%BA%94%E7%94%A8%E8%A7%92%E5%BA%A6%E7%90%86%E8%A7%A3-Hive-%E7%9A%84%E7%89%B9%E6%80%A7%E3%80%82\"><span class=\"toc-text\">Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-1-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80\"><span class=\"toc-text\">1 .4.1 查询语言</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%B1%E4%BA%8ESQL%E8%A2%AB%E5%B9%BF%E6%B3%9B%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%A8%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E4%B8%AD%EF%BC%8C%E5%9B%A0%E6%AD%A4%EF%BC%8C%E4%B8%93%E9%97%A8%E9%92%88%E5%AF%B9Hive%E7%9A%84%E7%89%B9%E6%80%A7%E8%AE%BE%E8%AE%A1%E4%BA%86%E7%B1%BBSQL%E7%9A%84%E6%9F%A5\"><span class=\"toc-text\">由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A2%E8%AF%AD%E8%A8%80HQL%E3%80%82%E7%86%9F%E6%82%89SQL%E5%BC%80%E5%8F%91%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E4%BD%BF%E7%94%A8Hive%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91%E3%80%82\"><span class=\"toc-text\">询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-2-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0\"><span class=\"toc-text\">1 .4.2 数据更新</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%B1%E4%BA%8EHive%E6%98%AF%E9%92%88%E5%AF%B9%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BA%94%E7%94%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%EF%BC%8C%E8%80%8C%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%9A%84%E5%86%85%E5%AE%B9%E6%98%AF%E8%AF%BB%E5%A4%9A%E5%86%99%E5%B0%91%E7%9A%84%E3%80%82%E5%9B%A0%E6%AD%A4%EF%BC%8CHive%E4%B8%AD\"><span class=\"toc-text\">由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8D%E5%BB%BA%E8%AE%AE%E5%AF%B9%E6%95%B0%E6%8D%AE%E7%9A%84%E6%94%B9%E5%86%99%EF%BC%8C%E6%89%80%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%AF%E5%9C%A8%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%97%B6%E5%80%99%E7%A1%AE%E5%AE%9A%E5%A5%BD%E7%9A%84%E3%80%82%E8%80%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E9%80%9A%E5%B8%B8%E6%98%AF%E9%9C%80\"><span class=\"toc-text\">不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A6%81%E7%BB%8F%E5%B8%B8%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%E7%9A%84%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-INSERT-INTO-%E2%80%A6-VALUES-%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%BF%E7%94%A8-UPDATE-%E2%80%A6-SET%E4%BF%AE\"><span class=\"toc-text\">要经常进行修改的，因此可以使用 INSERT INTO … VALUES 添加数据，使用 UPDATE … SET修</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%94%B9%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">改数据。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-3-%E6%89%A7%E8%A1%8C%E5%BB%B6%E8%BF%9F\"><span class=\"toc-text\">1 .4.3 执行延迟</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive-%E5%9C%A8%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%B2%A1%E6%9C%89%E7%B4%A2%E5%BC%95%EF%BC%8C%E9%9C%80%E8%A6%81%E6%89%AB%E6%8F%8F%E6%95%B4%E4%B8%AA%E8%A1%A8%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%BB%B6%E8%BF%9F%E8%BE%83%E9%AB%98%E3%80%82%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA%E5%AF%BC\"><span class=\"toc-text\">Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%87%B4-Hive-%E6%89%A7%E8%A1%8C%E5%BB%B6%E8%BF%9F%E9%AB%98%E7%9A%84%E5%9B%A0%E7%B4%A0%E6%98%AF-MapReduce%E6%A1%86%E6%9E%B6%E3%80%82%E7%94%B1%E4%BA%8EMapReduce-%E6%9C%AC%E8%BA%AB%E5%85%B7%E6%9C%89%E8%BE%83%E9%AB%98%E7%9A%84%E5%BB%B6%E8%BF%9F%EF%BC%8C%E5%9B%A0%E6%AD%A4\"><span class=\"toc-text\">致 Hive 执行延迟高的因素是 MapReduce框架。由于MapReduce 本身具有较高的延迟，因此</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E5%88%A9%E7%94%A8MapReduce-%E6%89%A7%E8%A1%8CHive%E6%9F%A5%E8%AF%A2%E6%97%B6%EF%BC%8C%E4%B9%9F%E4%BC%9A%E6%9C%89%E8%BE%83%E9%AB%98%E7%9A%84%E5%BB%B6%E8%BF%9F%E3%80%82%E7%9B%B8%E5%AF%B9%E7%9A%84%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%89%A7%E8%A1%8C%E5%BB%B6%E8%BF%9F%E8%BE%83%E4%BD%8E%E3%80%82\"><span class=\"toc-text\">在利用MapReduce 执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93%E7%84%B6%EF%BC%8C%E8%BF%99%E4%B8%AA%E4%BD%8E%E6%98%AF%E6%9C%89%E6%9D%A1%E4%BB%B6%E7%9A%84%EF%BC%8C%E5%8D%B3%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1%E8%BE%83%E5%B0%8F%EF%BC%8C%E5%BD%93%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1%E5%A4%A7%E5%88%B0%E8%B6%85%E8%BF%87%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%84%E7%90%86%E8%83%BD%E5%8A%9B%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C\"><span class=\"toc-text\">当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E7%9A%84%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E6%98%BE%E7%84%B6%E8%83%BD%E4%BD%93%E7%8E%B0%E5%87%BA%E4%BC%98%E5%8A%BF%E3%80%82\"><span class=\"toc-text\">Hive的并行计算显然能体现出优势。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-4-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1\"><span class=\"toc-text\">1 .4.4 数据规模</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%B1%E4%BA%8EHive%E5%BB%BA%E7%AB%8B%E5%9C%A8%E9%9B%86%E7%BE%A4%E4%B8%8A%E5%B9%B6%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8MapReduce%E8%BF%9B%E8%A1%8C%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%8F%AF%E4%BB%A5%E6%94%AF%E6%8C%81%E5%BE%88%E5%A4%A7%E8%A7%84%E6%A8%A1\"><span class=\"toc-text\">由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9B%E5%AF%B9%E5%BA%94%E7%9A%84%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%AF%E4%BB%A5%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1%E8%BE%83%E5%B0%8F%E3%80%82\"><span class=\"toc-text\">的数据；对应的，数据库可以支持的数据规模较小。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-2-%E7%AB%A0-Hive%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">第 2 章 Hive安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-1-Hive-%E5%AE%89%E8%A3%85%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">2.1 Hive 安装地址</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-Hive-%E5%AE%98%E7%BD%91%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">1 ） Hive 官网地址</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#http-hive-apache-org\"><span class=\"toc-text\">http:&#x2F;&#x2F;hive.apache.org&#x2F;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%96%87%E6%A1%A3%E6%9F%A5%E7%9C%8B%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">2 ）文档查看地址</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#https-cwiki-apache-org-confluence-display-Hive-GettingStarted\"><span class=\"toc-text\">https:&#x2F;&#x2F;cwiki.apache.org&#x2F;confluence&#x2F;display&#x2F;Hive&#x2F;GettingStarted</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">3 ）下载地址</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-3\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#http-archive-apache-org-dist-hive\"><span class=\"toc-text\">http:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;hive&#x2F;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89-github-%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">4 ） github 地址</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#https-github-com-apache-hive\"><span class=\"toc-text\">https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;hive</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-2-Hive-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">2.2 Hive 安装部署</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-2-1-%E5%AE%89%E8%A3%85-Hive\"><span class=\"toc-text\">2 .2.1 安装 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%8A%8A-apache-hive-3-1-2-bin-tar-gz-%E4%B8%8A%E4%BC%A0%E5%88%B0-linux-%E7%9A%84-x2F-opt-x2F-software-%E7%9B%AE%E5%BD%95%E4%B8%8B\"><span class=\"toc-text\">1 ）把 apache-hive-3.1.2-bin.tar.gz 上传到 linux 的 &#x2F;opt&#x2F;software 目录下</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E8%A7%A3%E5%8E%8B-apache-hive-3-1-2-bin-tar-gz-%E5%88%B0-x2F-opt-x2F-module-x2F-%E7%9B%AE%E5%BD%95%E4%B8%8B%E9%9D%A2\"><span class=\"toc-text\">2 ）解压 apache-hive-3.1.2-bin.tar.gz 到 &#x2F;opt&#x2F;module&#x2F; 目录下面</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E4%BF%AE%E6%94%B9-apache-hive-3-1-2-bin-tar-gz-%E7%9A%84%E5%90%8D%E7%A7%B0%E4%B8%BA-hive\"><span class=\"toc-text\">3 ）修改 apache-hive-3.1.2-bin.tar.gz 的名称为 hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E4%BF%AE%E6%94%B9-x2F-etc-x2F-profile-d-x2F-my-env-sh-%EF%BC%8C%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">4 ）修改 &#x2F;etc&#x2F;profile.d&#x2F;my_env.sh ，添加环境变量</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E6%B7%BB%E5%8A%A0%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">5 ）添加内容</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E8%A7%A3%E5%86%B3%E6%97%A5%E5%BF%97-Jar-%E5%8C%85%E5%86%B2%E7%AA%81\"><span class=\"toc-text\">6 ）解决日志 Jar 包冲突</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">7 ）初始化元数据库</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-2-2-%E5%90%AF%E5%8A%A8%E5%B9%B6%E4%BD%BF%E7%94%A8-Hive\"><span class=\"toc-text\">2 .2.2 启动并使用 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%90%AF%E5%8A%A8-Hive\"><span class=\"toc-text\">1 ）启动 Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%BD%BF%E7%94%A8-Hive\"><span class=\"toc-text\">2 ）使用 Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%9C%A8-CRT-%E7%AA%97%E5%8F%A3%E4%B8%AD%E5%BC%80%E5%90%AF%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3%E5%BC%80%E5%90%AF-Hive-%EF%BC%8C%E5%9C%A8-x2F-tmp-x2F-atguigu-%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9B%91%E6%8E%A7-hive-log-%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">3 ）在 CRT 窗口中开启另一个窗口开启 Hive ，在 &#x2F;tmp&#x2F;atguigu 目录下监控 hive.log 文件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-4\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E5%9B%A0%E5%9C%A8%E4%BA%8EHive%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BAderby%EF%BC%8C%E5%BC%80%E5%90%AFHive%E4%B9%8B%E5%90%8E%E5%B0%B1%E4%BC%9A%E5%8D%A0%E7%94%A8%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E4%B8%94%E4%B8%8D%E4%B8%8E\"><span class=\"toc-text\">原因在于Hive默认使用的元数据库为derby，开启Hive之后就会占用元数据库，且不与</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%B6%E4%BB%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%B0%86Hive%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%9C%B0%E5%9D%80%E6%94%B9%E4%B8%BAMySQL%E3%80%82\"><span class=\"toc-text\">其他客户端共享数据，所以我们需要将Hive的元数据地址改为MySQL。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-3-MySQL-%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">2.3 MySQL 安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A3%80%E6%9F%A5%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E8%BF%87MySQL\"><span class=\"toc-text\">1 ）检查当前系统是否安装过MySQL</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%B0%86-MySQL-%E5%AE%89%E8%A3%85%E5%8C%85%E6%8B%B7%E8%B4%9D%E5%88%B0-x2F-opt-x2F-software-%E7%9B%AE%E5%BD%95%E4%B8%8B\"><span class=\"toc-text\">2 ）将 MySQL 安装包拷贝到 &#x2F;opt&#x2F;software 目录下</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E8%A7%A3%E5%8E%8B-MySQL-%E5%AE%89%E8%A3%85%E5%8C%85\"><span class=\"toc-text\">3 ）解压 MySQL 安装包</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%9C%A8%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%A7%E8%A1%8Crpm%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">4 ）在安装目录下执行rpm安装</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F-%E6%8C%89%E7%85%A7%E9%A1%BA%E5%BA%8F%E4%BE%9D%E6%AC%A1%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">注意:按照顺序依次执行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82%E6%9E%9CLinux%E6%98%AF%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E7%9A%84%EF%BC%8C%E5%9C%A8%E5%AE%89%E8%A3%85mysql-community-server-5-7-28-1-el7-x86-64-rpm%E6%97%B6\"><span class=\"toc-text\">如果Linux是最小化安装的，在安装mysql-community-server-5.7.28-1.el7.x86_64.rpm时</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%A6%82%E4%B8%8B%E9%94%99%E8%AF%AF\"><span class=\"toc-text\">可能会出现如下错误</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-5\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%80%9A%E8%BF%87yum%E5%AE%89%E8%A3%85%E7%BC%BA%E5%B0%91%E7%9A%84%E4%BE%9D%E8%B5%96-%E7%84%B6%E5%90%8E%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85mysql-community-server-5-7-28-1-el7-x86-64%E5%8D%B3\"><span class=\"toc-text\">通过yum安装缺少的依赖,然后重新安装mysql-community-server-5.7.28-1.el7.x86_64即</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AF\"><span class=\"toc-text\">可</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%A0%E9%99%A4-x2F-etc-x2F-my-cnf-%E6%96%87%E4%BB%B6%E4%B8%AD-datadir-%E6%8C%87%E5%90%91%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9-%E5%A6%82%E6%9E%9C%E6%9C%89%E5%86%85%E5%AE%B9%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B\"><span class=\"toc-text\">5 ）删除 &#x2F;etc&#x2F;my.cnf 文件中 datadir 指向的目录下的所有内容 , 如果有内容的情况下 :</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8Bdatadir%E7%9A%84%E5%80%BC%EF%BC%9A\"><span class=\"toc-text\">查看datadir的值：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4-x2F-var-x2F-lib-x2F-mysql%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">删除&#x2F;var&#x2F;lib&#x2F;mysql目录下的所有内容:</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">6 ）初始化数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-%EF%BC%89%E6%9F%A5%E7%9C%8B%E4%B8%B4%E6%97%B6%E7%94%9F%E6%88%90%E7%9A%84-root-%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">7 ）查看临时生成的 root 用户的密码</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#8-%EF%BC%89%E5%90%AF%E5%8A%A8-MySQL-%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">8 ）启动 MySQL 服务</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#9-%EF%BC%89%E7%99%BB%E5%BD%95-MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">9 ）登录 MySQL 数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F\"><span class=\"toc-text\">登录成功.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#10-%EF%BC%89%E5%BF%85%E9%A1%BB%E5%85%88%E4%BF%AE%E6%94%B9-root-%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81-%E5%90%A6%E5%88%99%E6%89%A7%E8%A1%8C%E5%85%B6%E4%BB%96%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BC%9A%E6%8A%A5%E9%94%99\"><span class=\"toc-text\">10 ）必须先修改 root 用户的密码 , 否则执行其他的操作会报错</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#11-%EF%BC%89%E4%BF%AE%E6%94%B9-mysql-%E5%BA%93%E4%B8%8B%E7%9A%84-user-%E8%A1%A8%E4%B8%AD%E7%9A%84-root-%E7%94%A8%E6%88%B7%E5%85%81%E8%AE%B8%E4%BB%BB%E6%84%8F-ip-%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">11 ）修改 mysql 库下的 user 表中的 root 用户允许任意 ip 连接</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-6\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-Hive-%E5%85%83%E6%95%B0%E6%8D%AE%E9%85%8D%E7%BD%AE%E5%88%B0-MySQL\"><span class=\"toc-text\">2.4 Hive 元数据配置到 MySQL</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-1-%E6%8B%B7%E8%B4%9D%E9%A9%B1%E5%8A%A8\"><span class=\"toc-text\">2. 4 .1 拷贝驱动</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86MySQL%E7%9A%84JDBC%E9%A9%B1%E5%8A%A8%E6%8B%B7%E8%B4%9D%E5%88%B0Hive%E7%9A%84lib%E7%9B%AE%E5%BD%95%E4%B8%8B\"><span class=\"toc-text\">将MySQL的JDBC驱动拷贝到Hive的lib目录下</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-2-%E9%85%8D%E7%BD%AE-Metastore-%E5%88%B0-MySQL\"><span class=\"toc-text\">2. 4 .2 配置 Metastore 到 MySQL</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%9C%A8-HIVE-HOME-x2F-conf-%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%B0%E5%BB%BA-hive-site-xml-%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">1 ）在 $HIVE_HOME&#x2F;conf 目录下新建 hive-site.xml 文件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">添加如下内容</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-7\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E7%99%BB%E9%99%86-MySQL\"><span class=\"toc-text\">2 ）登陆 MySQL</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%96%B0%E5%BB%BA-Hive-%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">3 ）新建 Hive 元数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89-%E5%88%9D%E5%A7%8B%E5%8C%96-Hive-%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 ） 初始化 Hive 元数据库</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-3-%E5%86%8D%E6%AC%A1%E5%90%AF%E5%8A%A8-Hive\"><span class=\"toc-text\">2.4.3 再次启动 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%90%AF%E5%8A%A8-Hive-1\"><span class=\"toc-text\">1 ）启动 Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%BD%BF%E7%94%A8-Hive-1\"><span class=\"toc-text\">2 ）使用 Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%9C%A8-CRT-%E7%AA%97%E5%8F%A3%E4%B8%AD%E5%BC%80%E5%90%AF%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3%E5%BC%80%E5%90%AF-Hive\"><span class=\"toc-text\">3 ）在 CRT 窗口中开启另一个窗口开启 Hive</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-5-%E4%BD%BF%E7%94%A8%E5%85%83%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%96%B9%E5%BC%8F%E8%AE%BF%E9%97%AE-Hive\"><span class=\"toc-text\">2. 5 使用元数据服务的方式访问 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%9C%A8-hive-site-xml-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">1 ）在 hive-site.xml 文件中添加如下配置信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%90%AF%E5%8A%A8-metastore\"><span class=\"toc-text\">2 ）启动 metastore</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%90%AF%E5%8A%A8-hive\"><span class=\"toc-text\">3 ）启动 hive</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-6-%E4%BD%BF%E7%94%A8-JDBC-%E6%96%B9%E5%BC%8F%E8%AE%BF%E9%97%AE-Hive\"><span class=\"toc-text\">2. 6 使用 JDBC 方式访问 Hive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%9C%A8-hive-site-xml-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF-1\"><span class=\"toc-text\">1 ）在 hive-site.xml 文件中添加如下配置信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-8\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%90%AF%E5%8A%A8-hiveserver-2\"><span class=\"toc-text\">2 ）启动 hiveserver 2</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%90%AF%E5%8A%A8-beeline-%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88%E9%9C%80%E8%A6%81%E5%A4%9A%E7%AD%89%E5%BE%85%E4%B8%80%E4%BC%9A%EF%BC%89\"><span class=\"toc-text\">3 ）启动 beeline 客户端（需要多等待一会）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2\"><span class=\"toc-text\">4 ）看到如下界面</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E7%BC%96%E5%86%99-hive-%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89\"><span class=\"toc-text\">5 ）编写 hive 服务启动脚本（了解）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89-%E5%89%8D%E5%8F%B0%E5%90%AF%E5%8A%A8%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AF%BC%E8%87%B4%E9%9C%80%E8%A6%81%E6%89%93%E5%BC%80%E5%A4%9A%E4%B8%AAshell%E7%AA%97%E5%8F%A3%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E6%96%B9%E5%BC%8F%E5%90%8E%E5%8F%B0%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">（ 1 ） 前台启动的方式导致需要打开多个shell窗口，可以使用如下方式后台方式启动</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#nohup-%E6%94%BE%E5%9C%A8%E5%91%BD%E4%BB%A4%E5%BC%80%E5%A4%B4%EF%BC%8C%E8%A1%A8%E7%A4%BA%E4%B8%8D%E6%8C%82%E8%B5%B7-%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%85%B3%E9%97%AD%E7%BB%88%E7%AB%AF%E8%BF%9B%E7%A8%8B%E4%B9%9F%E7%BB%A7%E7%BB%AD%E4%BF%9D%E6%8C%81%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81\"><span class=\"toc-text\">nohup: 放在命令开头，表示不挂起,也就是关闭终端进程也继续保持运行状态</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#x2F-dev-x2F-null%EF%BC%9A%E6%98%AFLinux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E8%A2%AB%E7%A7%B0%E4%B8%BA%E9%BB%91%E6%B4%9E%EF%BC%8C%E6%89%80%E6%9C%89%E5%86%99%E5%85%A5%E6%94%B9%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">&#x2F;dev&#x2F;null：是Linux文件系统中的一个文件，被称为黑洞，所有写入改文件的内容</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%83%BD%E4%BC%9A%E8%A2%AB%E8%87%AA%E5%8A%A8%E4%B8%A2%E5%BC%83\"><span class=\"toc-text\">都会被自动丢弃</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-gt-amp-1-%E8%A1%A8%E7%A4%BA%E5%B0%86%E9%94%99%E8%AF%AF%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA%E4%B8%8A\"><span class=\"toc-text\">2 &gt;&amp;1 : 表示将错误重定向到标准输出上</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#amp-%E6%94%BE%E5%9C%A8%E5%91%BD%E4%BB%A4%E7%BB%93%E5%B0%BE-%E8%A1%A8%E7%A4%BA%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C\"><span class=\"toc-text\">&amp;: 放在命令结尾,表示后台运行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%80%E8%88%AC%E4%BC%9A%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8-nohup-xxx%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C-gt-file-2-gt-amp-1-amp-%EF%BC%8C%E8%A1%A8%E7%A4%BA%E5%B0%86xxx%E5%91%BD%E4%BB%A4%E8%BF%90%E8%A1%8C%E7%9A%84%E7%BB%93\"><span class=\"toc-text\">一般会组合使用: nohup [xxx命令操作]&gt; file 2&gt;&amp;1 &amp;，表示将xxx命令运行的结</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0file%E4%B8%AD%EF%BC%8C%E5%B9%B6%E4%BF%9D%E6%8C%81%E5%91%BD%E4%BB%A4%E5%90%AF%E5%8A%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%9C%A8%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E3%80%82\"><span class=\"toc-text\">果输出到file中，并保持命令启动的进程在后台运行。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%B8%8A%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%A6%81%E6%B1%82%E6%8E%8C%E6%8F%A1%E3%80%82\"><span class=\"toc-text\">如上命令不要求掌握。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89-%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BF%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC%E6%9D%A5%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD\"><span class=\"toc-text\">（ 2 ） 为了方便使用，可以直接编写脚本来管理服务的启动和关闭</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%9A%E6%AD%A4%E8%84%9A%E6%9C%AC%E7%9A%84%E7%BC%96%E5%86%99%E4%B8%8D%E8%A6%81%E6%B1%82%E6%8E%8C%E6%8F%A1%E3%80%82%E7%9B%B4%E6%8E%A5%E6%8B%BF%E6%9D%A5%E4%BD%BF%E7%94%A8%E5%8D%B3%E5%8F%AF%E3%80%82\"><span class=\"toc-text\">内容如下：此脚本的编写不要求掌握。直接拿来使用即可。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-9\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%B7%BB%E5%8A%A0%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90\"><span class=\"toc-text\">3 ）添加执行权限</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%90%AF%E5%8A%A8-Hive-%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">4 ）启动 Hive 后台服务</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-10\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-7-Hive-%E5%B8%B8%E7%94%A8%E4%BA%A4%E4%BA%92%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">2. 7 Hive 常用交互命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E2%80%9C-e-%E2%80%9D%E4%B8%8D%E8%BF%9B%E5%85%A5-hive-%E7%9A%84%E4%BA%A4%E4%BA%92%E7%AA%97%E5%8F%A3%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">1 ）“ - e ”不进入 hive 的交互窗口执行 sql 语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E2%80%9C-f-%E2%80%9D%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E4%B8%AD-sql-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">2 ）“ - f ”执行脚本中 sql 语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%9C%A8-x2F-opt-x2F-module-x2F-hive-x2F-%E4%B8%8B%E5%88%9B%E5%BB%BAdatas%E7%9B%AE%E5%BD%95%E5%B9%B6%E5%9C%A8datas%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BAhivef-sql%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">（ 1 ）在&#x2F;opt&#x2F;module&#x2F;hive&#x2F;下创建datas目录并在datas目录下创建hivef.sql文件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%96%87%E4%BB%B6%E4%B8%AD%E5%86%99%E5%85%A5%E6%AD%A3%E7%A1%AE%E7%9A%84sql%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 2 ）文件中写入正确的sql语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84sql%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 3 ）执行文件中的sql语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84sql%E8%AF%AD%E5%8F%A5%E5%B9%B6%E5%B0%86%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E4%B8%AD\"><span class=\"toc-text\">（ 4 ）执行文件中的sql语句并将结果写入文件中</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-8-Hive-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">2. 8 Hive 其他命令操作</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%80%80%E5%87%BA-hive-%E7%AA%97%E5%8F%A3%EF%BC%9A\"><span class=\"toc-text\">1 ）退出 hive 窗口：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%9C%A8-hive-cli-%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%E4%B8%AD%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B-hdfs-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\"><span class=\"toc-text\">2 ）在 hive cli 命令窗口中如何查看 hdfs 文件系统</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E5%9C%A8-hive-%E4%B8%AD%E8%BE%93%E5%85%A5%E7%9A%84%E6%89%80%E6%9C%89%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">3 ）查看在 hive 中输入的所有历史命令</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%BF%9B%E5%85%A5%E5%88%B0%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E7%9A%84%E6%A0%B9%E7%9B%AE%E5%BD%95-x2F-root%E6%88%96-x2F-home-x2F-atguigu\"><span class=\"toc-text\">（ 1 ）进入到当前用户的根目录 &#x2F;root或&#x2F;home&#x2F;atguigu</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E7%9C%8B-hivehistory%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">（ 2 ）查看. hivehistory文件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-11\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-9-Hive-%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">2. 9 Hive 常见属性配置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-9-1-Hive-%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">2. 9 .1 Hive 运行日志信息配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-Hive-%E7%9A%84-log-%E9%BB%98%E8%AE%A4%E5%AD%98%E6%94%BE%E5%9C%A8-x2F-tmp-x2F-atguigu-x2F-hive-log-%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%90%8D%E4%B8%8B%EF%BC%89\"><span class=\"toc-text\">1 ） Hive 的 log 默认存放在 &#x2F;tmp&#x2F;atguigu&#x2F;hive.log 目录下（当前用户名下）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%BF%AE%E6%94%B9-hive-%E7%9A%84-log-%E5%AD%98%E6%94%BE%E6%97%A5%E5%BF%97%E5%88%B0-x2F-opt-x2F-module-x2F-hive-x2F-logs\"><span class=\"toc-text\">2 ）修改 hive 的 log 存放日志到 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;logs</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E4%BF%AE%E6%94%B9-x2F-opt-x2F-module-x2F-hive-x2F-conf-x2F-hive-log4j-2-properties-template%E6%96%87%E4%BB%B6%E5%90%8D%E7%A7%B0%E4%B8%BA\"><span class=\"toc-text\">（ 1 ）修改&#x2F;opt&#x2F;module&#x2F;hive&#x2F;conf&#x2F;hive-log4j 2 .properties.template文件名称为</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#hive-log4j-2-properties\"><span class=\"toc-text\">hive-log4j 2 .properties</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%9C%A8hive-log4j-2-properties%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9log%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE\"><span class=\"toc-text\">（ 2 ）在hive-log4j 2 .properties文件中修改log存放位置</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-9-2-%E6%89%93%E5%8D%B0-%E5%BD%93%E5%89%8D%E5%BA%93-%E5%92%8C-%E8%A1%A8%E5%A4%B4\"><span class=\"toc-text\">2. 9 .2 打印 当前库 和 表头</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8hive-site-xml%E4%B8%AD%E5%8A%A0%E5%85%A5%E5%A6%82%E4%B8%8B%E4%B8%A4%E4%B8%AA%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">在hive-site.xml中加入如下两个配置:</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-9-3-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">2. 9. 3 参数配置方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%89%80%E6%9C%89%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">1 ）查看当前所有的配置信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%8F%82%E6%95%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">2 ）参数的配置三种方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 1 ）配置文件方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9Ahive-default-xml\"><span class=\"toc-text\">默认配置文件：hive-default.xml</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9Ahive-site-xml\"><span class=\"toc-text\">用户自定义配置文件：hive-site.xml</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E4%BC%9A%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E3%80%82%E5%8F%A6%E5%A4%96%EF%BC%8CHive%E4%B9%9F%E4%BC%9A%E8%AF%BB%E5%85%A5Hadoop%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%9B%A0%E4%B8%BAHive\"><span class=\"toc-text\">注意：用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%98%AF%E4%BD%9C%E4%B8%BAHadoop%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E5%8A%A8%E7%9A%84%EF%BC%8CHive%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BC%9A%E8%A6%86%E7%9B%96Hadoop%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%82%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%BE%E5%AE%9A%E5%AF%B9%E6%9C%AC\"><span class=\"toc-text\">是作为Hadoop的客户端启动的，Hive的配置会覆盖Hadoop的配置。配置文件的设定对本</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%9A%84%E6%89%80%E6%9C%89Hive%E8%BF%9B%E7%A8%8B%E9%83%BD%E6%9C%89%E6%95%88%E3%80%82\"><span class=\"toc-text\">机启动的所有Hive进程都有效。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 2 ）命令行参数方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8Hive%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%B7%BB%E5%8A%A0-hiveconf-param-x3D-value%E6%9D%A5%E8%AE%BE%E5%AE%9A%E5%8F%82%E6%95%B0%E3%80%82\"><span class=\"toc-text\">启动Hive时，可以在命令行添加-hiveconf param&#x3D;value来设定参数。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-12\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">例如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E4%BB%85%E5%AF%B9%E6%9C%AC%E6%AC%A1hive%E5%90%AF%E5%8A%A8%E6%9C%89%E6%95%88\"><span class=\"toc-text\">注意：仅对本次hive启动有效</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE%EF%BC%9A\"><span class=\"toc-text\">查看参数设置：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%8F%82%E6%95%B0%E5%A3%B0%E6%98%8E%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 3 ）参数声明方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E4%BB%A5%E5%9C%A8HQL%E4%B8%AD%E4%BD%BF%E7%94%A8SET%E5%85%B3%E9%94%AE%E5%AD%97%E8%AE%BE%E5%AE%9A%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">可以在HQL中使用SET关键字设定参数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%A6%82%EF%BC%9A-1\"><span class=\"toc-text\">例如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E4%BB%85%E5%AF%B9%E6%9C%AC%E6%AC%A1hive%E5%90%AF%E5%8A%A8%E6%9C%89%E6%95%88%E3%80%82\"><span class=\"toc-text\">注意：仅对本次hive启动有效。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">查看参数设置</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E8%BF%B0%E4%B8%89%E7%A7%8D%E8%AE%BE%E5%AE%9A%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E4%BE%9D%E6%AC%A1%E9%80%92%E5%A2%9E%E3%80%82%E5%8D%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-lt-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0-lt-%E5%8F%82%E6%95%B0%E5%A3%B0%E6%98%8E%E3%80%82%E6%B3%A8%E6%84%8F%E6%9F%90%E4%BA%9B%E7%B3%BB\"><span class=\"toc-text\">上述三种设定方式的优先级依次递增。即配置文件&lt;命令行参数&lt;参数声明。注意某些系</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%9F%E7%BA%A7%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BE%8B%E5%A6%82log4j%E7%9B%B8%E5%85%B3%E7%9A%84%E8%AE%BE%E5%AE%9A%EF%BC%8C%E5%BF%85%E9%A1%BB%E7%94%A8%E5%89%8D%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E8%AE%BE%E5%AE%9A%EF%BC%8C%E5%9B%A0%E4%B8%BA%E9%82%A3%E4%BA%9B%E5%8F%82%E6%95%B0%E7%9A%84%E8%AF%BB%E5%8F%96%E5%9C%A8%E4%BC%9A%E8%AF%9D\"><span class=\"toc-text\">统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在会话</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BB%BA%E7%AB%8B%E4%BB%A5%E5%89%8D%E5%B7%B2%E7%BB%8F%E5%AE%8C%E6%88%90%E4%BA%86%E3%80%82\"><span class=\"toc-text\">建立以前已经完成了。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-3-%E7%AB%A0-Hive%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">第 3 章 Hive数据类型</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-1-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">3 .1 基本数据类型</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E4%BA%8EHive%E7%9A%84String%E7%B1%BB%E5%9E%8B%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84varchar%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%AF%A5%E7%B1%BB%E5%9E%8B%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%AF%E5%8F%98%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E4%B8%8D\"><span class=\"toc-text\">对于Hive的String类型相当于数据库的varchar类型，该类型是一个可变的字符串，不</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%87%E5%AE%83%E4%B8%8D%E8%83%BD%E5%A3%B0%E6%98%8E%E5%85%B6%E4%B8%AD%E6%9C%80%E5%A4%9A%E8%83%BD%E5%AD%98%E5%82%A8%E5%A4%9A%E5%B0%91%E4%B8%AA%E5%AD%97%E7%AC%A6%EF%BC%8C%E7%90%86%E8%AE%BA%E4%B8%8A%E5%AE%83%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A82GB%E7%9A%84%E5%AD%97%E7%AC%A6%E6%95%B0%E3%80%82\"><span class=\"toc-text\">过它不能声明其中最多能存储多少个字符，理论上它可以存储2GB的字符数。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-13\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-2-%E9%9B%86%E5%90%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">3 .2 集合数据类型</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E6%9C%89%E4%B8%89%E7%A7%8D%E5%A4%8D%E6%9D%82%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8BARRAY%E3%80%81MAP-%E5%92%8C-STRUCT%E3%80%82ARRAY%E5%92%8CMAP%E4%B8%8EJava%E4%B8%AD%E7%9A%84Array\"><span class=\"toc-text\">Hive有三种复杂数据类型ARRAY、MAP 和 STRUCT。ARRAY和MAP与Java中的Array</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%92%8CMap%E7%B1%BB%E4%BC%BC%EF%BC%8C%E8%80%8CSTRUCT%E4%B8%8EC%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84Struct%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%AE%83%E5%B0%81%E8%A3%85%E4%BA%86%E4%B8%80%E4%B8%AA%E5%91%BD%E5%90%8D%E5%AD%97%E6%AE%B5%E9%9B%86%E5%90%88%EF%BC%8C%E5%A4%8D%E6%9D%82%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">和Map类似，而STRUCT与C语言中的Struct类似，它封装了一个命名字段集合，复杂数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%B1%BB%E5%9E%8B%E5%85%81%E8%AE%B8%E4%BB%BB%E6%84%8F%E5%B1%82%E6%AC%A1%E7%9A%84%E5%B5%8C%E5%A5%97%E3%80%82\"><span class=\"toc-text\">类型允许任意层次的嵌套。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">1 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%81%87%E8%AE%BE%E6%9F%90%E8%A1%A8%E6%9C%89%E5%A6%82%E4%B8%8B%E4%B8%80%E8%A1%8C%EF%BC%8C%E6%88%91%E4%BB%AC%E7%94%A8JSON%E6%A0%BC%E5%BC%8F%E6%9D%A5%E8%A1%A8%E7%A4%BA%E5%85%B6%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%82%E5%9C%A8Hive%E4%B8%8B%E8%AE%BF%E9%97%AE%E7%9A%84%E6%A0%BC\"><span class=\"toc-text\">（ 1 ）假设某表有如下一行，我们用JSON格式来表示其数据结构。在Hive下访问的格</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BC%8F%E4%B8%BA\"><span class=\"toc-text\">式为</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%9F%BA%E4%BA%8E%E4%B8%8A%E8%BF%B0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8Hive%E9%87%8C%E5%88%9B%E5%BB%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E8%A1%A8%EF%BC%8C%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">（ 2 ）基于上述数据结构，我们在Hive里创建对应的表，并导入数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6test-txt\"><span class=\"toc-text\">创建本地测试文件test.txt</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9AMAP%EF%BC%8CSTRUCT%E5%92%8CARRAY%E9%87%8C%E7%9A%84%E5%85%83%E7%B4%A0%E9%97%B4%E5%85%B3%E7%B3%BB%E9%83%BD%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E8%A1%A8%E7%A4%BA%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A8%E2%80%9C-%E2%80%9D%E3%80%82\"><span class=\"toc-text\">注意：MAP，STRUCT和ARRAY里的元素间关系都可以用同一个字符表示，这里用“_”。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89Hive%E4%B8%8A%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E8%A1%A8test\"><span class=\"toc-text\">（ 3 ）Hive上创建测试表test</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-14\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%97%E6%AE%B5%E8%A7%A3%E9%87%8A%EF%BC%9A\"><span class=\"toc-text\">字段解释：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#row-format-delimited-fields-terminated-by-%E2%80%98-%E2%80%99-%E2%80%93-%E5%88%97%E5%88%86%E9%9A%94%E7%AC%A6\"><span class=\"toc-text\">row format delimited fields terminated by ‘,’ – 列分隔符</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#collection-items-terminated-by-%E2%80%98-%E2%80%99-%E2%80%93MAP-STRUCT-%E5%92%8C-ARRAY-%E7%9A%84%E5%88%86%E9%9A%94%E7%AC%A6-%E6%95%B0%E6%8D%AE%E5%88%86%E5%89%B2%E7%AC%A6%E5%8F%B7\"><span class=\"toc-text\">collection items terminated by ‘_’ –MAP STRUCT 和 ARRAY 的分隔符(数据分割符号)</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#map-keys-terminated-by-%E2%80%98-%E2%80%99-%E2%80%93-MAP%E4%B8%AD%E7%9A%84key%E4%B8%8Evalue%E7%9A%84%E5%88%86%E9%9A%94%E7%AC%A6\"><span class=\"toc-text\">map keys terminated by ‘:’ – MAP中的key与value的分隔符</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#lines-terminated-by-%E2%80%98-n%E2%80%99-%E2%80%93-%E8%A1%8C%E5%88%86%E9%9A%94%E7%AC%A6\"><span class=\"toc-text\">lines terminated by ‘\\n’; – 行分隔符</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E5%AF%BC%E5%85%A5%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%88%B0%E6%B5%8B%E8%AF%95%E8%A1%A8\"><span class=\"toc-text\">（ 4 ）导入文本数据到测试表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#load-data-local-inpath-%E2%80%98-x2F-opt-x2F-module-x2F-hive-x2F-datas-x2F-test-txt%E2%80%99-into-table-test\"><span class=\"toc-text\">load data local inpath ‘&#x2F;opt&#x2F;module&#x2F;hive&#x2F;datas&#x2F;test.txt’ into table test;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E8%AE%BF%E9%97%AE%E4%B8%89%E7%A7%8D%E9%9B%86%E5%90%88%E5%88%97%E9%87%8C%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BB%A5%E4%B8%8B%E5%88%86%E5%88%AB%E6%98%AFARRAY%EF%BC%8CMAP%EF%BC%8CSTRUCT%E7%9A%84%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 5 ）访问三种集合列里的数据，以下分别是ARRAY，MAP，STRUCT的访问方式</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-3-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E5%8C%96\"><span class=\"toc-text\">3 .3 类型转化</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E7%9A%84%E5%8E%9F%E5%AD%90%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%98%AF%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%9A%84%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8EJava%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%9F%90%E8%A1%A8%E8%BE%BE%E5%BC%8F\"><span class=\"toc-text\">Hive的原子数据类型是可以进行隐式转换的，类似于Java的类型转换，例如某表达式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8INT%E7%B1%BB%E5%9E%8B%EF%BC%8CTINYINT%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2%E4%B8%BAINT%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%BD%86%E6%98%AFHive%E4%B8%8D%E4%BC%9A%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8C%96%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%8C%E6%9F%90%E8%A1%A8\"><span class=\"toc-text\">使用INT类型，TINYINT会自动转换为INT类型，但是Hive不会进行反向转化，例如，某表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BE%BE%E5%BC%8F%E4%BD%BF%E7%94%A8TINYINT%E7%B1%BB%E5%9E%8B%EF%BC%8CINT%E4%B8%8D%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2%E4%B8%BATINYINT%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%83%E4%BC%9A%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%EF%BC%8C%E9%99%A4%E9%9D%9E%E4%BD%BF%E7%94%A8CAST\"><span class=\"toc-text\">达式使用TINYINT类型，INT不会自动转换为TINYINT类型，它会返回错误，除非使用CAST</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">操作。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99%E5%A6%82%E4%B8%8B\"><span class=\"toc-text\">1 ）隐式类型转换规则如下</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E4%BB%BB%E4%BD%95%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%9A%90%E5%BC%8F%E5%9C%B0%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%8C%83%E5%9B%B4%E6%9B%B4%E5%B9%BF%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%A6%82TINYINT%E5%8F%AF%E4%BB%A5%E8%BD%AC%E6%8D%A2%E6%88%90\"><span class=\"toc-text\">（ 1 ）任何整数类型都可以隐式地转换为一个范围更广的类型，如TINYINT可以转换成</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#INT%EF%BC%8CINT%E5%8F%AF%E4%BB%A5%E8%BD%AC%E6%8D%A2%E6%88%90BIGINT%E3%80%82\"><span class=\"toc-text\">INT，INT可以转换成BIGINT。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%89%80%E6%9C%89%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%E3%80%81FLOAT%E5%92%8CSTRING%E7%B1%BB%E5%9E%8B%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%9A%90%E5%BC%8F%E5%9C%B0%E8%BD%AC%E6%8D%A2%E6%88%90DOUBLE%E3%80%82\"><span class=\"toc-text\">（ 2 ）所有整数类型、FLOAT和STRING类型都可以隐式地转换成DOUBLE。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89TINYINT%E3%80%81SMALLINT%E3%80%81INT%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%BD%AC%E6%8D%A2%E4%B8%BAFLOAT%E3%80%82\"><span class=\"toc-text\">（ 3 ）TINYINT、SMALLINT、INT都可以转换为FLOAT。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89BOOLEAN%E7%B1%BB%E5%9E%8B%E4%B8%8D%E5%8F%AF%E4%BB%A5%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BB%BB%E4%BD%95%E5%85%B6%E5%AE%83%E7%9A%84%E7%B1%BB%E5%9E%8B%E3%80%82\"><span class=\"toc-text\">（ 4 ）BOOLEAN类型不可以转换为任何其它的类型。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-CAST-%E6%93%8D%E4%BD%9C%E6%98%BE%E7%A4%BA%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2\"><span class=\"toc-text\">2 ）可以使用 CAST 操作显示进行数据类型转换</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%A6%82CAST-%E2%80%981%E2%80%99-AS-INT-%E5%B0%86%E6%8A%8A%E5%AD%97%E7%AC%A6%E4%B8%B2%E2%80%991%E2%80%99-%E8%BD%AC%E6%8D%A2%E6%88%90%E6%95%B4%E6%95%B0-1-%EF%BC%9B%E5%A6%82%E6%9E%9C%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%A6%82%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">例如CAST(‘1’ AS INT)将把字符串’1’ 转换成整数 1 ；如果强制类型转换失败，如执行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#CAST-%E2%80%98X%E2%80%99-AS-INT-%EF%BC%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%94%E5%9B%9E%E7%A9%BA%E5%80%BC-NULL%E3%80%82\"><span class=\"toc-text\">CAST(‘X’ AS INT)，表达式返回空值 NULL。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-15\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-4-%E7%AB%A0-DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89\"><span class=\"toc-text\">第 4 章 DDL数据定义</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 .1 创建数据库</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8-HDFS-%E4%B8%8A%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84%E6%98%AF-x2F-user-x2F-hive-x2F-warehouse-x2F-db-%E3%80%82\"><span class=\"toc-text\">1 ）创建一个数据库，数据库在 HDFS 上的默认存储路径是 &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;*.db 。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E9%81%BF%E5%85%8D%E8%A6%81%E5%88%9B%E5%BB%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E9%94%99%E8%AF%AF%EF%BC%8C%E5%A2%9E%E5%8A%A0-if-not-exists-%E5%88%A4%E6%96%AD%E3%80%82%EF%BC%88%E6%A0%87%E5%87%86%E5%86%99%E6%B3%95%EF%BC%89\"><span class=\"toc-text\">2 ）避免要创建的数据库已经存在错误，增加 if not exists 判断。（标准写法）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8-HDFS-%E4%B8%8A%E5%AD%98%E6%94%BE%E7%9A%84%E4%BD%8D%E7%BD%AE\"><span class=\"toc-text\">3 ）创建一个数据库，指定数据库在 HDFS 上存放的位置</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-2-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 .2 查询数据库</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-2-1-%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 .2.1 显示数据库</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">1 ）显示数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E8%BF%87%E6%BB%A4%E6%98%BE%E7%A4%BA%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">2 ）过滤显示查询的数据库</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-2-2-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%A6%E6%83%85\"><span class=\"toc-text\">4 .2.2 查看数据库详情</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">1 ）显示数据库信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%8C-extended\"><span class=\"toc-text\">2 ）显示数据库详细信息， extended</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-16\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-2-3-%E5%88%87%E6%8D%A2%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4. 2 .3 切换当前数据库</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-3-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 .3 修改数据库</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8ALTER-DATABASE%E5%91%BD%E4%BB%A4%E4%B8%BA%E6%9F%90%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84DBPROPERTIES%E8%AE%BE%E7%BD%AE%E9%94%AE-%E5%80%BC%E5%AF%B9%E5%B1%9E%E6%80%A7%E5%80%BC%EF%BC%8C\"><span class=\"toc-text\">用户可以使用ALTER DATABASE命令为某个数据库的DBPROPERTIES设置键-值对属性值，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A5%E6%8F%8F%E8%BF%B0%E8%BF%99%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%B1%9E%E6%80%A7%E4%BF%A1%E6%81%AF%E3%80%82\"><span class=\"toc-text\">来描述这个数据库的属性信息。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8hive%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%BF%AE%E6%94%B9%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">在hive中查看修改结果</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-4-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">4 .4 删除数据库</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%A0%E9%99%A4%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">1 ）删除空数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%A6%82%E6%9E%9C%E5%88%A0%E9%99%A4%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E6%9C%80%E5%A5%BD%E9%87%87%E7%94%A8-if-exists-%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8\"><span class=\"toc-text\">2 ）如果删除的数据库不存在，最好采用 if exists 判断数据库是否存在</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8D%E4%B8%BA%E7%A9%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%87%87%E7%94%A8-cascade-%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">3 ）如果数据库不为空，可以采用 cascade 命令，强制删除</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-5-%E5%88%9B%E5%BB%BA%E8%A1%A8\"><span class=\"toc-text\">4 .5 创建表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%BB%BA%E8%A1%A8%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">1 ）建表语法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AD%97%E6%AE%B5%E8%A7%A3%E9%87%8A%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">2 ）字段解释说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89CREATE-TABLE-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%8C%87%E5%AE%9A%E5%90%8D%E5%AD%97%E7%9A%84%E8%A1%A8%E3%80%82%E5%A6%82%E6%9E%9C%E7%9B%B8%E5%90%8C%E5%90%8D%E5%AD%97%E7%9A%84%E8%A1%A8%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%EF%BC%9B\"><span class=\"toc-text\">（ 1 ）CREATE TABLE 创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E7%94%A8-IF-NOT-EXISTS-%E9%80%89%E9%A1%B9%E6%9D%A5%E5%BF%BD%E7%95%A5%E8%BF%99%E4%B8%AA%E5%BC%82%E5%B8%B8%E3%80%82\"><span class=\"toc-text\">用户可以用 IF NOT EXISTS 选项来忽略这个异常。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-17\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89EXTERNAL%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%AF%E4%BB%A5%E8%AE%A9%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%8C%E5%9C%A8%E5%BB%BA%E8%A1%A8%E7%9A%84%E5%90%8C%E6%97%B6%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E6%8C%87%E5%90%91%E5%AE%9E\"><span class=\"toc-text\">（ 2 ）EXTERNAL关键字可以让用户创建一个外部表，在建表的同时可以指定一个指向实</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%99%85%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%88LOCATION%EF%BC%89%EF%BC%8C%E5%9C%A8%E5%88%A0%E9%99%A4%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%86%85%E9%83%A8%E8%A1%A8%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BC%9A%E8%A2%AB%E4%B8%80%E8%B5%B7%E5%88%A0%E9%99%A4%EF%BC%8C%E8%80%8C%E5%A4%96\"><span class=\"toc-text\">际数据的路径（LOCATION），在删除表的时候，内部表的元数据和数据会被一起删除，而外</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%83%A8%E8%A1%A8%E5%8F%AA%E5%88%A0%E9%99%A4%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8D%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">部表只删除元数据，不删除数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89COMMENT%EF%BC%9A%E4%B8%BA%E8%A1%A8%E5%92%8C%E5%88%97%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%87%8A%E3%80%82\"><span class=\"toc-text\">（ 3 ）COMMENT：为表和列添加注释。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89PARTITIONED-BY%E5%88%9B%E5%BB%BA%E5%88%86%E5%8C%BA%E8%A1%A8\"><span class=\"toc-text\">（ 4 ）PARTITIONED BY创建分区表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89CLUSTERED-BY%E5%88%9B%E5%BB%BA%E5%88%86%E6%A1%B6%E8%A1%A8\"><span class=\"toc-text\">（ 5 ）CLUSTERED BY创建分桶表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-6-%EF%BC%89SORTED-BY%E4%B8%8D%E5%B8%B8%E7%94%A8%EF%BC%8C%E5%AF%B9%E6%A1%B6%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E5%88%97%E5%8F%A6%E5%A4%96%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">（ 6 ）SORTED BY不常用，对桶中的一个或多个列另外排序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-7-%EF%BC%89ROW-FORMAT\"><span class=\"toc-text\">（ 7 ）ROW FORMAT</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#DELIMITED-FIELDS-TERMINATED-BY-char-COLLECTION-ITEMS-TERMINATED-BY-char\"><span class=\"toc-text\">DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#MAP-KEYS-TERMINATED-BY-char-LINES-TERMINATED-BY-char\"><span class=\"toc-text\">[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#SERDE-serde-name-WITH-SERDEPROPERTIES-property-name-x3D-property-value\"><span class=\"toc-text\">| SERDE serde_name [WITH SERDEPROPERTIES (property_name&#x3D;property_value,</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#property-name-x3D-property-value-%E2%80%A6\"><span class=\"toc-text\">property_name&#x3D;property_value, …)]</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E5%9C%A8%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89-SerDe-%E6%88%96%E8%80%85%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B8%A6%E7%9A%84-SerDe%E3%80%82%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A-ROW\"><span class=\"toc-text\">用户在建表的时候可以自定义 SerDe 或者使用自带的 SerDe。如果没有指定 ROW</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#FORMAT-%E6%88%96%E8%80%85ROW-FORMAT-DELIMITED%EF%BC%8C%E5%B0%86%E4%BC%9A%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B8%A6%E7%9A%84SerDe%E3%80%82%E5%9C%A8%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E7%94%A8%E6%88%B7%E8%BF%98%E9%9C%80\"><span class=\"toc-text\">FORMAT 或者ROW FORMAT DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A6%81%E4%B8%BA%E8%A1%A8%E6%8C%87%E5%AE%9A%E5%88%97%EF%BC%8C%E7%94%A8%E6%88%B7%E5%9C%A8%E6%8C%87%E5%AE%9A%E8%A1%A8%E7%9A%84%E5%88%97%E7%9A%84%E5%90%8C%E6%97%B6%E4%B9%9F%E4%BC%9A%E6%8C%87%E5%AE%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84SerDe%EF%BC%8CHive%E9%80%9A%E8%BF%87SerDe%E7%A1%AE%E5%AE%9A%E8%A1%A8\"><span class=\"toc-text\">要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E5%85%B7%E4%BD%93%E7%9A%84%E5%88%97%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">的具体的列的数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#SerDe%E6%98%AFSerialize-x2F-Deserilize%E7%9A%84%E7%AE%80%E7%A7%B0%EF%BC%8C-hive%E4%BD%BF%E7%94%A8Serde%E8%BF%9B%E8%A1%8C%E8%A1%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BA%8F%E5%88%97%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%82\"><span class=\"toc-text\">SerDe是Serialize&#x2F;Deserilize的简称， hive使用Serde进行行对象的序列与反序列化。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-8-%EF%BC%89STORED-AS%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">（ 8 ）STORED AS指定存储文件类型</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%EF%BC%9ASEQUENCEFILE%EF%BC%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%BA%8F%E5%88%97%E6%96%87%E4%BB%B6%EF%BC%89%E3%80%81TEXTFILE%EF%BC%88%E6%96%87%E6%9C%AC%EF%BC%89%E3%80%81RCFILE%EF%BC%88%E5%88%97\"><span class=\"toc-text\">常用的存储文件类型：SEQUENCEFILE（二进制序列文件）、TEXTFILE（文本）、RCFILE（列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BC%8F%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%EF%BC%89\"><span class=\"toc-text\">式存储格式文件）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82%E6%9E%9C%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E6%98%AF%E7%BA%AF%E6%96%87%E6%9C%AC%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8STORED-AS-TEXTFILE%E3%80%82%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E9%9C%80%E8%A6%81%E5%8E%8B%E7%BC%A9%EF%BC%8C%E4%BD%BF%E7%94%A8-STORED\"><span class=\"toc-text\">如果文件数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用 STORED</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#AS-SEQUENCEFILE%E3%80%82\"><span class=\"toc-text\">AS SEQUENCEFILE。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-9-%EF%BC%89LOCATION-%EF%BC%9A%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%9C%A8HDFS%E4%B8%8A%E7%9A%84%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE%E3%80%82\"><span class=\"toc-text\">（ 9 ）LOCATION ：指定表在HDFS上的存储位置。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-10-%EF%BC%89AS%EF%BC%9A%E5%90%8E%E8%B7%9F%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%8C%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%9B%E5%BB%BA%E8%A1%A8%E3%80%82\"><span class=\"toc-text\">（ 10 ）AS：后跟查询语句，根据查询结果创建表。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-11-%EF%BC%89LIKE%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E5%A4%8D%E5%88%B6%E7%8E%B0%E6%9C%89%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E4%BD%86%E6%98%AF%E4%B8%8D%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">（ 11 ）LIKE允许用户复制现有的表结构，但是不复制数据。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-5-1-%E7%AE%A1%E7%90%86%E8%A1%A8\"><span class=\"toc-text\">4 .5.1 管理表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%90%86%E8%AE%BA\"><span class=\"toc-text\">1 ）理论</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E5%88%9B%E5%BB%BA%E7%9A%84%E8%A1%A8%E9%83%BD%E6%98%AF%E6%89%80%E8%B0%93%E7%9A%84%E7%AE%A1%E7%90%86%E8%A1%A8%EF%BC%8C%E6%9C%89%E6%97%B6%E4%B9%9F%E8%A2%AB%E7%A7%B0%E4%B8%BA%E5%86%85%E9%83%A8%E8%A1%A8%E3%80%82%E5%9B%A0%E4%B8%BA%E8%BF%99%E7%A7%8D%E8%A1%A8%EF%BC%8CHive%E4%BC%9A%EF%BC%88%E6%88%96%E5%A4%9A%E6%88%96\"><span class=\"toc-text\">默认创建的表都是所谓的管理表，有时也被称为内部表。因为这种表，Hive会（或多或</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%91%E5%9C%B0%EF%BC%89%E6%8E%A7%E5%88%B6%E7%9D%80%E6%95%B0%E6%8D%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E3%80%82Hive-%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%B0%86%E8%BF%99%E4%BA%9B%E8%A1%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%9C%A8%E7%94%B1%E9%85%8D%E7%BD%AE%E9%A1%B9\"><span class=\"toc-text\">少地）控制着数据的生命周期。Hive 默认情况下会将这些表的数据存储在由配置项</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-18\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#hive-metastore-warehouse-dir-%E4%BE%8B%E5%A6%82%EF%BC%8C-x2F-user-x2F-hive-x2F-warehouse-%E6%89%80%E5%AE%9A%E4%B9%89%E7%9A%84%E7%9B%AE%E5%BD%95%E7%9A%84%E5%AD%90%E7%9B%AE%E5%BD%95%E4%B8%8B%E3%80%82\"><span class=\"toc-text\">hive.metastore.warehouse.dir(例如，&#x2F;user&#x2F;hive&#x2F;warehouse)所定义的目录的子目录下。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93%E6%88%91%E4%BB%AC%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E7%AE%A1%E7%90%86%E8%A1%A8%E6%97%B6%EF%BC%8CHive%E4%B9%9F%E4%BC%9A%E5%88%A0%E9%99%A4%E8%BF%99%E4%B8%AA%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E3%80%82%E7%AE%A1%E7%90%86%E8%A1%A8%E4%B8%8D%E9%80%82%E5%90%88%E5%92%8C%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7%E5%85%B1%E4%BA%AB\"><span class=\"toc-text\">当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">2 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-0-%EF%BC%89%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 0 ）原始数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%99%AE%E9%80%9A%E5%88%9B%E5%BB%BA%E8%A1%A8\"><span class=\"toc-text\">（ 1 ）普通创建表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%88%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%9C%E4%BC%9A%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%96%B0%E5%88%9B%E5%BB%BA%E7%9A%84%E8%A1%A8%E4%B8%AD%EF%BC%89\"><span class=\"toc-text\">（ 2 ）根据查询结果创建表（查询的结果会添加到新创建的表中）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%A0%B9%E6%8D%AE%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84%E5%88%9B%E5%BB%BA%E8%A1%A8\"><span class=\"toc-text\">（ 3 ）根据已经存在的表结构创建表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">（ 4 ）查询表的类型</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-5-2-%E5%A4%96%E9%83%A8%E8%A1%A8\"><span class=\"toc-text\">4 .5.2 外部表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%90%86%E8%AE%BA-1\"><span class=\"toc-text\">1 ）理论</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9B%A0%E4%B8%BA%E8%A1%A8%E6%98%AF%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%8C%E6%89%80%E4%BB%A5Hive%E5%B9%B6%E9%9D%9E%E8%AE%A4%E4%B8%BA%E5%85%B6%E5%AE%8C%E5%85%A8%E6%8B%A5%E6%9C%89%E8%BF%99%E4%BB%BD%E6%95%B0%E6%8D%AE%E3%80%82%E5%88%A0%E9%99%A4%E8%AF%A5%E8%A1%A8%E5%B9%B6%E4%B8%8D%E4%BC%9A%E5%88%A0%E9%99%A4%E6%8E%89%E8%BF%99\"><span class=\"toc-text\">因为表是外部表，所以Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%BD%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8D%E8%BF%87%E6%8F%8F%E8%BF%B0%E8%A1%A8%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E4%BC%9A%E8%A2%AB%E5%88%A0%E9%99%A4%E6%8E%89%E3%80%82\"><span class=\"toc-text\">份数据，不过描述表的元数据信息会被删除掉。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E7%AE%A1%E7%90%86%E8%A1%A8%E5%92%8C%E5%A4%96%E9%83%A8%E8%A1%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">2 ）管理表和外部表的使用场景</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%AF%8F%E5%A4%A9%E5%B0%86%E6%94%B6%E9%9B%86%E5%88%B0%E7%9A%84%E7%BD%91%E7%AB%99%E6%97%A5%E5%BF%97%E5%AE%9A%E6%9C%9F%E6%B5%81%E5%85%A5HDFS%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E3%80%82%E5%9C%A8%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%88%E5%8E%9F%E5%A7%8B%E6%97%A5%E5%BF%97%E8%A1%A8%EF%BC%89%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A\"><span class=\"toc-text\">每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%81%9A%E5%A4%A7%E9%87%8F%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E7%94%A8%E5%88%B0%E7%9A%84%E4%B8%AD%E9%97%B4%E8%A1%A8%E3%80%81%E7%BB%93%E6%9E%9C%E8%A1%A8%E4%BD%BF%E7%94%A8%E5%86%85%E9%83%A8%E8%A1%A8%E5%AD%98%E5%82%A8%EF%BC%8C%E6%95%B0%E6%8D%AE%E9%80%9A%E8%BF%87SELECT-INSERT%E8%BF%9B%E5%85%A5\"><span class=\"toc-text\">做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-19\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%85%E9%83%A8%E8%A1%A8%E3%80%82\"><span class=\"toc-text\">内部表。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">3 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%86%E5%88%AB%E5%88%9B%E5%BB%BA%E9%83%A8%E9%97%A8%E5%92%8C%E5%91%98%E5%B7%A5%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%8C%E5%B9%B6%E5%90%91%E8%A1%A8%E4%B8%AD%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">分别创建部门和员工外部表，并向表中导入数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-0-%EF%BC%89%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">（ 0 ）原始数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#dept\"><span class=\"toc-text\">dept:</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#emp%EF%BC%9A\"><span class=\"toc-text\">emp：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E5%88%B0HDFS\"><span class=\"toc-text\">（ 1 ）上传数据到HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5%EF%BC%8C%E5%88%9B%E5%BB%BA%E5%A4%96%E9%83%A8%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）建表语句，创建外部表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E9%83%A8%E9%97%A8%E8%A1%A8\"><span class=\"toc-text\">创建部门表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%91%98%E5%B7%A5%E8%A1%A8\"><span class=\"toc-text\">创建员工表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%9A%84%E8%A1%A8\"><span class=\"toc-text\">（ 3 ）查看创建的表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-20\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%A1%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 4 ）查看表格式化数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E5%88%A0%E9%99%A4%E5%A4%96%E9%83%A8%E8%A1%A8\"><span class=\"toc-text\">（ 5 ）删除外部表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%96%E9%83%A8%E8%A1%A8%E5%88%A0%E9%99%A4%E5%90%8E%EF%BC%8Chdfs%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%98%E5%9C%A8%EF%BC%8C%E4%BD%86%E6%98%AFmetadata%E4%B8%ADdept%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%B7%B2%E8%A2%AB%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">外部表删除后，hdfs中的数据还在，但是metadata中dept的元数据已被删除</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-5-3-%E7%AE%A1%E7%90%86%E8%A1%A8%E4%B8%8E%E5%A4%96%E9%83%A8%E8%A1%A8%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E6%8D%A2\"><span class=\"toc-text\">4 .5.3 管理表与外部表的互相转换</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">（ 1 ）查询表的类型</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E4%BF%AE%E6%94%B9%E5%86%85%E9%83%A8%E8%A1%A8student-2-%E4%B8%BA%E5%A4%96%E9%83%A8%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）修改内部表student 2 为外部表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">（ 3 ）查询表的类型</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E4%BF%AE%E6%94%B9%E5%A4%96%E9%83%A8%E8%A1%A8student-2-%E4%B8%BA%E5%86%85%E9%83%A8%E8%A1%A8\"><span class=\"toc-text\">（ 4 ）修改外部表student 2 为内部表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">（ 5 ）查询表的类型</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A-%E2%80%98EXTERNAL%E2%80%99-x3D-%E2%80%99TRUE%E2%80%99-%E5%92%8C-%E2%80%98EXTERNAL%E2%80%99-x3D-%E2%80%99FALSE%E2%80%99-%E4%B8%BA%E5%9B%BA%E5%AE%9A%E5%86%99%E6%B3%95%EF%BC%8C%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99%EF%BC%81\"><span class=\"toc-text\">注意：(‘EXTERNAL’&#x3D;’TRUE’)和(‘EXTERNAL’&#x3D;’FALSE’)为固定写法，区分大小写！</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-6-%E4%BF%AE%E6%94%B9%E8%A1%A8\"><span class=\"toc-text\">4 .6 修改表</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-6-1-%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8\"><span class=\"toc-text\">4 .6.1 重命名表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">1 ）语法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">2 ）实操案例</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-6-2-%E5%A2%9E%E5%8A%A0%E3%80%81%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4%E8%A1%A8%E5%88%86%E5%8C%BA\"><span class=\"toc-text\">4 .6.2 增加、修改和删除表分区</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%817-1%E7%AB%A0%E5%88%86%E5%8C%BA%E8%A1%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">详见7.1章分区表基本操作。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-6-3-%E5%A2%9E%E5%8A%A0-x2F-%E4%BF%AE%E6%94%B9-x2F-%E6%9B%BF%E6%8D%A2%E5%88%97%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">4 .6.3 增加 &#x2F; 修改 &#x2F; 替换列信息</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%AF%AD%E6%B3%95-1\"><span class=\"toc-text\">1 ）语法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9B%B4%E6%96%B0%E5%88%97\"><span class=\"toc-text\">（ 1 ）更新列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%A2%9E%E5%8A%A0%E5%92%8C%E6%9B%BF%E6%8D%A2%E5%88%97\"><span class=\"toc-text\">（ 2 ）增加和替换列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-21\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%EF%BC%9AADD%E6%98%AF%E4%BB%A3%E8%A1%A8%E6%96%B0%E5%A2%9E%E4%B8%80%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%AD%97%E6%AE%B5%E4%BD%8D%E7%BD%AE%E5%9C%A8%E6%89%80%E6%9C%89%E5%88%97%E5%90%8E%E9%9D%A2-partition%E5%88%97%E5%89%8D-%EF%BC%8C\"><span class=\"toc-text\">注：ADD是代表新增一字段，字段位置在所有列后面(partition列前)，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#REPLACE%E5%88%99%E6%98%AF%E8%A1%A8%E7%A4%BA%E6%9B%BF%E6%8D%A2%E8%A1%A8%E4%B8%AD%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5%E3%80%82\"><span class=\"toc-text\">REPLACE则是表示替换表中所有字段。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B-1\"><span class=\"toc-text\">2 ）实操案例</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">（ 1 ）查询表结构</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%B7%BB%E5%8A%A0%E5%88%97\"><span class=\"toc-text\">（ 2 ）添加列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">（ 3 ）查询表结构</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9B%B4%E6%96%B0%E5%88%97\"><span class=\"toc-text\">（ 4 ）更新列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">（ 5 ）查询表结构</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-6-%EF%BC%89%E6%9B%BF%E6%8D%A2%E5%88%97\"><span class=\"toc-text\">（ 6 ）替换列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-7-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">（ 7 ）查询表结构</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#4-7-%E5%88%A0%E9%99%A4%E8%A1%A8\"><span class=\"toc-text\">4 .7 删除表</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-5-%E7%AB%A0-DML%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">第 5 章 DML数据操作</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5\"><span class=\"toc-text\">5 .1 数据导入</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-1-%E5%90%91%E8%A1%A8%E4%B8%AD%E8%A3%85%E8%BD%BD%E6%95%B0%E6%8D%AE%EF%BC%88-Load-%EF%BC%89\"><span class=\"toc-text\">5 .1.1 向表中装载数据（ Load ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%AF%AD%E6%B3%95-2\"><span class=\"toc-text\">1 ）语法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89load-data-%E8%A1%A8%E7%A4%BA%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 1 ）load data:表示加载数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89local-%E8%A1%A8%E7%A4%BA%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0hive%E8%A1%A8%EF%BC%9B%E5%90%A6%E5%88%99%E4%BB%8EHDFS%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0hive%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）local:表示从本地加载数据到hive表；否则从HDFS加载数据到hive表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89inpath-%E8%A1%A8%E7%A4%BA%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">（ 3 ）inpath:表示加载数据的路径</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89overwrite-%E8%A1%A8%E7%A4%BA%E8%A6%86%E7%9B%96%E8%A1%A8%E4%B8%AD%E5%B7%B2%E6%9C%89%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%90%A6%E5%88%99%E8%A1%A8%E7%A4%BA%E8%BF%BD%E5%8A%A0\"><span class=\"toc-text\">（ 4 ）overwrite:表示覆盖表中已有数据，否则表示追加</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89into-table-%E8%A1%A8%E7%A4%BA%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%93%AA%E5%BC%A0%E8%A1%A8\"><span class=\"toc-text\">（ 5 ）into table:表示加载到哪张表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-6-%EF%BC%89student-%E8%A1%A8%E7%A4%BA%E5%85%B7%E4%BD%93%E7%9A%84%E8%A1%A8\"><span class=\"toc-text\">（ 6 ）student:表示具体的表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-22\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-7-%EF%BC%89partition-%E8%A1%A8%E7%A4%BA%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%8C%87%E5%AE%9A%E5%88%86%E5%8C%BA\"><span class=\"toc-text\">（ 7 ）partition:表示上传到指定分区</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B-2\"><span class=\"toc-text\">2 ）实操案例</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-0-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E8%A1%A8\"><span class=\"toc-text\">（ 0 ）创建一张表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%88%B0hive\"><span class=\"toc-text\">（ 1 ）加载本地文件到hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%8A%A0%E8%BD%BDHDFS%E6%96%87%E4%BB%B6%E5%88%B0hive%E4%B8%AD\"><span class=\"toc-text\">（ 2 ）加载HDFS文件到hive中</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0HDFS\"><span class=\"toc-text\">上传文件到HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BDHDFS%E4%B8%8A%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">加载HDFS上数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%A6%86%E7%9B%96%E8%A1%A8%E4%B8%AD%E5%B7%B2%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 3 ）加载数据覆盖表中已有的数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0HDFS-1\"><span class=\"toc-text\">上传文件到HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%A6%86%E7%9B%96%E8%A1%A8%E4%B8%AD%E5%B7%B2%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">加载数据覆盖表中已有的数据</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-2-%E9%80%9A%E8%BF%87%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E5%90%91%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%EF%BC%88-Insert-%EF%BC%89\"><span class=\"toc-text\">5 .1.2 通过查询语句向表中插入数据（ Insert ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E8%A1%A8\"><span class=\"toc-text\">1 ）创建一张表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%9F%BA%E6%9C%AC%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">2 ）基本插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%9F%BA%E6%9C%AC%E6%A8%A1%E5%BC%8F%E6%8F%92%E5%85%A5%EF%BC%88%E6%A0%B9%E6%8D%AE%E5%8D%95%E5%BC%A0%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%EF%BC%89\"><span class=\"toc-text\">3 ）基本模式插入（根据单张表查询结果）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#insert-into%EF%BC%9A%E4%BB%A5%E8%BF%BD%E5%8A%A0%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8F%92%E5%85%A5%E5%88%B0%E8%A1%A8%E6%88%96%E5%88%86%E5%8C%BA%EF%BC%8C%E5%8E%9F%E6%9C%89%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%BC%9A%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">insert into：以追加数据的方式插入到表或分区，原有数据不会删除</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#insert-overwrite%EF%BC%9A%E4%BC%9A%E8%A6%86%E7%9B%96%E8%A1%A8%E4%B8%AD%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">insert overwrite：会覆盖表中已存在的数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9Ainsert%E4%B8%8D%E6%94%AF%E6%8C%81%E6%8F%92%E5%85%A5%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5\"><span class=\"toc-text\">注意：insert不支持插入部分字段</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%A4%9A%E8%A1%A8%EF%BC%88%E5%A4%9A%E5%88%86%E5%8C%BA%EF%BC%89%E6%8F%92%E5%85%A5%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%A0%B9%E6%8D%AE%E5%A4%9A%E5%BC%A0%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%EF%BC%89\"><span class=\"toc-text\">4 ）多表（多分区）插入模式（根据多张表查询结果）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-23\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-3-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%B9%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%EF%BC%88-As-Select-%EF%BC%89\"><span class=\"toc-text\">5 .1.3 查询语句中创建表并加载数据（ As Select ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%814-5-1%E7%AB%A0%E5%88%9B%E5%BB%BA%E8%A1%A8%E3%80%82\"><span class=\"toc-text\">详见4.5.1章创建表。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%88%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%9C%E4%BC%9A%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%96%B0%E5%88%9B%E5%BB%BA%E7%9A%84%E8%A1%A8%E4%B8%AD%EF%BC%89\"><span class=\"toc-text\">根据查询结果创建表（查询的结果会添加到新创建的表中）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-4-%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E9%80%9A%E8%BF%87-Location-%E6%8C%87%E5%AE%9A%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">5 .1.4 创建表时通过 Location 指定加载数据路径</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E5%88%B0-hdfs-%E4%B8%8A\"><span class=\"toc-text\">1 ）上传数据到 hdfs 上</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%8C%E5%B9%B6%E6%8C%87%E5%AE%9A%E5%9C%A8-hdfs-%E4%B8%8A%E7%9A%84%E4%BD%8D%E7%BD%AE\"><span class=\"toc-text\">2 ）创建表，并指定在 hdfs 上的位置</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">3 ）查询数据</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-1-5-Import-%E6%95%B0%E6%8D%AE%E5%88%B0%E6%8C%87%E5%AE%9A-Hive-%E8%A1%A8%E4%B8%AD\"><span class=\"toc-text\">5.1.5 Import 数据到指定 Hive 表中</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%85%88%E7%94%A8export%E5%AF%BC%E5%87%BA%E5%90%8E%EF%BC%8C%E5%86%8D%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E3%80%82\"><span class=\"toc-text\">注意：先用export导出后，再将数据导入。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">5 .2 数据导出</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-1-Insert-%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">5.2.1 Insert 导出</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%9C%E5%AF%BC%E5%87%BA%E5%88%B0%E6%9C%AC%E5%9C%B0\"><span class=\"toc-text\">1 ）将查询的结果导出到本地</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%9C%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AF%BC%E5%87%BA%E5%88%B0%E6%9C%AC%E5%9C%B0\"><span class=\"toc-text\">2 ）将查询的结果格式化导出到本地</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%9C%E5%AF%BC%E5%87%BA%E5%88%B0-HDFS-%E4%B8%8A-%E6%B2%A1%E6%9C%89-local\"><span class=\"toc-text\">3 ）将查询的结果导出到 HDFS 上 ( 没有 local)</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-2-Hadoop-%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA%E5%88%B0%E6%9C%AC%E5%9C%B0\"><span class=\"toc-text\">5.2.2 Hadoop 命令导出到本地</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-24\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-3-Hive-Shell-%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">5.2.3 Hive Shell 命令导出</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%EF%BC%9A%EF%BC%88hive-f-x2F-e-%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E6%88%96%E8%80%85%E8%84%9A%E6%9C%AC-gt-file%EF%BC%89\"><span class=\"toc-text\">基本语法：（hive -f&#x2F;-e 执行语句或者脚本 &gt; file）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-4-Export-%E5%AF%BC%E5%87%BA%E5%88%B0-HDFS-%E4%B8%8A\"><span class=\"toc-text\">5.2.4 Export 导出到 HDFS 上</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#export%E5%92%8Cimport%E4%B8%BB%E8%A6%81%E7%94%A8%E4%BA%8E%E4%B8%A4%E4%B8%AAHadoop%E5%B9%B3%E5%8F%B0%E9%9B%86%E7%BE%A4%E4%B9%8B%E9%97%B4Hive%E8%A1%A8%E8%BF%81%E7%A7%BB%E3%80%82\"><span class=\"toc-text\">export和import主要用于两个Hadoop平台集群之间Hive表迁移。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-5-Sqoop-%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">5.2.5 Sqoop 导出</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%BB%AD%E8%AF%BE%E7%A8%8B%E4%B8%93%E9%97%A8%E8%AE%B2%E3%80%82\"><span class=\"toc-text\">后续课程专门讲。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#5-2-6-%E6%B8%85%E9%99%A4%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%EF%BC%88-Truncate-%EF%BC%89\"><span class=\"toc-text\">5.2.6 清除表中数据（ Truncate ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9ATruncate%E5%8F%AA%E8%83%BD%E5%88%A0%E9%99%A4%E7%AE%A1%E7%90%86%E8%A1%A8%EF%BC%8C%E4%B8%8D%E8%83%BD%E5%88%A0%E9%99%A4%E5%A4%96%E9%83%A8%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">注意：Truncate只能删除管理表，不能删除外部表中数据</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-6-%E7%AB%A0-%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">第 6 章 查询</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#https-cwiki-apache-org-confluence-display-Hive-LanguageManual-Select\"><span class=\"toc-text\">https:&#x2F;&#x2F;cwiki.apache.org&#x2F;confluence&#x2F;display&#x2F;Hive&#x2F;LanguageManual+Select</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E8%AF%AD%E6%B3%95%EF%BC%9A\"><span class=\"toc-text\">查询语句语法：</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%EF%BC%88-Select%E2%80%A6From-%EF%BC%89\"><span class=\"toc-text\">6 .1 基本查询（ Select…From ）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-1-%E5%85%A8%E8%A1%A8%E5%92%8C%E7%89%B9%E5%AE%9A%E5%88%97%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">6 .1.1 全表和特定列查询</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#0-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">0 ）数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-0-%EF%BC%89%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">（ 0 ）原始数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#dept-1\"><span class=\"toc-text\">dept:</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#emp%EF%BC%9A-1\"><span class=\"toc-text\">emp：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-25\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E9%83%A8%E9%97%A8%E8%A1%A8\"><span class=\"toc-text\">（ 1 ）创建部门表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%91%98%E5%B7%A5%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）创建员工表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 3 ）导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%85%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">1 ）全表查询</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E9%80%89%E6%8B%A9%E7%89%B9%E5%AE%9A%E5%88%97%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">2 ）选择特定列查询</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A\"><span class=\"toc-text\">注意：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89SQL-%E8%AF%AD%E8%A8%80%E5%A4%A7%E5%B0%8F%E5%86%99%E4%B8%8D%E6%95%8F%E6%84%9F%E3%80%82\"><span class=\"toc-text\">（ 1 ）SQL 语言大小写不敏感。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89SQL-%E5%8F%AF%E4%BB%A5%E5%86%99%E5%9C%A8%E4%B8%80%E8%A1%8C%E6%88%96%E8%80%85%E5%A4%9A%E8%A1%8C\"><span class=\"toc-text\">（ 2 ）SQL 可以写在一行或者多行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8D%E8%83%BD%E8%A2%AB%E7%BC%A9%E5%86%99%E4%B9%9F%E4%B8%8D%E8%83%BD%E5%88%86%E8%A1%8C\"><span class=\"toc-text\">（ 3 ）关键字不能被缩写也不能分行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E5%90%84%E5%AD%90%E5%8F%A5%E4%B8%80%E8%88%AC%E8%A6%81%E5%88%86%E8%A1%8C%E5%86%99%E3%80%82\"><span class=\"toc-text\">（ 4 ）各子句一般要分行写。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-26\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E4%BD%BF%E7%94%A8%E7%BC%A9%E8%BF%9B%E6%8F%90%E9%AB%98%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%8F%AF%E8%AF%BB%E6%80%A7%E3%80%82\"><span class=\"toc-text\">（ 5 ）使用缩进提高语句的可读性。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-2-%E5%88%97%E5%88%AB%E5%90%8D\"><span class=\"toc-text\">6 .1.2 列别名</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%80%E4%B8%AA%E5%88%97\"><span class=\"toc-text\">1 ）重命名一个列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%BE%BF%E4%BA%8E%E8%AE%A1%E7%AE%97\"><span class=\"toc-text\">2 ）便于计算</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E7%B4%A7%E8%B7%9F%E5%88%97%E5%90%8D%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%88%97%E5%90%8D%E5%92%8C%E5%88%AB%E5%90%8D%E4%B9%8B%E9%97%B4%E5%8A%A0%E5%85%A5%E5%85%B3%E9%94%AE%E5%AD%97%E2%80%98-AS-%E2%80%99\"><span class=\"toc-text\">3 ）紧跟列名，也可以在列名和别名之间加入关键字‘ AS ’</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">4 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E5%90%8D%E7%A7%B0%E5%92%8C%E9%83%A8%E9%97%A8\"><span class=\"toc-text\">查询名称和部门</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-3-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6\"><span class=\"toc-text\">6 .1.3 算术运算符</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5%E7%9A%84%E8%96%AA%E6%B0%B4%E5%90%8E%E5%8A%A0-1-%E6%98%BE%E7%A4%BA%E3%80%82\"><span class=\"toc-text\">案例实操：查询出所有员工的薪水后加 1 显示。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-4-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">6 .1.4 常用函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%B1%82%E6%80%BB%E8%A1%8C%E6%95%B0%EF%BC%88-count-%EF%BC%89\"><span class=\"toc-text\">1 ）求总行数（ count ）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%B1%82%E5%B7%A5%E8%B5%84%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%EF%BC%88-max-%EF%BC%89\"><span class=\"toc-text\">2 ）求工资的最大值（ max ）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%B1%82%E5%B7%A5%E8%B5%84%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC%EF%BC%88-min-%EF%BC%89\"><span class=\"toc-text\">3 ）求工资的最小值（ min ）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E6%B1%82%E5%B7%A5%E8%B5%84%E7%9A%84%E6%80%BB%E5%92%8C%EF%BC%88-sum-%EF%BC%89\"><span class=\"toc-text\">4 ）求工资的总和（ sum ）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E6%B1%82%E5%B7%A5%E8%B5%84%E7%9A%84%E5%B9%B3%E5%9D%87%E5%80%BC%EF%BC%88-avg-%EF%BC%89\"><span class=\"toc-text\">5 ）求工资的平均值（ avg ）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-5-Limit-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6.1.5 Limit 语句</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%B8%E5%9E%8B%E7%9A%84%E6%9F%A5%E8%AF%A2%E4%BC%9A%E8%BF%94%E5%9B%9E%E5%A4%9A%E8%A1%8C%E6%95%B0%E6%8D%AE%E3%80%82LIMIT%E5%AD%90%E5%8F%A5%E7%94%A8%E4%BA%8E%E9%99%90%E5%88%B6%E8%BF%94%E5%9B%9E%E7%9A%84%E8%A1%8C%E6%95%B0%E3%80%82\"><span class=\"toc-text\">典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-27\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-6-Where-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6.1.6 Where 语句</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%BD%BF%E7%94%A8-WHERE-%E5%AD%90%E5%8F%A5%EF%BC%8C%E5%B0%86%E4%B8%8D%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%E7%9A%84%E8%A1%8C%E8%BF%87%E6%BB%A4%E6%8E%89\"><span class=\"toc-text\">1 ）使用 WHERE 子句，将不满足条件的行过滤掉</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-WHERE-%E5%AD%90%E5%8F%A5%E7%B4%A7%E9%9A%8F-FROM-%E5%AD%90%E5%8F%A5\"><span class=\"toc-text\">2 ） WHERE 子句紧随 FROM 子句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-1\"><span class=\"toc-text\">3 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E5%87%BA%E8%96%AA%E6%B0%B4%E5%A4%A7%E4%BA%8E-1000-%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5\"><span class=\"toc-text\">查询出薪水大于 1000 的所有员工</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9Awhere%E5%AD%90%E5%8F%A5%E4%B8%AD%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E5%88%AB%E5%90%8D%E3%80%82\"><span class=\"toc-text\">注意：where子句中不能使用字段别名。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-7-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%88-Between-x2F-In-x2F-Is-Null-%EF%BC%89\"><span class=\"toc-text\">6 .1.7 比较运算符（ Between&#x2F;In&#x2F; Is Null ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%B8%8B%E9%9D%A2%E8%A1%A8%E4%B8%AD%E6%8F%8F%E8%BF%B0%E4%BA%86%E8%B0%93%E8%AF%8D%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E8%BF%99%E4%BA%9B%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%90%8C%E6%A0%B7%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%BA%8E-JOIN%E2%80%A6ON-%E5%92%8C-HAVING-%E8%AF%AD%E5%8F%A5%E4%B8%AD%E3%80%82\"><span class=\"toc-text\">1 ）下面表中描述了谓词操作符，这些操作符同样可以用于 JOIN…ON 和 HAVING 语句中。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-28\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-1\"><span class=\"toc-text\">2 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%87%BA%E8%96%AA%E6%B0%B4%E7%AD%89%E4%BA%8E-5000-%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5\"><span class=\"toc-text\">（ 1 ）查询出薪水等于 5000 的所有员工</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E5%9C%A8-500-%E5%88%B0-1000-%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 2 ）查询工资在 500 到 1000 的员工信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E8%AF%A2comm%E4%B8%BA%E7%A9%BA%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 3 ）查询comm为空的所有员工信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%B7%A5%E8%B5%84%E6%98%AF-1500-%E6%88%96-5000-%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 4 ）查询工资是 1500 或 5000 的员工信息</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-8-Like-%E5%92%8C-RLike\"><span class=\"toc-text\">6.1.8 Like 和 RLike</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%BD%BF%E7%94%A8-LIKE-%E8%BF%90%E7%AE%97%E9%80%89%E6%8B%A9%E7%B1%BB%E4%BC%BC%E7%9A%84%E5%80%BC\"><span class=\"toc-text\">1 ）使用 LIKE 运算选择类似的值</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E9%80%89%E6%8B%A9%E6%9D%A1%E4%BB%B6%E5%8F%AF%E4%BB%A5%E5%8C%85%E5%90%AB%E5%AD%97%E7%AC%A6%E6%88%96%E6%95%B0%E5%AD%97\"><span class=\"toc-text\">2 ）选择条件可以包含字符或数字 :</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E8%A1%A8%E9%9B%B6%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E5%AD%97%E7%AC%A6-%E4%BB%BB%E6%84%8F%E4%B8%AA%E5%AD%97%E7%AC%A6-%E3%80%82\"><span class=\"toc-text\">% 代表零个或多个字符(任意个字符)。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E8%A1%A8%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E3%80%82\"><span class=\"toc-text\">_ 代表一个字符。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-RLIKE-%E5%AD%90%E5%8F%A5\"><span class=\"toc-text\">3 ） RLIKE 子句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#RLIKE%E5%AD%90%E5%8F%A5%E6%98%AFHive%E4%B8%AD%E8%BF%99%E4%B8%AA%E5%8A%9F%E8%83%BD%E7%9A%84%E4%B8%80%E4%B8%AA%E6%89%A9%E5%B1%95%EF%BC%8C%E5%85%B6%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87Java%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%99%E4%B8%AA%E6%9B%B4%E5%BC%BA%E5%A4%A7\"><span class=\"toc-text\">RLIKE子句是Hive中这个功能的一个扩展，其可以通过Java的正则表达式这个更强大</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E8%AF%AD%E8%A8%80%E6%9D%A5%E6%8C%87%E5%AE%9A%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6%E3%80%82\"><span class=\"toc-text\">的语言来指定匹配条件。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-1\"><span class=\"toc-text\">4 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E4%BB%A5A%E5%BC%80%E5%A4%B4%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 1 ）查找名字以A开头的员工信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E4%B8%AD%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%AD%97%E6%AF%8D%E4%B8%BAA%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 2 ）查找名字中第二个字母为A的员工信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E4%B8%AD%E5%B8%A6%E6%9C%89A%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 3 ）查找名字中带有A的员工信息</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-1-9-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%88-And-x2F-Or-x2F-Not-%EF%BC%89\"><span class=\"toc-text\">6 .1.9 逻辑运算符（ And&#x2F;Or&#x2F;Not ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-1\"><span class=\"toc-text\">1 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%96%AA%E6%B0%B4%E5%A4%A7%E4%BA%8E-1000-%EF%BC%8C%E9%83%A8%E9%97%A8%E6%98%AF-30\"><span class=\"toc-text\">（ 1 ）查询薪水大于 1000 ，部门是 30</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-29\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E8%AF%A2%E8%96%AA%E6%B0%B4%E5%A4%A7%E4%BA%8E-1000-%EF%BC%8C%E6%88%96%E8%80%85%E9%83%A8%E9%97%A8%E6%98%AF-30\"><span class=\"toc-text\">（ 2 ）查询薪水大于 1000 ，或者部门是 30</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E8%AF%A2%E9%99%A4%E4%BA%86-20-%E9%83%A8%E9%97%A8%E5%92%8C-30-%E9%83%A8%E9%97%A8%E4%BB%A5%E5%A4%96%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 3 ）查询除了 20 部门和 30 部门以外的员工信息</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-2-%E5%88%86%E7%BB%84\"><span class=\"toc-text\">6 .2 分组</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-2-1-Group-By-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6.2.1 Group By 语句</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#GROUP-BY%E8%AF%AD%E5%8F%A5%E9%80%9A%E5%B8%B8%E4%BC%9A%E5%92%8C%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%8C%89%E7%85%A7%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AA%E5%88%97%E9%98%9F%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%EF%BC%8C%E7%84%B6\"><span class=\"toc-text\">GROUP BY语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%8E%E5%AF%B9%E6%AF%8F%E4%B8%AA%E7%BB%84%E6%89%A7%E8%A1%8C%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">后对每个组执行聚合操作。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A\"><span class=\"toc-text\">1 ）案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%AE%A1%E7%AE%97emp%E8%A1%A8%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84\"><span class=\"toc-text\">（ 1 ）计算emp表每个部门的平均工资</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E8%AE%A1%E7%AE%97emp%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E4%B8%AD%E6%AF%8F%E4%B8%AA%E5%B2%97%E4%BD%8D%E7%9A%84%E6%9C%80%E9%AB%98%E8%96%AA%E6%B0%B4\"><span class=\"toc-text\">（ 2 ）计算emp每个部门中每个岗位的最高薪水</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-2-2-Having-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6.2.2 Having 语句</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-having-%E4%B8%8E-where-%E4%B8%8D%E5%90%8C%E7%82%B9\"><span class=\"toc-text\">1 ） having 与 where 不同点</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89where%E5%90%8E%E9%9D%A2%E4%B8%8D%E8%83%BD%E5%86%99%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0%EF%BC%8C%E8%80%8Chaving%E5%90%8E%E9%9D%A2%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0%E3%80%82\"><span class=\"toc-text\">（ 1 ）where后面不能写分组函数，而having后面可以使用分组函数。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89having%E5%8F%AA%E7%94%A8%E4%BA%8Egroup-by%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1%E8%AF%AD%E5%8F%A5%E3%80%82\"><span class=\"toc-text\">（ 2 ）having只用于group by分组统计语句。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-2\"><span class=\"toc-text\">2 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%B1%82%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E8%96%AA%E6%B0%B4%E5%A4%A7%E4%BA%8E-2000-%E7%9A%84%E9%83%A8%E9%97%A8\"><span class=\"toc-text\">（ 1 ）求每个部门的平均薪水大于 2000 的部门</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B1%82%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84\"><span class=\"toc-text\">求每个部门的平均工资</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B1%82%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E8%96%AA%E6%B0%B4%E5%A4%A7%E4%BA%8E-2000-%E7%9A%84%E9%83%A8%E9%97%A8\"><span class=\"toc-text\">求每个部门的平均薪水大于 2000 的部门</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-Join-%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6.3 Join 语句</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-1-%E7%AD%89%E5%80%BC-Join\"><span class=\"toc-text\">6.3.1 等值 Join</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E6%94%AF%E6%8C%81%E9%80%9A%E5%B8%B8%E7%9A%84SQL-JOIN%E8%AF%AD%E5%8F%A5%E3%80%82\"><span class=\"toc-text\">Hive支持通常的SQL JOIN语句。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-2\"><span class=\"toc-text\">1 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%A0%B9%E6%8D%AE%E5%91%98%E5%B7%A5%E8%A1%A8%E5%92%8C%E9%83%A8%E9%97%A8%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7%E7%9B%B8%E7%AD%89%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E7%BC%96%E5%8F%B7%E3%80%81%E5%91%98%E5%B7%A5%E5%90%8D%E7%A7%B0%E5%92%8C%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0%EF%BC%9B\"><span class=\"toc-text\">（ 1 ）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-30\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-2-%E8%A1%A8%E7%9A%84%E5%88%AB%E5%90%8D\"><span class=\"toc-text\">6 .3.2 表的别名</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%A5%BD%E5%A4%84\"><span class=\"toc-text\">1 ）好处</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E4%BD%BF%E7%94%A8%E5%88%AB%E5%90%8D%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8C%96%E6%9F%A5%E8%AF%A2%E3%80%82\"><span class=\"toc-text\">（ 1 ）使用别名可以简化查询。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%90%8D%E5%89%8D%E7%BC%80%E5%8F%AF%E4%BB%A5%E6%8F%90%E9%AB%98%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87%E3%80%82\"><span class=\"toc-text\">（ 2 ）使用表名前缀可以提高执行效率。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-3\"><span class=\"toc-text\">2 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%88%E5%B9%B6%E5%91%98%E5%B7%A5%E8%A1%A8%E5%92%8C%E9%83%A8%E9%97%A8%E8%A1%A8\"><span class=\"toc-text\">合并员工表和部门表</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-3-%E5%86%85%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6 .3.3 内连接</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%9A%E5%8F%AA%E6%9C%89%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E7%9A%84%E4%B8%A4%E4%B8%AA%E8%A1%A8%E4%B8%AD%E9%83%BD%E5%AD%98%E5%9C%A8%E4%B8%8E%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6%E7%9B%B8%E5%8C%B9%E9%85%8D%E7%9A%84%E6%95%B0%E6%8D%AE%E6%89%8D%E4%BC%9A%E8%A2%AB%E4%BF%9D%E7%95%99%E4%B8%8B%E6%9D%A5%E3%80%82\"><span class=\"toc-text\">内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-4-%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6 .3.4 左外连接</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%9AJOIN%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%B7%A6%E8%BE%B9%E8%A1%A8%E4%B8%AD%E7%AC%A6%E5%90%88WHERE%E5%AD%90%E5%8F%A5%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%E5%B0%86%E4%BC%9A%E8%A2%AB%E8%BF%94%E5%9B%9E%E3%80%82\"><span class=\"toc-text\">左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-5-%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6 .3.5 右外连接</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%9AJOIN%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%8F%B3%E8%BE%B9%E8%A1%A8%E4%B8%AD%E7%AC%A6%E5%90%88WHERE%E5%AD%90%E5%8F%A5%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%E5%B0%86%E4%BC%9A%E8%A2%AB%E8%BF%94%E5%9B%9E%E3%80%82\"><span class=\"toc-text\">右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-6-%E6%BB%A1%E5%A4%96%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6 .3.6 满外连接</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%BB%A1%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%9A%E5%B0%86%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%89%80%E6%9C%89%E8%A1%A8%E4%B8%AD%E7%AC%A6%E5%90%88WHERE%E8%AF%AD%E5%8F%A5%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%E3%80%82%E5%A6%82%E6%9E%9C%E4%BB%BB%E4%B8%80%E8%A1%A8%E7%9A%84%E6%8C%87%E5%AE%9A%E5%AD%97\"><span class=\"toc-text\">满外连接：将会返回所有表中符合WHERE语句条件的所有记录。如果任一表的指定字</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%AE%B5%E6%B2%A1%E6%9C%89%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%80%BC%E7%9A%84%E8%AF%9D%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E4%BD%BF%E7%94%A8NULL%E5%80%BC%E6%9B%BF%E4%BB%A3%E3%80%82\"><span class=\"toc-text\">段没有符合条件的值的话，那么就使用NULL值替代。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-7-%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6 .3.7 多表连接</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E8%BF%9E%E6%8E%A5-n%E4%B8%AA%E8%A1%A8%EF%BC%8C%E8%87%B3%E5%B0%91%E9%9C%80%E8%A6%81n-1-%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%9A%E8%BF%9E%E6%8E%A5%E4%B8%89%E4%B8%AA%E8%A1%A8%EF%BC%8C%E8%87%B3%E5%B0%91%E9%9C%80%E8%A6%81%E4%B8%A4%E4%B8%AA%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">注意：连接 n个表，至少需要n- 1 个连接条件。例如：连接三个表，至少需要两个连接</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6%E3%80%82\"><span class=\"toc-text\">条件。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%BD%8D%E7%BD%AE%E8%A1%A8\"><span class=\"toc-text\">1 ）创建位置表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-31\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">2 ）导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">3 ）多表连接查询</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E5%A4%9A%E6%95%B0%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CHive%E4%BC%9A%E5%AF%B9%E6%AF%8F%E5%AF%B9JOIN%E8%BF%9E%E6%8E%A5%E5%AF%B9%E8%B1%A1%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAMapReduce%E4%BB%BB%E5%8A%A1%E3%80%82%E6%9C%AC%E4%BE%8B%E4%B8%AD%E4%BC%9A%E9%A6%96%E5%85%88\"><span class=\"toc-text\">大多数情况下，Hive会对每对JOIN连接对象启动一个MapReduce任务。本例中会首先</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAMapReduce-job%E5%AF%B9%E8%A1%A8e%E5%92%8C%E8%A1%A8d%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9C%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BC%9A%E5%86%8D%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAMapReduce-job%E5%B0%86\"><span class=\"toc-text\">启动一个MapReduce job对表e和表d进行连接操作，然后会再启动一个MapReduce job将</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E4%B8%AAMapReduce-job%E7%9A%84%E8%BE%93%E5%87%BA%E5%92%8C%E8%A1%A8l-%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">第一个MapReduce job的输出和表l;进行连接操作。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF%E8%A1%A8d%E5%92%8C%E8%A1%A8l%E5%85%88%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9C%E5%91%A2%EF%BC%9F%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BAHive%E6%80%BB%E6%98%AF%E6%8C%89%E7%85%A7%E4%BB%8E%E5%B7%A6%E5%88%B0%E5%8F%B3%E7%9A%84\"><span class=\"toc-text\">注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%E7%9A%84%E3%80%82\"><span class=\"toc-text\">顺序执行的。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BC%98%E5%8C%96%EF%BC%9A%E5%BD%93%E5%AF%B9-3-%E4%B8%AA%E6%88%96%E8%80%85%E6%9B%B4%E5%A4%9A%E8%A1%A8%E8%BF%9B%E8%A1%8Cjoin%E8%BF%9E%E6%8E%A5%E6%97%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%AF%8F%E4%B8%AAon%E5%AD%90%E5%8F%A5%E9%83%BD%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%90%8C%E7%9A%84%E8%BF%9E%E6%8E%A5%E9%94%AE%E7%9A%84\"><span class=\"toc-text\">优化：当对 3 个或者更多表进行join连接时，如果每个on子句都使用相同的连接键的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%9D%EF%BC%8C%E9%82%A3%E4%B9%88%E5%8F%AA%E4%BC%9A%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AAMapReduce-job%E3%80%82\"><span class=\"toc-text\">话，那么只会产生一个MapReduce job。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-3-8-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF\"><span class=\"toc-text\">6 .3.8 笛卡尔积</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%AC%9B%E5%8D%A1%E5%B0%94%E9%9B%86%E4%BC%9A%E5%9C%A8%E4%B8%8B%E9%9D%A2%E6%9D%A1%E4%BB%B6%E4%B8%8B%E4%BA%A7%E7%94%9F\"><span class=\"toc-text\">1 ）笛卡尔集会在下面条件下产生</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E7%9C%81%E7%95%A5%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6\"><span class=\"toc-text\">（ 1 ）省略连接条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6%E6%97%A0%E6%95%88\"><span class=\"toc-text\">（ 2 ）连接条件无效</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%89%80%E6%9C%89%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E8%A1%8C%E4%BA%92%E7%9B%B8%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">（ 3 ）所有表中的所有行互相连接</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-4\"><span class=\"toc-text\">2 ）案例实操</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">6 .4 排序</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-1-%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%EF%BC%88-Order-By-%EF%BC%89\"><span class=\"toc-text\">6.4.1 全局排序（ Order By ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Order-By%EF%BC%9A%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%EF%BC%8C%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AAReducer\"><span class=\"toc-text\">Order By：全局排序，只有一个Reducer</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%BD%BF%E7%94%A8-ORDER-BY-%E5%AD%90%E5%8F%A5%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">1 ）使用 ORDER BY 子句排序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ASC%EF%BC%88ascend%EF%BC%89-%E5%8D%87%E5%BA%8F%EF%BC%88%E9%BB%98%E8%AE%A4%EF%BC%89\"><span class=\"toc-text\">ASC（ascend）: 升序（默认）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#DESC%EF%BC%88descend%EF%BC%89-%E9%99%8D%E5%BA%8F\"><span class=\"toc-text\">DESC（descend）: 降序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-32\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-ORDER-BY-%E5%AD%90%E5%8F%A5%E5%9C%A8-SELECT-%E8%AF%AD%E5%8F%A5%E7%9A%84%E7%BB%93%E5%B0%BE\"><span class=\"toc-text\">2 ） ORDER BY 子句在 SELECT 语句的结尾</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-2\"><span class=\"toc-text\">3 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E6%8C%89%E5%B7%A5%E8%B5%84%E5%8D%87%E5%BA%8F%E6%8E%92%E5%88%97\"><span class=\"toc-text\">（ 1 ）查询员工信息按工资升序排列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E6%8C%89%E5%B7%A5%E8%B5%84%E9%99%8D%E5%BA%8F%E6%8E%92%E5%88%97\"><span class=\"toc-text\">（ 2 ）查询员工信息按工资降序排列</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-2-%E6%8C%89%E7%85%A7%E5%88%AB%E5%90%8D%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">6 .4.2 按照别名排序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8C%89%E7%85%A7%E5%91%98%E5%B7%A5%E8%96%AA%E6%B0%B4%E7%9A%84-2-%E5%80%8D%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">按照员工薪水的 2 倍排序</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-3-%E5%A4%9A%E4%B8%AA%E5%88%97%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">6 .4.3 多个列排序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8C%89%E7%85%A7%E9%83%A8%E9%97%A8%E5%92%8C%E5%B7%A5%E8%B5%84%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">按照部门和工资升序排序</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-4-%E6%AF%8F%E4%B8%AA-Reduce-%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%EF%BC%88-Sort-By-%EF%BC%89\"><span class=\"toc-text\">6 .4.4 每个 Reduce 内部排序（ Sort By ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Sort-By%EF%BC%9A%E5%AF%B9%E4%BA%8E%E5%A4%A7%E8%A7%84%E6%A8%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86order-by%E7%9A%84%E6%95%88%E7%8E%87%E9%9D%9E%E5%B8%B8%E4%BD%8E%E3%80%82%E5%9C%A8%E5%BE%88%E5%A4%9A%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%B9%B6%E4%B8%8D%E9%9C%80%E8%A6%81%E5%85%A8%E5%B1%80%E6%8E%92\"><span class=\"toc-text\">Sort By：对于大规模的数据集order by的效率非常低。在很多情况下，并不需要全局排</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BA%8F%EF%BC%8C%E6%AD%A4%E6%97%B6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-sort-by-%E3%80%82\"><span class=\"toc-text\">序，此时可以使用 sort by 。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Sort-by%E4%B8%BA%E6%AF%8F%E4%B8%AAreducer%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AA%E6%8E%92%E5%BA%8F%E6%96%87%E4%BB%B6%E3%80%82%E6%AF%8F%E4%B8%AAReducer%E5%86%85%E9%83%A8%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%EF%BC%8C%E5%AF%B9%E5%85%A8%E5%B1%80%E7%BB%93%E6%9E%9C%E9%9B%86\"><span class=\"toc-text\">Sort by为每个reducer产生一个排序文件。每个Reducer内部进行排序，对全局结果集</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A5%E8%AF%B4%E4%B8%8D%E6%98%AF%E6%8E%92%E5%BA%8F%E3%80%82\"><span class=\"toc-text\">来说不是排序。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%AE%BE%E7%BD%AE-reduce-%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">1 ）设置 reduce 个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%AE%BE%E7%BD%AE-reduce-%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">2 ）查看设置 reduce 个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%A0%B9%E6%8D%AE%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7%E9%99%8D%E5%BA%8F%E6%9F%A5%E7%9C%8B%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">3 ）根据部门编号降序查看员工信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%AF%BC%E5%85%A5%E5%88%B0%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%88%E6%8C%89%E7%85%A7%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7%E9%99%8D%E5%BA%8F%E6%8E%92%E5%BA%8F%EF%BC%89\"><span class=\"toc-text\">4 ）将查询结果导入到文件中（按照部门编号降序排序）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-5-%E5%88%86%E5%8C%BA%EF%BC%88-Distribute-By-%EF%BC%89\"><span class=\"toc-text\">6 .4.5 分区（ Distribute By ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Distribute-By%EF%BC%9A-%E5%9C%A8%E6%9C%89%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E6%8E%A7%E5%88%B6%E6%9F%90%E4%B8%AA%E7%89%B9%E5%AE%9A%E8%A1%8C%E5%BA%94%E8%AF%A5%E5%88%B0%E5%93%AA%E4%B8%AAreducer%EF%BC%8C%E9%80%9A%E5%B8%B8%E6%98%AF%E4%B8%BA\"><span class=\"toc-text\">Distribute By： 在有些情况下，我们需要控制某个特定行应该到哪个reducer，通常是为</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BA%86%E8%BF%9B%E8%A1%8C%E5%90%8E%E7%BB%AD%E7%9A%84%E8%81%9A%E9%9B%86%E6%93%8D%E4%BD%9C%E3%80%82-distribute-by-%E5%AD%90%E5%8F%A5%E5%8F%AF%E4%BB%A5%E5%81%9A%E8%BF%99%E4%BB%B6%E4%BA%8B%E3%80%82-distribute-by-%E7%B1%BB%E4%BC%BCMR%E4%B8%ADpartition\"><span class=\"toc-text\">了进行后续的聚集操作。 distribute by 子句可以做这件事。 distribute by 类似MR中partition</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E5%8C%BA%EF%BC%89%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%88%86%E5%8C%BA%EF%BC%8C%E7%BB%93%E5%90%88sort-by%E4%BD%BF%E7%94%A8%E3%80%82\"><span class=\"toc-text\">（自定义分区），进行分区，结合sort by使用。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E4%BA%8Edistribute-by%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E4%B8%80%E5%AE%9A%E8%A6%81%E5%88%86%E9%85%8D%E5%A4%9Areduce%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E5%90%A6%E5%88%99%E6%97%A0%E6%B3%95%E7%9C%8B%E5%88%B0distribute\"><span class=\"toc-text\">对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#by%E7%9A%84%E6%95%88%E6%9E%9C%E3%80%82\"><span class=\"toc-text\">by的效果。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-33\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-1\"><span class=\"toc-text\">1 ）案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%85%88%E6%8C%89%E7%85%A7%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7%E5%88%86%E5%8C%BA%EF%BC%8C%E5%86%8D%E6%8C%89%E7%85%A7%E5%91%98%E5%B7%A5%E7%BC%96%E5%8F%B7%E9%99%8D%E5%BA%8F%E6%8E%92%E5%BA%8F%E3%80%82\"><span class=\"toc-text\">（ 1 ）先按照部门编号分区，再按照员工编号降序排序。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A-1\"><span class=\"toc-text\">注意：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%9E%A2-distribute-by%E7%9A%84%E5%88%86%E5%8C%BA%E8%A7%84%E5%88%99%E6%98%AF%E6%A0%B9%E6%8D%AE%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E7%9A%84hash%E7%A0%81%E4%B8%8Ereduce%E7%9A%84%E4%B8%AA%E6%95%B0%E8%BF%9B%E8%A1%8C%E6%A8%A1%E9%99%A4%E5%90%8E%EF%BC%8C\"><span class=\"toc-text\">➢ distribute by的分区规则是根据分区字段的hash码与reduce的个数进行模除后，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%99%E6%95%B0%E7%9B%B8%E5%90%8C%E7%9A%84%E5%88%86%E5%88%B0%E4%B8%80%E4%B8%AA%E5%8C%BA%E3%80%82\"><span class=\"toc-text\">余数相同的分到一个区。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%9E%A2-Hive%E8%A6%81%E6%B1%82DISTRIBUTE-BY%E8%AF%AD%E5%8F%A5%E8%A6%81%E5%86%99%E5%9C%A8SORT-BY%E8%AF%AD%E5%8F%A5%E4%B9%8B%E5%89%8D%E3%80%82\"><span class=\"toc-text\">➢ Hive要求DISTRIBUTE BY语句要写在SORT BY语句之前。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#6-4-6-Cluster-By\"><span class=\"toc-text\">6.4.6 Cluster By</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93distribute-by%E5%92%8Csorts-by%E5%AD%97%E6%AE%B5%E7%9B%B8%E5%90%8C%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8cluster-by%E6%96%B9%E5%BC%8F%E3%80%82\"><span class=\"toc-text\">当distribute by和sorts by字段相同时，可以使用cluster by方式。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#cluster-by%E9%99%A4%E4%BA%86%E5%85%B7%E6%9C%89distribute-by%E7%9A%84%E5%8A%9F%E8%83%BD%E5%A4%96%E8%BF%98%E5%85%BC%E5%85%B7sort-by%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%E4%BD%86%E6%98%AF%E6%8E%92%E5%BA%8F%E5%8F%AA%E8%83%BD%E6%98%AF%E5%8D%87%E5%BA%8F\"><span class=\"toc-text\">cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序只能是升序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8E%92%E5%BA%8F%EF%BC%8C%E4%B8%8D%E8%83%BD%E6%8C%87%E5%AE%9A%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E4%B8%BAASC%E6%88%96%E8%80%85DESC%E3%80%82\"><span class=\"toc-text\">排序，不能指定排序规则为ASC或者DESC。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E4%BB%A5%E4%B8%8B%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95%E7%AD%89%E4%BB%B7\"><span class=\"toc-text\">（ 1 ）以下两种写法等价</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%8C%89%E7%85%A7%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7%E5%88%86%E5%8C%BA%EF%BC%8C%E4%B8%8D%E4%B8%80%E5%AE%9A%E5%B0%B1%E6%98%AF%E5%9B%BA%E5%AE%9A%E6%AD%BB%E7%9A%84%E6%95%B0%E5%80%BC%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%98%AF-20-%E5%8F%B7%E5%92%8C-30-%E5%8F%B7%E9%83%A8%E9%97%A8%E5%88%86%E5%88%B0%E4%B8%80\"><span class=\"toc-text\">注意：按照部门编号分区，不一定就是固定死的数值，可以是 20 号和 30 号部门分到一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AA%E5%88%86%E5%8C%BA%E9%87%8C%E9%9D%A2%E5%8E%BB%E3%80%82\"><span class=\"toc-text\">个分区里面去。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-7-%E7%AB%A0-%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E5%88%86%E6%A1%B6%E8%A1%A8\"><span class=\"toc-text\">第 7 章 分区表和分桶表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#7-1-%E5%88%86%E5%8C%BA%E8%A1%A8\"><span class=\"toc-text\">7.1 分区表</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#7-2-%E5%88%86%E6%A1%B6%E8%A1%A8\"><span class=\"toc-text\">7.2 分桶表</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-8-%E7%AB%A0-%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">第 8 章 函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-1-%E7%B3%BB%E7%BB%9F%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .1 系统内置函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E7%9A%84%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">1 ）查看系统自带的函数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%98%BE%E7%A4%BA%E8%87%AA%E5%B8%A6%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">2 ）显示自带的函数的用法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E8%AF%A6%E7%BB%86%E6%98%BE%E7%A4%BA%E8%87%AA%E5%B8%A6%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">3 ）详细显示自带的函数的用法</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .2 常用内置函数</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-1-%E7%A9%BA%E5%AD%97%E6%AE%B5%E8%B5%8B%E5%80%BC\"><span class=\"toc-text\">8 .2.1 空字段赋值</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">1 ）函数说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#NVL%EF%BC%9A%E7%BB%99%E5%80%BC%E4%B8%BANULL%E7%9A%84%E6%95%B0%E6%8D%AE%E8%B5%8B%E5%80%BC%EF%BC%8C%E5%AE%83%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%98%AFNVL-value%EF%BC%8Cdefault-value-%E3%80%82%E5%AE%83%E7%9A%84%E5%8A%9F%E8%83%BD%E6%98%AF%E5%A6%82\"><span class=\"toc-text\">NVL：给值为NULL的数据赋值，它的格式是NVL( value，default_value)。它的功能是如</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9E%9Cvalue%E4%B8%BANULL%EF%BC%8C%E5%88%99NVL%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9Edefault-value%E7%9A%84%E5%80%BC%EF%BC%8C%E5%90%A6%E5%88%99%E8%BF%94%E5%9B%9Evalue%E7%9A%84%E5%80%BC%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">果value为NULL，则NVL函数返回default_value的值，否则返回value的值，如果两个参数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%83%BD%E4%B8%BANULL-%EF%BC%8C%E5%88%99%E8%BF%94%E5%9B%9ENULL%E3%80%82\"><span class=\"toc-text\">都为NULL ，则返回NULL。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87%EF%BC%9A%E9%87%87%E7%94%A8%E5%91%98%E5%B7%A5%E8%A1%A8\"><span class=\"toc-text\">2 ）数据准备：采用员工表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%91%98%E5%B7%A5%E7%9A%84-comm-%E4%B8%BA-NULL-%EF%BC%8C%E5%88%99%E7%94%A8-1-%E4%BB%A3%E6%9B%BF\"><span class=\"toc-text\">3 ）查询：如果员工的 comm 为 NULL ，则用 - 1 代替</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-34\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%91%98%E5%B7%A5%E7%9A%84-comm-%E4%B8%BA-NULL-%EF%BC%8C%E5%88%99%E7%94%A8%E9%A2%86%E5%AF%BC-id-%E4%BB%A3%E6%9B%BF\"><span class=\"toc-text\">4 ）查询：如果员工的 comm 为 NULL ，则用领导 id 代替</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-2-CASE-WHEN-THEN-ELSE-END\"><span class=\"toc-text\">8 .2.2 CASE WHEN THEN ELSE END</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">1 ）数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#name-dept-id-sex\"><span class=\"toc-text\">name dept_id sex</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%82%9F%E7%A9%BA-A-%E7%94%B7\"><span class=\"toc-text\">悟空 A^ 男</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E6%B5%B7-A-%E7%94%B7\"><span class=\"toc-text\">大海 A^ 男</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%8B%E5%AE%8B-B-%E7%94%B7\"><span class=\"toc-text\">宋宋 B^ 男</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%87%A4%E5%A7%90-A-%E5%A5%B3\"><span class=\"toc-text\">凤姐 A 女</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A9%B7%E5%A7%90-B-%E5%A5%B3\"><span class=\"toc-text\">婷姐 B 女</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A9%B7%E5%A9%B7-B-%E5%A5%B3\"><span class=\"toc-text\">婷婷 B 女</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E9%9C%80%E6%B1%82\"><span class=\"toc-text\">2 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B1%82%E5%87%BA%E4%B8%8D%E5%90%8C%E9%83%A8%E9%97%A8%E7%94%B7%E5%A5%B3%E5%90%84%E5%A4%9A%E5%B0%91%E4%BA%BA%E3%80%82%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%EF%BC%9A\"><span class=\"toc-text\">求出不同部门男女各多少人。结果如下：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0-emp-sex-txt-%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">3 ）创建本地 emp_sex.txt ，导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-35\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA-hive-%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">4 ）创建 hive 表并导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E6%8C%89%E9%9C%80%E6%B1%82%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">5 ）按需求查询数据</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-3-%E8%A1%8C%E8%BD%AC%E5%88%97\"><span class=\"toc-text\">8 .2.3 行转列</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">1 ）相关函数说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#CONCAT-string-A-x2F-col-string-B-x2F-col%E2%80%A6-%EF%BC%9A%E8%BF%94%E5%9B%9E%E8%BE%93%E5%85%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8C%E6%94%AF%E6%8C%81%E4%BB%BB%E6%84%8F%E4%B8%AA%E8%BE%93%E5%85%A5%E5%AD%97\"><span class=\"toc-text\">CONCAT(string A&#x2F;col, string B&#x2F;col…)：返回输入字符串连接后的结果，支持任意个输入字</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%AC%A6%E4%B8%B2\"><span class=\"toc-text\">符串;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#CONCAT-WS-separator-str1-str2-%E2%80%A6-%EF%BC%9A%E5%AE%83%E6%98%AF%E4%B8%80%E4%B8%AA%E7%89%B9%E6%AE%8A%E5%BD%A2%E5%BC%8F%E7%9A%84-CONCAT-%E3%80%82%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E5%89%A9%E4%BD%99%E5%8F%82\"><span class=\"toc-text\">CONCAT_WS(separator, str1, str2,…)：它是一个特殊形式的 CONCAT()。第一个参数剩余参</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E9%97%B4%E7%9A%84%E5%88%86%E9%9A%94%E7%AC%A6%E3%80%82%E5%88%86%E9%9A%94%E7%AC%A6%E5%8F%AF%E4%BB%A5%E6%98%AF%E4%B8%8E%E5%89%A9%E4%BD%99%E5%8F%82%E6%95%B0%E4%B8%80%E6%A0%B7%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%82%E5%A6%82%E6%9E%9C%E5%88%86%E9%9A%94%E7%AC%A6%E6%98%AF-NULL%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B9%9F%E5%B0%86\"><span class=\"toc-text\">数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%BA-NULL%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%9A%E8%B7%B3%E8%BF%87%E5%88%86%E9%9A%94%E7%AC%A6%E5%8F%82%E6%95%B0%E5%90%8E%E7%9A%84%E4%BB%BB%E4%BD%95-NULL-%E5%92%8C%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%82%E5%88%86%E9%9A%94%E7%AC%A6%E5%B0%86%E8%A2%AB%E5%8A%A0%E5%88%B0%E8%A2%AB%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B9%8B%E9%97%B4\"><span class=\"toc-text\">的字符串之间;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F-CONCAT-WS-must-be-%E2%80%9Cstring-or-array\"><span class=\"toc-text\">注意: CONCAT_WS must be “string or array</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#COLLECT-SET-col-%EF%BC%9A%E5%87%BD%E6%95%B0%E5%8F%AA%E6%8E%A5%E5%8F%97%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%83%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%98%AF%E5%B0%86%E6%9F%90%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E5%8E%BB%E9%87%8D\"><span class=\"toc-text\">COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B1%87%E6%80%BB%EF%BC%8C%E4%BA%A7%E7%94%9FArray%E7%B1%BB%E5%9E%8B%E5%AD%97%E6%AE%B5%E3%80%82\"><span class=\"toc-text\">汇总，产生Array类型字段。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">2 ）数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#name-constellation-blood-type\"><span class=\"toc-text\">name constellation blood_type</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%99%E6%82%9F%E7%A9%BA-%E7%99%BD%E7%BE%8A%E5%BA%A7-A\"><span class=\"toc-text\">孙悟空 白羊座 A^</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E6%B5%B7-%E5%B0%84%E6%89%8B%E5%BA%A7-A\"><span class=\"toc-text\">大海 射手座 A^</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%8B%E5%AE%8B-%E7%99%BD%E7%BE%8A%E5%BA%A7-B\"><span class=\"toc-text\">宋宋 白羊座 B^</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-36\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%8C%AA%E5%85%AB%E6%88%92-%E7%99%BD%E7%BE%8A%E5%BA%A7-A\"><span class=\"toc-text\">猪八戒 白羊座 A^</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%87%A4%E5%A7%90-%E5%B0%84%E6%89%8B%E5%BA%A7-A\"><span class=\"toc-text\">凤姐 射手座 A</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%8B%8D%E8%80%81%E5%B8%88-%E7%99%BD%E7%BE%8A%E5%BA%A7-B\"><span class=\"toc-text\">苍老师 白羊座 B</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E9%9C%80%E6%B1%82\"><span class=\"toc-text\">3 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8A%8A%E6%98%9F%E5%BA%A7%E5%92%8C%E8%A1%80%E5%9E%8B%E4%B8%80%E6%A0%B7%E7%9A%84%E4%BA%BA%E5%BD%92%E7%B1%BB%E5%88%B0%E4%B8%80%E8%B5%B7%E3%80%82%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%EF%BC%9A\"><span class=\"toc-text\">把星座和血型一样的人归类到一起。结果如下：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0-constellation-txt-%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">4 ）创建本地 constellation.txt ，导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%9B%E5%BB%BA-hive-%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">5 ）创建 hive 表并导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E6%8C%89%E9%9C%80%E6%B1%82%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">6 ）按需求查询数据</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-4-%E5%88%97%E8%BD%AC%E8%A1%8C\"><span class=\"toc-text\">8 .2.4 列转行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E-1\"><span class=\"toc-text\">1 ）函数说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#EXPLODE-col-%EF%BC%9A%E5%B0%86hive%E4%B8%80%E5%88%97%E4%B8%AD%E5%A4%8D%E6%9D%82%E7%9A%84Array%E6%88%96%E8%80%85Map%E7%BB%93%E6%9E%84%E6%8B%86%E5%88%86%E6%88%90%E5%A4%9A%E8%A1%8C%E3%80%82\"><span class=\"toc-text\">EXPLODE(col)：将hive一列中复杂的Array或者Map结构拆分成多行。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#LATERAL-VIEW\"><span class=\"toc-text\">LATERAL VIEW</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%B3%95%EF%BC%9ALATERAL-VIEW-udtf-expression-tableAlias-AS-columnAlias\"><span class=\"toc-text\">用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E9%87%8A%EF%BC%9A%E7%94%A8%E4%BA%8E%E5%92%8Csplit-explode%E7%AD%89UDTF%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%AE%83%E8%83%BD%E5%A4%9F%E5%B0%86%E4%B8%80%E5%88%97%E6%95%B0%E6%8D%AE%E6%8B%86%E6%88%90%E5%A4%9A%E8%A1%8C%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%9C%A8%E6%AD%A4\"><span class=\"toc-text\">解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%8F%AF%E4%BB%A5%E5%AF%B9%E6%8B%86%E5%88%86%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E3%80%82\"><span class=\"toc-text\">基础上可以对拆分后的数据进行聚合。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-37\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-1\"><span class=\"toc-text\">2 ）数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A1%A8-6-7-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87\"><span class=\"toc-text\">表 6 - 7 数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#movie-category\"><span class=\"toc-text\">movie category</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E3%80%8A%E7%96%91%E7%8A%AF%E8%BF%BD%E8%B8%AA%E3%80%8B-%E6%82%AC%E7%96%91-%E5%8A%A8%E4%BD%9C-%E7%A7%91%E5%B9%BB-%E5%89%A7%E6%83%85\"><span class=\"toc-text\">《疑犯追踪》 悬疑,动作,科幻,剧情</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E3%80%8ALie-to-me%E3%80%8B-%E6%82%AC%E7%96%91-%E8%AD%A6%E5%8C%AA-%E5%8A%A8%E4%BD%9C-%E5%BF%83%E7%90%86-%E5%89%A7%E6%83%85\"><span class=\"toc-text\">《Lie to me》 悬疑,警匪,动作,心理,剧情</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E3%80%8A%E6%88%98%E7%8B%BC-2-%E3%80%8B-%E6%88%98%E4%BA%89-%E5%8A%A8%E4%BD%9C-%E7%81%BE%E9%9A%BE\"><span class=\"toc-text\">《战狼 2 》 战争,动作,灾难</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E9%9C%80%E6%B1%82-1\"><span class=\"toc-text\">3 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86%E7%94%B5%E5%BD%B1%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E5%B1%95%E5%BC%80%E3%80%82%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%EF%BC%9A\"><span class=\"toc-text\">将电影分类中的数组数据展开。结果如下：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0-movie-txt-%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">4 ）创建本地 movie.txt ，导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%9B%E5%BB%BA-hive-%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">5 ）创建 hive 表并导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E6%8C%89%E9%9C%80%E6%B1%82%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">6 ）按需求查询数据</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-5-%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%EF%BC%88%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0%EF%BC%89\"><span class=\"toc-text\">8 .2.5 窗口函数（开窗函数）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E-1\"><span class=\"toc-text\">1 ）相关函数说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#OVER-%EF%BC%9A%E6%8C%87%E5%AE%9A%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%95%B0%E6%8D%AE%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%95%B0%E6%8D%AE%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%9A%8F%E7%9D%80%E8%A1%8C%E7%9A%84%E5%8F%98%E8%80%8C%E5%8F%98\"><span class=\"toc-text\">OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变而变</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-38\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8C%96%E3%80%82\"><span class=\"toc-text\">化。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#CURRENT-ROW%EF%BC%9A%E5%BD%93%E5%89%8D%E8%A1%8C\"><span class=\"toc-text\">CURRENT ROW：当前行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#n-PRECEDING%EF%BC%9A%E5%BE%80%E5%89%8Dn%E8%A1%8C%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">n PRECEDING：往前n行数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#n-FOLLOWING%EF%BC%9A%E5%BE%80%E5%90%8En%E8%A1%8C%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">n FOLLOWING：往后n行数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#UNBOUNDED%EF%BC%9A%E8%B5%B7%E7%82%B9%EF%BC%8C\"><span class=\"toc-text\">UNBOUNDED：起点，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#UNBOUNDED-PRECEDING-%E8%A1%A8%E7%A4%BA%E4%BB%8E%E5%89%8D%E9%9D%A2%E7%9A%84%E8%B5%B7%E7%82%B9%EF%BC%8C\"><span class=\"toc-text\">UNBOUNDED PRECEDING 表示从前面的起点，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#UNBOUNDED-FOLLOWING%E8%A1%A8%E7%A4%BA%E5%88%B0%E5%90%8E%E9%9D%A2%E7%9A%84%E7%BB%88%E7%82%B9\"><span class=\"toc-text\">UNBOUNDED FOLLOWING表示到后面的终点</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#LAG-col-n-default-val-%EF%BC%9A%E5%BE%80%E5%89%8D%E7%AC%ACn%E8%A1%8C%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">LAG(col,n,default_val)：往前第n行数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#LEAD-col-n-default-val-%EF%BC%9A%E5%BE%80%E5%90%8E%E7%AC%ACn%E8%A1%8C%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">LEAD(col,n, default_val)：往后第n行数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#NTILE-n-%EF%BC%9A%E6%8A%8A%E6%9C%89%E5%BA%8F%E7%AA%97%E5%8F%A3%E7%9A%84%E8%A1%8C%E5%88%86%E5%8F%91%E5%88%B0%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%84%E4%B8%AD%EF%BC%8C%E5%90%84%E4%B8%AA%E7%BB%84%E6%9C%89%E7%BC%96%E5%8F%B7%EF%BC%8C%E7%BC%96%E5%8F%B7%E4%BB%8E-1-%E5%BC%80%E5%A7%8B%EF%BC%8C%E5%AF%B9\"><span class=\"toc-text\">NTILE(n)：把有序窗口的行分发到指定数据的组中，各个组有编号，编号从 1 开始，对</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BA%8E%E6%AF%8F%E4%B8%80%E8%A1%8C%EF%BC%8CNTILE%E8%BF%94%E5%9B%9E%E6%AD%A4%E8%A1%8C%E6%89%80%E5%B1%9E%E7%9A%84%E7%BB%84%E7%9A%84%E7%BC%96%E5%8F%B7%E3%80%82%E6%B3%A8%E6%84%8F%EF%BC%9An%E5%BF%85%E9%A1%BB%E4%B8%BAint%E7%B1%BB%E5%9E%8B%E3%80%82\"><span class=\"toc-text\">于每一行，NTILE返回此行所属的组的编号。注意：n必须为int类型。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87%EF%BC%9A-name-%EF%BC%8C-orderdate-%EF%BC%8C-cost\"><span class=\"toc-text\">2 ）数据准备： name ， orderdate ， cost</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E9%9C%80%E6%B1%82-2\"><span class=\"toc-text\">3 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%9C%A8-2017-%E5%B9%B4-4-%E6%9C%88%E4%BB%BD%E8%B4%AD%E4%B9%B0%E8%BF%87%E7%9A%84%E9%A1%BE%E5%AE%A2%E5%8F%8A%E6%80%BB%E4%BA%BA%E6%95%B0\"><span class=\"toc-text\">（ 1 ）查询在 2017 年 4 月份购买过的顾客及总人数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E8%AF%A2%E9%A1%BE%E5%AE%A2%E7%9A%84%E8%B4%AD%E4%B9%B0%E6%98%8E%E7%BB%86%E5%8F%8A%E6%9C%88%E8%B4%AD%E4%B9%B0%E6%80%BB%E9%A2%9D\"><span class=\"toc-text\">（ 2 ）查询顾客的购买明细及月购买总额</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E4%B8%8A%E8%BF%B0%E7%9A%84%E5%9C%BA%E6%99%AF-%E5%B0%86%E6%AF%8F%E4%B8%AA%E9%A1%BE%E5%AE%A2%E7%9A%84cost%E6%8C%89%E7%85%A7%E6%97%A5%E6%9C%9F%E8%BF%9B%E8%A1%8C%E7%B4%AF%E5%8A%A0\"><span class=\"toc-text\">（ 3 ）上述的场景, 将每个顾客的cost按照日期进行累加</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E9%A1%BE%E5%AE%A2%E4%B8%8A%E6%AC%A1%E7%9A%84%E8%B4%AD%E4%B9%B0%E6%97%B6%E9%97%B4\"><span class=\"toc-text\">（ 4 ）查询每个顾客上次的购买时间</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%89%8D20-%E6%97%B6%E9%97%B4%E7%9A%84%E8%AE%A2%E5%8D%95%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 5 ）查询前20%时间的订单信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0-business-txt-%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">4 ）创建本地 business.txt ，导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%9B%E5%BB%BA-hive-%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">5 ）创建 hive 表并导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-39\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E6%8C%89%E9%9C%80%E6%B1%82%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">6 ）按需求查询数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89-%E6%9F%A5%E8%AF%A2%E5%9C%A8-2017-%E5%B9%B4-4-%E6%9C%88%E4%BB%BD%E8%B4%AD%E4%B9%B0%E8%BF%87%E7%9A%84%E9%A1%BE%E5%AE%A2%E5%8F%8A%E6%80%BB%E4%BA%BA%E6%95%B0\"><span class=\"toc-text\">（ 1 ） 查询在 2017 年 4 月份购买过的顾客及总人数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89-%E6%9F%A5%E8%AF%A2%E9%A1%BE%E5%AE%A2%E7%9A%84%E8%B4%AD%E4%B9%B0%E6%98%8E%E7%BB%86%E5%8F%8A%E6%9C%88%E8%B4%AD%E4%B9%B0%E6%80%BB%E9%A2%9D\"><span class=\"toc-text\">（ 2 ） 查询顾客的购买明细及月购买总额</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89-%E5%B0%86%E6%AF%8F%E4%B8%AA%E9%A1%BE%E5%AE%A2%E7%9A%84cost%E6%8C%89%E7%85%A7%E6%97%A5%E6%9C%9F%E8%BF%9B%E8%A1%8C%E7%B4%AF%E5%8A%A0\"><span class=\"toc-text\">（ 3 ） 将每个顾客的cost按照日期进行累加</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#rows%E5%BF%85%E9%A1%BB%E8%B7%9F%E5%9C%A8order-by-%E5%AD%90%E5%8F%A5%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%AF%B9%E6%8E%92%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E9%99%90%E5%88%B6%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E7%9A%84%E8%A1%8C%E6%95%B0%E6%9D%A5%E9%99%90%E5%88%B6%E5%88%86\"><span class=\"toc-text\">rows必须跟在order by 子句之后，对排序的结果进行限制，使用固定的行数来限制分</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8C%BA%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A1%8C%E6%95%B0%E9%87%8F\"><span class=\"toc-text\">区中的数据行数量</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89-%E6%9F%A5%E7%9C%8B%E9%A1%BE%E5%AE%A2%E4%B8%8A%E6%AC%A1%E7%9A%84%E8%B4%AD%E4%B9%B0%E6%97%B6%E9%97%B4\"><span class=\"toc-text\">（ 4 ） 查看顾客上次的购买时间</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89-%E6%9F%A5%E8%AF%A2%E5%89%8D20-%E6%97%B6%E9%97%B4%E7%9A%84%E8%AE%A2%E5%8D%95%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">（ 5 ） 查询前20%时间的订单信息</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-6-Rank\"><span class=\"toc-text\">8 .2.6 Rank</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E-2\"><span class=\"toc-text\">1 ）函数说明</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#RANK-%E6%8E%92%E5%BA%8F%E7%9B%B8%E5%90%8C%E6%97%B6%E4%BC%9A%E9%87%8D%E5%A4%8D%EF%BC%8C%E6%80%BB%E6%95%B0%E4%B8%8D%E4%BC%9A%E5%8F%98\"><span class=\"toc-text\">RANK() 排序相同时会重复，总数不会变</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-40\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#DENSE-RANK-%E6%8E%92%E5%BA%8F%E7%9B%B8%E5%90%8C%E6%97%B6%E4%BC%9A%E9%87%8D%E5%A4%8D%EF%BC%8C%E6%80%BB%E6%95%B0%E4%BC%9A%E5%87%8F%E5%B0%91\"><span class=\"toc-text\">DENSE_RANK() 排序相同时会重复，总数会减少</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ROW-NUMBER-%E4%BC%9A%E6%A0%B9%E6%8D%AE%E9%A1%BA%E5%BA%8F%E8%AE%A1%E7%AE%97\"><span class=\"toc-text\">ROW_NUMBER() 会根据顺序计算</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-2\"><span class=\"toc-text\">2 ）数据准备</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#name-subject-score\"><span class=\"toc-text\">name subject score</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%99%E6%82%9F%E7%A9%BA-%E8%AF%AD%E6%96%87-87\"><span class=\"toc-text\">孙悟空 语文 87</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%99%E6%82%9F%E7%A9%BA-%E6%95%B0%E5%AD%A6-95\"><span class=\"toc-text\">孙悟空 数学 95</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%99%E6%82%9F%E7%A9%BA-%E8%8B%B1%E8%AF%AD-68\"><span class=\"toc-text\">孙悟空 英语 68</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E6%B5%B7-%E8%AF%AD%E6%96%87-94\"><span class=\"toc-text\">大海 语文 94</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E6%B5%B7-%E6%95%B0%E5%AD%A6-56\"><span class=\"toc-text\">大海 数学 56</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E6%B5%B7-%E8%8B%B1%E8%AF%AD-84\"><span class=\"toc-text\">大海 英语 84</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%8B%E5%AE%8B-%E8%AF%AD%E6%96%87-64\"><span class=\"toc-text\">宋宋 语文 64</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%8B%E5%AE%8B-%E6%95%B0%E5%AD%A6-86\"><span class=\"toc-text\">宋宋 数学 86</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%8B%E5%AE%8B-%E8%8B%B1%E8%AF%AD-84\"><span class=\"toc-text\">宋宋 英语 84</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A9%B7%E5%A9%B7-%E8%AF%AD%E6%96%87-65\"><span class=\"toc-text\">婷婷 语文 65</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A9%B7%E5%A9%B7-%E6%95%B0%E5%AD%A6-85\"><span class=\"toc-text\">婷婷 数学 85</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A9%B7%E5%A9%B7-%E8%8B%B1%E8%AF%AD-78\"><span class=\"toc-text\">婷婷 英语 78</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E9%9C%80%E6%B1%82-3\"><span class=\"toc-text\">3 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AE%A1%E7%AE%97%E6%AF%8F%E9%97%A8%E5%AD%A6%E7%A7%91%E6%88%90%E7%BB%A9%E6%8E%92%E5%90%8D%E3%80%82\"><span class=\"toc-text\">计算每门学科成绩排名。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0-score-txt-%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">4 ）创建本地 score.txt ，导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%9B%E5%BB%BA-hive-%E8%A1%A8%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE-3\"><span class=\"toc-text\">5 ）创建 hive 表并导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E6%8C%89%E9%9C%80%E6%B1%82%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-3\"><span class=\"toc-text\">6 ）按需求查询数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-41\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%89%A9%E5%B1%95%EF%BC%9A%E6%B1%82%E5%87%BA%E6%AF%8F%E9%97%A8%E5%AD%A6%E7%A7%91%E5%89%8D%E4%B8%89%E5%90%8D%E7%9A%84%E5%AD%A6%E7%94%9F%EF%BC%9F\"><span class=\"toc-text\">扩展：求出每门学科前三名的学生？</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-2-7-%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .2.7 其他常用函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%E8%B5%84%E6%96%99-05-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0-txt\"><span class=\"toc-text\">..\\2.资料\\05_常用函数\\常用函数.txt</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .3 自定义函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89Hive-%E8%87%AA%E5%B8%A6%E4%BA%86%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%8C%E6%AF%94%E5%A6%82%EF%BC%9Amax-x2F-min%E7%AD%89%EF%BC%8C%E4%BD%86%E6%98%AF%E6%95%B0%E9%87%8F%E6%9C%89%E9%99%90%EF%BC%8C%E8%87%AA%E5%B7%B1%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89UDF%E6%9D%A5\"><span class=\"toc-text\">1 ）Hive 自带了一些函数，比如：max&#x2F;min等，但是数量有限，自己可以通过自定义UDF来</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%96%B9%E4%BE%BF%E7%9A%84%E6%89%A9%E5%B1%95%E3%80%82\"><span class=\"toc-text\">方便的扩展。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%BD%93Hive%E6%8F%90%E4%BE%9B%E7%9A%84%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E6%97%A0%E6%B3%95%E6%BB%A1%E8%B6%B3%E4%BD%A0%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86%E9%9C%80%E8%A6%81%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89\"><span class=\"toc-text\">2 ）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%87%BD%E6%95%B0%EF%BC%88UDF%EF%BC%9Auser-defined-function%EF%BC%89%E3%80%82\"><span class=\"toc-text\">函数（UDF：user-defined function）。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E7%B1%BB%E5%88%AB%E5%88%86%E4%B8%BA%E4%BB%A5%E4%B8%8B%E4%B8%89%E7%A7%8D%EF%BC%9A\"><span class=\"toc-text\">3 ）根据用户自定义函数类别分为以下三种：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89UDF%EF%BC%88User-Defined-Function%EF%BC%89\"><span class=\"toc-text\">（ 1 ）UDF（User-Defined-Function）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%80%E8%BF%9B%E4%B8%80%E5%87%BA\"><span class=\"toc-text\">一进一出</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89UDAF%EF%BC%88User-Defined-Aggregation-Function%EF%BC%89\"><span class=\"toc-text\">（ 2 ）UDAF（User-Defined Aggregation Function）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%EF%BC%8C%E5%A4%9A%E8%BF%9B%E4%B8%80%E5%87%BA\"><span class=\"toc-text\">聚集函数，多进一出</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%B1%BB%E4%BC%BC%E4%BA%8E%EF%BC%9Acount-x2F-max-x2F-min\"><span class=\"toc-text\">类似于：count&#x2F;max&#x2F;min</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89UDTF%EF%BC%88User-Defined-Table-Generating-Functions%EF%BC%89\"><span class=\"toc-text\">（ 3 ）UDTF（User-Defined Table-Generating Functions）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%80%E8%BF%9B%E5%A4%9A%E5%87%BA\"><span class=\"toc-text\">一进多出</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82lateral-view-explode\"><span class=\"toc-text\">如lateral view explode()</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">4 ）官方文档地址</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#https-cwiki-apache-org-confluence-display-Hive-HivePlugins\"><span class=\"toc-text\">https:&#x2F;&#x2F;cwiki.apache.org&#x2F;confluence&#x2F;display&#x2F;Hive&#x2F;HivePlugins</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4%EF%BC%9A\"><span class=\"toc-text\">5 ）编程步骤：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E7%BB%A7%E6%89%BFHive%E6%8F%90%E4%BE%9B%E7%9A%84%E7%B1%BB\"><span class=\"toc-text\">（ 1 ）继承Hive提供的类</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#org-apache-hadoop-hive-ql-udf-generic-GenericUDF\"><span class=\"toc-text\">org.apache.hadoop.hive.ql.udf.generic.GenericUDF</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#org-apache-hadoop-hive-ql-udf-generic-GenericUDTF\"><span class=\"toc-text\">org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%B8%AD%E7%9A%84%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">（ 2 ）实现类中的抽象方法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-42\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%9C%A8hive%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AA%97%E5%8F%A3%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">（ 3 ）在hive的命令行窗口创建函数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0jar\"><span class=\"toc-text\">添加jar</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BAfunction\"><span class=\"toc-text\">创建function</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E5%9C%A8hive%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AA%97%E5%8F%A3%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">（ 4 ）在hive的命令行窗口删除函数</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#8-4-%E8%87%AA%E5%AE%9A%E4%B9%89-UDF-%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .4 自定义 UDF 函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#0-%EF%BC%89%E9%9C%80%E6%B1%82\"><span class=\"toc-text\">0 ）需求 :</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAUDF%E5%AE%9E%E7%8E%B0%E8%AE%A1%E7%AE%97%E7%BB%99%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%95%BF%E5%BA%A6%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">自定义一个UDF实现计算给定字符串的长度，例如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-Maven-%E5%B7%A5%E7%A8%8B-Hive\"><span class=\"toc-text\">1 ）创建一个 Maven 工程 Hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">2 ）导入依赖</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B1%BB\"><span class=\"toc-text\">3 ）创建一个类</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-43\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E6%89%93%E6%88%90-jar-%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8-x2F-opt-x2F-module-x2F-data-x2F-myudf-jar\"><span class=\"toc-text\">4 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;data&#x2F;myudf.jar</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%B0%86-jar-%E5%8C%85%E6%B7%BB%E5%8A%A0%E5%88%B0-hive-%E7%9A%84-classpath\"><span class=\"toc-text\">5 ）将 jar 包添加到 hive 的 classpath</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E5%87%BD%E6%95%B0%E4%B8%8E%E5%BC%80%E5%8F%91%E5%A5%BD%E7%9A%84-java-class-%E5%85%B3%E8%81%94\"><span class=\"toc-text\">6 ）创建临时函数与开发好的 java class 关联</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-%EF%BC%89%E5%8D%B3%E5%8F%AF%E5%9C%A8-hql-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">7 ）即可在 hql 中使用自定义的函数</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#8-5-%E8%87%AA%E5%AE%9A%E4%B9%89UDTF%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">8 .5 自定义UDTF函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#0-%EF%BC%89%E9%9C%80%E6%B1%82-1\"><span class=\"toc-text\">0 ）需求</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAUDTF%E5%AE%9E%E7%8E%B0%E5%B0%86%E4%B8%80%E4%B8%AA%E4%BB%BB%E6%84%8F%E5%88%86%E5%89%B2%E7%AC%A6%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%87%E5%89%B2%E6%88%90%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%8D%95%E8%AF%8D%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">自定义一个UDTF实现将一个任意分割符的字符串切割成独立的单词，例如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-44\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">1 ）代码实现</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-45\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%89%93%E6%88%90-jar-%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8-x2F-opt-x2F-module-x2F-hive-x2F-data-x2F-myudtf-jar\"><span class=\"toc-text\">2 ）打成 jar 包上传到服务器 &#x2F;opt&#x2F;module&#x2F;hive&#x2F;data&#x2F;myudtf.jar</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%B0%86-jar-%E5%8C%85%E6%B7%BB%E5%8A%A0%E5%88%B0-hive-%E7%9A%84-classpath-%E4%B8%8B\"><span class=\"toc-text\">3 ）将 jar 包添加到 hive 的 classpath 下</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E5%87%BD%E6%95%B0%E4%B8%8E%E5%BC%80%E5%8F%91%E5%A5%BD%E7%9A%84-java-class-%E5%85%B3%E8%81%94\"><span class=\"toc-text\">4 ）创建临时函数与开发好的 java class 关联</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">5 ）使用自定义的函数</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-9-%E7%AB%A0-%E5%8E%8B%E7%BC%A9%E5%92%8C%E5%AD%98%E5%82%A8\"><span class=\"toc-text\">第 9 章 压缩和存储</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-1-Hadoop-%E5%8E%8B%E7%BC%A9%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">9 .1 Hadoop 压缩配置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-1-1-MR-%E6%94%AF%E6%8C%81%E7%9A%84%E5%8E%8B%E7%BC%A9%E7%BC%96%E7%A0%81\"><span class=\"toc-text\">9 .1.1 MR 支持的压缩编码</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BA%86%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%8D%E5%8E%8B%E7%BC%A9-x2F-%E8%A7%A3%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95%EF%BC%8CHadoop%E5%BC%95%E5%85%A5%E4%BA%86%E7%BC%96%E7%A0%81-x2F-%E8%A7%A3%E7%A0%81%E5%99%A8%EF%BC%8C%E5%A6%82%E4%B8%8B%E8%A1%A8%E6%89%80%E7%A4%BA%EF%BC%9A\"><span class=\"toc-text\">为了支持多种压缩&#x2F;解压缩算法，Hadoop引入了编码&#x2F;解码器，如下表所示：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-46\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%8B%E7%BC%A9%E6%80%A7%E8%83%BD%E7%9A%84%E6%AF%94%E8%BE%83%EF%BC%9A\"><span class=\"toc-text\">压缩性能的比较：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#http-google-github-io-snappy\"><span class=\"toc-text\">http:&#x2F;&#x2F;google.github.io&#x2F;snappy&#x2F;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#On-a-single-core-of-a-Core-i7-processor-in-64-bit-mode-Snappy-compresses-at-about-250\"><span class=\"toc-text\">On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#MB-x2F-sec-or-more-and-decompresses-at-about-500-MB-x2F-sec-or-more\"><span class=\"toc-text\">MB&#x2F;sec or more and decompresses at about 500 MB&#x2F;sec or more.</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-1-2-%E5%8E%8B%E7%BC%A9%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">9 .1.2 压缩参数配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A6%81%E5%9C%A8Hadoop%E4%B8%AD%E5%90%AF%E7%94%A8%E5%8E%8B%E7%BC%A9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B%E5%8F%82%E6%95%B0%EF%BC%88mapred-site-xml%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%89%EF%BC%9A\"><span class=\"toc-text\">要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-2-%E5%BC%80%E5%90%AF-Map-%E8%BE%93%E5%87%BA%E9%98%B6%E6%AE%B5%E5%8E%8B%E7%BC%A9%EF%BC%88-MR-%E5%BC%95%E6%93%8E%EF%BC%89\"><span class=\"toc-text\">9 .2 开启 Map 输出阶段压缩（ MR 引擎）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%90%AFmap%E8%BE%93%E5%87%BA%E9%98%B6%E6%AE%B5%E5%8E%8B%E7%BC%A9%E5%8F%AF%E4%BB%A5%E5%87%8F%E5%B0%91job%E4%B8%ADmap%E5%92%8CReduce-task%E9%97%B4%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E9%87%8F%E3%80%82%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE%E5%A6%82\"><span class=\"toc-text\">开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8B%EF%BC%9A\"><span class=\"toc-text\">下：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-2\"><span class=\"toc-text\">1 ）案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BC%80%E5%90%AFhive%E4%B8%AD%E9%97%B4%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">（ 1 ）开启hive中间传输数据压缩功能</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%BC%80%E5%90%AFmapreduce%E4%B8%ADmap%E8%BE%93%E5%87%BA%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">（ 2 ）开启mapreduce中map输出压缩功能</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-47\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E8%AE%BE%E7%BD%AEmapreduce%E4%B8%ADmap%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8E%8B%E7%BC%A9%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 3 ）设置mapreduce中map输出数据的压缩方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 4 ）执行查询语句</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-3-%E5%BC%80%E5%90%AF-Reduce-%E8%BE%93%E5%87%BA%E9%98%B6%E6%AE%B5%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">9 .3 开启 Reduce 输出阶段压缩</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93-Hive-%E5%B0%86-%E8%BE%93-%E5%87%BA-%E5%86%99-%E5%85%A5-%E5%88%B0-%E8%A1%A8-%E4%B8%AD-%E6%97%B6%EF%BC%8C%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%E5%90%8C%E6%A0%B7%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E5%8E%8B%E7%BC%A9%E3%80%82%E5%B1%9E%E6%80%A7\"><span class=\"toc-text\">当 Hive 将 输 出 写 入 到 表 中 时，输出内容同样可以进行压缩。属性</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#hive-exec-compress-output%E6%8E%A7%E5%88%B6%E7%9D%80%E8%BF%99%E4%B8%AA%E5%8A%9F%E8%83%BD%E3%80%82%E7%94%A8%E6%88%B7%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E4%BF%9D%E6%8C%81%E9%BB%98%E8%AE%A4%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BCfalse%EF%BC%8C\"><span class=\"toc-text\">hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%99%E6%A0%B7%E9%BB%98%E8%AE%A4%E7%9A%84%E8%BE%93%E5%87%BA%E5%B0%B1%E6%98%AF%E9%9D%9E%E5%8E%8B%E7%BC%A9%E7%9A%84%E7%BA%AF%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E4%BA%86%E3%80%82%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%9C%A8%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%88%96%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%BF%99\"><span class=\"toc-text\">这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AA%E5%80%BC%E4%B8%BAtrue%EF%BC%8C%E6%9D%A5%E5%BC%80%E5%90%AF%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD%E3%80%82\"><span class=\"toc-text\">个值为true，来开启输出结果压缩功能。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-3\"><span class=\"toc-text\">1 ）案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BC%80%E5%90%AFhive%E6%9C%80%E7%BB%88%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">（ 1 ）开启hive最终输出数据压缩功能</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%BC%80%E5%90%AFmapreduce%E6%9C%80%E7%BB%88%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">（ 2 ）开启mapreduce最终输出数据压缩</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E8%AE%BE%E7%BD%AEmapreduce%E6%9C%80%E7%BB%88%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA%E5%8E%8B%E7%BC%A9%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">（ 3 ）设置mapreduce最终数据输出压缩方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E8%AE%BE%E7%BD%AEmapreduce%E6%9C%80%E7%BB%88%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA%E5%8E%8B%E7%BC%A9%E4%B8%BA%E5%9D%97%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">（ 4 ）设置mapreduce最终数据输出压缩为块压缩</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%98%AF%E5%90%A6%E6%98%AF%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">（ 5 ）测试一下输出结果是否是压缩文件</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">9 .4 文件存储格式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E6%94%AF%E6%8C%81%E7%9A%84%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A0%BC%E5%BC%8F%E4%B8%BB%E8%A6%81%E6%9C%89%EF%BC%9ATEXTFILE-%E3%80%81SEQUENCEFILE%E3%80%81ORC%E3%80%81PARQUET%E3%80%82\"><span class=\"toc-text\">Hive支持的存储数据的格式主要有：TEXTFILE 、SEQUENCEFILE、ORC、PARQUET。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-48\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-1-%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E5%92%8C%E8%A1%8C%E5%BC%8F%E5%AD%98%E5%82%A8\"><span class=\"toc-text\">9 .4.1 列式存储和行式存储</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%E5%B7%A6%E8%BE%B9%E4%B8%BA%E9%80%BB%E8%BE%91%E8%A1%A8%EF%BC%8C%E5%8F%B3%E8%BE%B9%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%BA%E8%A1%8C%E5%BC%8F%E5%AD%98%E5%82%A8%EF%BC%8C%E7%AC%AC%E4%BA%8C%E4%B8%AA%E4%B8%BA%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E3%80%82\"><span class=\"toc-text\">如图所示左边为逻辑表，右边第一个为行式存储，第二个为列式存储。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%A1%8C%E5%AD%98%E5%82%A8%E7%9A%84%E7%89%B9%E7%82%B9\"><span class=\"toc-text\">1 ）行存储的特点</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%E7%9A%84%E4%B8%80%E6%95%B4%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%88%97%E5%AD%98%E5%82%A8%E5%88%99%E9%9C%80%E8%A6%81%E5%8E%BB%E6%AF%8F%E4%B8%AA%E8%81%9A%E9%9B%86%E7%9A%84%E5%AD%97%E6%AE%B5%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%88%97\"><span class=\"toc-text\">查询满足条件的一整行数据的时候，列存储则需要去每个聚集的字段找到对应的每个列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E5%80%BC%EF%BC%8C%E8%A1%8C%E5%AD%98%E5%82%A8%E5%8F%AA%E9%9C%80%E8%A6%81%E6%89%BE%E5%88%B0%E5%85%B6%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%80%BC%EF%BC%8C%E5%85%B6%E4%BD%99%E7%9A%84%E5%80%BC%E9%83%BD%E5%9C%A8%E7%9B%B8%E9%82%BB%E5%9C%B0%E6%96%B9%EF%BC%8C%E6%89%80%E4%BB%A5%E6%AD%A4%E6%97%B6%E8%A1%8C%E5%AD%98%E5%82%A8%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%80%9F%E5%BA%A6\"><span class=\"toc-text\">的值，行存储只需要找到其中一个值，其余的值都在相邻地方，所以此时行存储查询的速度</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E5%BF%AB%E3%80%82\"><span class=\"toc-text\">更快。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%88%97%E5%AD%98%E5%82%A8%E7%9A%84%E7%89%B9%E7%82%B9\"><span class=\"toc-text\">2 ）列存储的特点</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9B%A0%E4%B8%BA%E6%AF%8F%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E6%95%B0%E6%8D%AE%E8%81%9A%E9%9B%86%E5%AD%98%E5%82%A8%EF%BC%8C%E5%9C%A8%E6%9F%A5%E8%AF%A2%E5%8F%AA%E9%9C%80%E8%A6%81%E5%B0%91%E6%95%B0%E5%87%A0%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%83%BD%E5%A4%A7%E5%A4%A7%E5%87%8F%E5%B0%91%E8%AF%BB%E5%8F%96%E7%9A%84\"><span class=\"toc-text\">因为每个字段的数据聚集存储，在查询只需要少数几个字段的时候，能大大减少读取的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E9%87%8F%EF%BC%9B%E6%AF%8F%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%80%E5%AE%9A%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%EF%BC%8C%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E5%8F%AF%E4%BB%A5%E9%92%88%E5%AF%B9%E6%80%A7%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%8B%E7%BC%A9%E7%AE%97\"><span class=\"toc-text\">数据量；每个字段的数据类型一定是相同的，列式存储可以针对性的设计更好的设计压缩算</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%95%E3%80%82\"><span class=\"toc-text\">法。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#TEXTFILE%E5%92%8CSEQUENCEFILE%E7%9A%84%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E9%83%BD%E6%98%AF%E5%9F%BA%E4%BA%8E%E8%A1%8C%E5%AD%98%E5%82%A8%E7%9A%84%EF%BC%9B\"><span class=\"toc-text\">TEXTFILE和SEQUENCEFILE的存储格式都是基于行存储的；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ORC%E5%92%8CPARQUET%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E7%9A%84%E3%80%82\"><span class=\"toc-text\">ORC和PARQUET是基于列式存储的。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-2-TextFile-%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">9 .4.2 TextFile 格式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E6%A0%BC%E5%BC%8F%EF%BC%8C%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%81%9A%E5%8E%8B%E7%BC%A9%EF%BC%8C%E7%A3%81%E7%9B%98%E5%BC%80%E9%94%80%E5%A4%A7%EF%BC%8C%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%BC%80%E9%94%80%E5%A4%A7%E3%80%82%E5%8F%AF%E7%BB%93%E5%90%88Gzip%E3%80%81Bzip2%E4%BD%BF%E7%94%A8%EF%BC%8C\"><span class=\"toc-text\">默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%86%E4%BD%BF%E7%94%A8Gzip%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8Chive%E4%B8%8D%E4%BC%9A%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%88%87%E5%88%86%EF%BC%8C%E4%BB%8E%E8%80%8C%E6%97%A0%E6%B3%95%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%B9%B6%E8%A1%8C%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-3-Orc-%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">9 .4.3 Orc 格式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Orc-Optimized-Row-Columnar-%E6%98%AFHive-0-11%E7%89%88%E9%87%8C%E5%BC%95%E5%85%A5%E7%9A%84%E6%96%B0%E7%9A%84%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E3%80%82\"><span class=\"toc-text\">Orc (Optimized Row Columnar)是Hive 0.11版里引入的新的存储格式。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%AF%8F%E4%B8%AAOrc%E6%96%87%E4%BB%B6%E7%94%B1-1-%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AAstripe%E7%BB%84%E6%88%90%EF%BC%8C%E6%AF%8F%E4%B8%AAstripe%E4%B8%80%E8%88%AC%E4%B8%BAHDFS\"><span class=\"toc-text\">如下图所示可以看到每个Orc文件由 1 个或多个stripe组成，每个stripe一般为HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E5%9D%97%E5%A4%A7%E5%B0%8F%EF%BC%8C%E6%AF%8F%E4%B8%80%E4%B8%AAstripe%E5%8C%85%E5%90%AB%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95%EF%BC%8C%E8%BF%99%E4%BA%9B%E8%AE%B0%E5%BD%95%E6%8C%89%E7%85%A7%E5%88%97%E8%BF%9B%E8%A1%8C%E7%8B%AC%E7%AB%8B%E5%AD%98%E5%82%A8%EF%BC%8C%E5%AF%B9%E5%BA%94%E5%88%B0Parquet\"><span class=\"toc-text\">的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E7%9A%84row-group%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%82%E6%AF%8F%E4%B8%AAStripe%E9%87%8C%E6%9C%89%E4%B8%89%E9%83%A8%E5%88%86%E7%BB%84%E6%88%90%EF%BC%8C%E5%88%86%E5%88%AB%E6%98%AFIndex-Data%EF%BC%8CRow-Data%EF%BC%8CStripe\"><span class=\"toc-text\">中的row group的概念。每个Stripe里有三部分组成，分别是Index Data，Row Data，Stripe</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Footer%EF%BC%9A\"><span class=\"toc-text\">Footer：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-49\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89Index-Data%EF%BC%9A%E4%B8%80%E4%B8%AA%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%9A%84index%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%E6%AF%8F%E9%9A%941W%E8%A1%8C%E5%81%9A%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%E3%80%82%E8%BF%99%E9%87%8C%E5%81%9A%E7%9A%84%E7%B4%A2%E5%BC%95%E5%BA%94%E8%AF%A5\"><span class=\"toc-text\">1 ）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AA%E6%98%AF%E8%AE%B0%E5%BD%95%E6%9F%90%E8%A1%8C%E7%9A%84%E5%90%84%E5%AD%97%E6%AE%B5%E5%9C%A8Row-Data%E4%B8%AD%E7%9A%84offset%E3%80%82\"><span class=\"toc-text\">只是记录某行的各字段在Row Data中的offset。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89Row-Data%EF%BC%9A%E5%AD%98%E7%9A%84%E6%98%AF%E5%85%B7%E4%BD%93%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%85%88%E5%8F%96%E9%83%A8%E5%88%86%E8%A1%8C%EF%BC%8C%E7%84%B6%E5%90%8E%E5%AF%B9%E8%BF%99%E4%BA%9B%E8%A1%8C%E6%8C%89%E5%88%97%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8%E3%80%82%E5%AF%B9%E6%AF%8F%E4%B8%AA\"><span class=\"toc-text\">2 ）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%97%E8%BF%9B%E8%A1%8C%E4%BA%86%E7%BC%96%E7%A0%81%EF%BC%8C%E5%88%86%E6%88%90%E5%A4%9A%E4%B8%AAStream%E6%9D%A5%E5%AD%98%E5%82%A8%E3%80%82\"><span class=\"toc-text\">列进行了编码，分成多个Stream来存储。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89Stripe-Footer%EF%BC%9A%E5%AD%98%E7%9A%84%E6%98%AF%E5%90%84%E4%B8%AAStream%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%8C%E9%95%BF%E5%BA%A6%E7%AD%89%E4%BF%A1%E6%81%AF%E3%80%82\"><span class=\"toc-text\">3 ）Stripe Footer：存的是各个Stream的类型，长度等信息。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%AF%8F%E4%B8%AA%E6%96%87%E4%BB%B6%E6%9C%89%E4%B8%80%E4%B8%AAFile-Footer%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E5%AD%98%E7%9A%84%E6%98%AF%E6%AF%8F%E4%B8%AAStripe%E7%9A%84%E8%A1%8C%E6%95%B0%EF%BC%8C%E6%AF%8F%E4%B8%AAColumn%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB\"><span class=\"toc-text\">每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9E%8B%E4%BF%A1%E6%81%AF%E7%AD%89%EF%BC%9B%E6%AF%8F%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E5%B0%BE%E9%83%A8%E6%98%AF%E4%B8%80%E4%B8%AAPostScript%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E8%AE%B0%E5%BD%95%E4%BA%86%E6%95%B4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E5%8E%8B%E7%BC%A9%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A\"><span class=\"toc-text\">型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#FileFooter%E7%9A%84%E9%95%BF%E5%BA%A6%E4%BF%A1%E6%81%AF%E7%AD%89%E3%80%82%E5%9C%A8%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E6%97%B6%EF%BC%8C%E4%BC%9Aseek%E5%88%B0%E6%96%87%E4%BB%B6%E5%B0%BE%E9%83%A8%E8%AF%BBPostScript%EF%BC%8C%E4%BB%8E%E9%87%8C%E9%9D%A2%E8%A7%A3%E6%9E%90%E5%88%B0\"><span class=\"toc-text\">FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#File-Footer%E9%95%BF%E5%BA%A6%EF%BC%8C%E5%86%8D%E8%AF%BBFileFooter%EF%BC%8C%E4%BB%8E%E9%87%8C%E9%9D%A2%E8%A7%A3%E6%9E%90%E5%88%B0%E5%90%84%E4%B8%AAStripe%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%86%8D%E8%AF%BB%E5%90%84%E4%B8%AAStripe%EF%BC%8C%E5%8D%B3%E4%BB%8E%E5%90%8E\"><span class=\"toc-text\">File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BE%80%E5%89%8D%E8%AF%BB%E3%80%82\"><span class=\"toc-text\">往前读。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-50\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-4-Parquet-%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">9 .4.4 Parquet 格式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Parquet%E6%96%87%E4%BB%B6%E6%98%AF%E4%BB%A5%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%B9%E5%BC%8F%E5%AD%98%E5%82%A8%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%98%AF%E4%B8%8D%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E7%9A%84%EF%BC%8C%E6%96%87%E4%BB%B6%E4%B8%AD%E5%8C%85%E6%8B%AC%E8%AF%A5%E6%96%87%E4%BB%B6%E7%9A%84\"><span class=\"toc-text\">Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%92%8C%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%9B%A0%E6%AD%A4Parquet%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E6%98%AF%E8%87%AA%E8%A7%A3%E6%9E%90%E7%9A%84%E3%80%82\"><span class=\"toc-text\">数据和元数据，因此Parquet格式文件是自解析的。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%A1%8C%E7%BB%84-Row-Group-%EF%BC%9A%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%84%E5%8C%85%E5%90%AB%E4%B8%80%E5%AE%9A%E7%9A%84%E8%A1%8C%E6%95%B0%EF%BC%8C%E5%9C%A8%E4%B8%80%E4%B8%AAHDFS%E6%96%87%E4%BB%B6%E4%B8%AD%E8%87%B3%E5%B0%91%E5%AD%98%E5%82%A8%E4%B8%80\"><span class=\"toc-text\">（ 1 ）行组(Row Group)：每一个行组包含一定的行数，在一个HDFS文件中至少存储一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AA%E8%A1%8C%E7%BB%84%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8Eorc%E7%9A%84stripe%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%82\"><span class=\"toc-text\">个行组，类似于orc的stripe的概念。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%88%97%E5%9D%97-Column-Chunk-%EF%BC%9A%E5%9C%A8%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%84%E4%B8%AD%E6%AF%8F%E4%B8%80%E5%88%97%E4%BF%9D%E5%AD%98%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%88%97%E5%9D%97%E4%B8%AD%EF%BC%8C%E8%A1%8C%E7%BB%84%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E5%88%97%E8%BF%9E\"><span class=\"toc-text\">（ 2 ）列块(Column Chunk)：在一个行组中每一列保存在一个列块中，行组中的所有列连</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%AD%E7%9A%84%E5%AD%98%E5%82%A8%E5%9C%A8%E8%BF%99%E4%B8%AA%E8%A1%8C%E7%BB%84%E6%96%87%E4%BB%B6%E4%B8%AD%E3%80%82%E4%B8%80%E4%B8%AA%E5%88%97%E5%9D%97%E4%B8%AD%E7%9A%84%E5%80%BC%E9%83%BD%E6%98%AF%E7%9B%B8%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%88%97%E5%9D%97%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84\"><span class=\"toc-text\">续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%8E%8B%E7%BC%A9%E3%80%82\"><span class=\"toc-text\">算法进行压缩。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E9%A1%B5-Page-%EF%BC%9A%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%88%97%E5%9D%97%E5%88%92%E5%88%86%E4%B8%BA%E5%A4%9A%E4%B8%AA%E9%A1%B5%EF%BC%8C%E4%B8%80%E4%B8%AA%E9%A1%B5%E6%98%AF%E6%9C%80%E5%B0%8F%E7%9A%84%E7%BC%96%E7%A0%81%E7%9A%84%E5%8D%95%E4%BD%8D%EF%BC%8C%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E5%88%97%E5%9D%97\"><span class=\"toc-text\">（ 3 ）页(Page)：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E4%B8%8D%E5%90%8C%E9%A1%B5%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E3%80%82\"><span class=\"toc-text\">的不同页可能使用不同的编码方式。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%80%9A%E5%B8%B8%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%AD%98%E5%82%A8Parquet%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E6%8C%89%E7%85%A7Block%E5%A4%A7%E5%B0%8F%E8%AE%BE%E7%BD%AE%E8%A1%8C%E7%BB%84%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E7%94%B1%E4%BA%8E%E4%B8%80%E8%88%AC\"><span class=\"toc-text\">通常情况下，在存储Parquet数据的时候会按照Block大小设置行组的大小，由于一般</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%83%85%E5%86%B5%E4%B8%8B%E6%AF%8F%E4%B8%80%E4%B8%AAMapper%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9C%80%E5%B0%8F%E5%8D%95%E4%BD%8D%E6%98%AF%E4%B8%80%E4%B8%AABlock%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E6%8A%8A%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%84%E7%94%B1%E4%B8%80\"><span class=\"toc-text\">情况下每一个Mapper任务处理数据的最小单位是一个Block，这样可以把每一个行组由一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AAMapper%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%EF%BC%8C%E5%A2%9E%E5%A4%A7%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E5%B9%B6%E8%A1%8C%E5%BA%A6%E3%80%82Parquet%E6%96%87%E4%BB%B6%E7%9A%84%E6%A0%BC%E5%BC%8F%E3%80%82\"><span class=\"toc-text\">个Mapper任务处理，增大任务执行并行度。Parquet文件的格式。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2\"><span class=\"toc-text\">2</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E5%9B%BE%E5%B1%95%E7%A4%BA%E4%BA%86%E4%B8%80%E4%B8%AAParquet%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8%E5%A4%9A%E4%B8%AA%E8%A1%8C%E7%BB%84%EF%BC%8C%E6%96%87%E4%BB%B6%E7%9A%84%E9%A6%96%E4%BD%8D%E9%83%BD%E6%98%AF\"><span class=\"toc-text\">上图展示了一个Parquet文件的内容，一个文件中可以存储多个行组，文件的首位都是</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A5%E6%96%87%E4%BB%B6%E7%9A%84Magic-Code%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%A0%A1%E9%AA%8C%E5%AE%83%E6%98%AF%E5%90%A6%E6%98%AF%E4%B8%80%E4%B8%AAParquet%E6%96%87%E4%BB%B6%EF%BC%8CFooter-length%E8%AE%B0%E5%BD%95%E4%BA%86%E6%96%87%E4%BB%B6%E5%85%83%E6%95%B0\"><span class=\"toc-text\">该文件的Magic Code，用于校验它是否是一个Parquet文件，Footer length记录了文件元数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-51\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8D%AE%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E9%80%9A%E8%BF%87%E8%AF%A5%E5%80%BC%E5%92%8C%E6%96%87%E4%BB%B6%E9%95%BF%E5%BA%A6%E5%8F%AF%E4%BB%A5%E8%AE%A1%E7%AE%97%E5%87%BA%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%8C%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8C%85%E6%8B%AC%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%A1%8C\"><span class=\"toc-text\">据的大小，通过该值和文件长度可以计算出元数据的偏移量，文件的元数据中包括每一个行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%84%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E5%92%8C%E8%AF%A5%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84Schema%E4%BF%A1%E6%81%AF%E3%80%82%E9%99%A4%E4%BA%86%E6%96%87%E4%BB%B6%E4%B8%AD%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%84%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%AF%8F%E4%B8%80\"><span class=\"toc-text\">组的元数据信息和该文件存储数据的Schema信息。除了文件中每一个行组的元数据，每一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%A1%B5%E7%9A%84%E5%BC%80%E5%A7%8B%E9%83%BD%E4%BC%9A%E5%AD%98%E5%82%A8%E8%AF%A5%E9%A1%B5%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%9C%A8Parquet%E4%B8%AD%EF%BC%8C%E6%9C%89%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%A1%B5%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%A1%B5%E3%80%81%E5%AD%97%E5%85%B8%E9%A1%B5%E5%92%8C%E7%B4%A2%E5%BC%95\"><span class=\"toc-text\">页的开始都会存储该页的元数据，在Parquet中，有三种类型的页：数据页、字典页和索引</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%A1%B5%E3%80%82%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%94%A8%E4%BA%8E%E5%AD%98%E5%82%A8%E5%BD%93%E5%89%8D%E8%A1%8C%E7%BB%84%E4%B8%AD%E8%AF%A5%E5%88%97%E7%9A%84%E5%80%BC%EF%BC%8C%E5%AD%97%E5%85%B8%E9%A1%B5%E5%AD%98%E5%82%A8%E8%AF%A5%E5%88%97%E5%80%BC%E7%9A%84%E7%BC%96%E7%A0%81%E5%AD%97%E5%85%B8%EF%BC%8C%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%88%97%E5%9D%97%E4%B8%AD%E6%9C%80\"><span class=\"toc-text\">页。数据页用于存储当前行组中该列的值，字典页存储该列值的编码字典，每一个列块中最</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8%E9%A1%B5%EF%BC%8C%E7%B4%A2%E5%BC%95%E9%A1%B5%E7%94%A8%E6%9D%A5%E5%AD%98%E5%82%A8%E5%BD%93%E5%89%8D%E8%A1%8C%E7%BB%84%E4%B8%8B%E8%AF%A5%E5%88%97%E7%9A%84%E7%B4%A2%E5%BC%95%EF%BC%8C%E7%9B%AE%E5%89%8DParquet%E4%B8%AD%E8%BF%98%E4%B8%8D%E6%94%AF%E6%8C%81%E7%B4%A2%E5%BC%95\"><span class=\"toc-text\">多包含一个字典页，索引页用来存储当前行组下该列的索引，目前Parquet中还不支持索引</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%A1%B5%E3%80%82\"><span class=\"toc-text\">页。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-4-5-%E4%B8%BB%E6%B5%81%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E5%AF%B9%E6%AF%94%E5%AE%9E%E9%AA%8C\"><span class=\"toc-text\">9 .4.5 主流文件存储格式对比实验</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%8E%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%9A%84%E5%8E%8B%E7%BC%A9%E6%AF%94%E5%92%8C%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%E4%B8%A4%E4%B8%AA%E8%A7%92%E5%BA%A6%E5%AF%B9%E6%AF%94%E3%80%82\"><span class=\"toc-text\">从存储文件的压缩比和查询速度两个角度对比。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%9A%84%E5%8E%8B%E7%BC%A9%E6%AF%94%E6%B5%8B%E8%AF%95%EF%BC%9A\"><span class=\"toc-text\">存储文件的压缩比测试：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">1 ）测试数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-TextFile\"><span class=\"toc-text\">2 ） TextFile</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%8C%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E4%B8%BATEXTFILE\"><span class=\"toc-text\">（ 1 ）创建表，存储数据格式为TEXTFILE</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%90%91%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 2 ）向表中加载数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F\"><span class=\"toc-text\">（ 3 ）查看表中数据大小</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#18-1-3-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-text-x2F-log-data\"><span class=\"toc-text\">18.1 3 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_text&#x2F;log.data</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-ORC\"><span class=\"toc-text\">3 ） ORC</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%8C%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E4%B8%BAORC\"><span class=\"toc-text\">（ 1 ）创建表，存储数据格式为ORC</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-52\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%90%91%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">（ 2 ）向表中加载数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F-1\"><span class=\"toc-text\">（ 3 ）查看表中数据大小</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-7-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-x2F-000000-0\"><span class=\"toc-text\">7. 7 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc&#x2F;000000_0</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89-Parquet\"><span class=\"toc-text\">4 ） Parquet</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E8%A1%A8%EF%BC%8C%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E4%B8%BAparquet\"><span class=\"toc-text\">（ 1 ）创建表，存储数据格式为parquet</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%90%91%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">（ 2 ）向表中加载数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F-2\"><span class=\"toc-text\">（ 3 ）查看表中数据大小</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#13-1-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-x2F-000000-0\"><span class=\"toc-text\">13.1 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_parquet&#x2F;000000_0</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%9A%84%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93%EF%BC%9A\"><span class=\"toc-text\">存储文件的对比总结：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ORC-gt-Parquet-gt-textFile\"><span class=\"toc-text\">ORC &gt; Parquet &gt; textFile</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%9A%84%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%E6%B5%8B%E8%AF%95%EF%BC%9A\"><span class=\"toc-text\">存储文件的查询速度测试：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89TextFile\"><span class=\"toc-text\">（ 1 ）TextFile</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89ORC\"><span class=\"toc-text\">（ 2 ）ORC</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89Parquet\"><span class=\"toc-text\">（ 3 ）Parquet</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%9A%84%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%E6%80%BB%E7%BB%93%EF%BC%9A%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%E7%9B%B8%E8%BF%91%E3%80%82\"><span class=\"toc-text\">存储文件的查询速度总结：查询速度相近。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-53\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-5-%E5%AD%98%E5%82%A8%E5%92%8C%E5%8E%8B%E7%BC%A9%E7%BB%93%E5%90%88\"><span class=\"toc-text\">9 .5 存储和压缩结合</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#9-5-1-%E6%B5%8B%E8%AF%95%E5%AD%98%E5%82%A8%E5%92%8C%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">9 .5.1 测试存储和压缩</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%98%E7%BD%91%EF%BC%9Ahttps-cwiki-apache-org-confluence-display-Hive-LanguageManual-ORC\"><span class=\"toc-text\">官网：https:&#x2F;&#x2F;cwiki.apache.org&#x2F;confluence&#x2F;display&#x2F;Hive&#x2F;LanguageManual+ORC</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ORC%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E7%9A%84%E5%8E%8B%E7%BC%A9%EF%BC%9A\"><span class=\"toc-text\">ORC存储方式的压缩：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%89%80%E6%9C%89%E5%85%B3%E4%BA%8EORCFile%E7%9A%84%E5%8F%82%E6%95%B0%E9%83%BD%E6%98%AF%E5%9C%A8HQL%E8%AF%AD%E5%8F%A5%E7%9A%84TBLPROPERTIES%E5%AD%97%E6%AE%B5%E9%87%8C%E9%9D%A2%E5%87%BA%E7%8E%B0\"><span class=\"toc-text\">注意：所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ZLIB-%E5%8E%8B%E7%BC%A9%E7%9A%84-ORC-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">1 ）创建一个 ZLIB 压缩的 ORC 存储方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 1 ）建表语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 2 ）插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E6%8F%92%E5%85%A5%E5%90%8E%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 3 ）查看插入后数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-78-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-none-x2F-000000-0\"><span class=\"toc-text\">2.78 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_none&#x2F;000000_0</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-SNAPPY-%E5%8E%8B%E7%BC%A9%E7%9A%84-ORC-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">2 ）创建一个 SNAPPY 压缩的 ORC 存储方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5-1\"><span class=\"toc-text\">（ 1 ）建表语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-54\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">（ 2 ）插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E6%8F%92%E5%85%A5%E5%90%8E%E6%95%B0%E6%8D%AE-1\"><span class=\"toc-text\">（ 3 ）查看插入后数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-75-M-x2F-user-x2F-hive-x2F-warehouse-x2F-log-orc-snappy-x2F-000000-0\"><span class=\"toc-text\">3. 75 M &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;log_orc_snappy&#x2F;000000_0</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#ZLIB%E6%AF%94Snappy%E5%8E%8B%E7%BC%A9%E7%9A%84%E8%BF%98%E5%B0%8F%E3%80%82%E5%8E%9F%E5%9B%A0%E6%98%AFZLIB%E9%87%87%E7%94%A8%E7%9A%84%E6%98%AFdeflate%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95%E3%80%82%E6%AF%94snappy%E5%8E%8B%E7%BC%A9%E7%9A%84\"><span class=\"toc-text\">ZLIB比Snappy压缩的还小。原因是ZLIB采用的是deflate压缩算法。比snappy压缩的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%8B%E7%BC%A9%E7%8E%87%E9%AB%98%E3%80%82\"><span class=\"toc-text\">压缩率高。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-SNAPPY-%E5%8E%8B%E7%BC%A9%E7%9A%84-parquet-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">3 ）创建一个 SNAPPY 压缩的 parquet 存储方式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5-2\"><span class=\"toc-text\">（ 1 ）建表语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">（ 2 ）插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9F%A5%E7%9C%8B%E6%8F%92%E5%85%A5%E5%90%8E%E6%95%B0%E6%8D%AE-2\"><span class=\"toc-text\">（ 3 ）查看插入后数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-39-MB-x2F-user-x2F-hive-x2F-warehouse-x2F-log-parquet-snappy-x2F-000000-0\"><span class=\"toc-text\">6.39 MB &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F; log_parquet_snappy &#x2F;000000_0</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E5%92%8C%E5%8E%8B%E7%BC%A9%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">4 ）存储方式和压缩总结</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E5%AE%9E%E9%99%85%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%BD%93%E4%B8%AD%EF%BC%8Chive%E8%A1%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E4%B8%80%E8%88%AC%E9%80%89%E6%8B%A9%EF%BC%9Aorc%E6%88%96parquet%E3%80%82%E5%8E%8B%E7%BC%A9%E6%96%B9%E5%BC%8F%E4%B8%80\"><span class=\"toc-text\">在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%88%AC%E9%80%89%E6%8B%A9snappy%EF%BC%8Clzo%E3%80%82\"><span class=\"toc-text\">般选择snappy，lzo。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-10-%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%B0%83%E4%BC%98\"><span class=\"toc-text\">第 10 章 企业级调优</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-0-1-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%88-Explain-%EF%BC%89\"><span class=\"toc-text\">1 0. 1 执行计划（ Explain ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">1 ）基本语法</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-55\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#EXPLAIN-EXTENDED-DEPENDENCY-AUTHORIZATION-query\"><span class=\"toc-text\">EXPLAIN [EXTENDED | DEPENDENCY | AUTHORIZATION] query</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-5\"><span class=\"toc-text\">2 ）案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%9F%A5%E7%9C%8B%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%9D%A1%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\"><span class=\"toc-text\">（ 1 ）查看下面这条语句的执行计划</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B2%A1%E6%9C%89%E7%94%9F%E6%88%90MR%E4%BB%BB%E5%8A%A1%E7%9A%84\"><span class=\"toc-text\">没有生成MR任务的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E7%94%9F%E6%88%90MR%E4%BB%BB%E5%8A%A1%E7%9A%84\"><span class=\"toc-text\">有生成MR任务的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-56\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\"><span class=\"toc-text\">（ 2 ）查看详细执行计划</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-2-Fetch-%E6%8A%93%E5%8F%96\"><span class=\"toc-text\">10. 2 Fetch 抓取</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Fetch%E6%8A%93%E5%8F%96%E6%98%AF%E6%8C%87%EF%BC%8CHive%E4%B8%AD%E5%AF%B9%E6%9F%90%E4%BA%9B%E6%83%85%E5%86%B5%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%AF%E4%BB%A5%E4%B8%8D%E5%BF%85%E4%BD%BF%E7%94%A8MapReduce%E8%AE%A1%E7%AE%97%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%9ASELECT\"><span class=\"toc-text\">Fetch抓取是指，Hive中对某些情况的查询可以不必使用MapReduce计算。例如：SELECT</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#FROM-employees-%E5%9C%A8%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CHive%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8D%95%E5%9C%B0%E8%AF%BB%E5%8F%96employee%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C\"><span class=\"toc-text\">* FROM employees;在这种情况下，Hive可以简单地读取employee对应的存储目录下的文件，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%84%B6%E5%90%8E%E8%BE%93%E5%87%BA%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0%E3%80%82\"><span class=\"toc-text\">然后输出查询结果到控制台。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8hive-default-xml-template%E6%96%87%E4%BB%B6%E4%B8%ADhive-fetch-task-conversion%E9%BB%98%E8%AE%A4%E6%98%AFmore%EF%BC%8C%E8%80%81%E7%89%88%E6%9C%AChive\"><span class=\"toc-text\">在hive-default.xml.template文件中hive.fetch.task.conversion默认是more，老版本hive</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E6%98%AFminimal%EF%BC%8C%E8%AF%A5%E5%B1%9E%E6%80%A7%E4%BF%AE%E6%94%B9%E4%B8%BA-more%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%9C%A8%E5%85%A8%E5%B1%80%E6%9F%A5%E6%89%BE%E3%80%81%E5%AD%97%E6%AE%B5%E6%9F%A5%E6%89%BE%E3%80%81limit%E6%9F%A5%E6%89%BE%E7%AD%89%E9%83%BD%E4%B8%8D%E8%B5%B0\"><span class=\"toc-text\">默认是minimal，该属性修改为 more以后，在全局查找、字段查找、limit查找等都不走</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#mapreduce%E3%80%82\"><span class=\"toc-text\">mapreduce。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-57\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-4\"><span class=\"toc-text\">1 ）案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%8A%8A-hive-fetch-task-conversion%E8%AE%BE%E7%BD%AE%E6%88%90none%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%8C%E9%83%BD%E4%BC%9A%E6%89%A7%E8%A1%8Cmapreduce\"><span class=\"toc-text\">（ 1 ）把 hive.fetch.task.conversion设置成none，然后执行查询语句，都会执行mapreduce</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A8%8B%E5%BA%8F%E3%80%82\"><span class=\"toc-text\">程序。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%8A%8Ahive-fetch-task-conversion%E8%AE%BE%E7%BD%AE%E6%88%90more%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%8C%E5%A6%82%E4%B8%8B%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F%E9%83%BD%E4%B8%8D\"><span class=\"toc-text\">（ 2 ）把hive.fetch.task.conversion设置成more，然后执行查询语句，如下查询方式都不</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BC%9A%E6%89%A7%E8%A1%8Cmapreduce%E7%A8%8B%E5%BA%8F%E3%80%82\"><span class=\"toc-text\">会执行mapreduce程序。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-3-%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">10.3 本地模式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E5%A4%9A%E6%95%B0%E7%9A%84Hadoop-Job%E6%98%AF%E9%9C%80%E8%A6%81Hadoop%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AE%8C%E6%95%B4%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E6%9D%A5%E5%A4%84%E7%90%86%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E3%80%82%E4%B8%8D%E8%BF%87%EF%BC%8C\"><span class=\"toc-text\">大多数的Hadoop Job是需要Hadoop提供的完整的可扩展性来处理大数据集的。不过，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E6%97%B6Hive%E7%9A%84%E8%BE%93%E5%85%A5%E6%95%B0%E6%8D%AE%E9%87%8F%E6%98%AF%E9%9D%9E%E5%B8%B8%E5%B0%8F%E7%9A%84%E3%80%82%E5%9C%A8%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E4%B8%BA%E6%9F%A5%E8%AF%A2%E8%A7%A6%E5%8F%91%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1%E6%B6%88%E8%80%97%E7%9A%84%E6%97%B6%E9%97%B4%E5%8F%AF%E8%83%BD\"><span class=\"toc-text\">有时Hive的输入数据量是非常小的。在这种情况下，为查询触发执行任务消耗的时间可能</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BC%9A%E6%AF%94%E5%AE%9E%E9%99%85job%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E8%A6%81%E5%A4%9A%E7%9A%84%E5%A4%9A%E3%80%82%E5%AF%B9%E4%BA%8E%E5%A4%A7%E5%A4%9A%E6%95%B0%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8CHive%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%8D%95%E5%8F%B0%E6%9C%BA\"><span class=\"toc-text\">会比实际job的执行时间要多的多。对于大多数这种情况，Hive可以通过本地模式在单台机</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%99%A8%E4%B8%8A%E5%A4%84%E7%90%86%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%BB%E5%8A%A1%E3%80%82%E5%AF%B9%E4%BA%8E%E5%B0%8F%E6%95%B0%E6%8D%AE%E9%9B%86%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E5%8F%AF%E4%BB%A5%E6%98%8E%E6%98%BE%E8%A2%AB%E7%BC%A9%E7%9F%AD%E3%80%82\"><span class=\"toc-text\">器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AE%BE%E7%BD%AEhive-exec-mode-local-auto%E7%9A%84%E5%80%BC%E4%B8%BAtrue%EF%BC%8C%E6%9D%A5%E8%AE%A9Hive%E5%9C%A8%E9%80%82%E5%BD%93%E7%9A%84%E6%97%B6%E5%80%99%E8%87%AA%E5%8A%A8\"><span class=\"toc-text\">用户可以通过设置hive.exec.mode.local.auto的值为true，来让Hive在适当的时候自动</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E8%BF%99%E4%B8%AA%E4%BC%98%E5%8C%96%E3%80%82\"><span class=\"toc-text\">启动这个优化。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A\"><span class=\"toc-text\">1 ） 案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%85%B3%E9%97%AD%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F%EF%BC%88%E9%BB%98%E8%AE%A4%E6%98%AF%E5%85%B3%E9%97%AD%E7%9A%84%EF%BC%89%EF%BC%8C%E5%B9%B6%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 2 ）关闭本地模式（默认是关闭的），并执行查询语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-58\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%BC%80%E5%90%AF%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%B9%B6%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">（ 1 ）开启本地模式，并执行查询语句</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-%E8%A1%A8%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">10. 4 表的优化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-1-%E5%B0%8F%E8%A1%A8%E5%A4%A7%E8%A1%A8-Join-%EF%BC%88-MapJOIN-%EF%BC%89\"><span class=\"toc-text\">10. 4 .1 小表大表 Join （ MapJOIN ）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86key%E7%9B%B8%E5%AF%B9%E5%88%86%E6%95%A3%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%95%B0%E6%8D%AE%E9%87%8F%E5%B0%8F%E7%9A%84%E8%A1%A8%E6%94%BE%E5%9C%A8join%E7%9A%84%E5%B7%A6%E8%BE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8map-join%E8%AE%A9%E5%B0%8F%E7%9A%84%E7%BB%B4%E5%BA%A6%E8%A1%A8\"><span class=\"toc-text\">将key相对分散，并且数据量小的表放在join的左边，可以使用map join让小的维度表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%85%88%E8%BF%9B%E5%86%85%E5%AD%98%E3%80%82%E5%9C%A8map%E7%AB%AF%E5%AE%8C%E6%88%90join%E3%80%82\"><span class=\"toc-text\">先进内存。在map端完成join。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E9%99%85%E6%B5%8B%E8%AF%95%E5%8F%91%E7%8E%B0%EF%BC%9A%E6%96%B0%E7%89%88%E7%9A%84hive%E5%B7%B2%E7%BB%8F%E5%AF%B9%E5%B0%8F%E8%A1%A8JOIN%E5%A4%A7%E8%A1%A8%E5%92%8C%E5%A4%A7%E8%A1%A8JOIN%E5%B0%8F%E8%A1%A8%E8%BF%9B%E8%A1%8C%E4%BA%86%E4%BC%98%E5%8C%96%E3%80%82%E5%B0%8F%E8%A1%A8%E6%94%BE\"><span class=\"toc-text\">实际测试发现：新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E5%B7%A6%E8%BE%B9%E5%92%8C%E5%8F%B3%E8%BE%B9%E5%B7%B2%E7%BB%8F%E6%B2%A1%E6%9C%89%E5%8C%BA%E5%88%AB%E3%80%82\"><span class=\"toc-text\">在左边和右边已经没有区别。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%9C%80%E6%B1%82%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">1 ）需求介绍</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%A1%A8JOIN%E5%B0%8F%E8%A1%A8%E5%92%8C%E5%B0%8F%E8%A1%A8JOIN%E5%A4%A7%E8%A1%A8%E7%9A%84%E6%95%88%E7%8E%87\"><span class=\"toc-text\">测试大表JOIN小表和小表JOIN大表的效率</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%BC%80%E5%90%AF-MapJoin-%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">2 ）开启 MapJoin 参数设置</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E9%80%89%E6%8B%A9Mapjoin\"><span class=\"toc-text\">（ 1 ）设置自动选择Mapjoin</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%A4%A7%E8%A1%A8%E5%B0%8F%E8%A1%A8%E7%9A%84%E9%98%88%E5%80%BC%E8%AE%BE%E7%BD%AE%EF%BC%88%E9%BB%98%E8%AE%A425M%E4%BB%A5%E4%B8%8B%E8%AE%A4%E4%B8%BA%E6%98%AF%E5%B0%8F%E8%A1%A8%EF%BC%89%EF%BC%9A\"><span class=\"toc-text\">（ 2 ）大表小表的阈值设置（默认25M以下认为是小表）：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-MapJoin-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6\"><span class=\"toc-text\">3 ） MapJoin 工作机制</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%BB%BA%E5%A4%A7%E8%A1%A8%E3%80%81%E5%B0%8F%E8%A1%A8%E5%92%8C-JOIN-%E5%90%8E%E8%A1%A8%E7%9A%84%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">4 ）建大表、小表和 JOIN 后表的语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-59\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E5%88%86%E5%88%AB%E5%90%91%E5%A4%A7%E8%A1%A8%E5%92%8C%E5%B0%8F%E8%A1%A8%E4%B8%AD%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">5 ）分别向大表和小表中导入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E5%B0%8F%E8%A1%A8-JOIN-%E5%A4%A7%E8%A1%A8%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">6 ）小表 JOIN 大表语句</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-%EF%BC%89%E5%A4%A7%E8%A1%A8-JOIN-%E5%B0%8F%E8%A1%A8%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">7 ）大表 JOIN 小表语句</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-2-%E5%A4%A7%E8%A1%A8-Join-%E5%A4%A7%E8%A1%A8\"><span class=\"toc-text\">10.4.2 大表 Join 大表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E7%A9%BA-KEY-%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">1 ）空 KEY 过滤</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E6%97%B6join%E8%B6%85%E6%97%B6%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%9F%90%E4%BA%9Bkey%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%AA%E5%A4%9A%EF%BC%8C%E8%80%8C%E7%9B%B8%E5%90%8Ckey%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E9%83%BD%E4%BC%9A%E5%8F%91%E9%80%81%E5%88%B0%E7%9B%B8%E5%90%8C\"><span class=\"toc-text\">有时join超时是因为某些key对应的数据太多，而相同key对应的数据都会发送到相同</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84reducer%E4%B8%8A%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AF%BC%E8%87%B4%E5%86%85%E5%AD%98%E4%B8%8D%E5%A4%9F%E3%80%82%E6%AD%A4%E6%97%B6%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E4%BB%94%E7%BB%86%E5%88%86%E6%9E%90%E8%BF%99%E4%BA%9B%E5%BC%82%E5%B8%B8%E7%9A%84key%EF%BC%8C%E5%BE%88%E5%A4%9A%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C\"><span class=\"toc-text\">的reducer上，从而导致内存不够。此时我们应该仔细分析这些异常的key，很多情况下，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%99%E4%BA%9Bkey%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%BC%82%E5%B8%B8%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%9C%A8SQL%E8%AF%AD%E5%8F%A5%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E3%80%82%E4%BE%8B%E5%A6%82key%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AD%97%E6%AE%B5%E4%B8%BA\"><span class=\"toc-text\">这些key对应的数据是异常数据，我们需要在SQL语句中进行过滤。例如key对应的字段为</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A9%BA%EF%BC%8C%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B%EF%BC%9A\"><span class=\"toc-text\">空，操作如下：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D-1\"><span class=\"toc-text\">案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E9%85%8D%E7%BD%AE%E5%8E%86%E5%8F%B2%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">（ 1 ）配置历史服务器</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEmapred-site-xml\"><span class=\"toc-text\">配置mapred-site.xml</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-60\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E5%8E%86%E5%8F%B2%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">启动历史服务器</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8Bjobhistory\"><span class=\"toc-text\">查看jobhistory</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#http-hadoop102-19888-jobhistory\"><span class=\"toc-text\">http:&#x2F;&#x2F;hadoop102:19888&#x2F;jobhistory</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%A9%BAid%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）创建原始数据空id表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%88%86%E5%88%AB%E5%8A%A0%E8%BD%BD%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%92%8C%E7%A9%BAid%E6%95%B0%E6%8D%AE%E5%88%B0%E5%AF%B9%E5%BA%94%E8%A1%A8%E4%B8%AD\"><span class=\"toc-text\">（ 3 ）分别加载原始数据和空id数据到对应表中</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%B5%8B%E8%AF%95%E4%B8%8D%E8%BF%87%E6%BB%A4%E7%A9%BAid\"><span class=\"toc-text\">（ 4 ）测试不过滤空id</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%B5%8B%E8%AF%95%E8%BF%87%E6%BB%A4%E7%A9%BAid\"><span class=\"toc-text\">（ 5 ）测试过滤空id</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E7%A9%BA-key-%E8%BD%AC%E6%8D%A2\"><span class=\"toc-text\">2 ）空 key 转换</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E6%97%B6%E8%99%BD%E7%84%B6%E6%9F%90%E4%B8%AAkey%E4%B8%BA%E7%A9%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BE%88%E5%A4%9A%EF%BC%8C%E4%BD%86%E6%98%AF%E7%9B%B8%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E6%98%AF%E5%BC%82%E5%B8%B8%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%BF%85%E9%A1%BB%E8%A6%81%E5%8C%85%E5%90%AB%E5%9C%A8\"><span class=\"toc-text\">有时虽然某个key为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#join%E7%9A%84%E7%BB%93%E6%9E%9C%E4%B8%AD%EF%BC%8C%E6%AD%A4%E6%97%B6%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%A1%A8a%E4%B8%ADkey%E4%B8%BA%E7%A9%BA%E7%9A%84%E5%AD%97%E6%AE%B5%E8%B5%8B%E4%B8%80%E4%B8%AA%E9%9A%8F%E6%9C%BA%E7%9A%84%E5%80%BC%EF%BC%8C%E4%BD%BF%E5%BE%97%E6%95%B0%E6%8D%AE%E9%9A%8F%E6%9C%BA%E5%9D%87%E5%8C%80%E5%9C%B0\"><span class=\"toc-text\">join的结果中，此时我们可以表a中key为空的字段赋一个随机的值，使得数据随机均匀地</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%86%E4%B8%8D%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84reducer%E4%B8%8A%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">分不到不同的reducer上。例如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A\"><span class=\"toc-text\">案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8D%E9%9A%8F%E6%9C%BA%E5%88%86%E5%B8%83%E7%A9%BAnull%E5%80%BC%EF%BC%9A\"><span class=\"toc-text\">不随机分布空null值：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%AE%BE%E7%BD%AE-5-%E4%B8%AAreduce%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">（ 1 ）设置 5 个reduce个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#set-mapreduce-job-reduces-x3D-5\"><span class=\"toc-text\">set mapreduce.job.reduces &#x3D; 5;</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89JOIN%E4%B8%A4%E5%BC%A0%E8%A1%A8\"><span class=\"toc-text\">（ 2 ）JOIN两张表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9E%9C%EF%BC%9A%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%87%BA%E7%8E%B0%E4%BA%86%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%EF%BC%8C%E6%9F%90%E4%BA%9Breducer%E7%9A%84%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97%E8%BF%9C%E5%A4%A7%E4%BA%8E%E5%85%B6\"><span class=\"toc-text\">结果：如下图所示，可以看出来，出现了数据倾斜，某些reducer的资源消耗远大于其</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%96reducer%E3%80%82\"><span class=\"toc-text\">他reducer。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-61\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%9A%8F%E6%9C%BA%E5%88%86%E5%B8%83%E7%A9%BAnull%E5%80%BC\"><span class=\"toc-text\">随机分布空null值</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%AE%BE%E7%BD%AE-5-%E4%B8%AAreduce%E4%B8%AA%E6%95%B0-1\"><span class=\"toc-text\">（ 1 ）设置 5 个reduce个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89JOIN%E4%B8%A4%E5%BC%A0%E8%A1%A8-1\"><span class=\"toc-text\">（ 2 ）JOIN两张表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9E%9C%EF%BC%9A%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%E6%9D%A5%EF%BC%8C%E6%B6%88%E9%99%A4%E4%BA%86%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%EF%BC%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1reducer%E7%9A%84%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97\"><span class=\"toc-text\">结果：如下图所示，可以看出来，消除了数据倾斜，负载均衡reducer的资源消耗</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-SMB-Sort-Merge-Bucket-join\"><span class=\"toc-text\">3 ） SMB(Sort Merge Bucket join)</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%BA%8C%E5%BC%A0%E5%A4%A7%E8%A1%A8\"><span class=\"toc-text\">（ 1 ）创建第二张大表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-62\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%A1%A8%E7%9B%B4%E6%8E%A5JOIN\"><span class=\"toc-text\">测试大表直接JOIN</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%88%86%E9%80%9A%E8%A1%A8-1-%E6%A1%B6%E7%9A%84%E4%B8%AA%E6%95%B0%E4%B8%8D%E8%A6%81%E8%B6%85%E8%BF%87%E5%8F%AF%E7%94%A8CPU%E7%9A%84%E6%A0%B8%E6%95%B0\"><span class=\"toc-text\">（ 2 ）创建分通表 1 ,桶的个数不要超过可用CPU的核数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%88%86%E9%80%9A%E8%A1%A8-2-%E6%A1%B6%E7%9A%84%E4%B8%AA%E6%95%B0%E4%B8%8D%E8%A6%81%E8%B6%85%E8%BF%87%E5%8F%AF%E7%94%A8CPU%E7%9A%84%E6%A0%B8%E6%95%B0\"><span class=\"toc-text\">（ 3 ）创建分通表 2 ,桶的个数不要超过可用CPU的核数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">（ 4 ）设置参数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">（ 5 ）测试</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-3-Group-By\"><span class=\"toc-text\">10.4.3 Group By</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CMap%E9%98%B6%E6%AE%B5%E5%90%8C%E4%B8%80Key%E6%95%B0%E6%8D%AE%E5%88%86%E5%8F%91%E7%BB%99%E4%B8%80%E4%B8%AAreduce%EF%BC%8C%E5%BD%93%E4%B8%80%E4%B8%AAkey%E6%95%B0%E6%8D%AE%E8%BF%87%E5%A4%A7%E6%97%B6%E5%B0%B1%E5%80%BE%E6%96%9C\"><span class=\"toc-text\">默认情况下，Map阶段同一Key数据分发给一个reduce，当一个key数据过大时就倾斜</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BA%86%E3%80%82\"><span class=\"toc-text\">了。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-63\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E9%83%BD%E9%9C%80%E8%A6%81%E5%9C%A8Reduce%E7%AB%AF%E5%AE%8C%E6%88%90%EF%BC%8C%E5%BE%88%E5%A4%9A%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%85%88%E5%9C%A8Map%E7%AB%AF%E8%BF%9B%E8%A1%8C\"><span class=\"toc-text\">并不是所有的聚合操作都需要在Reduce端完成，很多聚合操作都可以先在Map端进行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%83%A8%E5%88%86%E8%81%9A%E5%90%88%EF%BC%8C%E6%9C%80%E5%90%8E%E5%9C%A8Reduce%E7%AB%AF%E5%BE%97%E5%87%BA%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%E3%80%82\"><span class=\"toc-text\">部分聚合，最后在Reduce端得出最终结果。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%BC%80%E5%90%AF-Map-%E7%AB%AF%E8%81%9A%E5%90%88%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">1 ）开启 Map 端聚合参数设置</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%98%AF%E5%90%A6%E5%9C%A8Map%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BATrue\"><span class=\"toc-text\">（ 1 ）是否在Map端进行聚合，默认为True</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%9C%A8Map%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E7%9A%84%E6%9D%A1%E7%9B%AE%E6%95%B0%E7%9B%AE\"><span class=\"toc-text\">（ 2 ）在Map端进行聚合操作的条目数目</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9C%89%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%9B%E8%A1%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%89\"><span class=\"toc-text\">（ 3 ）有数据倾斜的时候进行负载均衡（默认是false）</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93%E9%80%89%E9%A1%B9%E8%AE%BE%E5%AE%9A%E4%B8%BA-true%EF%BC%8C%E7%94%9F%E6%88%90%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92%E4%BC%9A%E6%9C%89%E4%B8%A4%E4%B8%AAMR-Job%E3%80%82%E7%AC%AC%E4%B8%80%E4%B8%AAMR-Job%E4%B8%AD%EF%BC%8CMap%E7%9A%84%E8%BE%93%E5%87%BA\"><span class=\"toc-text\">当选项设定为 true，生成的查询计划会有两个MR Job。第一个MR Job中，Map的输出</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9E%9C%E4%BC%9A%E9%9A%8F%E6%9C%BA%E5%88%86%E5%B8%83%E5%88%B0Reduce%E4%B8%AD%EF%BC%8C%E6%AF%8F%E4%B8%AAReduce%E5%81%9A%E9%83%A8%E5%88%86%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%B9%B6%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%A4%84%E7%90%86%E7%9A%84%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">结果会随机分布到Reduce中，每个Reduce做部分聚合操作，并输出结果，这样处理的结果</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84Group-By-Key%E6%9C%89%E5%8F%AF%E8%83%BD%E8%A2%AB%E5%88%86%E5%8F%91%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84Reduce%E4%B8%AD%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BE%BE%E5%88%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E7%9B%AE%E7%9A%84%EF%BC%9B%E7%AC%AC%E4%BA%8C\"><span class=\"toc-text\">是相同的Group By Key有可能被分发到不同的Reduce中，从而达到负载均衡的目的；第二</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%AAMR-Job%E5%86%8D%E6%A0%B9%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%9C%E6%8C%89%E7%85%A7Group-By-Key%E5%88%86%E5%B8%83%E5%88%B0Reduce%E4%B8%AD%EF%BC%88%E8%BF%99%E4%B8%AA%E8%BF%87%E7%A8%8B%E5%8F%AF%E4%BB%A5%E4%BF%9D%E8%AF%81\"><span class=\"toc-text\">个MR Job再根据预处理的数据结果按照Group By Key分布到Reduce中（这个过程可以保证</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9B%B8%E5%90%8C%E7%9A%84Group-By-Key%E8%A2%AB%E5%88%86%E5%B8%83%E5%88%B0%E5%90%8C%E4%B8%80%E4%B8%AAReduce%E4%B8%AD%EF%BC%89%EF%BC%8C%E6%9C%80%E5%90%8E%E5%AE%8C%E6%88%90%E6%9C%80%E7%BB%88%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E3%80%82\"><span class=\"toc-text\">相同的Group By Key被分布到同一个Reduce中），最后完成最终的聚合操作。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BC%98%E5%8C%96%E4%BB%A5%E5%90%8E\"><span class=\"toc-text\">优化以后</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-64\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-4-Count-Distinct-%E5%8E%BB%E9%87%8D%E7%BB%9F%E8%AE%A1\"><span class=\"toc-text\">10.4. 4 Count(Distinct) 去重统计</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E9%87%8F%E5%B0%8F%E7%9A%84%E6%97%B6%E5%80%99%E6%97%A0%E6%89%80%E8%B0%93%EF%BC%8C%E6%95%B0%E6%8D%AE%E9%87%8F%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E7%94%B1%E4%BA%8E-COUNT-DISTINCT%E6%93%8D%E4%BD%9C%E9%9C%80%E8%A6%81%E7%94%A8%E4%B8%80%E4%B8%AA\"><span class=\"toc-text\">数据量小的时候无所谓，数据量大的情况下，由于 COUNT DISTINCT操作需要用一个</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Reduce-Task%E6%9D%A5%E5%AE%8C%E6%88%90%EF%BC%8C%E8%BF%99%E4%B8%80%E4%B8%AAReduce%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E9%87%8F%E5%A4%AA%E5%A4%A7%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%95%B4%E4%B8%AAJob%E5%BE%88%E9%9A%BE%E5%AE%8C%E6%88%90%EF%BC%8C\"><span class=\"toc-text\">Reduce Task来完成，这一个Reduce需要处理的数据量太大，就会导致整个Job很难完成，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%80%E8%88%ACCOUNT-DISTINCT%E4%BD%BF%E7%94%A8%E5%85%88GROUP-BY%E5%86%8DCOUNT%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9B%BF%E6%8D%A2-%E4%BD%86%E6%98%AF%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8Fgroup-by%E9%80%A0%E6%88%90\"><span class=\"toc-text\">一般COUNT DISTINCT使用先GROUP BY再COUNT的方式替换,但是需要注意group by造成</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">的数据倾斜问题.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89-%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D\"><span class=\"toc-text\">1 ） 案例实操</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E5%A4%A7%E8%A1%A8\"><span class=\"toc-text\">（ 1 ）创建一张大表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 2 ）加载数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E8%AE%BE%E7%BD%AE-5-%E4%B8%AAreduce%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">（ 3 ）设置 5 个reduce个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%89%A7%E8%A1%8C%E5%8E%BB%E9%87%8Did%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">（ 4 ）执行去重id查询</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-5-%EF%BC%89%E9%87%87%E7%94%A8GROUP-by%E5%8E%BB%E9%87%8Did\"><span class=\"toc-text\">（ 5 ）采用GROUP by去重id</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%99%BD%E7%84%B6%E4%BC%9A%E5%A4%9A%E7%94%A8%E4%B8%80%E4%B8%AAJob%E6%9D%A5%E5%AE%8C%E6%88%90%EF%BC%8C%E4%BD%86%E5%9C%A8%E6%95%B0%E6%8D%AE%E9%87%8F%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%BB%9D%E5%AF%B9%E6%98%AF%E5%80%BC%E5%BE%97%E7%9A%84%E3%80%82\"><span class=\"toc-text\">虽然会多用一个Job来完成，但在数据量大的情况下，这个绝对是值得的。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-5-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF\"><span class=\"toc-text\">10.4. 5 笛卡尔积</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%8Cjoin%E7%9A%84%E6%97%B6%E5%80%99%E4%B8%8D%E5%8A%A0on%E6%9D%A1%E4%BB%B6%EF%BC%8C%E6%88%96%E8%80%85%E6%97%A0%E6%95%88%E7%9A%84on%E6%9D%A1%E4%BB%B6%EF%BC%8CHive%E5%8F%AA%E8%83%BD%E4%BD%BF%E7%94%A8-1-%E4%B8%AA\"><span class=\"toc-text\">尽量避免笛卡尔积，join的时候不加on条件，或者无效的on条件，Hive只能使用 1 个</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#reducer%E6%9D%A5%E5%AE%8C%E6%88%90%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E3%80%82\"><span class=\"toc-text\">reducer来完成笛卡尔积。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-65\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-6-%E8%A1%8C%E5%88%97%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">10.4. 6 行列过滤</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%97%E5%A4%84%E7%90%86%EF%BC%9A%E5%9C%A8SELECT%E4%B8%AD%EF%BC%8C%E5%8F%AA%E6%8B%BF%E9%9C%80%E8%A6%81%E7%9A%84%E5%88%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E5%88%86%E5%8C%BA%EF%BC%8C%E5%B0%BD%E9%87%8F%E4%BD%BF%E7%94%A8%E5%88%86%E5%8C%BA%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%B0%91%E7%94%A8SELECT\"><span class=\"toc-text\">列处理：在SELECT中，只拿需要的列，如果有分区，尽量使用分区过滤，少用SELECT</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E3%80%82\"><span class=\"toc-text\">*。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%9A%E5%9C%A8%E5%88%86%E5%8C%BA%E5%89%AA%E8%A3%81%E4%B8%AD%EF%BC%8C%E5%BD%93%E4%BD%BF%E7%94%A8%E5%A4%96%E5%85%B3%E8%81%94%E6%97%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%B0%86%E5%89%AF%E8%A1%A8%E7%9A%84%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6%E5%86%99%E5%9C%A8Where%E5%90%8E%E9%9D%A2%EF%BC%8C\"><span class=\"toc-text\">行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在Where后面，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%82%A3%E4%B9%88%E5%B0%B1%E4%BC%9A%E5%85%88%E5%85%A8%E8%A1%A8%E5%85%B3%E8%81%94%EF%BC%8C%E4%B9%8B%E5%90%8E%E5%86%8D%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%AF%94%E5%A6%82%EF%BC%9A\"><span class=\"toc-text\">那么就会先全表关联，之后再过滤，比如：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-1\"><span class=\"toc-text\">案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%B5%8B%E8%AF%95%E5%85%88%E5%85%B3%E8%81%94%E4%B8%A4%E5%BC%A0%E8%A1%A8%EF%BC%8C%E5%86%8D%E7%94%A8-where-%E6%9D%A1%E4%BB%B6%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">1 ）测试先关联两张表，再用 where 条件过滤</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Time-taken-34-406-seconds-Fetched-100-row-s\"><span class=\"toc-text\">Time taken: 34.406 seconds, Fetched: 100 row(s)</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E9%80%9A%E8%BF%87%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%90%8E%EF%BC%8C%E5%86%8D%E5%85%B3%E8%81%94%E8%A1%A8\"><span class=\"toc-text\">2 ）通过子查询后，再关联表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Time-taken-30-058-seconds-Fetched-100-row-s\"><span class=\"toc-text\">Time taken: 30.058 seconds, Fetched: 100 row(s)</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-7-%E5%88%86%E5%8C%BA\"><span class=\"toc-text\">10.4. 7 分区</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%817-1%E7%AB%A0%E3%80%82\"><span class=\"toc-text\">详见7.1章。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-4-8-%E5%88%86%E6%A1%B6\"><span class=\"toc-text\">10.4. 8 分桶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%81-7-2%E7%AB%A0%E3%80%82\"><span class=\"toc-text\">详见 7 .2章。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-5-%E5%90%88%E7%90%86%E8%AE%BE%E7%BD%AE-Map-%E5%8F%8A-Reduce-%E6%95%B0\"><span class=\"toc-text\">10. 5 合理设置 Map 及 Reduce 数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%80%9A%E5%B8%B8%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E4%BD%9C%E4%B8%9A%E4%BC%9A%E9%80%9A%E8%BF%87input%E7%9A%84%E7%9B%AE%E5%BD%95%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AAmap%E4%BB%BB%E5%8A%A1%E3%80%82\"><span class=\"toc-text\">1 ）通常情况下，作业会通过input的目录产生一个或者多个map任务。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E8%A6%81%E7%9A%84%E5%86%B3%E5%AE%9A%E5%9B%A0%E7%B4%A0%E6%9C%89%EF%BC%9Ainput%E7%9A%84%E6%96%87%E4%BB%B6%E6%80%BB%E4%B8%AA%E6%95%B0%EF%BC%8Cinput%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%EF%BC%8C%E9%9B%86%E7%BE%A4%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%96%87%E4%BB%B6%E5%9D%97%E5%A4%A7%E5%B0%8F%E3%80%82\"><span class=\"toc-text\">主要的决定因素有：input的文件总个数，input的文件大小，集群设置的文件块大小。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E6%98%AF%E4%B8%8D%E6%98%AFmap%E6%95%B0%E8%B6%8A%E5%A4%9A%E8%B6%8A%E5%A5%BD%EF%BC%9F\"><span class=\"toc-text\">2 ）是不是map数越多越好？</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%AD%94%E6%A1%88%E6%98%AF%E5%90%A6%E5%AE%9A%E7%9A%84%E3%80%82%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%9C%89%E5%BE%88%E5%A4%9A%E5%B0%8F%E6%96%87%E4%BB%B6%EF%BC%88%E8%BF%9C%E8%BF%9C%E5%B0%8F%E4%BA%8E%E5%9D%97%E5%A4%A7%E5%B0%8F128m%EF%BC%89%EF%BC%8C%E5%88%99%E6%AF%8F%E4%B8%AA%E5%B0%8F%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">答案是否定的。如果一个任务有很多小文件（远远小于块大小128m），则每个小文件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B9%9F%E4%BC%9A%E8%A2%AB%E5%BD%93%E5%81%9A%E4%B8%80%E4%B8%AA%E5%9D%97%EF%BC%8C%E7%94%A8%E4%B8%80%E4%B8%AAmap%E4%BB%BB%E5%8A%A1%E6%9D%A5%E5%AE%8C%E6%88%90%EF%BC%8C%E8%80%8C%E4%B8%80%E4%B8%AAmap%E4%BB%BB%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%97%B6%E9%97%B4%E8%BF%9C%E8%BF%9C%E5%A4%A7\"><span class=\"toc-text\">也会被当做一个块，用一个map任务来完成，而一个map任务启动和初始化的时间远远大</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BA%8E%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%8C%E5%B0%B1%E4%BC%9A%E9%80%A0%E6%88%90%E5%BE%88%E5%A4%A7%E7%9A%84%E8%B5%84%E6%BA%90%E6%B5%AA%E8%B4%B9%E3%80%82%E8%80%8C%E4%B8%94%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9A%84map%E6%95%B0%E6%98%AF%E5%8F%97%E9%99%90%E7%9A%84%E3%80%82\"><span class=\"toc-text\">于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的map数是受限的。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%98%AF%E4%B8%8D%E6%98%AF%E4%BF%9D%E8%AF%81%E6%AF%8F%E4%B8%AAmap%E5%A4%84%E7%90%86%E6%8E%A5%E8%BF%91128m%E7%9A%84%E6%96%87%E4%BB%B6%E5%9D%97%EF%BC%8C%E5%B0%B1%E9%AB%98%E6%9E%95%E6%97%A0%E5%BF%A7%E4%BA%86%EF%BC%9F\"><span class=\"toc-text\">3 ）是不是保证每个map处理接近128m的文件块，就高枕无忧了？</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%AD%94%E6%A1%88%E4%B9%9F%E6%98%AF%E4%B8%8D%E4%B8%80%E5%AE%9A%E3%80%82%E6%AF%94%E5%A6%82%E6%9C%89%E4%B8%80%E4%B8%AA127m%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E6%AD%A3%E5%B8%B8%E4%BC%9A%E7%94%A8%E4%B8%80%E4%B8%AAmap%E5%8E%BB%E5%AE%8C%E6%88%90%EF%BC%8C%E4%BD%86%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%8F%AA\"><span class=\"toc-text\">答案也是不一定。比如有一个127m的文件，正常会用一个map去完成，但这个文件只</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E4%B8%A4%E4%B8%AA%E5%B0%8F%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%8D%B4%E6%9C%89%E5%87%A0%E5%8D%83%E4%B8%87%E7%9A%84%E8%AE%B0%E5%BD%95%EF%BC%8C%E5%A6%82%E6%9E%9Cmap%E5%A4%84%E7%90%86%E7%9A%84%E9%80%BB%E8%BE%91%E6%AF%94%E8%BE%83%E5%A4%8D%E6%9D%82%EF%BC%8C%E7%94%A8%E4%B8%80%E4%B8%AAmap\"><span class=\"toc-text\">有一个或者两个小字段，却有几千万的记录，如果map处理的逻辑比较复杂，用一个map</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%BB%E5%8A%A1%E5%8E%BB%E5%81%9A%EF%BC%8C%E8%82%AF%E5%AE%9A%E4%B9%9F%E6%AF%94%E8%BE%83%E8%80%97%E6%97%B6%E3%80%82\"><span class=\"toc-text\">任务去做，肯定也比较耗时。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-66\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%92%88%E5%AF%B9%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%97%AE%E9%A2%98-2-%E5%92%8C-3-%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E9%87%87%E5%8F%96%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%9D%A5%E8%A7%A3%E5%86%B3%EF%BC%9A%E5%8D%B3%E5%87%8F%E5%B0%91map%E6%95%B0%E5%92%8C%E5%A2%9E%E5%8A%A0map%E6%95%B0%EF%BC%9B\"><span class=\"toc-text\">针对上面的问题 2 和 3 ，我们需要采取两种方式来解决：即减少map数和增加map数；</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-5-1-%E5%A4%8D%E6%9D%82%E6%96%87%E4%BB%B6%E5%A2%9E%E5%8A%A0-Map-%E6%95%B0\"><span class=\"toc-text\">10. 5 .1 复杂文件增加 Map 数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93input%E7%9A%84%E6%96%87%E4%BB%B6%E9%83%BD%E5%BE%88%E5%A4%A7%EF%BC%8C%E4%BB%BB%E5%8A%A1%E9%80%BB%E8%BE%91%E5%A4%8D%E6%9D%82%EF%BC%8Cmap%E6%89%A7%E8%A1%8C%E9%9D%9E%E5%B8%B8%E6%85%A2%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E5%A2%9E%E5%8A%A0Map%E6%95%B0%EF%BC%8C\"><span class=\"toc-text\">当input的文件都很大，任务逻辑复杂，map执行非常慢的时候，可以考虑增加Map数，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A5%E4%BD%BF%E5%BE%97%E6%AF%8F%E4%B8%AAmap%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E9%87%8F%E5%87%8F%E5%B0%91%EF%BC%8C%E4%BB%8E%E8%80%8C%E6%8F%90%E9%AB%98%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87%E3%80%82\"><span class=\"toc-text\">来使得每个map处理的数据量减少，从而提高任务的执行效率。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A2%9E%E5%8A%A0map%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%BA%EF%BC%9A%E6%A0%B9%E6%8D%AE\"><span class=\"toc-text\">增加map的方法为：根据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#computeSliteSize-Math-max-minSize-Math-min-maxSize-blocksize-x3D-blocksize-x3D-128M-%E5%85%AC%E5%BC%8F%EF%BC%8C\"><span class=\"toc-text\">computeSliteSize(Math.max(minSize,Math.min(maxSize,blocksize)))&#x3D;blocksize&#x3D;128M 公式，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%B0%83%E6%95%B4maxSize%E6%9C%80%E5%A4%A7%E5%80%BC%E3%80%82%E8%AE%A9maxSize%E6%9C%80%E5%A4%A7%E5%80%BC%E4%BD%8E%E4%BA%8Eblocksize%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0map%E7%9A%84%E4%B8%AA%E6%95%B0%E3%80%82\"><span class=\"toc-text\">调整maxSize最大值。让maxSize最大值低于blocksize就可以增加map的个数。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D%EF%BC%9A-2\"><span class=\"toc-text\">案例实操：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2\"><span class=\"toc-text\">1 ）执行查询</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E5%88%87%E7%89%87%E5%80%BC%E4%B8%BA-100-%E4%B8%AA%E5%AD%97%E8%8A%82\"><span class=\"toc-text\">2 ）设置最大切片值为 100 个字节</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-5-2-%E5%B0%8F%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6\"><span class=\"toc-text\">10. 5 .2 小文件进行合并</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%9C%A8map%E6%89%A7%E8%A1%8C%E5%89%8D%E5%90%88%E5%B9%B6%E5%B0%8F%E6%96%87%E4%BB%B6%EF%BC%8C%E5%87%8F%E5%B0%91map%E6%95%B0%EF%BC%9ACombineHiveInputFormat%E5%85%B7%E6%9C%89%E5%AF%B9%E5%B0%8F%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%90%88\"><span class=\"toc-text\">1 ）在map执行前合并小文件，减少map数：CombineHiveInputFormat具有对小文件进行合</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B9%B6%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%88%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%89%E3%80%82HiveInputFormat%E6%B2%A1%E6%9C%89%E5%AF%B9%E5%B0%8F%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6%E5%8A%9F%E8%83%BD%E3%80%82\"><span class=\"toc-text\">并的功能（系统默认的格式）。HiveInputFormat没有对小文件合并功能。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%9C%A8Map-Reduce%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9D%9F%E6%97%B6%E5%90%88%E5%B9%B6%E5%B0%8F%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%BE%E7%BD%AE%EF%BC%9A\"><span class=\"toc-text\">2 ）在Map-Reduce的任务结束时合并小文件的设置：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8map-only%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9D%9F%E6%97%B6%E5%90%88%E5%B9%B6%E5%B0%8F%E6%96%87%E4%BB%B6%EF%BC%8C%E9%BB%98%E8%AE%A4true\"><span class=\"toc-text\">在map-only任务结束时合并小文件，默认true</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8map-reduce%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9D%9F%E6%97%B6%E5%90%88%E5%B9%B6%E5%B0%8F%E6%96%87%E4%BB%B6%EF%BC%8C%E9%BB%98%E8%AE%A4false\"><span class=\"toc-text\">在map-reduce任务结束时合并小文件，默认false</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%90%88%E5%B9%B6%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E9%BB%98%E8%AE%A4256M\"><span class=\"toc-text\">合并文件的大小，默认256M</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E7%9A%84%E5%B9%B3%E5%9D%87%E5%A4%A7%E5%B0%8F%E5%B0%8F%E4%BA%8E%E8%AF%A5%E5%80%BC%E6%97%B6%EF%BC%8C%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84map-reduce%E4%BB%BB%E5%8A%A1%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6merge\"><span class=\"toc-text\">当输出文件的平均大小小于该值时，启动一个独立的map-reduce任务进行文件merge</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-5-3-%E5%90%88%E7%90%86%E8%AE%BE%E7%BD%AE-Reduce-%E6%95%B0\"><span class=\"toc-text\">10. 5 .3 合理设置 Reduce 数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%B0%83%E6%95%B4-reduce-%E4%B8%AA%E6%95%B0%E6%96%B9%E6%B3%95%E4%B8%80\"><span class=\"toc-text\">1 ）调整 reduce 个数方法一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%AF%8F%E4%B8%AAReduce%E5%A4%84%E7%90%86%E7%9A%84%E6%95%B0%E6%8D%AE%E9%87%8F%E9%BB%98%E8%AE%A4%E6%98%AF256MB\"><span class=\"toc-text\">（ 1 ）每个Reduce处理的数据量默认是256MB</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-67\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%AF%8F%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%9C%80%E5%A4%A7%E7%9A%84reduce%E6%95%B0%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA-1009\"><span class=\"toc-text\">（ 2 ）每个任务最大的reduce数，默认为 1009</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E8%AE%A1%E7%AE%97reducer%E6%95%B0%E7%9A%84%E5%85%AC%E5%BC%8F\"><span class=\"toc-text\">（ 3 ）计算reducer数的公式</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E8%B0%83%E6%95%B4-reduce-%E4%B8%AA%E6%95%B0%E6%96%B9%E6%B3%95%E4%BA%8C\"><span class=\"toc-text\">2 ）调整 reduce 个数方法二</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8hadoop%E7%9A%84mapred-default-xml%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9\"><span class=\"toc-text\">在hadoop的mapred-default.xml文件中修改</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E7%BD%AE%E6%AF%8F%E4%B8%AAjob%E7%9A%84Reduce%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">设置每个job的Reduce个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89-reduce-%E4%B8%AA%E6%95%B0%E5%B9%B6%E4%B8%8D%E6%98%AF%E8%B6%8A%E5%A4%9A%E8%B6%8A%E5%A5%BD\"><span class=\"toc-text\">3 ） reduce 个数并不是越多越好</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%BF%87%E5%A4%9A%E7%9A%84%E5%90%AF%E5%8A%A8%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96reduce%E4%B9%9F%E4%BC%9A%E6%B6%88%E8%80%97%E6%97%B6%E9%97%B4%E5%92%8C%E8%B5%84%E6%BA%90%EF%BC%9B\"><span class=\"toc-text\">（ 1 ）过多的启动和初始化reduce也会消耗时间和资源；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%8F%A6%E5%A4%96%EF%BC%8C%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AAreduce%EF%BC%8C%E5%B0%B1%E4%BC%9A%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AA%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%94%9F%E6%88%90%E4%BA%86%E5%BE%88%E5%A4%9A%E4%B8%AA%E5%B0%8F%E6%96%87%E4%BB%B6%EF%BC%8C%E9%82%A3\"><span class=\"toc-text\">（ 2 ）另外，有多少个reduce，就会有多少个输出文件，如果生成了很多个小文件，那</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B9%88%E5%A6%82%E6%9E%9C%E8%BF%99%E4%BA%9B%E5%B0%8F%E6%96%87%E4%BB%B6%E4%BD%9C%E4%B8%BA%E4%B8%8B%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%BE%93%E5%85%A5%EF%BC%8C%E5%88%99%E4%B9%9F%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%B0%8F%E6%96%87%E4%BB%B6%E8%BF%87%E5%A4%9A%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9B\"><span class=\"toc-text\">么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E8%AE%BE%E7%BD%AEreduce%E4%B8%AA%E6%95%B0%E7%9A%84%E6%97%B6%E5%80%99%E4%B9%9F%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%8E%9F%E5%88%99%EF%BC%9A%E5%A4%84%E7%90%86%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E5%88%A9%E7%94%A8%E5%90%88%E9%80%82%E7%9A%84reduce%E6%95%B0%EF%BC%9B\"><span class=\"toc-text\">在设置reduce个数的时候也需要考虑这两个原则：处理大数据量利用合适的reduce数；</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E5%8D%95%E4%B8%AAreduce%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8F%E5%A4%A7%E5%B0%8F%E8%A6%81%E5%90%88%E9%80%82%EF%BC%9B\"><span class=\"toc-text\">使单个reduce任务处理数据量大小要合适；</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-6-%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">10. 6 并行执行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E4%BC%9A%E5%B0%86%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E8%BD%AC%E5%8C%96%E6%88%90%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AA%E9%98%B6%E6%AE%B5%E3%80%82%E8%BF%99%E6%A0%B7%E7%9A%84%E9%98%B6%E6%AE%B5%E5%8F%AF%E4%BB%A5%E6%98%AFMapReduce%E9%98%B6%E6%AE%B5%E3%80%81%E6%8A%BD\"><span class=\"toc-text\">Hive会将一个查询转化成一个或者多个阶段。这样的阶段可以是MapReduce阶段、抽</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A0%B7%E9%98%B6%E6%AE%B5%E3%80%81%E5%90%88%E5%B9%B6%E9%98%B6%E6%AE%B5%E3%80%81limit%E9%98%B6%E6%AE%B5%E3%80%82%E6%88%96%E8%80%85Hive%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E7%9A%84%E5%85%B6%E4%BB%96%E9%98%B6%E6%AE%B5%E3%80%82%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C\"><span class=\"toc-text\">样阶段、合并阶段、limit阶段。或者Hive执行过程中可能需要的其他阶段。默认情况下，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E4%B8%80%E6%AC%A1%E5%8F%AA%E4%BC%9A%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%AA%E9%98%B6%E6%AE%B5%E3%80%82%E4%B8%8D%E8%BF%87%EF%BC%8C%E6%9F%90%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%9A%84job%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E4%BC%97%E5%A4%9A%E7%9A%84%E9%98%B6%E6%AE%B5%EF%BC%8C%E8%80%8C%E8%BF%99%E4%BA%9B%E9%98%B6%E6%AE%B5%E5%8F%AF%E8%83%BD\"><span class=\"toc-text\">Hive一次只会执行一个阶段。不过，某个特定的job可能包含众多的阶段，而这些阶段可能</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B9%B6%E9%9D%9E%E5%AE%8C%E5%85%A8%E4%BA%92%E7%9B%B8%E4%BE%9D%E8%B5%96%E7%9A%84%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%E6%9C%89%E4%BA%9B%E9%98%B6%E6%AE%B5%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E8%83%BD%E4%BD%BF%E5%BE%97%E6%95%B4%E4%B8%AAjob%E7%9A%84%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个job的执行</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%97%B4%E7%BC%A9%E7%9F%AD%E3%80%82%E4%B8%8D%E8%BF%87%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E6%9B%B4%E5%A4%9A%E7%9A%84%E9%98%B6%E6%AE%B5%E5%8F%AF%E4%BB%A5%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%EF%BC%8C%E9%82%A3%E4%B9%88job%E5%8F%AF%E8%83%BD%E5%B0%B1%E8%B6%8A%E5%BF%AB%E5%AE%8C%E6%88%90%E3%80%82\"><span class=\"toc-text\">时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%80%9A%E8%BF%87%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0hive-exec-parallel%E5%80%BC%E4%B8%BAtrue%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%90%AF%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E3%80%82%E4%B8%8D%E8%BF%87%EF%BC%8C%E5%9C%A8%E5%85%B1%E4%BA%AB%E9%9B%86%E7%BE%A4%E4%B8%AD%EF%BC%8C\"><span class=\"toc-text\">通过设置参数hive.exec.parallel值为true，就可以开启并发执行。不过，在共享集群中，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E4%B8%8B%EF%BC%8C%E5%A6%82%E6%9E%9Cjob%E4%B8%AD%E5%B9%B6%E8%A1%8C%E9%98%B6%E6%AE%B5%E5%A2%9E%E5%A4%9A%EF%BC%8C%E9%82%A3%E4%B9%88%E9%9B%86%E7%BE%A4%E5%88%A9%E7%94%A8%E7%8E%87%E5%B0%B1%E4%BC%9A%E5%A2%9E%E5%8A%A0%E3%80%82\"><span class=\"toc-text\">需要注意下，如果job中并行阶段增多，那么集群利用率就会增加。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BD%93%E7%84%B6%EF%BC%8C%E5%BE%97%E6%98%AF%E5%9C%A8%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%AF%94%E8%BE%83%E7%A9%BA%E9%97%B2%E7%9A%84%E6%97%B6%E5%80%99%E6%89%8D%E6%9C%89%E4%BC%98%E5%8A%BF%EF%BC%8C%E5%90%A6%E5%88%99%EF%BC%8C%E6%B2%A1%E8%B5%84%E6%BA%90%EF%BC%8C%E5%B9%B6%E8%A1%8C%E4%B9%9F%E8%B5%B7%E4%B8%8D%E6%9D%A5%E3%80%82\"><span class=\"toc-text\">当然，得是在系统资源比较空闲的时候才有优势，否则，没资源，并行也起不来。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-7-%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">10. 7 严格模式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Hive%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AE%BE%E7%BD%AE%E9%98%B2%E6%AD%A2%E4%B8%80%E4%BA%9B%E5%8D%B1%E9%99%A9%E6%93%8D%E4%BD%9C%EF%BC%9A\"><span class=\"toc-text\">Hive可以通过设置防止一些危险操作：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%88%86%E5%8C%BA%E8%A1%A8%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%88%86%E5%8C%BA%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">1 ）分区表不使用分区过滤</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86hive-strict-checks-no-partition-filter%E8%AE%BE%E7%BD%AE%E4%B8%BAtrue%E6%97%B6%EF%BC%8C%E5%AF%B9%E4%BA%8E%E5%88%86%E5%8C%BA%E8%A1%A8%EF%BC%8C%E9%99%A4%E9%9D%9Ewhere%E8%AF%AD%E5%8F%A5%E4%B8%AD%E5%90%AB\"><span class=\"toc-text\">将hive.strict.checks.no.partition.filter设置为true时，对于分区表，除非where语句中含</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%89%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6%E6%9D%A5%E9%99%90%E5%88%B6%E8%8C%83%E5%9B%B4%EF%BC%8C%E5%90%A6%E5%88%99%E4%B8%8D%E5%85%81%E8%AE%B8%E6%89%A7%E8%A1%8C%E3%80%82%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8C%E5%B0%B1%E6%98%AF%E7%94%A8%E6%88%B7%E4%B8%8D%E5%85%81%E8%AE%B8%E6%89%AB%E6%8F%8F%E6%89%80%E6%9C%89%E5%88%86\"><span class=\"toc-text\">有分区字段过滤条件来限制范围，否则不允许执行。换句话说，就是用户不允许扫描所有分</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-68\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8C%BA%E3%80%82%E8%BF%9B%E8%A1%8C%E8%BF%99%E4%B8%AA%E9%99%90%E5%88%B6%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%EF%BC%8C%E9%80%9A%E5%B8%B8%E5%88%86%E5%8C%BA%E8%A1%A8%E9%83%BD%E6%8B%A5%E6%9C%89%E9%9D%9E%E5%B8%B8%E5%A4%A7%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86%EF%BC%8C%E8%80%8C%E4%B8%94%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%8A%A0%E8%BF%85%E9%80%9F%E3%80%82%E6%B2%A1%E6%9C%89\"><span class=\"toc-text\">区。进行这个限制的原因是，通常分区表都拥有非常大的数据集，而且数据增加迅速。没有</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E8%A1%8C%E5%88%86%E5%8C%BA%E9%99%90%E5%88%B6%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%B6%88%E8%80%97%E4%BB%A4%E4%BA%BA%E4%B8%8D%E5%8F%AF%E6%8E%A5%E5%8F%97%E7%9A%84%E5%B7%A8%E5%A4%A7%E8%B5%84%E6%BA%90%E6%9D%A5%E5%A4%84%E7%90%86%E8%BF%99%E4%B8%AA%E8%A1%A8%E3%80%82\"><span class=\"toc-text\">进行分区限制的查询可能会消耗令人不可接受的巨大资源来处理这个表。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%BD%BF%E7%94%A8-order-by-%E6%B2%A1%E6%9C%89-limit-%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">2 ）使用 order by 没有 limit 过滤</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86hive-strict-checks-orderby-no-limit%E8%AE%BE%E7%BD%AE%E4%B8%BAtrue%E6%97%B6%EF%BC%8C%E5%AF%B9%E4%BA%8E%E4%BD%BF%E7%94%A8%E4%BA%86order-by%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%9F%A5%E8%AF%A2%EF%BC%8C%E8%A6%81\"><span class=\"toc-text\">将hive.strict.checks.orderby.no.limit设置为true时，对于使用了order by语句的查询，要</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B1%82%E5%BF%85%E9%A1%BB%E4%BD%BF%E7%94%A8limit%E8%AF%AD%E5%8F%A5%E3%80%82%E5%9B%A0%E4%B8%BAorder-by%E4%B8%BA%E4%BA%86%E6%89%A7%E8%A1%8C%E6%8E%92%E5%BA%8F%E8%BF%87%E7%A8%8B%E4%BC%9A%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%E7%BB%93%E6%9E%9C%E6%95%B0%E6%8D%AE%E5%88%86%E5%8F%91%E5%88%B0%E5%90%8C%E4%B8%80%E4%B8%AA\"><span class=\"toc-text\">求必须使用limit语句。因为order by为了执行排序过程会将所有的结果数据分发到同一个</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Reducer%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E5%BC%BA%E5%88%B6%E8%A6%81%E6%B1%82%E7%94%A8%E6%88%B7%E5%A2%9E%E5%8A%A0%E8%BF%99%E4%B8%AALIMIT%E8%AF%AD%E5%8F%A5%E5%8F%AF%E4%BB%A5%E9%98%B2%E6%AD%A2Reducer%E9%A2%9D%E5%A4%96%E6%89%A7%E8%A1%8C%E5%BE%88%E9%95%BF%E4%B8%80\"><span class=\"toc-text\">Reducer中进行处理，强制要求用户增加这个LIMIT语句可以防止Reducer额外执行很长一</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%AE%B5%E6%97%B6%E9%97%B4%E3%80%82\"><span class=\"toc-text\">段时间。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF\"><span class=\"toc-text\">3 ）笛卡尔积</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86hive-strict-checks-cartesian-product%E8%AE%BE%E7%BD%AE%E4%B8%BAtrue%E6%97%B6%EF%BC%8C%E4%BC%9A%E9%99%90%E5%88%B6%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E7%9A%84%E6%9F%A5%E8%AF%A2%E3%80%82%E5%AF%B9%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0\"><span class=\"toc-text\">将hive.strict.checks.cartesian.product设置为true时，会限制笛卡尔积的查询。对关系型数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8D%AE%E5%BA%93%E9%9D%9E%E5%B8%B8%E4%BA%86%E8%A7%A3%E7%9A%84%E7%94%A8%E6%88%B7%E5%8F%AF%E8%83%BD%E6%9C%9F%E6%9C%9B%E5%9C%A8-%E6%89%A7%E8%A1%8CJOIN%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%97%B6%E5%80%99%E4%B8%8D%E4%BD%BF%E7%94%A8ON%E8%AF%AD%E5%8F%A5%E8%80%8C%E6%98%AF%E4%BD%BF%E7%94%A8where%E8%AF%AD\"><span class=\"toc-text\">据库非常了解的用户可能期望在 执行JOIN查询的时候不使用ON语句而是使用where语</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%A5%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96%E5%99%A8%E5%B0%B1%E5%8F%AF%E4%BB%A5%E9%AB%98%E6%95%88%E5%9C%B0%E5%B0%86WHERE%E8%AF%AD%E5%8F%A5%E8%BD%AC%E5%8C%96%E6%88%90%E9%82%A3%E4%B8%AAON%E8%AF%AD%E5%8F%A5%E3%80%82%E4%B8%8D%E5%B9%B8\"><span class=\"toc-text\">句，这样关系数据库的执行优化器就可以高效地将WHERE语句转化成那个ON语句。不幸</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%9A%84%E6%98%AF%EF%BC%8CHive%E5%B9%B6%E4%B8%8D%E4%BC%9A%E6%89%A7%E8%A1%8C%E8%BF%99%E7%A7%8D%E4%BC%98%E5%8C%96%EF%BC%8C%E5%9B%A0%E6%AD%A4%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%A1%A8%E8%B6%B3%E5%A4%9F%E5%A4%A7%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AA%E6%9F%A5%E8%AF%A2%E5%B0%B1%E4%BC%9A%E5%87%BA%E7%8E%B0%E4%B8%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%83%85\"><span class=\"toc-text\">的是，Hive并不会执行这种优化，因此，如果表足够大，那么这个查询就会出现不可控的情</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%B5%E3%80%82\"><span class=\"toc-text\">况。</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-8-JVM-%E9%87%8D%E7%94%A8\"><span class=\"toc-text\">10. 8 JVM 重用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%81hadoop%E4%BC%98%E5%8C%96%E6%96%87%E6%A1%A3%E4%B8%ADjvm%E9%87%8D%E7%94%A8\"><span class=\"toc-text\">详见hadoop优化文档中jvm重用</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#10-9-%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">10. 9 压缩</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%81%E7%AC%AC-9-%E7%AB%A0%E3%80%82\"><span class=\"toc-text\">详见第 9 章。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC-11-%E7%AB%A0-Hive%E5%AE%9E%E6%88%98\"><span class=\"toc-text\">第 11 章 Hive实战</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-1-%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">11 .1 需求描述</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%9F%E8%AE%A1%E7%A1%85%E8%B0%B7%E5%BD%B1%E9%9F%B3%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99%E7%9A%84%E5%B8%B8%E8%A7%84%E6%8C%87%E6%A0%87%EF%BC%8C%E5%90%84%E7%A7%8DTopN%E6%8C%87%E6%A0%87%EF%BC%9A\"><span class=\"toc-text\">统计硅谷影音视频网站的常规指标，各种TopN指标：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0Top-10\"><span class=\"toc-text\">– 统计视频观看数Top 10</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E7%B1%BB%E5%88%AB%E7%83%AD%E5%BA%A6Top-10\"><span class=\"toc-text\">– 统计视频类别热度Top 10</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E5%87%BA%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0%E6%9C%80%E9%AB%98%E7%9A%84-20-%E4%B8%AA%E8%A7%86%E9%A2%91%E7%9A%84%E6%89%80%E5%B1%9E%E7%B1%BB%E5%88%AB%E4%BB%A5%E5%8F%8A%E7%B1%BB%E5%88%AB%E5%8C%85%E5%90%ABTop20%E8%A7%86%E9%A2%91%E7%9A%84%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">– 统计出视频观看数最高的 20 个视频的所属类别以及类别包含Top20视频的个数</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0Top-50-%E6%89%80%E5%85%B3%E8%81%94%E8%A7%86%E9%A2%91%E7%9A%84%E6%89%80%E5%B1%9E%E7%B1%BB%E5%88%AB%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">– 统计视频观看数Top 50 所关联视频的所属类别排序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E7%B1%BB%E5%88%AB%E4%B8%AD%E7%9A%84%E8%A7%86%E9%A2%91%E7%83%AD%E5%BA%A6Top10-%E4%BB%A5Music%E4%B8%BA%E4%BE%8B\"><span class=\"toc-text\">– 统计每个类别中的视频热度Top10,以Music为例</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%93-%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E7%B1%BB%E5%88%AB%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0Top-10\"><span class=\"toc-text\">– 统计每个类别视频观看数Top 10</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-69\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">11 .2 数据结构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%A7%86%E9%A2%91%E8%A1%A8\"><span class=\"toc-text\">1 ）视频表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%86%E9%A2%91%E8%A1%A8\"><span class=\"toc-text\">视频表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E7%94%A8%E6%88%B7%E8%A1%A8\"><span class=\"toc-text\">2 ）用户表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E8%A1%A8\"><span class=\"toc-text\">用户表</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-3-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">11 .3 准备工作</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-3-1-%E5%87%86%E5%A4%87%E8%A1%A8\"><span class=\"toc-text\">11 .3. 1 准备表</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%E7%9A%84%E8%A1%A8\"><span class=\"toc-text\">1 ）需要准备的表</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%9Agulivideo-ori%EF%BC%8Cgulivideo-user-ori%EF%BC%8C\"><span class=\"toc-text\">创建原始数据表：gulivideo_ori，gulivideo_user_ori，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E6%9C%80%E7%BB%88%E8%A1%A8%EF%BC%9Agulivideo-orc%EF%BC%8Cgulivideo-user-orc\"><span class=\"toc-text\">创建最终表：gulivideo_orc，gulivideo_user_orc</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%9A\"><span class=\"toc-text\">2 ）创建原始数据表：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89gulivideo-ori\"><span class=\"toc-text\">（ 1 ）gulivideo_ori</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-70\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E8%A1%A8-gulivideo-user-ori\"><span class=\"toc-text\">（ 2 ）创建原始数据表: gulivideo_user_ori</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-%E5%88%9B%E5%BB%BA-orc-%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E5%B8%A6-snappy-%E5%8E%8B%E7%BC%A9%E7%9A%84%E8%A1%A8%EF%BC%9A\"><span class=\"toc-text\">2 ） 创建 orc 存储格式带 snappy 压缩的表：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89gulivideo-orc\"><span class=\"toc-text\">（ 1 ）gulivideo_orc</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89gulivideo-user-orc\"><span class=\"toc-text\">（ 2 ）gulivideo_user_orc</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%90%91ori%E8%A1%A8%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 3 ）向ori表插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E5%90%91orc%E8%A1%A8%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">（ 4 ）向orc表插入数据</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-71\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-3-2-%E5%AE%89%E8%A3%85-Tez-%E5%BC%95%E6%93%8E%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89\"><span class=\"toc-text\">11.3. 2 安装 Tez 引擎（了解）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Tez%E6%98%AF%E4%B8%80%E4%B8%AAHive%E7%9A%84%E8%BF%90%E8%A1%8C%E5%BC%95%E6%93%8E%EF%BC%8C%E6%80%A7%E8%83%BD%E4%BC%98%E4%BA%8EMR%E3%80%82%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%98%E4%BA%8EMR%E5%91%A2%EF%BC%9F%E7%9C%8B%E4%B8%8B%E3%80%82\"><span class=\"toc-text\">Tez是一个Hive的运行引擎，性能优于MR。为什么优于MR呢？看下。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%94%A8Hive%E7%9B%B4%E6%8E%A5%E7%BC%96%E5%86%99MR%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%81%87%E8%AE%BE%E6%9C%89%E5%9B%9B%E4%B8%AA%E6%9C%89%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E7%9A%84MR%E4%BD%9C%E4%B8%9A%EF%BC%8C%E4%B8%8A%E5%9B%BE%E4%B8%AD%EF%BC%8C%E7%BB%BF%E8%89%B2%E6%98%AFReduce\"><span class=\"toc-text\">用Hive直接编写MR程序，假设有四个有依赖关系的MR作业，上图中，绿色是Reduce</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Task%EF%BC%8C%E4%BA%91%E7%8A%B6%E8%A1%A8%E7%A4%BA%E5%86%99%E5%B1%8F%E8%94%BD%EF%BC%8C%E9%9C%80%E8%A6%81%E5%B0%86%E4%B8%AD%E9%97%B4%E7%BB%93%E6%9E%9C%E6%8C%81%E4%B9%85%E5%8C%96%E5%86%99%E5%88%B0HDFS%E3%80%82\"><span class=\"toc-text\">Task，云状表示写屏蔽，需要将中间结果持久化写到HDFS。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#Tez%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%9C%89%E4%BE%9D%E8%B5%96%E7%9A%84%E4%BD%9C%E4%B8%9A%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%B8%80%E4%B8%AA%E4%BD%9C%E4%B8%9A%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AA%E9%9C%80%E5%86%99%E4%B8%80%E6%AC%A1HDFS%EF%BC%8C%E4%B8%94%E4%B8%AD%E9%97%B4%E8%8A%82%E7%82%B9%E8%BE%83%E5%B0%91%EF%BC%8C\"><span class=\"toc-text\">Tez可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%8E%E8%80%8C%E5%A4%A7%E5%A4%A7%E6%8F%90%E5%8D%87%E4%BD%9C%E4%B8%9A%E7%9A%84%E8%AE%A1%E7%AE%97%E6%80%A7%E8%83%BD%E3%80%82\"><span class=\"toc-text\">从而大大提升作业的计算性能。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E5%B0%86-tez-%E5%AE%89%E8%A3%85%E5%8C%85%E6%8B%B7%E8%B4%9D%E5%88%B0%E9%9B%86%E7%BE%A4%EF%BC%8C%E5%B9%B6%E8%A7%A3%E5%8E%8B-tar-%E5%8C%85\"><span class=\"toc-text\">1 ）将 tez 安装包拷贝到集群，并解压 tar 包</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89%E4%B8%8A%E4%BC%A0-tez-%E4%BE%9D%E8%B5%96%E5%88%B0-HDFS\"><span class=\"toc-text\">2 ）上传 tez 依赖到 HDFS</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E6%96%B0%E5%BB%BA-tez-site-xml\"><span class=\"toc-text\">3 ）新建 tez-site.xml</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%9A\"><span class=\"toc-text\">添加如下内容：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-72\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E4%BF%AE%E6%94%B9-Hadoop-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">4 ）修改 Hadoop 环境变量</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0Tez%E7%9A%84Jar%E5%8C%85%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">添加Tez的Jar包相关信息</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E4%BF%AE%E6%94%B9-Hive-%E7%9A%84%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E\"><span class=\"toc-text\">5 ）修改 Hive 的计算引擎</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0\"><span class=\"toc-text\">添加</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89%E8%A7%A3%E5%86%B3%E6%97%A5%E5%BF%97-Jar-%E5%8C%85%E5%86%B2%E7%AA%81-1\"><span class=\"toc-text\">6 ）解决日志 Jar 包冲突</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90\"><span class=\"toc-text\">11 .4 业务分析</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-1-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0-Top10\"><span class=\"toc-text\">11 .4.1 统计视频观看数 Top10</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%EF%BC%9A%E4%BD%BF%E7%94%A8order-by%E6%8C%89%E7%85%A7views%E5%AD%97%E6%AE%B5%E5%81%9A%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%90%8C%E6%97%B6%E6%88%91%E4%BB%AC%E8%AE%BE%E7%BD%AE%E5%8F%AA%E6%98%BE%E7%A4%BA%E5%89%8D-10\"><span class=\"toc-text\">思路：使用order by按照views字段做一个全局排序即可，同时我们设置只显示前 10</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E3%80%82\"><span class=\"toc-text\">条。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">最终代码：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-73\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-2-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E7%B1%BB%E5%88%AB%E7%83%AD%E5%BA%A6-Top10\"><span class=\"toc-text\">11 .4.2 统计视频类别热度 Top10</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%EF%BC%9A\"><span class=\"toc-text\">思路：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%8D%B3%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E7%B1%BB%E5%88%AB%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AA%E8%A7%86%E9%A2%91%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%87%BA%E5%8C%85%E5%90%AB%E8%A7%86%E9%A2%91%E6%9C%80%E5%A4%9A%E7%9A%84%E5%89%8D-10-%E4%B8%AA%E7%B1%BB%E5%88%AB%E3%80%82\"><span class=\"toc-text\">（ 1 ）即统计每个类别有多少个视频，显示出包含视频最多的前 10 个类别。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E6%8C%89%E7%85%A7%E7%B1%BB%E5%88%ABgroup-by%E8%81%9A%E5%90%88%EF%BC%8C%E7%84%B6%E5%90%8Ecount%E7%BB%84%E5%86%85%E7%9A%84videoId%E4%B8%AA%E6%95%B0%E5%8D%B3%E5%8F%AF%E3%80%82\"><span class=\"toc-text\">（ 2 ）我们需要按照类别group by聚合，然后count组内的videoId个数即可。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E5%9B%A0%E4%B8%BA%E5%BD%93%E5%89%8D%E8%A1%A8%E7%BB%93%E6%9E%84%E4%B8%BA%EF%BC%9A%E4%B8%80%E4%B8%AA%E8%A7%86%E9%A2%91%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E7%B1%BB%E5%88%AB%E3%80%82%E6%89%80%E4%BB%A5%E5%A6%82%E6%9E%9C%E8%A6%81group-by%E7%B1%BB%E5%88%AB%EF%BC%8C\"><span class=\"toc-text\">（ 3 ）因为当前表结构为：一个视频对应一个或多个类别。所以如果要group by类别，</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%9C%80%E8%A6%81%E5%85%88%E5%B0%86%E7%B1%BB%E5%88%AB%E8%BF%9B%E8%A1%8C%E5%88%97%E8%BD%AC%E8%A1%8C-%E5%B1%95%E5%BC%80-%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E8%BF%9B%E8%A1%8Ccount%E5%8D%B3%E5%8F%AF%E3%80%82\"><span class=\"toc-text\">需要先将类别进行列转行(展开)，然后再进行count即可。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-4-%EF%BC%89%E6%9C%80%E5%90%8E%E6%8C%89%E7%85%A7%E7%83%AD%E5%BA%A6%E6%8E%92%E5%BA%8F%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%89%8D-10-%E6%9D%A1%E3%80%82\"><span class=\"toc-text\">（ 4 ）最后按照热度排序，显示前 10 条。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81%EF%BC%9A-1\"><span class=\"toc-text\">最终代码：</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-3-%E7%BB%9F%E8%AE%A1%E5%87%BA%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0%E6%9C%80%E9%AB%98%E7%9A%84-20-%E4%B8%AA%E8%A7%86%E9%A2%91%E7%9A%84%E6%89%80%E5%B1%9E%E7%B1%BB%E5%88%AB%E4%BB%A5%E5%8F%8A%E7%B1%BB%E5%88%AB%E5%8C%85%E5%90%AB\"><span class=\"toc-text\">11 .4.3 统计出视频观看数最高的 20 个视频的所属类别以及类别包含</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Top20-%E8%A7%86%E9%A2%91%E7%9A%84%E4%B8%AA%E6%95%B0\"><span class=\"toc-text\">Top20 视频的个数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%EF%BC%9A-1\"><span class=\"toc-text\">思路：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%85%88%E6%89%BE%E5%88%B0%E8%A7%82%E7%9C%8B%E6%95%B0%E6%9C%80%E9%AB%98%E7%9A%84-20-%E4%B8%AA%E8%A7%86%E9%A2%91%E6%89%80%E5%B1%9E%E6%9D%A1%E7%9B%AE%E7%9A%84%E6%89%80%E6%9C%89%E4%BF%A1%E6%81%AF%EF%BC%8C%E9%99%8D%E5%BA%8F%E6%8E%92%E5%88%97\"><span class=\"toc-text\">（ 1 ）先找到观看数最高的 20 个视频所属条目的所有信息，降序排列</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E6%8A%8A%E8%BF%99-20-%E6%9D%A1%E4%BF%A1%E6%81%AF%E4%B8%AD%E7%9A%84category%E5%88%86%E8%A3%82%E5%87%BA%E6%9D%A5-%E5%88%97%E8%BD%AC%E8%A1%8C\"><span class=\"toc-text\">（ 2 ）把这 20 条信息中的category分裂出来(列转行)</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E6%9C%80%E5%90%8E%E6%9F%A5%E8%AF%A2%E8%A7%86%E9%A2%91%E5%88%86%E7%B1%BB%E5%90%8D%E7%A7%B0%E5%92%8C%E8%AF%A5%E5%88%86%E7%B1%BB%E4%B8%8B%E6%9C%89%E5%A4%9A%E5%B0%91%E4%B8%AATop20%E7%9A%84%E8%A7%86%E9%A2%91\"><span class=\"toc-text\">（ 3 ）最后查询视频分类名称和该分类下有多少个Top20的视频</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81%EF%BC%9A-2\"><span class=\"toc-text\">最终代码：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-74\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-4-%E7%BB%9F%E8%AE%A1%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0-Top50-%E6%89%80%E5%85%B3%E8%81%94%E8%A7%86%E9%A2%91%E7%9A%84%E6%89%80%E5%B1%9E%E7%B1%BB%E5%88%AB%E6%8E%92%E5%BA%8F\"><span class=\"toc-text\">11 .4.4 统计视频观看数 Top50 所关联视频的所属类别排序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">代码：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-75\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-5-%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E7%B1%BB%E5%88%AB%E4%B8%AD%E7%9A%84%E8%A7%86%E9%A2%91%E7%83%AD%E5%BA%A6-Top10-%EF%BC%8C%E4%BB%A5-Music-%E4%B8%BA%E4%BE%8B\"><span class=\"toc-text\">11 .4.5 统计每个类别中的视频热度 Top10 ，以 Music 为例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%EF%BC%9A-2\"><span class=\"toc-text\">思路：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E8%A6%81%E6%83%B3%E7%BB%9F%E8%AE%A1Music%E7%B1%BB%E5%88%AB%E4%B8%AD%E7%9A%84%E8%A7%86%E9%A2%91%E7%83%AD%E5%BA%A6Top-10-%EF%BC%8C%E9%9C%80%E8%A6%81%E5%85%88%E6%89%BE%E5%88%B0Music%E7%B1%BB%E5%88%AB%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E9%9C%80%E8%A6%81%E5%B0%86\"><span class=\"toc-text\">（ 1 ）要想统计Music类别中的视频热度Top 10 ，需要先找到Music类别，那么就需要将</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#category%E5%B1%95%E5%BC%80%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E8%A1%A8%E7%94%A8%E4%BA%8E%E5%AD%98%E6%94%BEcategoryId%E5%B1%95%E5%BC%80%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">category展开，所以可以创建一张表用于存放categoryId展开的数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%90%91category%E5%B1%95%E5%BC%80%E7%9A%84%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E3%80%82\"><span class=\"toc-text\">（ 2 ）向category展开的表中插入数据。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-3-%EF%BC%89%E7%BB%9F%E8%AE%A1%E5%AF%B9%E5%BA%94%E7%B1%BB%E5%88%AB%EF%BC%88Music%EF%BC%89%E4%B8%AD%E7%9A%84%E8%A7%86%E9%A2%91%E7%83%AD%E5%BA%A6%E3%80%82\"><span class=\"toc-text\">（ 3 ）统计对应类别（Music）中的视频热度。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%BB%9F%E8%AE%A1Music%E7%B1%BB%E5%88%AB%E7%9A%84Top-10-%EF%BC%88%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%BB%9F%E8%AE%A1%E5%85%B6%E4%BB%96%EF%BC%89\"><span class=\"toc-text\">统计Music类别的Top 10 （也可以统计其他）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#11-4-6-%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E7%B1%BB%E5%88%AB%E8%A7%86%E9%A2%91%E8%A7%82%E7%9C%8B%E6%95%B0-Top10\"><span class=\"toc-text\">11 .4.6 统计每个类别视频观看数 Top10</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81%EF%BC%9A-3\"><span class=\"toc-text\">最终代码：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-76\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-4-7-%E7%BB%9F%E8%AE%A1%E4%B8%8A%E4%BC%A0%E8%A7%86%E9%A2%91%E6%9C%80%E5%A4%9A%E7%9A%84%E7%94%A8%E6%88%B7-Top-10-%E4%BB%A5%E5%8F%8A%E4%BB%96%E4%BB%AC%E4%B8%8A%E4%BC%A0%E7%9A%84%E8%A7%86%E9%A2%91\"><span class=\"toc-text\">11 .4.7 统计上传视频最多的用户 Top 10 以及他们上传的视频</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A7%82%E7%9C%8B%E6%AC%A1%E6%95%B0%E5%9C%A8%E5%89%8D-20-%E7%9A%84%E8%A7%86%E9%A2%91\"><span class=\"toc-text\">观看次数在前 20 的视频</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF%EF%BC%9A-3\"><span class=\"toc-text\">思路：</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E6%B1%82%E5%87%BA%E4%B8%8A%E4%BC%A0%E8%A7%86%E9%A2%91%E6%9C%80%E5%A4%9A%E7%9A%84-10-%E4%B8%AA%E7%94%A8%E6%88%B7\"><span class=\"toc-text\">（ 1 ）求出上传视频最多的 10 个用户</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E5%85%B3%E8%81%94gulivideo-orc%E8%A1%A8%EF%BC%8C%E6%B1%82%E5%87%BA%E8%BF%99-10-%E4%B8%AA%E7%94%A8%E6%88%B7%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%89%80%E6%9C%89%E7%9A%84%E8%A7%86%E9%A2%91%EF%BC%8C%E6%8C%89%E7%85%A7%E8%A7%82%E7%9C%8B%E6%95%B0%E5%8F%96%E5%89%8D-20\"><span class=\"toc-text\">（ 2 ）关联gulivideo_orc表，求出这 10 个用户上传的所有的视频，按照观看数取前 20</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">最终代码:</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-77\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%99%84%E5%BD%95%EF%BC%9A%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">附录：常见错误及解决方案</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#0-%EF%BC%89-%E5%A6%82%E6%9E%9C%E6%9B%B4%E6%8D%A2-Tez-%E5%BC%95%E6%93%8E%E5%90%8E%EF%BC%8C%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1%E5%8D%A1%E4%BD%8F%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%9D%E8%AF%95%E8%B0%83%E8%8A%82%E5%AE%B9%E9%87%8F%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">0 ） 如果更换 Tez 引擎后，执行任务卡住，可以尝试调节容量调度器的资源调度策略</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B0%86-HADOOP-HOME-x2F-etc-x2F-hadoop-x2F-capacity-scheduler-xml%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84\"><span class=\"toc-text\">将$HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;capacity-scheduler.xml文件中的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%94%B9%E6%88%90\"><span class=\"toc-text\">改成</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1-%EF%BC%89%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8A-mysql-%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">1 ）连接不上 mysql 数据库</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-1-%EF%BC%89%E5%AF%BC%E9%94%99%E9%A9%B1%E5%8A%A8%E5%8C%85%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%8A%8Amysql-connector-java-5-1-27-bin-jar%E5%AF%BC%E5%85%A5-x2F-opt-x2F-module-x2F-hive-x2F-lib%E7%9A%84\"><span class=\"toc-text\">（ 1 ）导错驱动包，应该把mysql-connector-java-5.1.27-bin.jar导入&#x2F;opt&#x2F;module&#x2F;hive&#x2F;lib的</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8D%E6%98%AF%E8%BF%99%E4%B8%AA%E5%8C%85%E3%80%82%E9%94%99%E6%8A%8Amysql-connector-java-5-1-27-tar-gz%E5%AF%BC%E5%85%A5hive-x2F-lib%E5%8C%85%E4%B8%8B%E3%80%82\"><span class=\"toc-text\">不是这个包。错把mysql-connector-java-5.1.27.tar.gz导入hive&#x2F;lib包下。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%EF%BC%88-2-%EF%BC%89%E4%BF%AE%E6%94%B9user%E8%A1%A8%E4%B8%AD%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%A7%B0%E6%B2%A1%E6%9C%89%E9%83%BD%E4%BF%AE%E6%94%B9%E4%B8%BA-%EF%BC%8C%E8%80%8C%E6%98%AF%E4%BF%AE%E6%94%B9%E4%B8%BAlocalhost\"><span class=\"toc-text\">（ 2 ）修改user表中的主机名称没有都修改为%，而是修改为localhost</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2-%EF%BC%89-hive-%E9%BB%98%E8%AE%A4%E7%9A%84%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E6%98%AF-CombineHiveInputFormat-%EF%BC%8C%E4%BC%9A%E5%AF%B9%E5%B0%8F%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%E3%80%82\"><span class=\"toc-text\">2 ） hive 默认的输入格式处理是 CombineHiveInputFormat ，会对小文件进行合并。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E4%BB%A5%E9%87%87%E7%94%A8HiveInputFormat%E5%B0%B1%E4%BC%9A%E6%A0%B9%E6%8D%AE%E5%88%86%E5%8C%BA%E6%95%B0%E8%BE%93%E5%87%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E6%96%87%E4%BB%B6%E3%80%82\"><span class=\"toc-text\">可以采用HiveInputFormat就会根据分区数输出相应的文件。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3-%EF%BC%89%E4%B8%8D%E8%83%BD%E6%89%A7%E8%A1%8C-mapreduce-%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">3 ）不能执行 mapreduce 程序</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%83%BD%E6%98%AFhadoop%E7%9A%84yarn%E6%B2%A1%E5%BC%80%E5%90%AF%E3%80%82\"><span class=\"toc-text\">可能是hadoop的yarn没开启。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4-%EF%BC%89%E5%90%AF%E5%8A%A8-mysql-%E6%9C%8D%E5%8A%A1%E6%97%B6%EF%BC%8C%E6%8A%A5-MySQL-server-PID-file-could-not-be-found-%E5%BC%82%E5%B8%B8%E3%80%82\"><span class=\"toc-text\">4 ）启动 mysql 服务时，报 MySQL server PID file could not be found! 异常。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8-x2F-var-x2F-lock-x2F-subsys-x2F-mysql%E8%B7%AF%E5%BE%84%E4%B8%8B%E5%88%9B%E5%BB%BAhadoop102-pid%EF%BC%8C%E5%B9%B6%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%86%85%E5%AE%B9%EF%BC%9A-4396\"><span class=\"toc-text\">在&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql路径下创建hadoop102.pid，并在文件中添加内容： 4396</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5-%EF%BC%89%E6%8A%A5-service-mysql-status-MySQL-is-not-running-but-lock-file-x2F-var-x2F-lock-x2F-subsys-x2F-mysql-%E5%A4%B1%E8%B4%A5-%E5%BC%82\"><span class=\"toc-text\">5 ）报 service mysql status MySQL is not running, but lock file (&#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql[ 失败 ]) 异</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E3%80%82\"><span class=\"toc-text\">常。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94-78\"><span class=\"toc-text\">—————————————————————————————————————</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E5%9C%A8-x2F-var-x2F-lib-x2F-mysql-%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BA%EF%BC%9A-rw-rw%E2%80%94-1-mysql-mysql-5-12%E6%9C%88-22\"><span class=\"toc-text\">解决方案：在&#x2F;var&#x2F;lib&#x2F;mysql 目录下创建： - rw-rw—-. 1 mysql mysql 5 12月 22</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#16-41-hadoop102-pid-%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E4%B8%BA-777-%E3%80%82\"><span class=\"toc-text\">16:41 hadoop102.pid 文件，并修改权限为 777 。</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#6-%EF%BC%89-JVM-%E5%A0%86%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA\"><span class=\"toc-text\">6 ） JVM 堆内存溢出</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8F%8F%E8%BF%B0%EF%BC%9Ajava-lang-OutOfMemoryError-Java-heap-space\"><span class=\"toc-text\">描述：java.lang.OutOfMemoryError: Java heap space</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%EF%BC%9A%E5%9C%A8yarn-site-xml%E4%B8%AD%E5%8A%A0%E5%85%A5%E5%A6%82%E4%B8%8B%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">解决：在yarn-site.xml中加入如下代码</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#7-%EF%BC%89%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E9%99%90%E5%88%B6\"><span class=\"toc-text\">7 ）虚拟内存限制</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%9C%A8yarn-site-xml%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">在yarn-site.xml中添加如下配置:</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\"><span class=\"toc-text\"></span></a></li></ol>","author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Java","uid":"dc3ddb3c3e294cfbfa2182d222982083","slug":"java","date":"2022-03-31T13:03:51.091Z","updated":"2022-03-29T12:04:42.063Z","comments":true,"path":"api/articles/java.json","keywords":null,"cover":[],"text":"写在前面第一章 开发前言1.1 Java语言概述什么是JavaSun公司（Stanford University Netword）、高级编程语言 发展史Java可以做什么 网站 电商 快递 … 大数据（Hadoop） 1.2计算机基础知识二进制 字节cmd+notepad：打开一...","link":"","photos":[],"count_time":{"symbolsCount":838,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"java","slug":"java","count":2,"path":"api/tags/java.json"}],"author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"flume","uid":"668b17fd878754e2652b25e78c8ab4f7","slug":"flume","date":"2022-03-31T13:03:51.085Z","updated":"2022-03-29T11:58:03.838Z","comments":true,"path":"api/articles/flume.json","keywords":null,"cover":[],"text":"我们不生产数据我们只是数据的搬运工 yum的配置三种source exec：不支持断点续传 spoolingdirector：不支持动态更新 taildirsource：解决上述两点，存在的问题重复上传&#x3D;&gt;不能更名，如果非要更名，只有改源码 改源码 tailfil...","link":"","photos":[],"count_time":{"symbolsCount":"6.6k","symbolsTime":"6 mins."},"categories":[],"tags":[],"author":{"name":"Cencus","slug":"blog-author","avatar":"https://gitee.com/cencus/blog-image/raw/master/blogImage/1648381409561.jpg","link":"/","description":"stay hungry, stay foolish.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}